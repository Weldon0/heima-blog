import{_ as n}from"./plugin-vue_export-helper.21dcd24c.js";import{e as s}from"./app.5281c868.js";const a={},e=s(`<h2 id="\u4E00-\u524D\u8A00" tabindex="-1"><a class="header-anchor" href="#\u4E00-\u524D\u8A00" aria-hidden="true">#</a> \u4E00 \u524D\u8A00</h2><p>\u672C\u7AE0\u8282\u5C06\u7EE7\u7EED\u4ECB\u7ECD React \u7684\u53E6\u5916\u4E00\u4E2A\u72B6\u6001\u7BA1\u7406\u5DE5\u5177 React-Mobx \u3002\u5E0C\u671B\u901A\u8FC7\u672C\u7AE0\u8282\u7684\u5B66\u4E60\uFF0C\u4F60\u80FD\u6536\u83B7\uFF1A</p><ul><li>Mobx \u7684\u7279\u6027\u53CA\u5176\u57FA\u672C\u4F7F\u7528\uFF1B</li><li>Mobx \uFF0CReact-Mobx \u539F\u7406\u89E3\u6790\uFF08\u6E90\u7801\u7EA7\u522B\uFF09\uFF1B</li><li>Mobx \u548C Redux \u533A\u522B\u3002</li></ul><blockquote><p>\u6CE8\u610F\uFF1A\u4ECA\u5929\u8BB2\u7684 Mobx \u4E3A <code>v6</code> \u7248\u672C\uFF0CMobx-React \u4E3A <code>v7</code> \u7248\u672C\u3002</p></blockquote><h2 id="\u4E8C-mobx\u7279\u6027" tabindex="-1"><a class="header-anchor" href="#\u4E8C-mobx\u7279\u6027" aria-hidden="true">#</a> \u4E8C Mobx\u7279\u6027</h2><p>\u540C\u4E3A\u72B6\u6001\u7BA1\u7406\u5DE5\u5177\uFF0CMobx \u548C Redux \u672C\u8D28\u4E0A\u4E0A\u6709\u5F88\u5927\u7684\u533A\u522B\uFF0C\u4F46\u662F Mobx \u548C Redux \u90FD\u662F\u72EC\u7ACB\u7684\uFF0C\u4E0D\u4F9D\u8D56\u4E8E React \u672C\u8EAB\uFF1B\u4E3A\u4E86\u628A React \u548C Mobx \u5173\u8054\u8D77\u6765\uFF0C\u5728 React \u5E94\u7528\u4E2D\u66F4\u597D\u7684\u4F7F\u7528 Mobx \uFF0C\u51FA\u73B0\u4E86 mobx-react \uFF0C mobx-react \u63D0\u4F9B\u4E86 HOC \uFF0C\u53EF\u4EE5\u83B7\u53D6\u72B6\u6001\u7BA1\u7406 Mobx \u7684\u6570\u636E\u5C42\uFF0C\u4E5F\u80FD\u63A5\u53D7 mobx \u6570\u636E\u6539\u53D8\u5E26\u6765\u7684\u66F4\u65B0\u3002</p><p><strong>\u2460\u89C2\u5BDF\u8005\u6A21\u5F0F</strong></p><p>Mobx \u91C7\u7528\u4E86\u4E00\u79CD&#39;\u89C2\u5BDF\u8005\u6A21\u5F0F&#39;\u2014\u2014<code>Observer</code>\uFF0C\u6574\u4E2A\u8BBE\u8BA1\u67B6\u6784\u90FD\u662F\u56F4\u7ED5 Observer \u5C55\u5F00\uFF1A</p><ul><li>\u5728 mobx \u7684\u72B6\u6001\u5C42\uFF0C\u6BCF\u4E00\u4E2A\u9700\u8981\u89C2\u5BDF\u7684\u5C5E\u6027\u90FD\u4F1A\u6DFB\u52A0\u4E00\u4E2A\u89C2\u5BDF\u8005\uFF0C\u53EF\u4EE5\u79F0\u4E4B\u4E3A <code>ObserverValue</code> \u3002</li><li>\u6709\u4E86\u89C2\u5BDF\u8005\uFF0C\u90A3\u4E48\u5C31\u9700\u8981\u5411\u89C2\u5BDF\u8005\u4E2D\u6536\u96C6 listener \uFF0Cmobx \u4E2D\u6709\u4E00\u4E2A Reaction \u6A21\u5757\uFF0C\u53EF\u4EE5\u5BF9\u4E00\u4E9B\u884C\u4E3A\u505A\u4F9D\u8D56\u6536\u96C6\uFF0C\u5728 React \u4E2D\uFF0C\u662F\u901A\u8FC7\u52AB\u6301 render \u51FD\u6570\u6267\u884C\u884C\u4E3A\uFF0C\u8FDB\u884C\u7684\u4F9D\u8D56\u6536\u96C6\u3002</li><li>\u5982\u4F55\u76D1\u542C\u6539\u53D8\uFF0C\u7528\u81EA\u5B9A\u4E49\u5B58\u53D6\u5668\u5C5E\u6027\u4E2D\u7684 get \u548C set \uFF0C\u6765\u8FDB\u884C\u7684\u4F9D\u8D56\u6536\u96C6\u548C\u66F4\u65B0\u6D3E\u53D1\uFF0C\u5F53\u72B6\u6001\u6539\u53D8\uFF0C\u89C2\u5BDF\u8005\u4F1A\u76F4\u63A5\u7CBE\u786E\u901A\u77E5\u6BCF\u4E2A listener \u3002</li></ul><p><strong>\u2461\u72B6\u6001\u63D0\u5347</strong></p><p>\u5728\u6B63\u5E38\u60C5\u51B5\u4E0B\uFF0C\u5728 React \u5E94\u7528\u4E2D\u4F7F\u7528 Mobx \uFF0C\u672C\u8D28\u4E0A mobx \u91CC\u9762\u7684\u72B6\u6001\uFF0C\u5E76\u4E0D\u662F\u5B58\u5728 React \u7EC4\u4EF6\u91CC\u9762\u7684\uFF0C\u662F\u5728\u5916\u90E8\u7531\u4E00\u4E2A\u4E2A mobx \u7684\u6A21\u5757 model \u6784\u6210\uFF0C\u6BCF\u4E00\u4E2A model \u53EF\u4EE5\u7406\u89E3\u6210\u4E00\u4E2A\u5BF9\u8C61\uFF0C\u72B6\u6001\u5B9E\u8D28\u5B58\u5728 model \u4E2D\uFF0Cmodel \u72B6\u6001\u901A\u8FC7 props \u6DFB\u52A0\u5230\u7EC4\u4EF6\u4E2D\uFF0C\u53EF\u4EE5\u7528 mobx-react \u4E2D\u7684 Provder \u548C inject \u4FBF\u6377\u83B7\u53D6\u5B83\u4EEC\uFF0C\u867D\u7136 mobx \u4E2D\u54CD\u5E94\u5F0F\u5904\u7406\u8FD9\u4E9B\u72B6\u6001\uFF0C\u4F46\u662F\u4E0D\u8981\u8BD5\u56FE\u76F4\u63A5\u4FEE\u6539 props \u6765\u4FC3\u4F7F\u66F4\u65B0\uFF0C\u8FD9\u6837\u8FDD\u80CC\u4E86 React Prop \u5355\u5411\u6570\u636E\u6D41\u7684\u539F\u5219\u3002\u6B63\u786E\u7684\u5904\u7406\u65B9\u6CD5\uFF0C\u8FD8\u662F\u901A\u8FC7 model \u4E0B\u9762\u7684 action \u65B9\u6CD5\uFF0C\u6765\u6539\u53D8\u72B6\u6001\uFF0CReact \u5B9E\u8D28\u4E0A\u8C03\u7528\u7684\u662F action \u65B9\u6CD5\u3002</p><p><strong>\u2462\u88C5\u9970\u5668\u6A21\u5F0F</strong></p><p>\u4E3A\u4E86\u5EFA\u7ACB\u89C2\u5BDF\u8005\u6A21\u5F0F\uFF0C\u4FBF\u6377\u5730\u83B7\u53D6\u72B6\u6001/\u76D1\u542C\u72B6\u6001\uFF0Cmobx \u5F88\u591A\u63A5\u53E3\u90FD\u652F\u6301\u88C5\u9970\u5668\u6A21\u5F0F\u7684\u5199\u6CD5\uFF0C\u6240\u4EE5\u5728 mobx \u4E2D\uFF0C\u88C5\u9970\u5668\u6A21\u5F0F\u662F\u6700\u5E38\u7528\u7684\u5199\u6CD5\uFF0C\u5982\u679C\u4E0D\u77E5\u9053\u88C5\u9970\u5668\u7684\u540C\u5B66\uFF0C\u5EFA\u8BAE\u5148\u4E86\u89E3\u4E00\u4E0B\u4E0B ts \u4E2D<code>decorator</code>\uFF0C\u7531\u4E8E\u4E0D\u662F\u672C\u7AE0\u8282\u7684\u5185\u5BB9\uFF0C\u6211\u8FD9\u91CC\u5C31\u4E0D\u4ECB\u7ECD\u4E86\u3002\u6BD4\u5982\u5982\u4E0B\u5C31\u662F mobx \u4E2D\u88C5\u9970\u5668\u7684\u4F53\u73B0\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Root</span><span class="token punctuation">{</span>
    @observable name <span class="token operator">=</span> <span class="token string">&#39;alien&#39;</span> <span class="token comment">/* \u5EFA\u7ACB\u89C2\u5BDF\u8005name\u5C5E\u6027 */</span>
    @action <span class="token function">setName</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name   <span class="token punctuation">}</span>  <span class="token comment">/* \u6539\u53D8 name \u5C5E\u6027 */</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u76EE\u524D typescript \u5DF2\u7ECF\u5168\u9762\u652F\u6301\u5982\u4E0A\u5199\u6CD5\uFF0C\u5982\u679C\u5728 javascript \u4E2D\u76F4\u63A5\u4F7F\u7528\u4F1A\u62A5\u9519\uFF0C\u6240\u4EE5\u901A\u5E38\u9700\u8981\u5728<code>.babelrc</code> \u4E2D\u8FD9\u4E48\u914D\u7F6E\u4E00\u4E0B\uFF1A</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;plugins&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
         <span class="token punctuation">[</span>
          <span class="token string">&quot;@babel/plugin-proposal-decorators&quot;</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">&quot;legacy&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token property">&quot;loose&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">&quot;@babel/plugin-proposal-class-properties&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5982\u4E0A\u6DFB\u52A0\u914D\u7F6E\u540E\uFF0C\u5C31\u53EF\u4EE5\u5728 js \u4E2D\u6B63\u5E38\u4F7F\u7528\u88C5\u9970\u5668\u6A21\u5F0F\u4E86\u3002</p><p><strong>\u2463\u7CBE\u786E\u9897\u7C92\u5316\u6536\u96C6</strong></p><p>mobx \u8FD8\u6709\u4E00\u4E2A\u91CD\u8981\u7279\u70B9\uFF0C\u5C31\u662F\u5BF9\u4E8E\u5C5E\u6027\u7684\u4F9D\u8D56\u6536\u96C6\u662F\u7CBE\u786E\u7684\uFF0C\u9897\u7C92\u5316\u7684\uFF0C\u4E3A\u4EC0\u4E48\u8FD9\u4E48\u8BF4\u5462\uFF1F\u6BD4\u5982\u5728 mobx \u4E00\u4E2A\u6A21\u5757\u5982\u4E0B\u5199\u9053\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Root</span> <span class="token punctuation">{</span>
    @observable object <span class="token operator">=</span> <span class="token punctuation">{</span>                  <span class="token comment">//C\u7EC4\u4EF6\u4F7F\u7528</span>
         <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&#39;alien&#39;</span><span class="token punctuation">,</span>                     <span class="token comment">// A\u7EC4\u4EF6\u4F7F\u7528</span>
         <span class="token literal-property property">mes</span><span class="token operator">:</span><span class="token string">&#39;let us learn React!&#39;</span>         <span class="token comment">// B\u7EC4\u4EF6\u4F7F\u7528</span>
    <span class="token punctuation">}</span>
    @action <span class="token function">setName</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>object<span class="token punctuation">.</span>name <span class="token operator">=</span> name  <span class="token punctuation">}</span>
    @action <span class="token function">setMes</span><span class="token punctuation">(</span><span class="token parameter">mes</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>object<span class="token punctuation">.</span>mes <span class="token operator">=</span> mes <span class="token punctuation">}</span>
    @action <span class="token function">setObject</span><span class="token punctuation">(</span><span class="token parameter">object</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>object <span class="token operator">=</span> object  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>\u5BF9\u4E8E observable \u5904\u7406\u8FC7\u7684\u5C5E\u6027\uFF0C\u6BCF\u4E00\u4E2A\u5C5E\u6027\u90FD\u4F1A\u6709 ObserverValue \uFF0C\u6BD4\u5982\u4E0A\u9762\u7684\u7ED3\u6784\u4F1A\u4EA7\u751F\u4E09\u4E2A ObserverValue \uFF0C\u5206\u522B\u5BF9\u5E94 object \uFF0Cname \uFF0Cmes \u3002</li><li>\u5F53\u4E0A\u9762\u901A\u8FC7 setName \u6539\u53D8 name \u5C5E\u6027\u7684\u65F6\u5019\uFF0C\u53EA\u6709\u7EC4\u4EF6 A \u4F1A\u66F4\u65B0\u3002\u4E5F\u5C31\u662F name ObserverValue \u53EA\u6536\u96C6\u4E86\u7528\u5230 name \u7684\u4F9D\u8D56\u9879 A \u7EC4\u4EF6\u3002</li><li>\u8C03\u7528 setMes \u540C\u7406\uFF0C\u53EA\u6709\u7EC4\u4EF6 B \u66F4\u65B0\u3002 mes ObserverValue \u53EA\u6536\u96C6\u4E86 B \u7EC4\u4EF6\u7684\u4F9D\u8D56\u3002</li><li>\u5F53\u4E0A\u9762\u901A\u8FC7 setObject \u6539\u53D8 object \u7684\u65F6\u5019\uFF0C\u5373\u4F7F object \u91CC\u9762name \uFF0Cmes \u7684\u503C\u6CA1\u6709\u53D8\u5316\uFF0C\u4E5F\u4F1A\u8BA9\u7EC4\u4EF6 A \uFF0C\u7EC4\u4EF6 B \uFF0C\u7EC4\u4EF6 C \uFF0C\u5168\u90E8\u6E32\u67D3\u3002object \u7684 Observer \u540C\u6837\u6536\u96C6\u4E86name\u7684 ObserverValue \u548C mes \u7684 ObserverValue \u3002</li></ul><p>\u6A21\u578B\u56FE\u5982\u4E0B\uFF1A</p><p><img src="https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/1268c78788bd436887d91d9d997b680a~tplv-k3u1fbpfcp-watermark.awebp" alt="2.jpg" loading="lazy"></p><p><strong>\u2464\u5F15\u7528\u7C7B\u578B\u5904\u7406</strong></p><p>observable \u5BF9\u4E8E\u5F15\u7528\u6570\u636E\u7C7B\u578B\uFF0C\u6BD4\u5982 Object \uFF0CArray \uFF0CSet \uFF0CMap\u7B49\uFF0C\u9664\u4E86\u65B0\u5EFA\u4E00\u4E2A observable \u4E4B\u5916\uFF0C\u8FD8\u4F1A\u505A\u5982\u4E0B\u4E24\u70B9\u64CD\u4F5C\u3002</p><ul><li>\u4E00 <code>Proxy</code>\uFF1A\u4F1A\u628A\u539F\u59CB\u5BF9\u8C61\u7528 Proxy \u4EE3\u7406\uFF0CProxy \u4F1A\u7CBE\u786E\u54CD\u5E94\u539F\u59CB\u5BF9\u8C61\u7684\u53D8\u5316\uFF0C\u6BD4\u5982\u589E\u52A0\u5C5E\u6027\u2014\u2014\u7ED9\u5C5E\u6027\u7ED1\u5B9A ObserverValue \uFF0C\u5220\u9664\u5C5E\u6027\u2014\u2014\u7ED9\u5C5E\u6027\u89E3\u7ED1 ObserverValue \u7B49\u3002</li><li>\u4E8C <code>ObservableAdministration</code>\uFF1A \u5BF9\u4E8E\u5B50\u4EE3\u5C5E\u6027\uFF0C\u4F1A\u521B\u5EFA\u4E00\u4E2A <code>ObservableAdministration</code>\uFF0C\u7528\u4E8E\u7BA1\u7406\u5B50\u4EE3\u5C5E\u6027\u7684ObserverValue\u3002</li><li>\u5BF9\u4E8E\u5916\u5C42 Root \uFF0C\u5728 <code>constructor</code> \u4F7F\u7528 <code>makeObservable</code> \uFF0Cmobx \u4F1A\u9ED8\u8BA4\u7ED9\u6700\u5916\u5C42\u7684 Root \u6DFB\u52A0 ObservableAdministration \u3002</li></ul><h2 id="\u4E09-\u57FA\u672C\u7528\u6CD5" tabindex="-1"><a class="header-anchor" href="#\u4E09-\u57FA\u672C\u7528\u6CD5" aria-hidden="true">#</a> \u4E09 \u57FA\u672C\u7528\u6CD5</h2><h3 id="_1-mobx\u57FA\u672C\u4F7F\u7528" tabindex="-1"><a class="header-anchor" href="#_1-mobx\u57FA\u672C\u4F7F\u7528" aria-hidden="true">#</a> 1 Mobx\u57FA\u672C\u4F7F\u7528</h3><h4 id="mobx\u5E38\u7528api" tabindex="-1"><a class="header-anchor" href="#mobx\u5E38\u7528api" aria-hidden="true">#</a> mobx\u5E38\u7528api</h4><p>\u628A\u4E0A\u8FF0\u6BCF\u4E00\u4E2A class \u79F0\u4E4B\u4E3A\u4E00\u4E2A\u6A21\u5757\uFF0C\u5982\u4E0A\u8FF0 Root \u5C31\u662F\u4E00\u4E2A\u6A21\u5757\u3002mobx\u7684 api \u57FA\u672C\u7528\u4E8E\u6784\u5EFA\u6BCF\u4E00\u4E2A\u54CD\u5E94\u5F0F\u6A21\u5757\u3002</p><p><strong>\u2460 makeObservable</strong></p><p>\u5728\u65B0\u7248\u672C mobx \u4E2D\uFF0C\u60F3\u8981\u8BA9\u6574\u4E2A\u6A21\u5757\u53D8\u6210\u53EF\u54CD\u5E94\u5F0F\u7684\uFF0C\u90A3\u4E48\u9700\u8981\u5728 constructor \u8C03\u7528 makeObservable\u3002\u8001\u7248\u672C\u7684 mobx \u4E0D\u9700\u8981\u8FD9\u4E48\u505A\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token function">makeObservable</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>\u2461 observable</strong></p><p>\u4F1A\u7ED9\u5C5E\u6027\u503C\u52A0\u4E00\u4E2A\u89C2\u5BDF\u8005\u5BF9\u8C61\uFF0C\u4F7F\u5176\u80FD\u53D8\u6210\u53EF\u89C2\u5BDF\u7684\uFF0C\u5F53\u5C5E\u6027\u503C\u6539\u53D8\u7684\u65F6\u5019\uFF0C\u89C2\u5BDF\u8005\u4F1A\u901A\u77E5\u6BCF\u4E00\u4E2A\u4F9D\u8D56\u9879\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>@observable name <span class="token operator">=</span> <span class="token string">&#39;\u300AReact\u8FDB\u9636\u5B9E\u8DF5\u6307\u5357\u300B&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>\u2462action</strong></p><p>\u901A\u8FC7 action \u5305\u88F9\u7684\u51FD\u6570\uFF0C\u53EF\u4EE5\u7528\u6765\u4FEE\u6539 mobx \u4E2D\u7684\u72B6\u6001\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>@action <span class="token function">setName</span><span class="token punctuation">(</span><span class="token parameter">newName</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> newName  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>\u2463computed</strong></p><p>\u6839\u636E\u73B0\u6709\u7684\u72B6\u6001\u6216\u5176\u5B83\u8BA1\u7B97\u503C\u884D\u751F\u51FA\u7684\u503C\u3002\u5982\u4E0B total \u662F\u901A\u8FC7 price \u548C count \u884D\u751F\u51FA\u6765\u7684\u65B0\u503C\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>@observable price <span class="token operator">=</span> <span class="token number">666</span>  <span class="token comment">// \u53EF\u89C2\u5BDF\u5C5E\u6027\u2014\u2014\u4EF7\u683C</span>
@observable count <span class="token operator">=</span> <span class="token number">1</span>    <span class="token comment">// \u53EF\u89C2\u5BDF\u5C5E\u6027\u2014\u2014\u6570\u91CF</span>
@computed <span class="token keyword">get</span> <span class="token function">total</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>price <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>count
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="mobx-react-\u5E38\u7528-api" tabindex="-1"><a class="header-anchor" href="#mobx-react-\u5E38\u7528-api" aria-hidden="true">#</a> mobx-react \u5E38\u7528 api</h4><p>mobx-react \u4E2D\u7684 api \uFF0C\u7528\u4E8E\u628A mobx \u4E2D\u7684\u72B6\u6001\uFF0C\u63D0\u4F9B\u7ED9\u7EC4\u4EF6\uFF0C\u5E76\u628A\u7EC4\u4EF6\u4E5F\u53D8\u6210\u53EF\u89C2\u5BDF\u7684 \u2014\u2014 mobx \u72B6\u6001\u6539\u53D8\uFF0C\u7EC4\u4EF6\u89E6\u53D1\u66F4\u65B0\u3002</p><p><strong>\u2460Provider</strong></p><p>\u7528\u4E8E\u628A mobx \u7684\u5404\u4E2A\u6A21\u5757\uFF0C\u7528 Context \u4E0A\u4E0B\u6587\u5F62\u5F0F\uFF0C\u4FDD\u5B58\u8D77\u6765\uFF0C\u4F9B\u7ED9\u7EC4\u4EF6\u4F7F\u7528\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>Provider Root<span class="token operator">=</span><span class="token punctuation">{</span>Root<span class="token punctuation">}</span> <span class="token operator">&gt;</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span> <span class="token operator">&lt;</span><span class="token operator">/</span>Provider<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>\u2461inject</strong></p><p>inject \u9AD8\u9636\u7EC4\u4EF6\u53EF\u4EE5\u628A Provider \u4E2D\u7684 mobx \u6A21\u5757\uFF0C\u6DF7\u5165\u5230\u7EC4\u4EF6\u7684 props \u4E2D\uFF0C\u6240\u4EE5\u5C31\u53EF\u4EE5\u5728\u7EC4\u4EF6\u4E2D\u6D88\u8D39\u72B6\u6001\uFF0C\u6216\u8005\u8C03\u7528\u6539\u53D8\u72B6\u6001\u7684\u65B9\u6CD5\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>@<span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">&#39;Root&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Index</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u2462observer</strong></p><p>\u88AB observer \u9AD8\u9636\u7EC4\u4EF6\u5305\u88C5\u7684\u7EC4\u4EF6\uFF0C\u5982\u679C\u7EC4\u4EF6\u5185\u90E8\u5F15\u5165\u4E86 mobx \u53EF\u89C2\u5BDF\u5C5E\u6027\u503C\uFF0C\u5F53\u503C\u6539\u53D8\u7684\u65F6\u5019\uFF0C\u4F1A\u8FFD\u6EAF\u5230\u5F53\u524D\u7EC4\u4EF6\uFF0C\u4FC3\u4F7F\u5F53\u524D\u7EC4\u4EF6\u66F4\u65B0\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>@observer
<span class="token keyword">class</span> <span class="token class-name">Index</span> <span class="token keyword">extends</span>  <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u9762\u4ECB\u7ECD\u4E86\u4E00\u904D mobx \u548C mobx-react \u7684\u5404\u4E2A\u90E8\u5206\u529F\u80FD\uFF0C\u63A5\u4E0B\u6765\u9488\u5BF9\u4E24\u79CD\u4F7F\u7528\u573A\u666F\u8FDB\u884C\u5B9E\u8DF5\u3002</p><h3 id="_2-\u5B9E\u8DF5\u2014\u2014\u5B9E\u73B0\u72B6\u6001\u5171\u4EAB" tabindex="-1"><a class="header-anchor" href="#_2-\u5B9E\u8DF5\u2014\u2014\u5B9E\u73B0\u72B6\u6001\u5171\u4EAB" aria-hidden="true">#</a> 2 \u5B9E\u8DF5\u2014\u2014\u5B9E\u73B0\u72B6\u6001\u5171\u4EAB</h3><p>\u63A5\u4E0B\u6765\u7528 mobx \u5B9E\u73B0\u72B6\u6001\u5171\u4EAB\u573A\u666F\u3002\u9996\u5148\u521B\u5EFA Root \u6A21\u5757\uFF0C\u7528\u4E8E\u4FDD\u5B58\u5168\u5C40\u7684\u4E00\u4E9B\u6570\u636E\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> observable <span class="token punctuation">,</span>action <span class="token punctuation">,</span>makeObservable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;mobx&#39;</span>
<span class="token keyword">class</span> <span class="token class-name">Root</span><span class="token punctuation">{</span>
   <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token function">makeObservable</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
   @observable info<span class="token operator">=</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&#39;xxx&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">mes</span><span class="token operator">:</span><span class="token string">&#39;xxx&#39;</span> <span class="token punctuation">}</span>
   <span class="token comment">// @observable number = 1</span>
   @action <span class="token function">setInfo</span><span class="token punctuation">(</span><span class="token parameter">info</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>info <span class="token operator">=</span> info <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">Root</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6839\u672C\u7EC4\u4EF6\u6CE8\u5165\u72B6\u6001\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> Root <span class="token keyword">from</span> <span class="token string">&#39;./mobx&#39;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>Provider Root<span class="token operator">=</span><span class="token punctuation">{</span>Root<span class="token punctuation">}</span> <span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Child <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Provider<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>\u5168\u5C40\u901A\u8FC7 mobx-react \u4E2D\u7684 Provider \u4F20\u9012\u5185\u5BB9\u3002</li></ul><p>\u4F7F\u7528\u72B6\u6001\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">getUserInfo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&#39;alien&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">mes</span><span class="token operator">:</span><span class="token string">&#39;let us learn React!&#39;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
       <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
@<span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">&#39;Root&#39;</span><span class="token punctuation">)</span>
@observer
<span class="token keyword">class</span> <span class="token class-name">Child</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token punctuation">{</span>
    <span class="token keyword">async</span> <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
       <span class="token comment">/*  \u6A21\u62DF\u6570\u636E\u4EA4\u4E92 */</span>
       <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getUserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>Root<span class="token punctuation">.</span><span class="token function">setInfo</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> info <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>Root
        <span class="token keyword">return</span> <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;box&quot;</span> <span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span> \u59D3\u540D\uFF1A<span class="token punctuation">{</span>info<span class="token punctuation">.</span>name<span class="token punctuation">}</span> <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span> \u60F3\u5BF9\u5927\u5BB6\u8BF4\uFF1A<span class="token punctuation">{</span>info<span class="token punctuation">.</span>mes<span class="token punctuation">}</span> <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>inject \u5F15\u5165 Root\uFF0Cobserver \u505A\u6570\u636E\u54CD\u5E94\uFF0C\u6A21\u62DF\u6570\u636E\u4EA4\u4E92\uFF0C\u8C03\u7528 setInfo \u6539\u53D8 Root \u4E2D info \u5185\u5BB9\u3002 info \u5185\u5BB9\u6539\u53D8\uFF0C\u91CD\u65B0\u6E32\u67D3\u89C6\u56FE\u3002</li></ul><h3 id="_3-\u5B9E\u8DF5\u2014\u2014\u5B9E\u73B0\u7EC4\u4EF6\u901A\u4FE1" tabindex="-1"><a class="header-anchor" href="#_3-\u5B9E\u8DF5\u2014\u2014\u5B9E\u73B0\u7EC4\u4EF6\u901A\u4FE1" aria-hidden="true">#</a> 3 \u5B9E\u8DF5\u2014\u2014\u5B9E\u73B0\u7EC4\u4EF6\u901A\u4FE1</h3><p>\u63A5\u4E0B\u6765\u6A21\u62DF\u7EC4\u4EF6\u901A\u4FE1\u573A\u666F\uFF1A\u9996\u5148\u6CE8\u518C\u6A21\u5757\u7528\u4E8E\u7EC4\u4EF6\u901A\u4FE1\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Communi</span> <span class="token punctuation">{</span>
   <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
       <span class="token function">makeObservable</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
   @observable mesA <span class="token operator">=</span> <span class="token string">&#39;&#39;</span>
   @observable mesB <span class="token operator">=</span> <span class="token string">&#39;&#39;</span>
   @action <span class="token function">setMesA</span><span class="token punctuation">(</span><span class="token parameter">mes</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mesA <span class="token operator">=</span> mes <span class="token punctuation">}</span>
   @action <span class="token function">setMesB</span><span class="token punctuation">(</span><span class="token parameter">mes</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mesB <span class="token operator">=</span> mes <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">Communi</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7136\u540E\u5EFA\u7ACBA\uFF0CB\u7EC4\u4EF6\u5B9E\u73B0\u901A\u4FE1\u529F\u80FD\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>@<span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">&#39;Communi&#39;</span><span class="token punctuation">)</span>
@observer
<span class="token keyword">class</span> <span class="token class-name">ComponentA</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token punctuation">{</span> <span class="token comment">/* \u7EC4\u4EF6A */</span>
    state<span class="token operator">=</span><span class="token punctuation">{</span> <span class="token literal-property property">CompAsay</span><span class="token operator">:</span><span class="token string">&#39;&#39;</span><span class="token punctuation">}</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> CompAsay <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state
        <span class="token keyword">const</span> <span class="token punctuation">{</span> mesB  <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>Communi
        <span class="token keyword">return</span> <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;box&quot;</span> <span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>\u6211\u662F\u7EC4\u4EF6<span class="token constant">A</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span> <span class="token constant">B</span>\u7EC4\u4EF6\u5BF9\u6211\u8BF4\uFF1A<span class="token punctuation">{</span>mesB<span class="token punctuation">}</span> <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        \u6211\u5BF9<span class="token constant">B</span>\u7EC4\u4EF6\u8BF4\uFF1A <span class="token operator">&lt;</span>input onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">CompAsay</span> <span class="token operator">:</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span> placeholder<span class="token operator">=</span><span class="token string">&quot;CompAsay&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>Communi<span class="token punctuation">.</span><span class="token function">setMesA</span><span class="token punctuation">(</span>CompAsay<span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">&gt;</span>\u786E\u5B9A<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
@<span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">&#39;Communi&#39;</span><span class="token punctuation">)</span>
@observer
<span class="token keyword">class</span> <span class="token class-name">ComponentB</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token punctuation">{</span> <span class="token comment">/* \u7EC4\u4EF6B */</span>
   state<span class="token operator">=</span><span class="token punctuation">{</span> <span class="token literal-property property">compBsay</span><span class="token operator">:</span><span class="token string">&#39;&#39;</span><span class="token punctuation">}</span>
   <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
       <span class="token keyword">const</span> <span class="token punctuation">{</span> compBsay <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state
       <span class="token keyword">const</span> <span class="token punctuation">{</span>  mesA  <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>Communi
       <span class="token keyword">return</span> <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;box pt50&quot;</span> <span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>\u6211\u662F\u7EC4\u4EF6<span class="token constant">B</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
           <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span> <span class="token constant">A</span>\u7EC4\u4EF6\u5BF9\u6211\u8BF4\uFF1A<span class="token punctuation">{</span>mesA<span class="token punctuation">}</span> <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
           \u6211\u5BF9<span class="token constant">A</span>\u7EC4\u4EF6\u8BF4\uFF1A<span class="token operator">&lt;</span>input onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">compBsay</span> <span class="token operator">:</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span>  placeholder<span class="token operator">=</span><span class="token string">&quot;CompAsay&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
           <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>Communi<span class="token punctuation">.</span><span class="token function">setMesB</span><span class="token punctuation">(</span>compBsay<span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">&gt;</span>\u786E\u5B9A<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
       <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6548\u679C\uFF1A</p><p><img src="https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/7b80f4d277744fe6999e214f036d97fb~tplv-k3u1fbpfcp-watermark.awebp" alt="1.gif" loading="lazy"></p><h2 id="\u56DB-mobx\u6D41\u7A0B\u5206\u6790\u548C\u539F\u7406\u63ED\u79D8" tabindex="-1"><a class="header-anchor" href="#\u56DB-mobx\u6D41\u7A0B\u5206\u6790\u548C\u539F\u7406\u63ED\u79D8" aria-hidden="true">#</a> \u56DB Mobx\u6D41\u7A0B\u5206\u6790\u548C\u539F\u7406\u63ED\u79D8</h2><p>\u63A5\u4E0B\u6765\u5F00\u59CB\u6B63\u5F0F\u8FDB\u5165 Mobx \u6D41\u7A0B\u5206\u6790\u548C\u539F\u7406\u63ED\u79D8\u73AF\u8282\u3002\u4ECE\u672C\u7AE0\u8282\u7684\u7B2C\u4E8C\u90E8\u5206\uFF0C\u5C31\u5F00\u59CB\u4ECB\u7ECD\u4E86 mobx \u5185\u90E8\uFF0C\u53EF\u89C2\u5BDF\u5C5E\u6027 ObserverValue \u6700\u540E\u4F1A\u88ABmobx \u5E95\u5C42\u5904\u7406\u7684\u6837\u5B50\u3002\u4E8E\u662F\u987A\u85E4\u6478\u74DC\uFF0C\u5256\u6790 mobx \u7684\u6574\u4E2A\u6D41\u7A0B\u3002</p><p>\u53EF\u4EE5\u4ECE\u4E09\u4E2A\u89D2\u5EA6\u5206\u6790 mobx \u548C mobx-react \u6574\u4E2A\u6D41\u7A0B\uFF1A</p><ul><li><strong>\u521D\u59CB\u5316</strong>\uFF1A\u9996\u5148\u5C31\u662F mobx \u5728\u521D\u59CB\u5316\u7684\u65F6\u5019\uFF0C\u662F\u5982\u4F55\u5904\u7406 observable \u53EF\u89C2\u5BDF\u5C5E\u6027\u7684\u3002</li><li><strong>\u4F9D\u8D56\u6536\u96C6</strong>\uFF1A\u7B2C\u4E8C\u70B9\u5C31\u662F\u901A\u8FC7 mobx-react \u4E2D\u7684 observer \uFF0C\u5982\u4F55\u6536\u96C6\u4F9D\u8D56\u9879\uFF0C\u4E0E observable \u5EFA\u7ACB\u8D77\u5173\u7CFB\u7684\u3002</li><li><strong>\u6D3E\u53D1\u66F4\u65B0</strong>\uFF1A\u6700\u540E\u5C31\u662F\u5F53\u6539\u53D8\u53EF\u89C2\u5BDF\u5C5E\u6027\u7684\u503C\u7684\u65F6\u5019\uFF0C\u5982\u4F55\u66F4\u65B0\u5BF9\u5E94\u7EC4\u4EF6\u7684\u3002</li></ul><p>\u6BD4\u5982\u5982\u4E0B\u5728 mobx \u4E2D\u7684\u4E00\u4E2A\u6A21\u5757\u8FD9\u4E48\u5199\u9053\uFF08\u8FD9\u91CC\u79F0\u4E4B\u4E3A <strong>DEMO1</strong> \uFF09\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Root</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token function">makeObservable</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    @observable authorInfo <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&#39;alien&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">mes</span><span class="token operator">:</span><span class="token punctuation">{</span>
            <span class="token literal-property property">say</span><span class="token operator">:</span><span class="token string">&#39;let us learn React!&#39;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    @observable name<span class="token operator">=</span><span class="token string">&#39;\u300AReact\u8FDB\u9636\u5B9E\u8DF5\u6307\u5357\u300B&#39;</span>
    @action <span class="token function">setName</span><span class="token punctuation">(</span><span class="token parameter">newName</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> newName  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4EE5\u4E0A\u9762\u7684 DEMO1 \u4F5C\u4E3A\u57FA\u7840\u53C2\u8003\u3002</p><h3 id="_1-\u6A21\u5757\u521D\u59CB\u5316" tabindex="-1"><a class="header-anchor" href="#_1-\u6A21\u5757\u521D\u59CB\u5316" aria-hidden="true">#</a> 1 \u6A21\u5757\u521D\u59CB\u5316</h3><p>\u9996\u5148\u662F\u6A21\u5757\u521D\u59CB\u5316\u6D41\u7A0B\u3002\u53EF\u4EE5\u4ECE <code>makeObservable</code> \u548C <code>observable</code> \u5165\u624B\u3002</p><p>\u9996\u5148\u88AB observable \u88C5\u9970\u5668\u5305\u88F9\u7684\u5C5E\u6027\u5230\u5E95\u505A\u4E86\u4E9B\u4EC0\u4E48\u5462\uFF1F</p><h4 id="_1\u7ED1\u5B9A\u72B6\u6001\u2014\u2014observable" tabindex="-1"><a class="header-anchor" href="#_1\u7ED1\u5B9A\u72B6\u6001\u2014\u2014observable" aria-hidden="true">#</a> \u2460\u7ED1\u5B9A\u72B6\u6001\u2014\u2014observable</h4><blockquote><p>mobx/src/api/observable.ts</p></blockquote><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">createObservable</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span>name<span class="token punctuation">,</span>descriptor</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// \u5BF9\u4E8E\u5982\u4E0ADEMO1\uFF0Ctarget\u2014\u2014Root\u7C7B\uFF0Cname\u2014\u2014\u5C5E\u6027\u540D\u79F0 authorInfo \u6216\u8005 name \uFF0Cdescriptor\u2014\u2014\u5C5E\u6027\u63CF\u8FF0\uFF0C\u679A\u4E3E\u6027\uFF0C\u53EF\u8BFB\u6027\u7B49</span>
     <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isStringish</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">/* \u88C5\u9970\u5668\u6A21\u5F0F\u4E0B */</span>
         target<span class="token punctuation">[</span><span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">&quot;mobx-stored-annotations&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">/* \u5411\u7C7B\u7684mobx-stored-annotations\u5C5E\u6027\u7684name\u5C5E\u6027\u4E0A\uFF0C\u7ED1\u5B9A annotationType_ \uFF0C extend_ \u7B49\u65B9\u6CD5\u3002 */</span>
            <span class="token literal-property property">annotationType_</span><span class="token operator">:</span> <span class="token string">&#39;observable&#39;</span><span class="token punctuation">,</span>  <span class="token comment">//\u8FD9\u4E2A\u6807\u7B7E\u8BC1\u660E\u662F observable\uFF0C\u9664\u4E86observable\uFF0C\u8FD8\u6709 action\uFF0C computed \u7B49\u3002</span>
            <span class="token literal-property property">options_</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
            make_<span class="token punctuation">,</span>  <span class="token comment">// \u8FD9\u4E2A\u65B9\u6CD5\u5728\u7C7B\u7EC4\u4EF6 makeObservable \u4F1A\u88AB\u6FC0\u6D3B</span>
            extend_ <span class="token comment">// \u8FD9\u4E2A\u65B9\u6CD5\u5728\u7C7B\u7EC4\u4EF6 makeObservable \u4F1A\u88AB\u6FC0\u6D3B</span>
        <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>       
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>\u88AB observable \u88C5\u9970\u5668\u5305\u88C5\u7684\u5C5E\u6027\uFF0C\u672C\u8D28\u4E0A\u5C31\u662F\u8C03\u7528createObservable \u65B9\u6CD5\u3002</li><li>\u901A\u8FC7 <code>createObservable</code> \u5C06\u7C7B\u4E0A\u7ED1\u5B9A\u5F53\u524D observable \u5BF9\u5E94\u7684\u914D\u7F6E\u9879\uFF0C\u8BF4\u767D\u4E86\uFF0C\u5C31\u662F\u7ED9 observable \u7ED1\u5B9A\u7684\u5C5E\u6027\u6DFB\u52A0\u4E00\u4E9B\u989D\u5916\u7684\u72B6\u6001\uFF0C\u8FD9\u4E9B\u72B6\u6001\u5C06\u5728\u7C7B\u5B9E\u4F8B\u5316\u7684\u65F6\u5019 <code>makeObservable</code> \u4E2D\u88AB\u6FC0\u6D3B\u3002</li></ul><p>\u8FD9\u91CC\u6709\u5FC5\u8981\u5148\u8BB0\u5F55\u4E00\u4E0B <code>make_</code> \u548C <code>extend_</code> \u65B9\u6CD5\uFF0C\u90FD\u505A\u4E86\u4E9B\u4EC0\u4E48\u3002</p><blockquote><p>mobx/src/types/createObservableAnnotation.ts</p></blockquote><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">make_</span><span class="token punctuation">(</span><span class="token parameter">adm<span class="token punctuation">,</span>key<span class="token punctuation">,</span>descriptor</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">/*  */</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">extend_</span><span class="token punctuation">(</span>adm<span class="token punctuation">,</span>key<span class="token punctuation">,</span>descriptor<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">extend_</span><span class="token punctuation">(</span><span class="token parameter">adm<span class="token punctuation">,</span>key<span class="token punctuation">,</span>descriptor</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> adm<span class="token punctuation">.</span><span class="token function">defineObservableProperty_</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span>descriptor<span class="token punctuation">,</span>options<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>\u9700\u8981\u8BB0\u4F4F\u4E00\u70B9\u5C31\u662F\uFF1A\u5F53\u8C03\u7528 observable \u914D\u7F6E\u9879\u7684 make_ \uFF0C\u672C\u8D28\u4E0A\u8C03\u7528 <code>adm.defineObservableProperty_</code> \uFF0C\u81F3\u4E8E\u8FD9\u4E2A\u662F\u4EC0\u4E48\uFF0C\u9A6C\u4E0A\u5C31\u4F1A\u8BB2\u5230\u3002</li></ul><h4 id="_2\u6FC0\u6D3B\u72B6\u6001\u2014\u2014makeobservable" tabindex="-1"><a class="header-anchor" href="#_2\u6FC0\u6D3B\u72B6\u6001\u2014\u2014makeobservable" aria-hidden="true">#</a> \u2461\u6FC0\u6D3B\u72B6\u6001\u2014\u2014makeObservable</h4><p>\u4E0A\u8FB9\u8BB2\u5230\u8FC7\uFF0C\u5728\u65B0\u7248\u672C mobx \u4E2D\uFF0C\u5FC5\u987B\u5728\u7C7B\u7684 constructor \u4E2D\u8C03\u7528<code>makeObservable(this)</code> \u624D\u80FD\u5EFA\u7ACB\u54CD\u5E94\u5F0F\u3002\u4E00\u8D77\u770B\u4E00\u4E0BmakeObservable\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">makeObservable</span> <span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// target \u6A21\u5757\u5B9E\u4F8B\u2014\u2014this</span>
    <span class="token keyword">const</span> adm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObservableObjectAdministration</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span> <span class="token comment">/* \u521B\u5EFA\u4E00\u4E2A\u7BA1\u7406\u8005\u2014\u2014\u8FD9\u4E2A\u7BA1\u7406\u8005\u662F\u6700\u4E0A\u5C42\u7684\u7BA1\u7406\u8005\uFF0C\u7BA1\u7406\u6A21\u5757\u4E0B\u7684observable\u5C5E\u6027 */</span>
    target<span class="token punctuation">[</span><span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">&quot;mobx administration&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> adm  <span class="token comment">/* \u5C06\u7BA1\u7406\u8005 adm \u548C class \u5B9E\u4F8B\u5EFA\u7ACB\u8D77\u5173\u8054 */</span>
    <span class="token function">startBatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">try</span><span class="token punctuation">{</span>
        <span class="token keyword">let</span> annotations <span class="token operator">=</span> target<span class="token punctuation">[</span><span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">&quot;mobx-stored-annotations&quot;</span><span class="token punctuation">]</span> <span class="token comment">/* \u4E0A\u9762\u7B2C\u4E00\u6B65\u8BF4\u5230\uFF0C\u83B7\u53D6\u72B6\u6001 */</span>
        Reflect<span class="token punctuation">.</span><span class="token function">ownKeys</span><span class="token punctuation">(</span>annotations<span class="token punctuation">)</span>  <span class="token comment">/* \u5F97\u5230\u6BCF\u4E2A\u72B6\u6001\u540D\u79F0 */</span>
        <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> adm<span class="token punctuation">.</span><span class="token function">make_</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> annotations<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">/* \u5BF9\u6BCF\u4E2A\u5C5E\u6027\u8C03\u7528 */</span>
    <span class="token punctuation">}</span><span class="token keyword">finally</span><span class="token punctuation">{</span>
        <span class="token function">endBatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>makeObservable \u4E3B\u8981\u505A\u7684\u4E8B\u6709\u4EE5\u4E0B\u4E24\u70B9\uFF1A</p><ul><li>\u521B\u5EFA\u4E00\u4E2A\u7BA1\u7406\u8005 <code>ObservableAdministration</code> \uFF0C\u4E0A\u9762\u8BB2\u5230\u8FC7\uFF0C\u7BA1\u7406\u8005\u5C31\u662F\u4E3A\u4E86\u7BA1\u7406\u5B50\u4EE3\u5C5E\u6027\u7684 ObservableValue \u3002\u5E76\u548C\u6A21\u5757\u5B9E\u4F8B\u5EFA\u7ACB\u8D77\u5173\u7CFB\u3002</li><li>\u7136\u540E\u4F1A\u904D\u5386\u89C2\u5BDF\u8005\u72B6\u6001\u4E0B\u7684\u6BCF\u4E00\u4E2A\u5C5E\u6027\uFF0C\u5C06\u6BCF\u4E2A\u5C5E\u6027\u901A\u8FC7<code>adm.make_</code>\u5904\u7406\uFF0C\u503C\u5F97\u6CE8\u610F\u7684\u662F\uFF0C<strong>\u8FD9\u4E2Amake_\u662F\u7BA1\u7406\u8005\u7684\uFF0C\u5E76\u4E0D\u662F\u5C5E\u6027\u72B6\u6001\u7684make_\uFF0C\u8FD9\u4E00\u70B9\u4E0D\u8981\u5F04\u6DF7\u6DC6\u4E86</strong>\u3002</li></ul><p>\u63A5\u4E0B\u6765\u4E00\u8D77\u770B\u4E00\u4E0B\uFF0C\u7BA1\u7406\u8005 ObservableAdministration \u91CC\u9762\u662F\u5982\u4F55\u7BA1\u7406\u72B6\u6001\u7684\u3002</p><h4 id="_3\u89C2\u5BDF\u8005\u5C5E\u6027\u7BA1\u7406\u8005\u2014\u2014observableadministration" tabindex="-1"><a class="header-anchor" href="#_3\u89C2\u5BDF\u8005\u5C5E\u6027\u7BA1\u7406\u8005\u2014\u2014observableadministration" aria-hidden="true">#</a> \u2462\u89C2\u5BDF\u8005\u5C5E\u6027\u7BA1\u7406\u8005\u2014\u2014ObservableAdministration</h4><p>\u7EC6\u5FC3\u7684\u540C\u5B66\u5E94\u8BE5\u4F1A\u53D1\u73B0\uFF0C\u4E0A\u8FF0\u521D\u59CB\u5316\u521B\u5EFA\u7684\u7BA1\u7406\u8005\uFF0C\u8C03\u7528\u7684\u662F <code>ObservableObjectAdministration</code> \uFF0C\u5B9E\u9645\u5728 mobx \u5185\u90E8\u4F1A\u5B58\u5728\u591A\u4E2A\u79CD\u7C7B\u7684\u7BA1\u7406\u8005\uFF0C\u6BD4\u5982\u6570\u7EC4\uFF0C\u5BF9\u8C61\u6570\u636E\u7C7B\u578B\u3002\u56E0\u4E3A\u4E0D\u540C\u7684\u7C7B\u578B\uFF0C\u91CC\u9762\u7684\u65B9\u6CD5\u548C\u72B6\u6001\u90FD\u662F\u4E0D\u540C\u7684\u3002\u672C\u6587\u662F\u4EE5\u5BF9\u8C61\u7684\u7BA1\u7406\u8005\u4F5C\u4E3A\u53C2\u8003\u3002</p><blockquote><p>mobx/src/types/observableobject.ts</p></blockquote><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">ObservableObjectAdministration</span><span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">target_<span class="token punctuation">,</span>values_</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>target_ <span class="token operator">=</span> target_
        <span class="token keyword">this</span><span class="token punctuation">.</span>values_ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//\u5B58\u653E\u6BCF\u4E00\u4E2A\u5C5E\u6027\u7684ObserverValue\u3002</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/* \u8C03\u7528 ObserverValue\u7684 get \u2014\u2014 \u6536\u96C6\u4F9D\u8D56  */</span>
    <span class="token function">getObservablePropValue_</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>values_<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/* \u8C03\u7528 ObserverValue\u7684 setNewValue_   */</span>
    <span class="token function">setObservablePropValue_</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span>newValue</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">const</span> observable <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>values_<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
        observable<span class="token punctuation">.</span><span class="token function">setNewValue_</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span> <span class="token comment">/* \u8BBE\u7F6E\u65B0\u503C */</span>
    <span class="token punctuation">}</span>
    <span class="token function">make_</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span>annotation</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// annotation \u4E3A\u6BCF\u4E2Aobservable\u5BF9\u5E94\u7684\u914D\u7F6E\u9879\u7684\u5185\u5BB9\uFF0C{ make_,extends }</span>
        <span class="token keyword">const</span> outcome <span class="token operator">=</span> annotation<span class="token punctuation">.</span><span class="token function">make_</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> descriptor<span class="token punctuation">,</span> source<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/* \u8FD9\u4E2A\u51FD\u6570\u5F88\u91CD\u8981\uFF0C\u7528\u4E8E\u52AB\u6301\u5BF9\u8C61\u4E0A\u7684get,set */</span>
    <span class="token function">defineObservableProperty_</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span>value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">try</span><span class="token punctuation">{</span>
            <span class="token function">startBatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">const</span> descriptor <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token comment">// \u5F53\u6211\u4EEC\u5F15\u7528\u5BF9\u8C61\u4E0B\u7684\u5C5E\u6027\uFF0C\u5B9E\u9645\u4E0A\u89E6\u53D1\u7684\u662F getObservablePropValue_</span>
                   <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getObservablePropValue_</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token function">set</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// \u5F53\u6211\u4EEC\u6539\u53D8\u5BF9\u8C61\u4E0B\u7684\u5C5E\u6027\uFF0C\u5B9E\u9645\u4E0A\u89E6\u53D1\u7684\u662F setObservablePropValue_</span>
                   <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setObservablePropValue_</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span>value<span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>target_<span class="token punctuation">,</span> key <span class="token punctuation">,</span> descriptor<span class="token punctuation">)</span>
            <span class="token keyword">const</span> observable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObservableValue</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token comment">// \u521B\u5EFA\u4E00\u4E2A ObservableValue</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>values_<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> observable<span class="token punctuation">)</span>             <span class="token comment">// \u8BBE\u7F6Eobservable\u5230value\u4E2D</span>
        <span class="token punctuation">}</span><span class="token keyword">finally</span><span class="token punctuation">{</span>
            <span class="token function">endBatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u56DE\u5230\u4E3B\u6D41\u7A0B\u4E0A\u6765\uFF0C\u5F53 mobx \u5E95\u5C42\u904D\u5386\u89C2\u5BDF\u8005\u5C5E\u6027\uFF0C\u7136\u540E\u8C03\u7528 make_ \u65B9\u6CD5\u7684\u65F6\u5019\uFF0C\u672C\u8D28\u4E0A\u8C03\u7528\u7684\u662F\u5982\u4E0A make_ \u65B9\u6CD5\uFF0C\u4F1A\u6FC0\u6D3B\u5F53\u524D\u7684 observable \u5C5E\u6027\uFF0C\u89E6\u53D1 observable \u914D\u7F6E\u9879\u4E0A\u7684 make_ \u65B9\u6CD5\uFF0C\u7136\u540E\u5C31\u4F1A\u8FDB\u5165\u771F\u6B63\u7684\u6DFB\u52A0\u89C2\u5BDF\u8005\u5C5E\u6027\u73AF\u8282 <code>defineObservableProperty_</code> \u3002</p><ul><li>\u9996\u5148\u4F1A\u901A\u8FC7 <strong>Object.defineProperty</strong> \uFF0C\u62E6\u622A\u5BF9\u8C61\u7684\u5C5E\u6027\uFF0C\u6DFB\u52A0get\uFF0Cset \uFF0C\u6BD4\u5982\u7EC4\u4EF6\u4E2D\u5F15\u7528\u5BF9\u8C61\u4E0A\u7684\u5C5E\u6027\uFF0C\u8C03\u7528 get \u2014\u2014\u672C\u8D28\u4E0A\u8C03\u7528 <code>getObservablePropValue_</code> \uFF0C\u5728 observableValues \u8C03\u7528\u7684\u662F get \u65B9\u6CD5\uFF1B\u5F53\u4FEE\u6539\u5BF9\u8C61\u4E0A\u7684\u5C5E\u6027\uFF0C\u8C03\u7528 set \u2014\u2014\u672C\u8D28\u4E0A\u8C03\u7528 <code>setObservablePropValue_</code> \uFF0CsetObservablePropValue_ \u8C03\u7528\u7684\u662F ObservableValues \u4E0A\u7684 <code>setNewValue_</code> \u65B9\u6CD5\u3002</li><li>\u5BF9\u4E8E\u6BCF\u4E00\u4E2A\u5C5E\u6027\u4F1A\u589E\u52A0\u4E00\u4E2A\u89C2\u5BDF\u8005 ObservableValue \uFF0C\u7136\u540E\u628A\u5F53\u524D ObservableValue \u653E\u5165\u7BA1\u7406\u8005 ObservableAdministration \u7684 values_ \u5C5E\u6027\u4E0A\u3002</li></ul><p>\u5230\u6B64\u4E3A\u6B62\uFF0C\u5F62\u6210\u4E86\u5982\u4E0B\u7684\u6A21\u578B\u56FE\u7ED3\u6784\uFF1A</p><p><img src="https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/b46e88e4ac7c4a24a61c4e9bc56617e8~tplv-k3u1fbpfcp-watermark.awebp" alt="3.jpg" loading="lazy"></p><h3 id="_2-\u4F9D\u8D56\u6536\u96C6" tabindex="-1"><a class="header-anchor" href="#_2-\u4F9D\u8D56\u6536\u96C6" aria-hidden="true">#</a> 2 \u4F9D\u8D56\u6536\u96C6</h3><p>\u5982\u4E0A\u8BE6\u7EC6\u4ECB\u7ECD\u4E86\u521D\u59CB\u5316\u8FC7\u7A0B\uFF0C\u63A5\u4E0B\u6765\u4E00\u8D77\u7814\u7A76\u4E00\u4E0B\u4F9D\u8D56\u6536\u96C6\u6D41\u7A0B\u3002\u901A\u8FC7\u521D\u59CB\u5316\u8FC7\u7A0B\uFF0C\u8FD8\u9057\u7559\u4E00\u70B9\u5C31\u662F ObservableValue \u505A\u4E86\u54EA\u4E9B\u4E8B\uFF1F</p><h4 id="_1\u89C2\u5BDF\u8005\u2014\u2014observablevalue" tabindex="-1"><a class="header-anchor" href="#_1\u89C2\u5BDF\u8005\u2014\u2014observablevalue" aria-hidden="true">#</a> \u2460\u89C2\u5BDF\u8005\u2014\u2014ObservableValue</h4><p>\u4E0A\u9762\u6211\u77E5\u9053\u4E86\u53EA\u8981\u901A\u8FC7 @observable \u5305\u88F9\uFF0C\u5C31\u4F1A\u521B\u5EFA\u4E00\u4E2A ObservableValue \u3002</p><p>\u5728 Mobx \u6709\u4E00\u4E2A\u6838\u5FC3\u7684\u601D\u60F3\u5C31\u662F Atom \u4E3B\u8981\u662F\u6536\u96C6\u4F9D\u8D56\uFF0C\u901A\u77E5\u4F9D\u8D56\u3002\u5148\u6765\u770B\u4E00\u4E0B Atom \u7684\u91CD\u70B9\u65B9\u6CD5:</p><blockquote><p>mobx/src/core/atom.ts</p></blockquote><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Atom</span><span class="token punctuation">{</span>
    observers_ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">/* \u5B58\u653E\u6BCF\u4E2A\u7EC4\u4EF6\u7684 */</span>
    <span class="token comment">/* value\u6539\u53D8\uFF0C\u901A\u77E5\u66F4\u65B0 */</span>
    <span class="token function">reportChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">startBatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token function">propagateChanged</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
        <span class="token function">endBatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/* \u6536\u96C6\u4F9D\u8D56 */</span>
    <span class="token function">reportObserved</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">reportObserved</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ObservableValue \u7EE7\u627F\u4E86 Atom\u3002</p><blockquote><p>mobx/src/types/observablevalue.ts</p></blockquote><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">ObservableValue</span> <span class="token keyword">extends</span> <span class="token class-name">Atom</span><span class="token punctuation">{</span>
    <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">//adm.getObservablePropValue_ \u88AB\u8C03\u7528</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">reportObserved</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// \u8C03\u7528Atom\u4E2D reportObserved</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">dehanceValue</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value_<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">setNewValue_</span><span class="token punctuation">(</span><span class="token parameter">newValue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// adm.setObservablePropValue_</span>
        <span class="token keyword">const</span> oldValue <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value_
        <span class="token keyword">this</span><span class="token punctuation">.</span>value_ <span class="token operator">=</span> newValue
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">reportChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// \u8C03\u7528Atom\u4E2DreportChanged</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u91CD\u70B9\u770B\u4E00\u4E0B\u5728\u89C2\u5BDF\u8005\u5C5E\u6027\u7BA1\u7406\u8005\u6700\u7EC8\u8C03\u7528\u7684\u4E24\u4E2A\u65B9\u6CD5\u2014\u2014 <code>get</code> \u548C <code>setNewValue_</code> \u3002</p><h4 id="_2\u6CE8\u5165\u6A21\u5757\u2014\u2014provider\u548Cinject-mobx-react" tabindex="-1"><a class="header-anchor" href="#_2\u6CE8\u5165\u6A21\u5757\u2014\u2014provider\u548Cinject-mobx-react" aria-hidden="true">#</a> \u2461\u6CE8\u5165\u6A21\u5757\u2014\u2014Provider\u548Cinject\uFF08mobx-react\uFF09</h4><p>\u65E2\u7136\u89C2\u5BDF\u8005\u6A21\u5757\u5DF2\u7ECF\u641E\u5B9A\uFF0C\u90A3\u4E48\u63A5\u4E0B\u6765\u770B\u4E00\u4E0B\uFF0C<code>mobx-react</code> \u5982\u4F55\u5C06\u6A21\u5757\u6CE8\u5165\u5230\u5BF9\u5E94\u7684\u7EC4\u4EF6\u4E2D\u7684\u3002</p><p><strong>Provider</strong></p><blockquote><p>mobx-react/src/Provider.tsx</p></blockquote><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> MobXProviderContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">Provider</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>MobXProviderContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">{</span>value<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>MobXProviderContext<span class="token punctuation">.</span>Provider<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>mobx-react \u4E2D\u7684 Provide r\u975E\u5E38\u7B80\u5355\uFF0C\u5C31\u662F\u521B\u5EFA\u4E00\u4E2A\u4E0A\u4E0B\u6587 context \uFF0C\u5E76\u901A\u8FC7 context.Provider \u4F20\u9012\u4E0A\u4E0B\u6587\u3002</li></ul><p><strong>inject</strong></p><blockquote><p>mobx-react/src/inject.ts</p></blockquote><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>storeNames</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token keyword">const</span> Injector <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">forwardRef</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> ref</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">let</span> newProps <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>props <span class="token punctuation">}</span>
        <span class="token keyword">const</span> context <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useContext</span><span class="token punctuation">(</span>MobXProviderContext<span class="token punctuation">)</span>
        storeNames<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">storeName</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">//storeNames - [ &#39;Root&#39; ]</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>storeName <span class="token keyword">in</span> newProps<span class="token punctuation">)</span> <span class="token keyword">return</span> 
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>storeName <span class="token keyword">in</span> context<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token comment">/* \u5C06mobx\u72B6\u6001\u4ECEcontext\u4E2D\u6DF7\u5165\u5230props\u4E2D\u3002 */</span>
                newProps<span class="token punctuation">[</span>storeName<span class="token punctuation">]</span> <span class="token operator">=</span> context<span class="token punctuation">[</span>storeName<span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>component<span class="token punctuation">,</span> newProps<span class="token punctuation">)</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
   <span class="token keyword">return</span> Injector 
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E3A\u4E86\u8BA9\u5927\u5BB6\u66F4\u6E05\u6670\u6D41\u7A0B\uFF0Cinject \u662F\u5408\u5E76\u52A0\u4E0A\u7B80\u5316\u540E\u7684\u3002</p><ul><li>inject \u4F5C\u7528\u5F88\u7B80\u5355\uFF0C\u5C31\u662F\u5C06 mobx \u7684\u72B6\u6001\uFF0C\u4ECE context \u4E2D\u6DF7\u5165 props \u4E2D\u3002</li></ul><h4 id="_3\u53EF\u89C2\u5BDF\u7EC4\u4EF6\u2014\u2014-observer-mobx-react" tabindex="-1"><a class="header-anchor" href="#_3\u53EF\u89C2\u5BDF\u7EC4\u4EF6\u2014\u2014-observer-mobx-react" aria-hidden="true">#</a> \u2462\u53EF\u89C2\u5BDF\u7EC4\u4EF6\u2014\u2014 observer\uFF08 mobx-react \uFF09</h4><p>\u88AB observe \u7684\u7EC4\u4EF6\uFF0C\u88AB\u8D4B\u4E88\u4E00\u9879\u529F\u80FD\uFF0C\u5C31\u662F\u53EF\u89C2\u5BDF\u7684\uFF0C\u5F53\u91CC\u9762\u5F15\u7528\u4E86 mobx \u4E2D\u7684 ObservableValue \uFF0C\u5F53 ObservableValue \u6539\u53D8\uFF0C\u7EC4\u4EF6\u4F1A\u66F4\u65B0\u3002 \u63A5\u4E0B\u6765\u5C31\u662F\u6838\u5FC3\u4E86\uFF0C\u9700\u8981\u770B\u4E00\u4E0B\u88AB observe \u5305\u88F9\u7684\u7EC4\u4EF6\u4F1A<strong>\u6709\u54EA\u4E9B\u65B0\u7279\u5F81</strong>\uFF0C<strong>\u4EE5\u53CA\u5982\u4F55\u6536\u96C6\u7684\u4F9D\u8D56</strong>\uFF0C<strong>\u53C8\u662F\u5982\u4F55\u66F4\u65B0\u7684</strong>\u3002\u88AB observe \u7684\u7EC4\u4EF6\u5206\u4E3A\u51FD\u6570\u7EC4\u4EF6\u548C\u7C7B\u7EC4\u4EF6\u4E24\u79CD\u60C5\u51B5\uFF0C\u4E3A\u4E86\u8BA9\u5927\u5BB6\u660E\u767D\u6D41\u7A0B\uFF0C\u6211\u8FD9\u91CC\u53EA\u8BB2\u4E86\u7C7B\u7EC4\u4EF6\u7684\u60C5\u51B5\u3002</p><p><strong>observer</strong></p><blockquote><p>mobx-react/src/observer.tsx</p></blockquote><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">observer</span><span class="token punctuation">(</span><span class="token parameter">componentClass</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">/* componentClass \u662F\u7C7B\u7EC4\u4EF6\u7684\u60C5\u51B5 (\u51FD\u6570\u7EC4\u4EF6\u6211\u4EEC\u6682\u4E14\u5FFD\u7565) */</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">makeClassComponentObserver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">const</span> target <span class="token operator">=</span> componentClass<span class="token punctuation">.</span>prototype
        <span class="token keyword">const</span> baseRender <span class="token operator">=</span> target<span class="token punctuation">.</span>render <span class="token comment">/* \u8FD9\u4E2A\u662F\u539F\u6765\u7EC4\u4EF6\u7684render */</span>
        <span class="token comment">/* \u52AB\u6301render\u51FD\u6570 */</span>
        target<span class="token punctuation">.</span><span class="token function-variable function">render</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">makeComponentReactive</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> baseRender<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>\u5230\u8FD9\u91CC\u57FA\u672C\u53EF\u4EE5\u5F04\u6E05\u695A mobx-react \u4E2D observer HOC \u7684\u4F5C\u7528\u4E86\u2014\u2014<strong>\u6E32\u67D3 render \u7684\u52AB\u6301</strong>\u3002\u901A\u8FC7\u52AB\u6301 render \u51FD\u6570\u6267\u884C\uFF0C\u6536\u96C6\u91CC\u9762\u7684\u4F9D\u8D56\u3002</li></ul><p><strong>makeComponentReactive</strong></p><blockquote><p>mobx-react/src/observerClass.ts</p></blockquote><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">makeComponentReactive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> baseRender <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token comment">// baseRender\u4E3A\u771F\u6B63\u7684render\u65B9\u6CD5</span>
     <span class="token comment">/* \u521B\u5EFA\u4E00\u4E2A\u53CD\u5E94\u5668\uFF0C\u7ED1\u5B9A\u7C7B\u7EC4\u4EF6\u7684\u66F4\u65B0\u51FD\u6570 \u2014\u2014 forceUpdate  */</span>
     <span class="token keyword">const</span> reaction <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Reaction</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>initialName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.render()</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
          <span class="token class-name">Component</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">forceUpdate</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token comment">/* forceUpdate \u4E3A\u7C7B\u7EC4\u4EF6\u66F4\u65B0\u51FD\u6570 */</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span>
    reaction<span class="token punctuation">[</span><span class="token string">&quot;reactComponent&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span>    <span class="token comment">/* Reaction \u548C \u7EC4\u4EF6\u5B9E\u4F8B\u5EFA\u7ACB\u8D77\u5173\u8054 */</span>
    reactiveRender<span class="token punctuation">[</span><span class="token string">&quot;$mobx&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> reaction
    <span class="token keyword">this</span><span class="token punctuation">.</span>render <span class="token operator">=</span> reactiveRender 
    <span class="token keyword">function</span> <span class="token function">reactiveRender</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* \u6539\u9020\u7684\u54CD\u5E94\u5F0Frender\u65B9\u6CD5 */</span>
        reaction<span class="token punctuation">.</span><span class="token function">track</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token comment">// track\u4E2D\u8FDB\u884C\u771F\u6B63\u7684\u4F9D\u8D56\u6536\u96C6</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                rendering <span class="token operator">=</span> <span class="token function">baseRender</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">/* \u6267\u884C\u66F4\u65B0\u51FD\u6570 */</span>
            <span class="token punctuation">}</span> 
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> rendering
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">reactiveRender</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>makeComponentReactive</code> \u901A\u8FC7\u6539\u9020 render \u51FD\u6570\uFF0C\u6765\u5B9E\u73B0\u4F9D\u8D56\u7684\u6536\u96C6\uFF0C\u91CC\u9762\u5305\u542B\u4E86\u5F88\u591A\u6838\u5FC3\u6D41\u7A0B\u3002</p><ul><li>\u6BCF\u4E00\u4E2A\u7EC4\u4EF6\u4F1A\u521B\u5EFA\u4E00\u4E2A Reaction\uFF0CReaction \u7684\u7B2C\u4E8C\u4E2A\u53C2\u6570\u5185\u90E8\u5C01\u88C5\u4E86\u66F4\u65B0\u7EC4\u4EF6\u7684\u65B9\u6CD5\u3002\u90A3\u4E48\u5982\u679C\u89E6\u53D1\u53EF\u89C2\u5BDF\u5C5E\u6027\u7684 set \uFF0C\u90A3\u4E48\u6700\u540E\u89E6\u53D1\u66F4\u65B0\u7684\u5C31\u662F\u8FD9\u4E2A\u65B9\u6CD5\uFF0C\u5BF9\u4E8E\u7C7B\u7EC4\u4EF6\u672C\u8D28\u4E0A\u5C31\u662F\u7684 <code>forceUpdate</code> \u65B9\u6CD5\u3002</li><li>\u5BF9 render \u51FD\u6570\u8FDB\u884C\u6539\u9020\uFF0C\u6539\u9020\u6210 reactiveRender \uFF0C\u5728 reactiveRender \u4E2D\uFF0Creaction.track \u662F\u771F\u6B63\u7684\u8FDB\u884C\u4F9D\u8D56\u7684\u6536\u96C6\uFF0Ctrack \u56DE\u8C03\u51FD\u6570\u4E2D\uFF0C\u6267\u884C\u771F\u6B63\u7684 render \u65B9\u6CD5\uFF0C\u5F97\u5230 element \u5BF9\u8C61 rendering \u3002</li></ul><h4 id="_4\u53CD\u5E94\u5668\u2014\u2014reaction" tabindex="-1"><a class="header-anchor" href="#_4\u53CD\u5E94\u5668\u2014\u2014reaction" aria-hidden="true">#</a> \u2463\u53CD\u5E94\u5668\u2014\u2014Reaction</h4><p>\u90A3\u4E48\u63A5\u4E0B\u6765\u91CD\u70B9\u770B\u4E00\u4E0B Reaction \u5982\u4F55\u5904\u7406\u66F4\u65B0\u51FD\u6570\uFF0C\u8FD8\u6709\u5C31\u662F track \u65B9\u6CD5\u662F\u5982\u4F55\u6536\u96C6\u4F9D\u8D56\u7684\u3002\u5728\u5982\u4E0B track \u4E2D\uFF0C\u6211\u6807\u8BB0\u4E86\u4E09\u4E2A\u9636\u6BB5\uFF0C\u9605\u8BFB\u7684\u540C\u5B66\u8BF7\u7EC6\u5FC3\u770B\u8FD9\u4E2A\u4E09\u9636\u6BB5\u90FD\u505A\u4E86\u4E9B\u4EC0\u4E48\u3002</p><blockquote><p>mobx/src/core/reaction.ts</p></blockquote><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code> <span class="token keyword">class</span> <span class="token class-name">Reaction</span><span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name_<span class="token punctuation">,</span>onInvalidate_</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>name_ <span class="token operator">=</span> name_
       <span class="token keyword">this</span><span class="token punctuation">.</span>onInvalidate_ <span class="token operator">=</span> onInvalidate_ <span class="token comment">/* onInvalidate_ \u91CC\u9762\u6709\u7EC4\u4EF6\u7684forceUpdate\u51FD\u6570\uFF0C\u7528\u4E8E\u66F4\u65B0\u7EC4\u4EF6 */</span>
    <span class="token punctuation">}</span>
    <span class="token function">onBecomeStale_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">schedule_</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">/* \u89E6\u53D1\u8C03\u5EA6\u66F4\u65B0 */</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/* \u5F00\u542F\u8C03\u5EA6\u66F4\u65B0 */</span>
    <span class="token function">schedule_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>isScheduled_<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>isScheduled_ <span class="token operator">=</span> <span class="token boolean">true</span>
            globalState<span class="token punctuation">.</span>pendingReactions<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
            <span class="token function">runReactions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/* \u66F4\u65B0 */</span>
    <span class="token function">runReaction_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">startBatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>isScheduled_ <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token keyword">const</span> prev <span class="token operator">=</span> globalState<span class="token punctuation">.</span>trackingContext
        globalState<span class="token punctuation">.</span>trackingContext <span class="token operator">=</span> <span class="token keyword">this</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onInvalidate_</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">/* \u66F4\u65B0\u7EC4\u4EF6  */</span>
        globalState<span class="token punctuation">.</span>trackingContext <span class="token operator">=</span> prev
        <span class="token function">endBatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/* \u6536\u96C6\u4F9D\u8D56 */</span>
    <span class="token function">track</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">startBatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">/* \u7B2C\u4E00\u9636\u6BB5 */</span>
        <span class="token keyword">const</span> prevTracking <span class="token operator">=</span> globalState<span class="token punctuation">.</span>trackingDerivation
        globalState<span class="token punctuation">.</span>trackingDerivation <span class="token operator">=</span> <span class="token keyword">this</span>
        <span class="token comment">/* \u7B2C\u4E8C\u9636\u6BB5 */</span>
        <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span>
        globalState<span class="token punctuation">.</span>trackingDerivation <span class="token operator">=</span> prevTracking
        <span class="token comment">/* \u7B2C\u4E09\u9636\u6BB5 */</span>
        <span class="token function">bindDependencies</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> 
    <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u8FD9\u4E2A\u51FD\u6570\u7279\u522B\u91CD\u8981\uFF0C\u662F\u6574\u4E2A\u6536\u96C6\u4F9D\u8D56\u6838\u5FC3\u3002</strong></p><ul><li>\u7B2C\u4E00\u9636\u6BB5\uFF1A \u9996\u5148\u5728\u6267\u884C track \u7684\u65F6\u5019\uFF0C\u4F1A\u628A\u5168\u5C40\u53D8\u91CF\u7684 <code>trackingDerivation</code>\uFF0C\u6307\u5411\u5F53\u524D\u7684 trackingDerivation \u3002\u8FD9\u6837\u5728\u6536\u96C6\u4F9D\u8D56\u7684\u8FC7\u7A0B\u4E2D\uFF0C\u53EF\u4EE5\u76F4\u63A5\u6536\u96C6\u5F53\u524D\u7684 trackingDerivation \uFF0C\u4E5F\u5C31\u662F\u4E3A\u4EC0\u4E48 ObservableValue \u80FD\u7CBE\u786E\u6536\u96C6\u6BCF\u4E00\u4E2A Reaction \u3002</li><li>\u7B2C\u4E8C\u9636\u6BB5\uFF1A\u9996\u5148\u5F53\u88AB observer \u5305\u88C5\u7684\u7EC4\u4EF6\uFF0C\u53EA\u8981\u6267\u884C render \u51FD\u6570\uFF0C\u5C31\u4F1A\u6267\u884C track \u65B9\u6CD5\uFF0C<code>fn.call(context)</code>\uFF0C\u771F\u6B63\u7684r ender \u51FD\u6570\u4F1A\u5728\u91CC\u9762\u6267\u884C\uFF0C\u5982\u679C\u5728 render \u7684\u8FC7\u7A0B\u4E2D\uFF0C\u5F15\u7528\u4E86 mobx \u53EF\u89C2\u5BDF\u6A21\u5757\uFF0C\u6BD4\u5982\uFF1A</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>@<span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">&#39;Root&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Index</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span> 
           <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>Root<span class="token punctuation">.</span>name <span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span> 
           <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>Root<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&#39;\u300AReact\u8FDB\u9636\u5B9E\u8DF5\u6307\u5357\u300B666&#39;</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">&gt;</span>\u6539\u53D8Mobx\u4E2Dname<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>\u7B2C\u4E8C\u9636\u6BB5\uFF1A\u5F53\u5982\u4E0A render \u6267\u884C\u7684\u65F6\u5019\uFF0C\u9996\u5148\u4F1A\u89E6\u53D1 track \uFF0C\u5C06\u5F53\u524DReaction \u8D4B\u503C\u7ED9 trackingDerivation \uFF0C\u7136\u540E\u8BBF\u95EE\u4E86 Root \u4E0B\u9762\u7684name \u5C5E\u6027\uFF0C\u90A3\u4E48\u9996\u5148\u4F1A\u89E6\u53D1\u89C2\u5BDF\u72B6\u6001\u7BA1\u7406\u8005\u7684 adm \u7684 getObservablePropValue_ \uFF0C\u63A5\u4E0B\u6765\u4F1A\u89E6\u53D1 name \u5C5E\u6027\u7684\u89C2\u5BDF\u8005 ObservableValue \u4E0B\u9762\u7684 get \u65B9\u6CD5\uFF0C\u6700\u540E\u6267\u884C\u7684\u662F <code>reportObserved(this)</code>\uFF0C\u770B\u4E00\u4E0B reportObserved \u91CC\u9762\u505A\u4E86\u5199\u4EC0\u4E48\uFF1F</li></ul><blockquote><p>mobx/src/core/observable.ts</p></blockquote><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">reportObserved</span><span class="token punctuation">(</span><span class="token parameter">observable</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">/* \u6B64\u65F6\u83B7\u53D6\u5230\u5F53\u524D\u51FD\u6570\u5BF9\u5E94\u7684 Reaction\u3002 */</span>
    <span class="token keyword">const</span> derivation <span class="token operator">=</span> globalState<span class="token punctuation">.</span>trackingDerivation 
    <span class="token comment">/* \u5C06\u5F53\u524D\u7684 observable \u5B58\u653E\u5230 Reaction \u7684 newObserving_ \u4E2D\u3002 */</span>
    derivation<span class="token punctuation">.</span>newObserving_<span class="token operator">!</span><span class="token punctuation">[</span>derivation<span class="token punctuation">.</span>unboundDepsCount_<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> observable 
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>\u7B2C\u4E8C\u9636\u6BB5\uFF1AreportObserved \u505A\u7684\u4E8B\u60C5\u975E\u5E38\u76F4\u63A5\uFF0C\u5C31\u662F\u5C06\u5F53\u524D\u7684 observable \u653E\u5165 Reaction \u7684 newObserving_ \u4E2D\uFF0C\u8FD9\u6837\u5C31\u628A\u89C2\u5BDF\u8005\u5C5E\u6027\uFF08\u5982\u4E0A\u4F8B\u5B50\u4E2D\u7684name\uFF09\u548C\u7EC4\u4EF6\u5BF9\u5E94\u7684 Reaction \u5EFA\u7ACB\u8D77\u5173\u8054\u3002</li></ul><p>\u5F53\u7EC4\u4EF6\u4E2D render \u51FD\u6570\u6267\u884C\u5B8C\u6BD5\uFF0C\u4E5F\u5C31\u662F jsx \u4E2D\u7684\u4F9D\u8D56\u5168\u90E8\u6536\u96C6\u5B8C\u6210\uFF0C\u5C31\u4F1A\u5230\u7B2C\u4E09\u9636\u6BB5\uFF0C\u7EC6\u5FC3\u7684\u540C\u5B66\u53D1\u73B0\uFF0C\u4E0A\u8FF0\u53EA\u662F ObservableValue \u5230 Reaction \u6536\u96C6\uFF0C\u4F46\u662F\u6CA1\u6709 Reaction \u5230 ObservableValue \uFF0C\u4E5F\u5C31\u662F\u8BF4 ObservableValue \u91CC\u9762\u8FD8\u6CA1\u6709\u7EC4\u4EF6\u7684 Reaction\uFF0C\u522B\u7740\u6025\uFF0C\u8FD9\u4E2A\u90FD\u662F\u7B2C\u4E09\u9636\u6BB5\u7684 <code>bindDependencies</code> \u505A\u7684\u4E8B\u3002</p><blockquote><p>mobx/src/core/derivation.ts</p></blockquote><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">bindDependencies</span><span class="token punctuation">(</span><span class="token parameter">Reaction</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">/* \u5F53\u524D\u7EC4\u4EF6\u7684 Reaction */</span>
    <span class="token keyword">const</span> prevObserving <span class="token operator">=</span> derivation<span class="token punctuation">.</span>observing_ <span class="token comment">/* \u4E4B\u524D\u7684observing_ */</span>
    <span class="token keyword">const</span> observing <span class="token operator">=</span> <span class="token punctuation">(</span>derivation<span class="token punctuation">.</span>observing_ <span class="token operator">=</span> derivation<span class="token punctuation">.</span>newObserving_<span class="token operator">!</span><span class="token punctuation">)</span> <span class="token comment">/* \u65B0\u7684observing_  */</span>
    <span class="token keyword">let</span> l <span class="token operator">=</span> prevObserving<span class="token punctuation">.</span>length
    <span class="token keyword">while</span> <span class="token punctuation">(</span>l<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* observableValue \u5220\u9664\u4E4B\u524D\u7684 Reaction  */</span>
        <span class="token keyword">const</span> observableValue <span class="token operator">=</span> prevObserving<span class="token punctuation">[</span>l<span class="token punctuation">]</span>
        observable<span class="token punctuation">.</span>observers_<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>Reaction<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">let</span> i0 <span class="token operator">=</span> observing<span class="token punctuation">.</span>length 
    <span class="token keyword">while</span> <span class="token punctuation">(</span>i0<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* \u7ED9renderhanobservableValue\u91CD\u65B0\u6DFB\u52A0 Reaction  */</span>
        <span class="token keyword">const</span> observableValue <span class="token operator">=</span> observing<span class="token punctuation">[</span>i0<span class="token punctuation">]</span>
         observable<span class="token punctuation">.</span>observers_<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>Reaction<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>\u7B2C\u4E09\u9636\u6BB5\uFF1A bindDependencies \u4E3B\u8981\u505A\u7684\u4E8B\u60C5\u5982\u4E0B\uFF1A</li></ul><p>\u2460 \u5BF9\u4E8E\u6709<strong>\u5F53\u524D Reaction</strong>\u7684 observableValue\uFF0CobservableValue\u4F1A\u7EDF\u4E00\u5220\u9664\u6389\u91CC\u9762\u7684 Reaction\u3002 \u2461 \u4F1A\u7ED9\u8FD9\u4E00\u6B21 render \u4E2D\u7528\u5230\u7684\u65B0\u7684\u4F9D\u8D56 observableValue \uFF0C\u7EDF\u4E00\u6DFB\u52A0\u5F53\u524D\u7684 Reaction \u3002 \u2462 \u8FD8\u4F1A\u6709\u4E00\u4E9B\u7EC6\u8282\uFF0C\u6BD4\u5982\u8BF4\u5728 render \u4E2D\uFF0C\u5F15\u5165\u4E24\u6B21\u76F8\u540C\u7684\u503C\uFF08\u5982\u4E0A\u7684 demo \u4E2D\u7684 name \uFF09\uFF0C\u4F1A\u7EDF\u4E00\u6536\u96C6\u4E00\u6B21\u4F9D\u8D56\u3002</p><p>\u4F9D\u8D56\u6536\u96C6\u6D41\u7A0B\u56FE\uFF1A</p><p><img src="https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/5712e9017d4946fbac0876ddf2542e6c~tplv-k3u1fbpfcp-watermark.awebp" alt="4.jpeg" loading="lazy"></p><h3 id="_3-\u6D3E\u53D1\u66F4\u65B0" tabindex="-1"><a class="header-anchor" href="#_3-\u6D3E\u53D1\u66F4\u65B0" aria-hidden="true">#</a> 3 \u6D3E\u53D1\u66F4\u65B0</h3><p>\u63A5\u4E0B\u6765\u5C31\u662F\u4E00\u6B21\u66F4\u65B0\u4E2D\uFF0C\u6BD4\u5982\u5728\uFF08 DEMO1 \uFF09\u4E2D\u70B9\u51FB\u6309\u94AE\uFF0C\u901A\u8FC7 action \uFF0C\u6539\u53D8 mobx \u4E2D\u7684 name \u5C5E\u6027\u3002\u90A3\u4E48\u4F1A\u53D1\u751F\u4EC0\u4E48\u5462\u3002</p><ul><li><strong>\u7B2C\u4E00\u6B65\uFF1A</strong> \u9996\u5148\u5BF9\u4E8E\u89C2\u5BDF\u8005\u5C5E\u6027\u7BA1\u7406\u8005 ObservableAdministration \u4F1A\u89E6\u53D1 setObservablePropValue_ \uFF0C\u7136\u540E\u627E\u5230\u5BF9\u5E94\u7684 ObservableValue \u89E6\u53D1 setNewValue_ \u65B9\u6CD5\u3002</li><li><strong>\u7B2C\u4E8C\u6B65\uFF1A</strong> setNewValue_ \u672C\u8D28\u4E0A\u4F1A\u89E6\u53D1Atom\u4E2D\u7684reportChanged \uFF0C\u7136\u540E\u8C03\u7528 <code>propagateChanged</code>\u3002\u9996\u5148\u6765\u770B\u4E00\u4E0BpropagateChanged\uFF1A</li></ul><blockquote><p>mobx/src/core/observable.ts</p></blockquote><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">propagateChanged</span><span class="token punctuation">(</span><span class="token parameter">observable</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    observable<span class="token punctuation">.</span>observers_<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">Reaction</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        Reaction<span class="token punctuation">.</span><span class="token function">onBecomeStale_</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8C03\u7528 <code>propagateChanged</code> \u89E6\u53D1\uFF0C\u4F9D\u8D56\u4E8E\u5F53\u524D\u7EC4\u4EF6\u7684\u6240\u6709 Reaction \u4F1A\u89E6\u53D1 onBecomeStale_ \u65B9\u6CD5\u3002</p><ul><li><strong>\u7B2C\u4E09\u6B65\uFF1A</strong> Reaction \u7684 onBecomeStale_ \u89E6\u53D1\uFF0C\u4F1A\u8BA9Reaction \u7684 schedule_ \u6267\u884C\uFF0C\u6CE8\u610F\u4E00\u4E0B\u8FD9\u91CC schedule_ \u4F1A\u5F00\u542F\u66F4\u65B0\u8C03\u5EA6\u3002\u4EC0\u4E48\u53EB\u66F4\u65B0\u8C03\u5EA6\u5462\u3002\u5C31\u662F schedule_ \u5E76\u4E0D\u4F1A\u9A6C\u4E0A\u6267\u884C\u7EC4\u4EF6\u66F4\u65B0\uFF0C\u800C\u662F\u628A\u5F53\u524D\u7684 Reaction \u653E\u5165 globalState.pendingReactions\uFF08\u5F85\u66F4\u65B0 Reaction \u961F\u5217\uFF09\u4E2D\uFF0C\u7136\u540E\u4F1A\u6267\u884C runReactions \u5916\u90E8\u65B9\u6CD5\u3002</li></ul><blockquote><p>mobx/src/core/reaction.ts</p></blockquote><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">runReactions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>globalState<span class="token punctuation">.</span>inBatch <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">||</span> globalState<span class="token punctuation">.</span>isRunningReactions<span class="token punctuation">)</span> <span class="token keyword">return</span>
    globalState<span class="token punctuation">.</span>isRunningReactions <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token keyword">const</span> allReactions <span class="token operator">=</span> globalState<span class="token punctuation">.</span>pendingReactions
    <span class="token comment">/* \u8FD9\u91CC\u7684\u4EE3\u7801\u662F\u7ECF\u8FC7\u4FEE\u6539\u8FC7\u540E\u7684\uFF0C\u6E90\u7801\u4E2D\u8981\u6BD4 */</span>
    allReactions<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">Reaction</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
         <span class="token comment">/* \u6267\u884C\u6BCF\u4E00\u4E2A\u7EC4\u4EF6\u7684\u66F4\u65B0\u51FD\u6570 */</span>
         Reaction<span class="token punctuation">.</span><span class="token function">runReaction_</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    globalState<span class="token punctuation">.</span>pendingReactions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    globalState<span class="token punctuation">.</span>isRunningReactions <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>\u7B2C\u56DB\u6B65\uFF1A</strong> \u6267\u884C\u6BCF\u4E00\u4E2A Reaction \uFF0C\u5F53\u4E00\u4E2A ObservableValue \u7684\u5C5E\u6027\u503C\u6539\u53D8\uFF0C\u53EF\u4EE5\u6536\u96C6\u4E86\u591A\u4E2A\u7EC4\u4EF6\u7684\u4F9D\u8D56\uFF0C\u6240\u4EE5 mobx \u7528\u8FD9\u4E2A\u8C03\u5EA6\u673A\u5236\uFF0C\u5148\u628A\u6BCF\u4E00\u4E2A Reaction \u653E\u5165 pendingReactions \u4E2D\uFF0C\u7136\u540E\u96C6\u4E2D\u5904\u7406\u8FD9\u4E9B Reaction \uFF0C Reaction \u4F1A\u89E6\u53D1 <code>runReaction_()</code> \u65B9\u6CD5\uFF0C\u4F1A\u89E6\u53D1 onInvalidate_ \u2014\u2014\u7C7B\u7EC4\u4EF6\u7684 forceupdate \u65B9\u6CD5\u5B8C\u6210\u7EC4\u4EF6\u66F4\u65B0\u3002</li></ul><p>\u501F\u6B64\u5B8C\u6210\u6574\u4E2A\u6D41\u7A0B\u3002</p><p>\u72B6\u6001\u6D3E\u53D1\u6D41\u7A0B\u56FE\uFF1A</p><p><img src="https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/606265172f9649e59b16c783923f4dd4~tplv-k3u1fbpfcp-watermark.awebp" alt="5.jpeg" loading="lazy"></p><h2 id="\u4E94-mobx\u4E0Eredux\u533A\u522B" tabindex="-1"><a class="header-anchor" href="#\u4E94-mobx\u4E0Eredux\u533A\u522B" aria-hidden="true">#</a> \u4E94 Mobx\u4E0ERedux\u533A\u522B</h2><ul><li>\u9996\u5148\u5728 Mobx \u5728\u4E0A\u624B\u7A0B\u5EA6\u4E0A\uFF0C\u8981\u4F18\u4E8E Redux \uFF0C\u6BD4\u5982 Redux \u60F3\u4F7F\u7528\u5F02\u6B65\uFF0C\u9700\u8981\u914D\u5408\u4E2D\u95F4\u4EF7\uFF0C\u6D41\u7A0B\u6BD4\u8F83\u590D\u6742\u3002</li><li>Redux \u5BF9\u4E8E\u6570\u636E\u6D41\u5411\u66F4\u89C4\u8303\u5316\uFF0CMobx \u4E2D\u6570\u636E\u66F4\u52A0\u591A\u6837\u5316\uFF0C\u5141\u8BB8\u6570\u636E\u5197\u4F59\u3002</li><li>Redux \u6574\u4F53\u6570\u636E\u6D41\u5411\u7B80\u5355\uFF0CMobx \u4F9D\u8D56\u4E8E Proxy\uFF0C Object.defineProperty \u7B49\uFF0C\u52AB\u6301\u5C5E\u6027 get \uFF0Cset \uFF0C\u6570\u636E\u53D8\u5316\u591A\u6837\u6027\u3002</li><li>Redux \u53EF\u62D3\u5C55\u6027\u6BD4\u8F83\u5F3A\uFF0C\u53EF\u4EE5\u901A\u8FC7\u4E2D\u95F4\u4EF6\u81EA\u5B9A\u4E49\u589E\u5F3A dispatch \u3002</li><li>\u5728 Redux \u4E2D\uFF0C\u57FA\u672C\u6709\u4E00\u4E2A store \uFF0C\u7EDF\u4E00\u7BA1\u7406 store \u4E0B\u7684\u72B6\u6001\uFF0C\u5728 mobx \u4E2D\u53EF\u4EE5\u6709\u591A\u4E2A\u6A21\u5757\uFF0C\u53EF\u4EE5\u7406\u89E3\u6BCF\u4E00\u4E2A\u6A21\u5757\u90FD\u662F\u4E00\u4E2A store \uFF0C\u76F8\u4E92\u4E4B\u95F4\u662F\u72EC\u7ACB\u7684\u3002</li></ul><h2 id="\u516D-\u603B\u7ED3" tabindex="-1"><a class="header-anchor" href="#\u516D-\u603B\u7ED3" aria-hidden="true">#</a> \u516D \u603B\u7ED3</h2><p>\u5E0C\u671B\u901A\u8FC7\u672C\u7AE0\u8282\u7684\u5B66\u4E60\uFF0C\u53EF\u4EE5\u5B66\u5230\u4E00\u4E0B\u5185\u5BB9\uFF1A</p><ul><li>mobx \u57FA\u672C\u4F7F\u7528\uFF0C\u5B9E\u8DF5\u72B6\u6001\u7BA1\u7406\u548C\u7EC4\u4EF6\u901A\u4FE1\u4E24\u79CD\u573A\u666F\u3002</li><li>mobx \u548C mobx-react \u539F\u7406\u3002</li><li>mobx \u548C redux \u7684\u533A\u522B\u3002</li></ul>`,171);function t(p,o){return e}var i=n(a,[["render",t],["__file","20.\u751F\u6001\u7BC7-React-mobx.html.vue"]]);export{i as default};
