# ğŸ“šæå®¢å›­M-1ã€é¡¹ç›®æ­å»ºã€‘

èµ„æ–™ï¼š

 H5 ç«¯é¡¹ç›®æ¼”ç¤ºï¼š[http://toutiao.itheima.net/](http://toutiao.itheima.net/)

 H5 ç«¯é¡¹ç›®æ¥å£æ–‡æ¡£ï¼š[http://toutiao.itheima.net/api.html](http://toutiao.itheima.net/api.html)

 H5 é¡¹ç›®ä»“åº“åœ°å€ï¼š[https://gitee.com/zqran/geek-h5-89](https://gitee.com/zqran/geek-h5-89)

### 01-é¡¹ç›®ä»‹ç»

**ç›®æ ‡**ï¼šäº†è§£é¡¹ç›®å®šä½å’ŒåŠŸèƒ½

**å†…å®¹**ï¼š

æå®¢å›­ H5 ç«¯é¡¹ç›®ï¼šä¸ªäººè‡ªåª’ä½“å‰å°

> ã€Œæå®¢å›­ã€å¯¹æ ‡`CSDN`ã€`åšå®¢å›­`ç­‰ç«å“ï¼Œè‡´åŠ›æˆä¸ºæ›´åŠ è´´è¿‘å¹´è½» IT ä»ä¸šè€…ï¼ˆå­¦å‘˜ï¼‰çš„ç§‘æŠ€èµ„è®¯ç±»åº”ç”¨ äº§å“å…³é”®è¯ï¼šITã€æå®¢ã€æ´»åŠ›ã€ç§‘æŠ€ã€æŠ€æœ¯åˆ†äº«ã€å‰æ²¿åŠ¨æ€ã€å†…å®¹ç¤¾äº¤ ç”¨æˆ·ç‰¹ç‚¹ï¼šå¹´è½»æœ‰æ´»åŠ›ï¼Œå¯¹ IT é¢†åŸŸå‰è¨€ç§‘æŠ€ä¿¡æ¯å……æ»¡æ¢ç´¢æ¬²å’Œå­¦ä¹ çƒ­æƒ…

- é¡¹ç›®åŠŸèƒ½å’Œæ¼”ç¤ºï¼ŒåŒ…æ‹¬
  - çŸ­ä¿¡ç™»å½•ã€é€€å‡º
  - é¦–é¡µ-é¢‘é“ç®¡ç†ï¼Œæ–‡ç« åˆ—è¡¨ï¼Œæ›´å¤šæ“ä½œ
  - æ–‡ç« è¯¦æƒ…-æ–‡ç« è¯¦æƒ…ï¼Œæ–‡ç« è¯„è®ºï¼Œè¯„è®ºå›å¤ï¼Œç‚¹èµï¼Œæ”¶è—ï¼Œå…³æ³¨
  - ä¸ªäººä¸­å¿ƒ-ä¸ªäººèµ„æ–™å±•ç¤ºï¼Œä¸ªäººèµ„æ–™ç¼–è¾‘
- æŠ€æœ¯æ ˆï¼š
  - é¡¹ç›®æ­å»ºï¼šReact å®˜æ–¹è„šæ‰‹æ¶ `create-react-app`
  - react hooks
  - çŠ¶æ€ç®¡ç†ï¼šredux
  - UI ç»„ä»¶åº“ï¼š`antd-mobile` v5
  - ajax è¯·æ±‚åº“ï¼š`axios`
  - è·¯ç”±ï¼š`react-router-dom` ä»¥åŠ `history`
  - CSS é¢„ç¼–è¯‘å™¨ï¼š`sass`
  - CSS Modules é¿å…ç»„ä»¶ä¹‹é—´çš„æ ·å¼å†²çª
  - **TypeScript**
  - å·¥å…·åº“ï¼šlodash
  - hooks åº“ï¼šahooks
  - websocket å³æ—¶é€šè®¯

## 02-é¡¹ç›®æ­å»º

**ç›®æ ‡**ï¼šèƒ½å¤ŸåŸºäºè„šæ‰‹æ¶æ­å»ºæ”¯æŒ TypeScript çš„é¡¹ç›®**æ­¥éª¤**ï¼š

1. ä½¿ç”¨ React CLI æ­å»ºé¡¹ç›®ï¼š`npx create-react-app geek-h5 --template typescript`
2. è¿›å…¥é¡¹ç›®æ ¹ç›®å½•ï¼š`cd é¡¹ç›®åç§°`
3. å¯åŠ¨é¡¹ç›®ï¼š`yarn start`
4. è°ƒæ•´é¡¹ç›®ç›®å½•ç»“æ„ï¼š

```tree
/src
  /assets         é¡¹ç›®èµ„æºæ–‡ä»¶ï¼Œæ¯”å¦‚ï¼Œå›¾ç‰‡ ç­‰
  /components     é€šç”¨ç»„ä»¶
  /pages          é¡µé¢
  /store          Redux çŠ¶æ€ä»“åº“
  /types          TS ç±»å‹ï¼ŒåŒ…æ‹¬ï¼šæ¥å£ã€reduxç­‰ç±»å‹
  /utils          å·¥å…·ï¼Œæ¯”å¦‚ï¼Œtokenã€axios çš„å°è£…ç­‰
  App.scss        æ ¹ç»„ä»¶æ ·å¼æ–‡ä»¶
  App.tsx         æ ¹ç»„ä»¶
  index.scss      å…¨å±€æ ·å¼
  index.tsx       é¡¹ç›®å…¥å£
```

**æ ¸å¿ƒä»£ç **ï¼š

src/index.tsx ä¸­ï¼š

```tsx
import ReactDOM from 'react-dom';
import './index.scss';
import App from './App';


ReactDOM.render(<App />, document.getElementById('root'));
```

src/index.scss ä¸­ï¼š

```scss
html,
body {
  margin: 0;
  padding: 0;
}


html,
body,
#root {
  height: 100%;
}


p,
h2,
h3 {
  margin: 0;
}
```

src/App.tsx ä¸­ï¼š

```tsx
import './App.scss';


function App() {
  return <div className="app"></div>;
}


export default App;
```

src/App.scss ä¸­ï¼š

```scss
.app {
  height: 100%;
}
```

*æ³¨ï¼šä¸ºäº†ç»Ÿä¸€æ“ä½œï¼Œç›´æ¥åˆ é™¤ src ä¸‹çš„æ‰€æœ‰æ–‡ä»¶åï¼Œå†è°ƒæ•´*

## 03-ä½¿ç”¨ SASS

**ç›®æ ‡**ï¼šèƒ½å¤Ÿåœ¨ CRA ä¸­ä½¿ç”¨ sass å†™æ ·å¼**æ­¥éª¤**ï¼š

1. å®‰è£…è§£æ sass çš„åŒ…ï¼š`yarn add sass`

## 04-ä½¿ç”¨ git/gitee ç®¡ç†é¡¹ç›®

**ç›®æ ‡**ï¼šèƒ½å¤Ÿå°†é¡¹ç›®æ¨é€åˆ° gitee è¿œç¨‹ä»“åº“**æ­¥éª¤**ï¼š

1. åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰“å¼€ç»ˆç«¯ï¼Œå¹¶åˆå§‹åŒ– git ä»“åº“ï¼ˆå¦‚æœå·²ç»æœ‰äº† git ä»“åº“ï¼Œæ— éœ€é‡å¤è¯¥æ­¥ï¼‰ï¼Œå‘½ä»¤ï¼š`git init`
2. æ·»åŠ é¡¹ç›®å†…å®¹åˆ°æš‚å­˜åŒºï¼š`git add .`
3. æäº¤é¡¹ç›®å†…å®¹åˆ°ä»“åº“åŒºï¼š`git commit -m é¡¹ç›®åˆå§‹åŒ–`
4. æ·»åŠ  remote ä»“åº“åœ°å€ï¼š`git remote add origin [gitee ä»“åº“åœ°å€]`
5. å°†é¡¹ç›®å†…å®¹æ¨é€åˆ° giteeï¼š`git push origin master -u`

- ä»¥ååªéœ€è¦ï¼š`git push origin` å³å¯

## 05-é…ç½®åŸºç¡€è·¯ç”±

**ç›®æ ‡**ï¼šèƒ½å¤Ÿé…ç½®ç™»å½•é¡µé¢çš„è·¯ç”±å¹¶æ˜¾ç¤ºåœ¨é¡µé¢ä¸­**æ­¥éª¤**ï¼š

1. å®‰è£…è·¯ç”±ï¼š`yarn add react-router-dom@5.3.0` å’Œè·¯ç”±çš„ç±»å‹å£°æ˜æ–‡ä»¶ `yarn add @types/react-router-dom -D`
2. åœ¨ pages ç›®å½•ä¸­åˆ›å»ºä¸¤ä¸ªæ–‡ä»¶å¤¹ï¼šLoginã€Layout
3. åˆ†åˆ«åœ¨ä¸¤ä¸ªç›®å½•ä¸­åˆ›å»º index.tsx æ–‡ä»¶ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªç®€å•çš„ç»„ä»¶åå¯¼å‡º
4. åœ¨ App ç»„ä»¶ä¸­ï¼Œå¯¼å…¥è·¯ç”±ç»„ä»¶ä»¥åŠä¸¤ä¸ªé¡µé¢ç»„ä»¶
5. é…ç½® Login å’Œ Layout çš„è·¯ç”±è§„åˆ™

**æ ¸å¿ƒä»£ç **ï¼š

pages/Login/index.tsx ä¸­ï¼š

```tsx
const Login = () => {
  return <div>ç™»å½•é¡µé¢</div>;
};
export default Login;
```

App.tsx ä¸­ï¼š

```tsx
// å¯¼å…¥è·¯ç”±
import { BrowserRouter as Router, Route, Switch } from 'react-router-dom';


// å¯¼å…¥é¡µé¢ç»„ä»¶
import Login from './pages/Login';
import Layout from './pages/Layout';


// é…ç½®è·¯ç”±è§„åˆ™
function App() {
  return (
    <Router>
      <div className="app">
        <Switch>
          <Route path="/home" component={Layout} />
          <Route path="/login" component={Login} />
        </Switch>
      </div>
    </Router>
  );
}


export default App;
```

## 06-é»˜è®¤å±•ç¤ºé¦–é¡µå†…å®¹

**ç›®æ ‡**ï¼šèƒ½å¤Ÿåœ¨æ‰“å¼€é¡µé¢æ—¶å°±å±•ç¤ºé¦–é¡µå†…å®¹

**åˆ†æè¯´æ˜**ï¼š

åŒ¹é…é»˜è®¤è·¯ç”±ï¼Œè¿›è¡Œé‡å®šå‘

- [Route render prop](https://reactrouter.com/web/api/Route/render-func)
- Route çš„ `render` å±æ€§ï¼šç”¨æ¥å†…è”æ¸²æŸ“ä»»æ„å†…å®¹

**æ­¥éª¤**ï¼š

1. åœ¨ App.tsx ä¸­æ·»åŠ ä¸€ä¸ªæ–°çš„ Routeï¼Œç”¨æ¥åŒ¹é…é»˜è®¤è·¯ç”±
2. ä¸º Route ç»„ä»¶æ·»åŠ  `render` å±æ€§ï¼Œç”¨æ¥æ¸²æŸ“è‡ªå®šä¹‰å†…å®¹
3. åœ¨ render ä¸­ï¼Œæ¸²æŸ“ Redirect å®ç°è·¯ç”±é‡å®šå‘

**æ ¸å¿ƒä»£ç **ï¼š

App.tsx ä¸­ï¼š

```tsx
import { Redirect } from 'react-router-dom';


<Route exact path="/" render={() => <Redirect to="/home" />} />;
```

**æ€»ç»“**ï¼š

1. Route é€šè¿‡å“ªä¸ªå±æ€§æ¥æ¸²æŸ“è‡ªå®šä¹‰å†…å®¹ï¼Ÿ
2. é€šè¿‡å“ªä¸ªç»„ä»¶æ¥å®ç°è·¯ç”±é‡å®šå‘ï¼Ÿ

## 07-antd-mobile ç»„ä»¶åº“

**ç›®æ ‡**ï¼šèƒ½å¤Ÿä½¿ç”¨ antd-mobile çš„ Button ç»„ä»¶æ¸²æŸ“æŒ‰é’®

**å†…å®¹**ï¼š

> **`antd-mobile` æ˜¯ Ant Design çš„ç§»åŠ¨è§„èŒƒçš„ React å®ç°**ï¼ŒæœåŠ¡äºèš‚èšåŠå£ç¢‘æ— çº¿ä¸šåŠ¡ã€‚**å¼€ç®±å³ç”¨**

[antd-mobile æ–‡æ¡£](https://mobile.ant.design/)

**æ­¥éª¤**ï¼š

1. å®‰è£… antd ç»„ä»¶åº“ï¼š`yarn add antd-mobile@next`
2. å¯¼å…¥ Button ç»„ä»¶
3. åœ¨ Login é¡µé¢æ¸²æŸ“ Button ç»„ä»¶

**æ ¸å¿ƒä»£ç **ï¼š

pages/Login/index.tsx ä¸­ï¼š

```tsx
import { Button } from 'antd-mobile';


const Login = () => (
  <div>
    <Button color="primary">Button</Button>
  </div>
);
```

## 08-åŸç”Ÿ CSS å˜é‡

**ç›®æ ‡**ï¼šèƒ½å¤Ÿä½¿ç”¨åŸå§‹ CSS å˜é‡

**å†…å®¹**ï¼š

- [MDN - CSS å˜é‡ï¼ˆè‡ªå®šä¹‰å±æ€§ï¼‰](https://developer.mozilla.org/zh-CN/docs/Web/CSS/Using_CSS_custom_properties)

CSS è‡ªå®šä¹‰å±æ€§ï¼Œé€šå¸¸ç§°ä¸º `CSS å˜é‡`ã€‚ç±»ä¼¼äº JS ä¸­å£°æ˜çš„å˜é‡ï¼Œå¯ä»¥**å¤ç”¨** CSS å±æ€§å€¼ã€‚æ¯”å¦‚ï¼š

```css
/* 
  æ¯”å¦‚ï¼Œé¡¹ç›®ä¸­å¤šæ¬¡ä½¿ç”¨æŸä¸€ä¸ªé¢œè‰²å€¼ï¼ŒåŸæ¥éœ€è¦é‡å¤å†™å¤šæ¬¡
*/
.list-item-active {
  color: #fc6627;
}


.tabs-item-active {
  color: #fc6627;
}


/* 
  ä½¿ç”¨ CSS å˜é‡æ¥å®ç°å¤ç”¨
*/


/* 1 åˆ›å»ºå…¨å±€ CSS å˜é‡ --geek-color-primary*/
:root {
  --geek-color-primary: #fc6627;
}
/* 2 å¤ç”¨ */
.list-item-active {
  color: var(--geek-color-primary);
}


.tabs-item-active {
  color: var(--geek-color-primary);
}
```

- ç‰¹ç‚¹ï¼š
  1. å¯å¤ç”¨
  2. è¯­ä¹‰åŒ–ï¼Œ`--geek-color-primary` æ¯” #fc6627 æ›´å®¹æ˜“è®©äººç†è§£
- æ ¹æ® CSS å˜é‡çš„ä½œç”¨åŸŸï¼Œåˆ†ä¸ºä¸¤ç§ï¼š
  1. å…¨å±€ CSS å˜é‡ï¼šå…¨å±€æœ‰æ•ˆ
  2. å±€éƒ¨ CSS å˜é‡ï¼šåªåœ¨æŸä¸ªä½œç”¨åŸŸå†…ï¼ˆæ¯”å¦‚ï¼ŒæŸä¸ªç±»åä¸­ï¼‰æœ‰æ•ˆ

```css
/*
  å…¨å±€ CSS å˜é‡
  1. ä½¿ç”¨ :root è¿™ä¸ª CSS ä¼ªç±»åŒ¹é…æ–‡æ¡£æ ‘çš„æ ¹å…ƒç´  htmlã€‚å¯ä»¥åœ¨CSSæ–‡ä»¶çš„ä»»æ„ä½ç½®ä½¿ç”¨è¯¥å˜é‡
     ç›¸å½“äº JS å˜é‡ä¸­çš„å…¨å±€
  2. CSS å˜é‡é€šè¿‡ä¸¤ä¸ªå‡å·ï¼ˆ--ï¼‰å¼€å¤´ï¼Œå¤šä¸ªå•è¯ä¹‹é—´æ¨èä½¿ç”¨ - é“¾æ¥ã€‚CSS å˜é‡åå¯ä»¥æ˜¯ä»»æ„å˜é‡å
*/
:root {
  --geek-color-primary: #fc6627;
}
/* ä½¿ç”¨ */
.tabs-item-active {
  color: var(--geek-color-primary);
}
.list-item-active {
  color: var(--geek-color-primary);
}


/* 
  å±€éƒ¨ CSS å˜é‡
*/
.list {
  --active-color: #1677ff;


  /* åœ¨è¯¥ ç±» å†…éƒ¨ä½¿ç”¨æ”¹å˜é‡ */
  color: var(--active-color);
}
.test {
  color: var(--active-color); /* é”™è¯¯æ¼”ç¤ºï¼šæ— æ•ˆï¼æ•ˆæœä¸ä¸ä½¿ç”¨è¯¥å˜é‡æ—¶ä¸€è‡´*/
}
```

## 09-ç»„ä»¶åº“ antd-mobile ä¸»é¢˜å®šåˆ¶

**ç›®æ ‡**ï¼šèƒ½å¤Ÿä½¿ç”¨åŸç”Ÿ CSS å˜é‡æ¥å®šåˆ¶æå®¢å›­é¡¹ç›®çš„ä¸»é¢˜

**å†…å®¹**ï¼š[antd-mobile ä¸»é¢˜](https://mobile.ant.design/zh/guide/theming)

**æ ¸å¿ƒä»£ç **ï¼š

src/index.scss ä¸­ï¼š

```scss
:root:root {
  --adm-color-primary: #fc6627;
  --adm-font-family: 'PingFangSC-Regular';


  --font-size: 16px;
}
```

## 10-é…ç½®è·¯å¾„åˆ«å

**ç›®æ ‡**ï¼šèƒ½å¤Ÿé…ç½®@è·¯å¾„åˆ«åç®€åŒ–è·¯å¾„å¤„ç†

**å†…å®¹**ï¼š

[è‡ªå®šä¹‰ CRA çš„é»˜è®¤é…ç½®](https://ant.design/docs/react/use-with-create-react-app-cn#é«˜çº§é…ç½®)[craco é…ç½®æ–‡æ¡£](https://github.com/gsoft-inc/craco/blob/master/packages/craco/README.md#configuration)

**æ­¥éª¤**ï¼š

1. å®‰è£…ä¿®æ”¹ CRA é…ç½®çš„åŒ…ï¼š`yarn add -D @craco/craco`
2. åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­åˆ›å»º craco çš„é…ç½®æ–‡ä»¶ï¼š`craco.config.js`ï¼Œå¹¶åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®è·¯å¾„åˆ«å
3. ä¿®æ”¹ `package.json` ä¸­çš„è„šæœ¬å‘½ä»¤
4. åœ¨ä»£ç ä¸­ï¼Œå°±å¯ä»¥é€šè¿‡ `@` æ¥è¡¨ç¤º src ç›®å½•çš„ç»å¯¹è·¯å¾„
5. é‡å¯é¡¹ç›®ï¼Œè®©é…ç½®ç”Ÿæ•ˆ

**æ ¸å¿ƒä»£ç **ï¼š

/craco.config.js ä¸­ï¼š

```js
const path = require('path');


module.exports = {
  // webpack é…ç½®
  webpack: {
    // é…ç½®åˆ«å
    alias: {
      // çº¦å®šï¼šä½¿ç”¨ @ è¡¨ç¤º src æ–‡ä»¶æ‰€åœ¨è·¯å¾„
      '@': path.resolve(__dirname, 'src'),
      // çº¦å®šï¼šä½¿ç”¨ @scss è¡¨ç¤ºå…¨å±€ SASS æ ·å¼æ‰€åœ¨è·¯å¾„
      // åœ¨ SASS ä¸­ä½¿ç”¨
      '@scss': path.resolve(__dirname, 'src/assets/styles'),
    },
  },
};
```

package.json ä¸­ï¼š

```json
// å°† start/build/test ä¸‰ä¸ªå‘½ä»¤ä¿®æ”¹ä¸º craco æ–¹å¼


"scripts": {
  "start": "craco start",
  "build": "craco build",
  "test": "craco test",
  "eject": "react-scripts eject"
},
```

## 11-@åˆ«åè·¯å¾„æç¤º

**ç›®æ ‡**ï¼šèƒ½å¤Ÿè®© vscode è¯†åˆ«@è·¯å¾„å¹¶ç»™å‡ºè·¯å¾„æç¤º

**åˆ†æè¯´æ˜**ï¼š

å› ä¸ºé¡¹ç›®ä½¿ç”¨äº† TSï¼Œè€Œ TS å¸¦æœ‰é…ç½®æ–‡ä»¶ tsconfig.jsonã€‚å› æ­¤ï¼Œä¸éœ€è¦å†ä½¿ç”¨ jsconfig.jsonï¼ˆå®é™…ä¸Šï¼Œjsconfig.json æ˜¯å‚è€ƒ tsconfig.json çš„ï¼‰

VSCode ä¼šè‡ªåŠ¨è¯»å– `tsconfig.json` ä¸­çš„é…ç½®ï¼Œè®© vscode çŸ¥é“ @ å°±æ˜¯ src ç›®å½•

**æ­¥éª¤**ï¼š

1. åˆ›å»º `path.tsconfig.json` é…ç½®æ–‡ä»¶
2. åœ¨è¯¥é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®
3. åœ¨ `tsconfig.json` ä¸­å¯¼å…¥è¯¥é…ç½®æ–‡ä»¶ï¼Œè®©é…ç½®ç”Ÿæ•ˆ
4. é‡å¯ VSCode

**æ ¸å¿ƒä»£ç **ï¼š

/path.tsconfig.json ä¸­ï¼š

```json
{
  "compilerOptions": {
    "baseUrl": "./",
    "paths": {
      "@/*": ["src/*"],
      "@scss/*": ["src/assets/styles/*"]
    }
  }
}
```

/tsconfig.json ä¸­ï¼š

```json
{
  // å¯¼å…¥é…ç½®æ–‡ä»¶
  "extends": "./path.tsconfig.json"
}
```

## 12-ç§»åŠ¨ç«¯é€‚é…

**ç›®æ ‡**ï¼šèƒ½è·Ÿé€šè¿‡é…ç½®å®ç°è‡ªåŠ¨é€‚é…ç§»åŠ¨ç«¯é¡¹ç›®

**åˆ†æè¯´æ˜**ï¼š

é€‚é…æ¦‚è¿°

- ä¸ºä»€ä¹ˆè¦é€‚é…ï¼Ÿ
  - ä¸ºäº†è®©æˆ‘ä»¬å¼€å‘çš„ç§»åŠ¨ç«¯é¡¹ç›®é¡µé¢ï¼Œåœ¨ä¸åŒå°ºå¯¸å¤§å°çš„ç§»åŠ¨ç«¯è®¾å¤‡ï¼ˆæ‰‹æœºï¼‰ä¸­ï¼Œä¿æŒç›¸åŒçš„æ¯”ä¾‹
- é€‚é…åŸç†
  - é€‰æ‹©æŸä¸ªæ‰‹æœºçš„å°ºå¯¸å¤§å°ä½œä¸ºåŸºå‡†ï¼Œå…¶ä»–æ‰‹æœºè¿›è¡Œ**ç­‰æ¯”ä¾‹ç¼©æ”¾**
  - ä¸€èˆ¬é€‰æ‹© `iPhone 6`ï¼ˆ2 å€å±å¹•ï¼‰ï¼Œå±å¹•å®½åº¦ä¸ºï¼š`375px`
- é€‚é…æ–¹å¼
  - remï¼šéœ€è¦æ‰‹åŠ¨ä¿®æ”¹ `html` å…ƒç´ çš„ `font-size`ï¼›é¢å¤–è®¾ç½® `body` å…ƒç´ çš„å­—ä½“å¤§å°ä¸ºæ­£å¸¸å€¼
  - vwï¼š 1 `vw` ç­‰äºå±å¹•å®½åº¦çš„ `1%`

```js
// rem é€‚é…
// iphone6       html ==> font-size: 37.5px
// iphone6 plus  html ==> font-size: 41.4px
//
// iPhone 6 ä¸‹å®½é«˜ä¸º 100pxï¼š
// 100 / 37.5 â‰ˆ 2.667
// height: 2.667rem; width: 2.667rem;


// vw é€‚é…
// iPhone 6 ä¸‹å®½é«˜ä¸º 100pxï¼š
// 100 / (375 / 100) = 100 / 3.75 â‰ˆ 26.7vw
// height: 26.667vw; width: 26.667vw;
```

- å¦‚æœæ¯æ¬¡è®¾ç½®å®½é«˜éƒ½éœ€è¦æ‰‹åŠ¨è®¡ç®—ä¸€æ¬¡ï¼Œå¤ªç¹çäº†ï¼å› æ­¤ï¼Œéœ€è¦å€ŸåŠ©å·¥å…·æ¥è§£å†³ï¼

**æ­¥éª¤**ï¼š

- [postcss-px-to-viewport æ–‡æ¡£](https://github.com/evrone/postcss-px-to-viewport)

1. å®‰è£… px è½¬ vw çš„åŒ…ï¼š

   ```
   yarn add -D postcss-px-to-viewport
   ```

   - åŒ…çš„ä½œç”¨ï¼šå°† `px` è½¬åŒ–ä¸º `vw`ï¼Œæ‰€ä»¥æœ‰äº†è¯¥å·¥å…·ï¼Œåªéœ€è¦åœ¨ä»£ç ä¸­å†™ `px` å³å¯

2. åœ¨ `craco.config.js` æ·»åŠ ç›¸åº”é…ç½®

3. é‡å¯é¡¹ç›®ï¼Œè®©é…ç½®ç”Ÿæ•ˆ

**æ ¸å¿ƒä»£ç **ï¼š

/craco.config.js ä¸­ï¼š

```js
const pxToViewport = require('postcss-px-to-viewport');
const vw = pxToViewport({
  // è§†å£å®½åº¦ï¼Œä¸€èˆ¬å°±æ˜¯ 375ï¼ˆ è®¾è®¡ç¨¿ä¸€èˆ¬é‡‡ç”¨äºŒå€ç¨¿ï¼Œå®½åº¦ä¸º 375 ï¼‰
  viewportWidth: 375,
});


module.exports = {
  // æ­¤å¤„çœç•¥ webpack é…ç½®
  webpack: {},


  style: {
    postcss: {
      plugins: [vw],
    },
  },
};
```

å…³äºè®¾è®¡ç¨¿çš„è¯´æ˜ï¼š

1. æ‘¹å®¢ - è®¾è®¡ç¨¿ã€åŸå‹å›¾
2. è“æ¹– - è®¾è®¡ç¨¿ã€åŸå‹å›¾

- è®¾è®¡ç¨¿ï¼Œä¸€èˆ¬ä½¿ç”¨ 2 å€è®¾è®¡ç¨¿ï¼Œä¹Ÿå°±æ˜¯ iPhone 6 å¯¹åº”çš„å°ºå¯¸å¤§å°
  - iPhone 6 å±å¹•å®½åº¦ï¼š375pxï¼Œå› ä¸ºæ˜¯ 2 å€å±å¹•ï¼Œæ‰€ä»¥ï¼Œå®é™…ä¸Šæœ‰ 750 ä¸ªç‰©ç†åƒç´ ï¼Œå› æ­¤ 1px = 2 ä¸ªç‰©ç†åƒç´ 
- åœ¨ æ‘¹å®¢ ä¸­ï¼Œå¯ä»¥é€šè¿‡è‡ªå®šä¹‰æ¥ä¿®æ”¹è®¾è®¡ç¨¿çš„å®½åº¦ï¼Œä¸€èˆ¬å°±ä¿®æ”¹ä¸ºï¼šè®¾è®¡ç¨¿å®½åº¦ 375pxã€‚è¿™æ ·è®¾è®¡ç¨¿ä¸­çš„å†…å®¹å¤šå®½å¤šé«˜ï¼Œåœ¨ä»£ç ä¸­å°±å†™å¤šå°‘

## 13-ç§»åŠ¨ç«¯ 1px åƒç´ è¾¹æ¡†

**ç›®æ ‡**ï¼šèƒ½å¤Ÿå±•ç¤º 1px åƒç´ çš„è¾¹æ¡†

**åˆ†æè¯´æ˜**ï¼š

[å‚è€ƒ antd-mobile çš„å®ç°](https://github.com/ant-design/ant-design-mobile/blob/v2/components/style/mixins/hairline.less)

å®ç°åŸç†ï¼š**ä¼ªå…ƒç´  + transform ç¼©æ”¾**

- ä¼ªå…ƒç´ `::after`æˆ–`::before`ç‹¬ç«‹äºå½“å‰å…ƒç´ ï¼Œå¯ä»¥å•ç‹¬å¯¹å…¶ç¼©æ”¾è€Œä¸å½±å“å…ƒç´ æœ¬èº«çš„ç¼©æ”¾

**æ ¸å¿ƒä»£ç **ï¼š

```scss
// src/assets/styles/hairline.scss


@mixin scale-hairline-common($color, $top, $right, $bottom, $left) {
  content: '';
  position: absolute;
  display: block;
  z-index: 1;
  top: $top;
  right: $right;
  bottom: $bottom;
  left: $left;
  background-color: $color;
}


// æ·»åŠ è¾¹æ¡†
/* 
  ç”¨æ³•ï¼š


  // å¯¼å…¥
  @import '@scss/hairline.scss';


  // åœ¨ç±»ä¸­ä½¿ç”¨
  .a {
	  position: relative;
    @include hairline(bottom, #f0f0f0);
  }
*/
@mixin hairline($direction, $color: #000, $radius: 0) {
  @if $direction == top {
    border-top: 1px solid $color;


    // min-resolution ç”¨æ¥æ£€æµ‹è®¾å¤‡çš„æœ€å°åƒç´ å¯†åº¦
    @media (min-resolution: 2dppx), (-webkit-min-device-pixel-ratio: 2) {
      border-top: none;


      &::before {
        @include scale-hairline-common($color, 0, auto, auto, 0);
        width: 100%;
        height: 1px;
        transform-origin: 50% 50%;
        transform: scaleY(0.5);


        @media (min-resolution: 3dppx), (-webkit-min-device-pixel-ratio: 3) {
          transform: scaleY(0.33);
        }
      }
    }
  } @else if $direction == right {
    border-right: 1px solid $color;


    @media (min-resolution: 2dppx), (-webkit-min-device-pixel-ratio: 2) {
      border-right: none;


      &::after {
        @include scale-hairline-common($color, 0, 0, auto, auto);
        width: 1px;
        height: 100%;
        background: $color;
        transform-origin: 100% 50%;
        transform: scaleX(0.5);


        @media (min-resolution: 3dppx), (-webkit-min-device-pixel-ratio: 3) {
          transform: scaleX(0.33);
        }
      }
    }
  } @else if $direction == bottom {
    border-bottom: 1px solid $color;


    @media (min-resolution: 2dppx), (-webkit-min-device-pixel-ratio: 2) {
      border-bottom: none;


      &::after {
        @include scale-hairline-common($color, auto, auto, 0, 0);
        width: 100%;
        height: 1px;
        transform-origin: 50% 100%;
        transform: scaleY(0.5);


        @media (min-resolution: 3dppx), (-webkit-min-device-pixel-ratio: 3) {
          transform: scaleY(0.33);
        }
      }
    }
  } @else if $direction == left {
    border-left: 1px solid $color;


    @media (min-resolution: 2dppx), (-webkit-min-device-pixel-ratio: 2) {
      border-left: none;


      &::before {
        @include scale-hairline-common($color, 0, auto, auto, 0);
        width: 1px;
        height: 100%;
        transform-origin: 100% 50%;
        transform: scaleX(0.5);


        @media (min-resolution: 3dppx), (-webkit-min-device-pixel-ratio: 3) {
          transform: scaleX(0.33);
        }
      }
    }
  } @else if $direction == all {
    border: 1px solid $color;
    border-radius: $radius;


    @media (min-resolution: 2dppx), (-webkit-min-device-pixel-ratio: 2) {
      position: relative;
      border: none;


      &::before {
        content: '';
        position: absolute;
        left: 0;
        top: 0;
        width: 200%;
        height: 200%;
        border: 1px solid $color;
        border-radius: $radius * 2;
        transform-origin: 0 0;
        transform: scale(0.5);
        box-sizing: border-box;
        pointer-events: none;
      }
    }
  }
}


// ç§»é™¤è¾¹æ¡†
@mixin hairline-remove($position: all) {
  @if $position == left {
    border-left: 0;
    &::before {
      display: none !important;
    }
  } @else if $position == right {
    border-right: 0;
    &::after {
      display: none !important;
    }
  } @else if $position == top {
    border-top: 0;
    &::before {
      display: none !important;
    }
  } @else if $position == bottom {
    border-bottom: 0;
    &::after {
      display: none !important;
    }
  } @else if $position == all {
    border: 0;
    &::before {
      display: none !important;
    }
    &::after {
      display: none !important;
    }
  }
}
```

## 14-å­—ä½“å›¾æ ‡

**ç›®æ ‡**ï¼šèƒ½å¤Ÿåœ¨é¡¹ç›®ä¸­ä½¿ç”¨å­—ä½“å›¾æ ‡

**å†…å®¹**ï¼š

1. åœ¨ public ä¸‹ index.html body ä¸­å¼•å…¥è¯¥æ–‡ä»¶

```html
<!-- å­—ä½“å›¾æ ‡åœ°å€ï¼š -->
<script src="//at.alicdn.com/t/font_2503709_i408x28a4zp.js"></script>
```

1. åœ¨ `index.scss` ä¸­æ·»åŠ é€šè¿‡ css ä»£ç 

```scss
.icon {
  width: 1em;
  height: 1em;
  vertical-align: -0.15em;
  fill: currentColor;
  overflow: hidden;
}
```

1. åœ¨ç»„ä»¶ä¸­ï¼Œä½¿ç”¨ï¼š

```tsx
<svg className="icon" aria-hidden="true">
  {/* ä½¿ç”¨æ—¶ï¼Œåªéœ€è¦å°†æ­¤å¤„çš„ iconbtn_like_sel æ›¿æ¢ä¸º icon çš„åç§°å³å¯*/}
  <use xlinkHref="#iconbtn_like_sel"></use>
</svg>
```

## 15-å°è£… Icon ç»„ä»¶

**ç›®æ ‡**ï¼šèƒ½å¤Ÿå°è£… Icon å›¾ç‰‡é€šç”¨ç»„ä»¶

**æ­¥éª¤**ï¼š

1. åœ¨ components ç›®å½•ä¸­ï¼Œåˆ›å»º Icon/index.tsx æ–‡ä»¶
2. åˆ›å»º Icon ç»„ä»¶ï¼Œå¹¶æŒ‡å®š props ç±»å‹
3. å®‰è£… classnames åŒ…ï¼ˆ`yarn add classnames`ï¼‰ï¼Œå¤„ç†ç±»å

**æ ¸å¿ƒä»£ç **ï¼š

components/Icon/index.tsx ä¸­ï¼š

```tsx
import classnames from 'classnames';


// ç»„ä»¶ props çš„ç±»å‹
type Props = {
  // icon çš„ç±»å‹
  type: string;
  // icon çš„è‡ªå®šä¹‰æ ·å¼
  className?: string;
  // ç‚¹å‡»äº‹ä»¶
  onClick?: () => void;
};


const Icon = ({ type, className, onClick }: Props) => {
  return (
    <svg
      className={classnames('icon', className)}
      aria-hidden="true"
      onClick={onClick}
    >
      <use xlinkHref={`#${type}`}></use>
    </svg>
  );
};


export default Icon;
```

## 16-é…ç½® Redux

**ç›®æ ‡**ï¼šèƒ½å¤Ÿå®Œæˆ Redux çš„åŸºç¡€é…ç½®

**åˆ†æè¯´æ˜**ï¼š

Redux ç›¸å…³çš„ç±»å‹æ¯”è¾ƒå¤šä¸”å¤æ‚ï¼Œå¯ä»¥æš‚æ—¶å…ˆç”¨ unknownï¼Œåé¢ä¼šä¸“é—¨å¤„ç†å…¶ç±»å‹

**æ­¥éª¤**ï¼š

1. å®‰è£… redux ç›¸å…³çš„åŒ…ï¼š
   - `yarn add redux react-redux redux-thunk@2.3.0 redux-devtools-extension axios`
2. åœ¨ store ç›®å½•ä¸­åˆ†åˆ«åˆ›å»ºï¼šactions å’Œ reducers æ–‡ä»¶å¤¹ã€index.ts æ–‡ä»¶
3. åœ¨ store/index.ts ä¸­ï¼Œåˆ›å»º store å¹¶å¯¼å‡º
4. åˆ›å»º reducers/index.ts æ–‡ä»¶ï¼Œåˆ›å»º rootReducer å¹¶å¯¼å‡º
5. åˆ›å»º reducers/login.ts æ–‡ä»¶ï¼Œåˆ›å»ºåŸºç¡€ login reducer å¹¶å¯¼å‡º
6. åœ¨ src/index.tsx ä¸­ä¸º React ç»„ä»¶æ¥å…¥ Redux

**æ ¸å¿ƒä»£ç **ï¼š

store ç›®å½•ç»“æ„ï¼š

```html
/store /actions /reducers index.ts index.ts
```

store/index.ts ä¸­ï¼š

```ts
import { createStore, applyMiddleware } from 'redux';
import thunk from 'redux-thunk';
import { composeWithDevTools } from 'redux-devtools-extension';
import rootReducer from './reducers';


const middlewares = composeWithDevTools(applyMiddleware(thunk));
const store = createStore(rootReducer, middlewares);


export default store;
```

store/reducers/index.ts ä¸­ï¼š

```ts
import { combineReducers } from 'redux';


import { login } from './login';


const rootReducer = combineReducers({
  login,
});


export default rootReducer;
```

store/reducers/login.ts ä¸­ï¼š

```ts
// æ³¨æ„ï¼šè¯¥é¡¹ç›®ä¸­ï¼Œåœ¨ redux ä¸­å­˜å‚¨çš„ token æ˜¯ä¸ªå¯¹è±¡ï¼ŒåŒ…å«ä¸¤ä¸ª tokenï¼š1 tokenï¼ˆç™»å½•æˆåŠŸçš„ä»¤ç‰Œï¼‰  2 refresh_tokenï¼ˆåˆ·æ–°tokenï¼Œtokenè¿‡æœŸæ—¶æ¢å–æ–°çš„tokenï¼‰


const initialState = {};
export const login = (state = initialState, action: unknown) => {
  return state;
};
```

src/index.tsx ä¸­ï¼š

```tsx
import { Provider } from 'react-redux';
import store from './store';


ReactDOM.render(
  <Provider store={store}>
    <App />
  </Provider>,
  document.querySelector('#root'),
);
```

## 17-é…ç½® Redux çš„ç›¸å…³ç±»å‹

**ç›®æ ‡**ï¼šèƒ½å¤Ÿé…ç½® Redux çš„åŸºç¡€ç±»å‹

**æ­¥éª¤**ï¼š

1. åœ¨ types ç›®å½•ä¸­åˆ›å»ºä¸¤ä¸ªç±»å‹å£°æ˜æ–‡ä»¶ï¼š`store.d.ts` å’Œ `data.d.ts`

- store.d.tsï¼šç”¨æ¥å­˜æ”¾è·Ÿ Redux ç›¸å…³ç±»å‹ï¼Œæ¯”å¦‚ï¼Œaction çš„ç±»å‹ç­‰
- data.d.tsï¼šç”¨æ¥å­˜æ”¾è·Ÿæ•°æ®æ¥å£ç›¸å…³ç±»å‹

1. åœ¨ store.d.ts ä¸­æ·»åŠ  Redux ç›¸å…³ç±»å‹

**æ ¸å¿ƒä»£ç **ï¼š

types/store.d.ts ä¸­ï¼š

```ts
import { ThunkAction } from 'redux-thunk';
import store from '../store';


// Redux åº”ç”¨çš„çŠ¶æ€
export type RootState = ReturnType<typeof store.getState>;


// ä½¿ç”¨ thunk ä¸­é—´ä»¶åçš„ Redux dispatch ç±»å‹
// ReturnTypeï¼šthunk action çš„è¿”å›ç±»å‹
// State: Redux çš„çŠ¶æ€  RootState
// ExtraThunkArg: é¢å¤–çš„å‚æ•°ï¼Œæ²¡æœ‰ç”¨åˆ°ï¼Œå¯ä»¥æŒ‡å®šä¸º unknown
// BasicAction: é thunk actionï¼Œå³å¯¹è±¡å½¢å¼çš„ action
export type RootThunkAction = ThunkAction<void, RootState, unknown, RootAction>;


// é¡¹ç›®ä¸­æ‰€æœ‰ action çš„ç±»å‹
type RootAction = unknown;


// -------------------- Redux å¯¹è±¡å½¢å¼çš„ action çš„ç±»å‹ ---------------------------


// ç™»å½•ç›¸å…³çš„ action ç±»å‹
// æ–‡ç« ç›¸å…³çš„ action ç±»å‹
// ç­‰ç­‰
```

## 18-å‡†å¤‡ç™»å½•åŠŸèƒ½çš„ç±»å‹

**ç›®æ ‡**ï¼šèƒ½å¤Ÿæ ¹æ®æ¥å£æ–‡æ¡£å‡†å¤‡å¥½ç™»å½•çš„ç±»å‹

**æ­¥éª¤**ï¼š

1. æ‰“å¼€[ç™»å½•æ¥å£æ–‡æ¡£](http://geek.itheima.net/api.html#u7528u6237u8ba4u8bc1uff08u767bu5f55u6ce8u518cuff090a3ca20id3du7528u6237u8ba4u8bc1uff08u767bu5f55u6ce8u518cuff093e203ca3e)
2. æŸ¥çœ‹ç™»å½•æ¥å£çš„è¿”å›æ•°æ®
3. åœ¨ data.d.ts ä¸­ï¼Œåˆ›å»ºç™»å½•æ¥å£è¿”å›æ•°æ®çš„ç±»å‹ Token
4. æ ¹æ®ç™»å½•æ¥å£è¿”å›æ•°æ®çš„ç±»å‹ Tokenï¼Œåˆ›å»ºç™»å½• action ç±»å‹
5. å°†ç™»å½• action ç±»å‹æ·»åŠ åˆ° RootAction ç±»å‹ä¸­ï¼ˆ ç›®çš„ï¼šdispatch action æ—¶æœ‰ç±»å‹æç¤º ï¼‰

**æ ¸å¿ƒä»£ç **ï¼š

types/data.d.ts ä¸­ï¼š

```ts
// ç™»å½•æ¥å£è¿”å›æ•°æ®ç±»å‹
export type Token = {
  token: string;
  refresh_token: string;
};
```

types/store.d.ts ä¸­ï¼š

```ts
import { Token } from './data';


// å°†ç™»å½• action æ·»åŠ åˆ°è¯¥ç±»å‹ä¸­
type RootAction = LoginAction;


// ç™»å½• action ç±»å‹
export type LoginAction = {
  type: 'login/token';
  payload: Token;
};
```

store/reducers/login.ts ä¸­ï¼š

```ts
import { Token } from '@/types/data';


const initialState: Token = {
  token: '',
  refresh_token: '',
};


export const login = (state = initialState, action: unknown): Token => {
  return state;
};
```

## 19-å·¥å…·å‡½æ•°

**ç›®æ ‡**ï¼šèƒ½å¤Ÿå¤ç”¨æå®¢å›­ PC ç«¯é¡¹ç›®åˆ›å»ºå¥½çš„å·¥å…·å‡½æ•°

**æ­¥éª¤**ï¼š

1. å®‰è£… historyï¼š`yarn add history@4.10.1`
2. æ‹·è´æå®¢å›­ PC ç«¯é¡¹ç›®ä¸­çš„å·¥å…·å‡½æ•°åˆ°è¯¥é¡¹ç›®ä¸­
3. å°†åŸæ¥çš„ .js æ–‡ä»¶ï¼Œä¿®æ”¹ä¸º .ts æ–‡ä»¶
4. è§£å†³å·¥å…·å‡½æ•°çš„ç±»å‹é”™è¯¯
5. åœ¨ App.tsx ä¸­ï¼Œé…ç½®è‡ªå®šä¹‰çš„ history

**æ ¸å¿ƒä»£ç **ï¼š

utils/token.ts ä¸­ï¼š

```ts
import { Token } from '@/types/data';


// ä½¿ç”¨å¸¸é‡æ¥å­˜å‚¨ key
const GEEK_TOKEN_KEY = 'geek-h5-token';


// åˆ›å»º è·å– token
export const getToken = (): Token =>
  JSON.parse(localStorage.getItem(GEEK_TOKEN_KEY) || '{}');


// åˆ›å»º è®¾ç½® token
export const setToken = (token: Token) =>
  localStorage.setItem(GEEK_TOKEN_KEY, JSON.stringify(token));


// åˆ›å»º æ¸…é™¤ token
export const clearToken = () => localStorage.removeItem(GEEK_TOKEN_KEY);


// åˆ›å»º æ ¹æ® token åˆ¤æ–­æ˜¯å¦ç™»å½•
export const isAuth = () => !!getToken();
```

utils/http.ts ä¸­ï¼š

```ts
// å°è£… axios
import axios from 'axios';
import store from '@/store';
import { Toast } from 'antd-mobile';
import { customHistory } from './history';
// import { logout } from '@/store/actions'


const http = axios.create({
  baseURL: 'http://toutiao.itheima.net/v1_0',
  timeout: 5000,
});


// å°†æ¥å¯ä»¥ç»§ç»­è¿›è¡Œ æ‹¦æˆªå™¨ çš„å¤„ç†


// è¯·æ±‚æ‹¦æˆªå™¨
http.interceptors.request.use((config) => {
  // è·å–token
  // æ³¨æ„ï¼šæå®¢å›­h5é¡¹ç›®ä¸­ï¼Œlogin å­˜å‚¨çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡ä¸­çš„ token å±æ€§ï¼Œæ‰æ˜¯ç™»å½•èº«ä»½ä»¤ç‰Œ
  const {
    login: { token },
  } = store.getState();


  // é™¤äº†ç™»å½•è¯·æ±‚å¤–ï¼Œå…¶ä»–è¯·æ±‚ç»Ÿä¸€æ·»åŠ  token
  if (!config.url?.startsWith('/authorizations')) {
    // æ­¤å¤„ï¼Œéœ€è¦ä½¿ç”¨ éç©ºæ–­è¨€ æ¥å»æ‰ headers ç±»å‹ä¸­çš„ undefined ç±»å‹
    config.headers!.Authorization = `Bearer ${token}`;
  }


  return config;
});


// å“åº”æ‹¦æˆªå™¨
http.interceptors.response.use(undefined, (error) => {
  // å“åº”å¤±è´¥æ—¶ï¼Œä¼šæ‰§è¡Œæ­¤å¤„çš„å›è°ƒå‡½æ•°
  if (!error.response) {
    // ç½‘è·¯è¶…æ—¶
    Toast.show({
      content: 'ç½‘ç»œç¹å¿™ï¼Œè¯·ç¨åå†è¯•',
      duration: 1000,
    });
    return Promise.reject(error);
  }


  if (error.response.status === 401) {
    // token è¿‡æœŸï¼Œç™»å½•è¶…æ—¶
    Toast.show({
      content: 'ç™»å½•è¶…æ—¶ï¼Œè¯·é‡æ–°ç™»å½•',
      duration: 1000,
      afterClose: () => {
        customHistory.push('/login', {
          from: customHistory.location.pathname,
        });
        // è§¦å‘é€€å‡º actionï¼Œå°† token ç­‰æ¸…é™¤
        // store.dispatch(logout())
      },
    });
  }


  return Promise.reject(error);
});


export { http };
```

App.tsx ä¸­ï¼š

```tsx
// æ³¨æ„ï¼šæ­¤å¤„éœ€è¦å¯¼å…¥ Router
import { Router } from 'react-router-dom';
import { customHistory } from './utils/history';


const App = () => {
  return <Router history={customHistory}></Router>;
};
```
