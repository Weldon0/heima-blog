---
title: ğŸ“šæå®¢å›­M-6ã€æœç´¢ã€‘
---





## 01-è·¯ç”±å’Œé¡µé¢ç»“æ„

**ç›®æ ‡**ï¼šèƒ½å¤Ÿæ ¹æ®æ¨¡æ¿æ­å»ºæœç´¢é¡µé¢ç»“æ„

**æ­¥éª¤**ï¼š

1. å°†æœç´¢é¡µé¢çš„æ¨¡æ¿æ‹·è´åˆ° pages ç›®å½•ä¸­
2. åœ¨ App ç»„ä»¶ä¸­åˆ†åˆ«é…ç½®æœç´¢å’Œæœç´¢ç»“æœé¡µé¢çš„è·¯ç”±
3. åœ¨ Home ç»„ä»¶ä¸­ä¸ºæœç´¢æŒ‰é’®ç»‘å®šç‚¹å‡»äº‹ä»¶ï¼Œè·³è½¬åˆ°æœç´¢é¡µé¢

**æ ¸å¿ƒä»£ç **ï¼š

App.jsx ä¸­ï¼š

```tsx
import Search from './pages/Search'
import SearchResult from './pages/Search/Result'


const App = () => {
  return (
    // ...
    <Route exact path="/search">
      <Search />
    </Route>
    <Route path="/search/result">
      <SearchResult />
    </Route>
  )
}
```

Home/index.jsx ä¸­ï¼š

```tsx
import { useHistory } from 'react-router-dom';


const Home = () => {
  const history = useHistory();


  return (
    // ...
    <Icon type="iconbtn_search" onClick={() => history.push('/search')} />
  );
};
```

## 02-Search ç»„ä»¶åŸºæœ¬ä½¿ç”¨

**ç›®æ ‡**ï¼šèƒ½å¤Ÿä½¿ç”¨ antd-mobile ç»„ä»¶åº“ä¸­çš„ Search ç»„ä»¶**æ­¥éª¤**ï¼š

1. åˆ›å»ºçŠ¶æ€ï¼Œé€šè¿‡å—æ§ç»„ä»¶æ–¹å¼è·å– Search çš„å€¼

**æ ¸å¿ƒä»£ç **ï¼š

Search/index.jsx ä¸­ï¼š

```tsx
import { useState } from 'react';


const SearchPage = () => {
  const history = useHistory();
  const [searchTxt, setSearchTxt] = useState('');


  const onSearchChange = (value) => {
    setSearchTxt(value);
  };


  return (
    // ...
    <Search
      placeholder="è¯·è¾“å…¥å…³é”®å­—æœç´¢"
      value={searchTxt}
      onChange={onSearchChange}
    />
  );
};
```

## 04-è·å–æœç´¢è”æƒ³å…³é”®è¯

**ç›®æ ‡**ï¼šèƒ½å¤Ÿåœ¨æœç´¢æ¡†è¾“å…¥å†…å®¹æ—¶è·å–æœç´¢è”æƒ³å…³é”®è¯

**æ­¥éª¤**ï¼š

1. åœ¨æœç´¢æ¡†çš„ change äº‹ä»¶ä¸­åˆ†å‘ action è·å–æœç´¢è”æƒ³å…³é”®è¯
2. åˆ›å»º actions/search.js å¹¶åˆ›å»ºè·å–æœç´¢è”æƒ³å…³é”®è¯çš„å‡½æ•°
3. åœ¨æœç´¢è”æƒ³å…³é”®è¯çš„ aciton ä¸­å‘é€è¯·æ±‚è·å–è”æƒ³å…³é”®è¯
4. åˆ†å‘ action å°†è”æƒ³å…³é”®è¯çŠ¶æ€ä¿å­˜åˆ° redux ä¸­
5. åˆ›å»º reducers/search.js å¹¶åˆå¹¶åˆ°æ ¹ reducer ä¸­
6. åœ¨ reducer ä¸­å¤„ç†è”æƒ³å…³é”®çš„ action

**æ ¸å¿ƒä»£ç **ï¼š

Search/index.jsx ä¸­ï¼š

```ts
import { useDispatch } from 'react-redux';
import { getSuggestion } from '@/store/actions';


const SearchPage = () => {
  const dispatch = useDispatch();


  const onSearchChange = (value) => {
    // ...
    dispatch(getSuggestion(value));
  };
};
```

actions/search.js ä¸­ï¼š

```ts
import { http } from '@/utils';


export const getSuggestion = (value) => {
  return async (dispatch) => {
    const res = await http.get('/suggestion', {
      params: {
        q: value,
      },
    });


    dispatch({ type: 'search/suggestion', payload: res.data.data.options });
  };
};
```

reducers/search.js ä¸­ï¼š

```ts
const initialState = {
  suggestion: [],
};


const Search = (state = initialState, action) => {
  switch (action.type) {
    case 'search/suggestion':
      return {
        ...state,
        suggestion: action.payload,
      };


    default:
      return state;
  }
};


export default Search;
```

reducers/index.js ä¸­ï¼š

```ts
import search from './search';


const rootReducer = combineReducers({
  // ...
  search,
});
```

## 05-æœç´¢è¾“å…¥æ—¶é˜²æŠ–

**ç›®æ ‡**ï¼šèƒ½å¤Ÿåœ¨æœç´¢æ¡†ä¸­è¾“å…¥å†…å®¹æ—¶è¿›è¡Œé˜²æŠ–å¤„ç†

**åˆ†æè¯´æ˜**ï¼š

å®é™…å¼€å‘ä¸­ï¼Œç›´æ¥å€ŸåŠ©ç¬¬ä¸‰æ–¹åº“æ¥å®ç°é˜²æŠ–åŠŸèƒ½å³å¯ã€‚æœ‰ä¸¤ç§æ–¹å¼ï¼š

1. lodash çš„ debounce å‡½æ•°
2. [ahooks](https://ahooks.gitee.io/zh-CN)ï¼ˆé˜¿é‡Œæä¾›çš„ hooks åº“ï¼‰åº“æä¾›çš„ `useDebounceFn` hook æ¥å®ç°ã€‚ï¼‰

å…ˆçœ‹ç¬¬ä¸€ç§ï¼š

```tsx
// å¯¼å…¥ lodash ä¸­çš„é˜²æŠ–å‡½æ•°
import debounce from 'lodash/debounce';
import { useState, useRef } from 'react';
import { debounce } from 'lodash';


const SearchPage = () => {
  const dispatch = useDispatch();
  const [searchText, setSearchText] = useState('');


  // æ³¨æ„ï¼šå¦‚æœ useRef æœ‰é»˜è®¤å€¼ï¼Œé‚£ä¹ˆï¼Œè¯¥ ref å¯¹è±¡çš„ current å±æ€§æ˜¯åªè¯»çš„ï¼
  // åªè¦å»æ‰ é»˜è®¤å€¼ ï¼Œref ä¸­çš„ current å±æ€§å°±ä¸æ˜¯åªè¯»å±æ€§äº†
  const debounceFnRef = useRef();


  // å¦‚æœæ¯æ¬¡è¾“å…¥å†…å®¹éƒ½æ›´æ–°äº†çŠ¶æ€ï¼Œå°±ä¼šå¯¼è‡´æ¯æ¬¡è¾“å…¥å†…å®¹è¯¥ç»„ä»¶é‡æ–°æ¸²æŸ“
  // è€Œè¯¥ç»„ä»¶é‡æ–°æ¸²æŸ“ä¼šè®©ç»„ä»¶ä¸­çš„ä»£ç é‡æ–°æ‰§è¡Œ
  // ä»£ç é‡æ–°æ‰§è¡Œï¼Œå°±ä¼šå¯¼è‡´ é˜²æŠ–å‡½æ•° é‡å¤åˆ›å»ºï¼Œè¿™æ ·çš„è¯ï¼Œæ¯æ¬¡è¾“å…¥åæ‹¿åˆ°çš„éƒ½æ˜¯æ–°åˆ›å»ºçš„é˜²æŠ–å‡½æ•°
  // ä¹Ÿå°±æ˜¯æœ‰å¤šä¸ªé˜²æŠ–å‡½æ•°äº†ã€‚è€Œå¤šä¸ªé˜²æŠ–å‡½æ•°ä¹‹é—´æ˜¯ä¸ä¼šç›¸äº’é˜²æŠ–çš„ï¼
  // æ­£ç¡®çš„æ“ä½œï¼šä¸ç®¡ç»„ä»¶æ›´æ–°å¤šå°‘æ¬¡ï¼Œéƒ½åº”è¯¥åªåˆ›å»ºä¸€æ¬¡é˜²æŠ–å‡½æ•°ï¼Œæ‰èƒ½å®ç°é˜²æŠ–åŠŸèƒ½
  const debounceFn = debounce((value) => {
    dispatch(getSuggestion(value));
  }, 500);


  // åˆ¤æ–­ ref ä¸­æ˜¯å¦å·²ç»æœ‰å€¼ï¼Œå¦‚æœæ²¡æœ‰å€¼ï¼Œå°±æ·»åŠ å€¼ï¼›å¦‚æœæœ‰äº†ï¼Œå°±ä¸å†æ·»åŠ äº†
  if (!debounceFnRef.current) {
    debounceFnRef.current = debounceFn;
  }


  // æœç´¢
  const onSearchChange = (value: string) => {
    setSearchText(value);
    if (value.trim() === '') return;
    // è°ƒç”¨é˜²æŠ–å‡½æ•°
    debounceFnRef.current?.(value);
  };


  return (
    <SearchBar
      value={searchText}
      placeholder="è¯·è¾“å…¥å…³é”®å­—æœç´¢"
      onChange={onSearchChange}
    />
  );
};
```

:::tip ä½¿ç”¨lodashçš„ä¼˜åŒ–ä»£ç 

å…³é”®ç‚¹ï¼šåªè¦å‡½æ•°ä¸è¢«é‡å¤å£°æ˜å³å¯





```jsx
  const debounceFn = useCallback(debounce(value => {
    dispatch(getSuggestion(value))
  }, 500), [])
  
  const onSearchChange = value => {
    setSearchText(value)
    debounceFn(value)
  }
```



:::

å†æ¥çœ‹ç¬¬äºŒç§æ–¹æ¡ˆï¼š

```ts
const {
  // é˜²æŠ–å‡½æ•°
  run,
} = useDebounceFn(
  // éœ€è¦é˜²æŠ–æ‰§è¡Œçš„å‡½æ•°
  fn,
  // é…ç½®é˜²æŠ–çš„é…ç½®é¡¹ï¼Œæ¯”å¦‚ï¼Œè®¾ç½®è¶…æ—¶æ—¶é—´
  options,
);
```

æ³¨æ„ï¼šç”±äº antd-mobile ç»„ä»¶åº“ä¾èµ–äº† ahooks å¹¶ä¸”æ˜¯ [ahooks@2.10.14](mailto:ahooks@2.10.14) ç‰ˆæœ¬ï¼Œæ‰€ä»¥ï¼Œåœ¨å®‰è£… ahooks æ—¶éœ€è¦æ˜ç¡®æŒ‡å®šç‰ˆæœ¬ï¼›å¦åˆ™ï¼Œä¼šå¯¼è‡´æŠ¥é”™

**æ­¥éª¤**ï¼š

1. å®‰è£… ahooks åŒ…ï¼š`yarn add ahooks@2.10.14`
2. å¯¼å…¥ `useDebounceFn` hook
3. åˆ›å»ºé˜²æŠ–å‡½æ•°
4. æœç´¢æ¡†ä¸­è¾“å…¥å†…å®¹æ—¶ï¼Œè°ƒç”¨é˜²æŠ–å‡½æ•°

**æ ¸å¿ƒä»£ç **ï¼š

Search/index.jsx ä¸­ï¼š

```tsx
import { useDebounceFn } from 'ahooks';


const SearchPage = () => {
  const { run } = useDebounceFn(
    (value) => {
      dispatch(getSuggestion(value));
    },
    {
      wait: 500,
    },
  );


  const onSearchChange = (value) => {
    // ...
    run(value);
  };
};
```

## 06-æ¸²æŸ“è”æƒ³å…³é”®è¯

**ç›®æ ‡**ï¼šèƒ½å¤Ÿæ¸²æŸ“è”æƒ³å…³é”®è¯åˆ—è¡¨

**æ­¥éª¤**ï¼š

1. è·å–è”æƒ³å…³é”®è¯çš„çŠ¶æ€
2. åˆ¤æ–­æ˜¯å¦æœ‰è”æƒ³å…³é”®è¯ï¼Œæœ‰çš„è¯æ·»åŠ  show ç±»åï¼Œæ¥å±•ç¤ºåˆ—è¡¨
3. éå†è”æƒ³å…³é”®è¯å¹¶æ¸²æŸ“

**æ ¸å¿ƒä»£ç **ï¼š

Search/index.jsx ä¸­ï¼š

```tsx
const SearchPage = () => {
  const { suggestion } = useSelector((state) => state.search);


  return (
    // ...
    <div
      className={classnames(
        'search-result',
        suggestion.length > 0 ? 'show' : '',
      )}
    >
      {suggestion.map((item, index) => (
        <div key={index} className="result-item">
          <Icon className="icon-search" type="iconbtn_search" />
          <div className="result-value">{item}</div>
        </div>
      ))}
    </div>
  );
};
```

## 07-æ¸…ç©ºè”æƒ³å…³é”®è¯

**ç›®æ ‡**ï¼šèƒ½å¤Ÿåœ¨æœç´¢æ–‡æœ¬æ¡†ä¸ºç©ºæ—¶æ¸…ç©ºè”æƒ³å…³é”®è¯

**æ­¥éª¤**ï¼š

**æ ¸å¿ƒä»£ç **ï¼š

Search/index.tsx ä¸­

```tsx
import { clearSuggestion } from '@/store/actions';


const SearchPage = () => {
  const onSearchChange = (value) => {
    // ...
    if (!value) return dispatch(clearSuggestion());
  };
};
```

actions/search.js ä¸­ï¼š

```ts
export const clearSuggestion = () => ({ type: 'search/clearSuggestion' });
```

## 08-è”æƒ³å…³é”®è¯é«˜äº®

**ç›®æ ‡**ï¼šèƒ½å¤Ÿè®©è”æƒ³æœç´¢å…³é”®è¯é«˜äº®

**åˆ†æè¯´æ˜**ï¼š

æ¯”å¦‚ï¼Œæœç´¢å†…å®¹ä¸º '1'ï¼Œæ¥å£è¿”å›çš„æ•°æ®ï¼š['1', '012', '1.11', '01', '18']ï¼Œçº¦å®šè®©æ¯ä¸€é¡¹è”æƒ³å»ºè®®çš„ç¬¬ä¸€ä¸ª '1' é«˜äº®

é‚£ä¹ˆï¼Œå°±è¦æ‰¾åˆ° '1' çš„ä½ç½®ï¼Œç„¶åï¼Œåˆ†åˆ«å¾—åˆ° '1' å‰é¢çš„å†…å®¹ å’Œ '1' åé¢çš„å†…å®¹ã€‚æ¯”å¦‚ï¼Œä»¥ '012' ä¸ºä¾‹ï¼š

```ts
{
  left: '0',
  search: '1',  // é«˜äº®
  right: '2',
}
```

æ³¨æ„ï¼šå¦‚æœæœç´¢å…³é”®è¯ä¸º 'mac'ï¼Œæœç´¢ç»“æœä¸­ä¼šåŒ…å« 'MAC'ï¼Œæ‰€ä»¥ï¼Œä¸ºäº†åœ¨è¿™ç§æƒ…å†µä¸‹ä¹Ÿå®ç°é«˜äº®ï¼Œåº”è¯¥å¿½ç•¥å¤§å°å†™

> åŸç†åˆ†æ

<img src="https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20220323154341520.png" alt="image-20220323154341520" style="zoom:50%;" />

**æ­¥éª¤**ï¼š

1. éå† suggestion æ•°ç»„ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„å¸¦æœ‰é«˜äº®å…³é”®å­—çš„è”æƒ³ç»“æœ
2. å°†æ¯ä¸€é¡¹è”æƒ³å†…å®¹å’Œå½“å‰æœç´¢å†…å®¹è½¬å°å†™
3. æ‰¾åˆ°æœç´¢å†…å®¹åœ¨è”æƒ³å†…å®¹ä¸­çš„ä½ç½®
4. åˆ†åˆ«è·å–åˆ°å·¦ä¾§ã€å³ä¾§ä»¥åŠæœç´¢å†…å®¹å¯¹åº”çš„çœŸå®è”æƒ³å†…å®¹
5. æ¸²æŸ“å¸¦æœ‰é«˜äº®å…³é”®å­—çš„è”æƒ³ç»“æœ

**æ ¸å¿ƒä»£ç **ï¼š

Search/index.jsx ä¸­ï¼š

```tsx
const SearchPage = () => {
  // ...


  const highlightSuggestion = suggestion.map((item) => {
    const lowerCaseItem = item.toLocaleLowerCase();
    const lowerCaseSearchTxt = searchTxt.toLocaleLowerCase();
    const index = lowerCaseItem.indexOf(lowerCaseSearchTxt);


    const searchTxtLength = searchTxt.length;


    const left = item.slice(0, index);
    const right = item.slice(index + searchTxtLength);
    const search = item.slice(index, index + searchTxtLength);


    return {
      left,
      right,
      search,
    };
  });


  return (
    // ...
    <div
      className={classNames(
        'search-result',
        suggestion.length > 0 ? 'show' : '',
      )}
    >
      {highlightSuggestion.map((item, index) => (
        <div key={index} className="result-item">
          <Icon className="icon-search" type="iconbtn_search" />
          <div className="result-value">
            {item.left}
            {/* æ”¾åœ¨ span ä¸­çš„å†…å®¹ä¼šé«˜äº® */}
            <span>{item.search}</span>
            {item.right}
          </div>
        </div>
      ))}
    </div>
  );
};
```

## 09-è·³è½¬åˆ°æœç´¢ç»“æœé¡µé¢

**ç›®æ ‡**ï¼šèƒ½å¤Ÿç‚¹å‡»æœç´¢å…³é”®è¯è·³è½¬åˆ°ç»“æœé¡µé¢

**æ­¥éª¤**ï¼š

1. ä¸ºè”æƒ³åˆ—è¡¨é¡¹ç»‘å®šç‚¹å‡»äº‹ä»¶
2. æ¸…ç©ºè”æƒ³å»ºè®®
3. åœ¨ç‚¹å‡»äº‹ä»¶ä¸­æ‹¿åˆ°è”æƒ³å…³é”®è¯ï¼Œè·³è½¬åˆ°ç»“æœé¡µé¢ï¼ŒåŒæ—¶ä¼ é€’è”æƒ³å…³é”®è¯
4. ä¸ºæœç´¢æŒ‰é’®ç»‘å®šç‚¹å‡»äº‹ä»¶
5. åœ¨ç‚¹å‡»äº‹ä»¶ä¸­ï¼Œæ‹¿åˆ°å½“å‰æœç´¢å†…å®¹ï¼Œè·³è½¬åˆ°ç»“æœé¡µé¢ï¼ŒåŒæ—¶ä¼ é€’æœç´¢å†…å®¹

**æ ¸å¿ƒä»£ç **ï¼š

Search/index.jsx ä¸­ï¼š

```tsx
const SearchPage = () => {
  // ...
  const onSearch = (value) => {
    dispatch(clearSuggestion())
    history.push(`/search/result?q=${value}`)
  }


  return (
    // ...
    <span className="search-text" onClick={() => onSearch(searchTxt)}>
      æœç´¢
    </span>


    <div
        className={classnames(
          'search-result',
        )}
      >
      {highlightSuggestion.map((item, index) => (
        <div
          onClick={() => onSearch(item.left + item.search + item.right)}
        >
        </div>
      ))}
    </div>
  )
}
```

## 10-æœç´¢å†å²è®°å½•

**ç›®æ ‡**ï¼šèƒ½å¤Ÿå°†æœç´¢å†…å®¹ä¿å­˜åˆ°å†å²è®°å½•

:::tip ä¿å­˜æœç´¢è®°å½•çš„åˆ†æ

ç®€å•åˆ†æï¼š

å¦‚æœæœç´¢äº†ä¸€ä¸ªå†å²è®°å½•é‡Œé¢æ²¡æœ‰çš„å†…å®¹ï¼Œå½“å‰çš„å†…å®¹éœ€è¦æ·»åŠ åˆ°å†å²è®°å½•é‡Œé¢çš„

å¦‚æœæœç´¢äº†ä¸€ä¸ªå·²ç»çš„å­˜åœ¨åœ¨å†å²è®°å½•é‡Œé¢çš„å†…å®¹ï¼ŒåŸæœ‰çš„æ•°æ®é•¿åº¦ä¸å˜

:::

**æ­¥éª¤**ï¼š

1. åˆ›å»ºä¿å­˜å†å²è®°å½•çš„å‡½æ•° saveHistories
2. ä»æœ¬åœ°ç¼“å­˜ä¸­è·å–åˆ°å†å²è®°å½•ï¼Œåˆ¤æ–­æœ¬åœ°ç¼“å­˜ä¸­æ˜¯å¦æœ‰å†å²è®°å½•æ•°æ®
3. å¦‚æœæ²¡æœ‰ï¼Œç›´æ¥æ·»åŠ å½“å‰æœç´¢å†…å®¹åˆ°å†å²è®°å½•ä¸­
4. å¦‚æœæœ‰ï¼Œåˆ¤æ–­æ˜¯å¦åŒ…å«å½“å‰æœç´¢å†…å®¹
5. å¦‚æœæ²¡æœ‰åŒ…å«ï¼Œç›´æ¥æ·»åŠ åˆ°å†å²è®°å½•ä¸­
6. å¦‚æœåŒ…å«ï¼Œå°†å…¶ç§»åŠ¨åˆ°ç¬¬ä¸€ä¸ª
7. å°†æœ€æ–°çš„å†å²è®°å½•å­˜å‚¨åˆ°æœ¬åœ°ç¼“å­˜ä¸­

**æ ¸å¿ƒä»£ç **ï¼š

Search/index.jsx ä¸­ï¼š

```tsx
const SearchPage = () => {
  const onSearch = (value) => {
    // ...
    saveHistories(value);
  };


  const saveHistories = (value) => {
    // è·å–æœ¬åœ°å­˜å‚¨çš„æœç´¢å†å²æ•°æ®
    const localHistories = JSON.parse(
      localStorage.getItem(GEEK_SEARCH_KEY) || '[]',
    );
    let histories = [];


    if (localHistories.length === 0) {
      // æ²¡æœ‰
      histories = [value];
    } else {
      // æœ‰
      const exist = localHistories.indexOf(value) >= 0;
      if (exist) {
        // å­˜åœ¨
        const leftHistories = localHistories.filter((item) => item !== value);
        histories = [value, ...leftHistories];
      } else {
        // ä¸å­˜åœ¨
        histories = [value, ...localHistories];
      }
    }


    localStorage.setItem(GEEK_SEARCH_KEY, JSON.stringify(histories));
  };
};
```

## 11-æ¸²æŸ“å†å²è®°å½•

**ç›®æ ‡**ï¼šèƒ½å¤Ÿåœ¨è¿›å…¥æœç´¢é¡µé¢æ—¶æ¸²æŸ“å†å²è®°å½•

**æ­¥éª¤**ï¼š

1. åˆ›å»ºå­˜å‚¨å†å²è®°å½•çš„çŠ¶æ€
2. åœ¨è¿›å…¥é¡µé¢æ—¶ï¼Œä»æœ¬åœ°ç¼“å­˜ä¸­è·å–å†å²è®°å½•ï¼Œå¹¶æ›´æ–°çŠ¶æ€
3. æ ¹æ®æ˜¯å¦æœ‰å†å²è®°å½•æ¥å†³å®šæ˜¯å¦å±•ç¤ºå†å²è®°å½•å†…å®¹
4. éå†å†å²è®°å½•æ•°æ®ï¼Œæ¸²æŸ“åˆ—è¡¨

**æ ¸å¿ƒä»£ç **ï¼š

Search/index.jsx ä¸­ï¼š

```tsx
import { useEffect } from 'react';
const SearchPage = () => {
  const [searchHistory, setSearchHistory] = useState([]);


  useEffect(() => {
    const histories = JSON.parse(
      localStorage.getItem(GEEK_SEARCH_KEY) || '[]',
    );


    setSearchHistory(histories);
  }, []);


  return (
    // ...
    <div
      className="history"
      style={{
        display: suggestion.length > 0 ? 'none' : 'block',
      }}
    >
      // ...
      <div className="history-list">
        {searchHistory.map((item, index) => (
          <div key={index} className="history-item">
            <span className="text-overflow">{item}</span>
            <Icon type="iconbtn_essay_close" />
          </div>
        ))}
      </div>
    </div>
  );
};
```

## 12-åˆ é™¤å’Œæ¸…ç©ºå†å²è®°å½•

**ç›®æ ‡**ï¼šèƒ½å¤Ÿå®ç°åˆ é™¤æœç´¢å†å²è®°å½•

**æ­¥éª¤**ï¼š

1. ä¸ºå†å²è®°å½•åˆ—è¡¨é¡¹çš„åˆ é™¤æŒ‰é’®ç»‘å®šç‚¹å‡»äº‹ä»¶
2. åœ¨ç‚¹å‡»äº‹ä»¶ä¸­åˆ é™¤å½“å‰å†å²è®°å½•ï¼Œå¹¶æ›´æ–°åˆ°æœ¬åœ°ç¼“å­˜ä¸­
3. ä¸ºæ¸…é™¤å…¨éƒ¨æŒ‰é’®ç»‘å®šç‚¹å‡»äº‹ä»¶
4. åœ¨ç‚¹å‡»äº‹ä»¶ä¸­æ¸…ç©ºå†å²è®°å½•ï¼Œå¹¶ç§»é™¤æœ¬åœ°ç¼“å­˜
5. åˆ¤æ–­æ˜¯å¦æœ‰å†å²è®°å½•å¦‚æœæœ‰ï¼Œæ‰å±•ç¤ºå†å²è®°å½•å†…å®¹

**æ ¸å¿ƒä»£ç **ï¼š

Search/index.jsx ä¸­ï¼š

```tsx
const SearchPage = () => {
  // ...
  const onDeleteHistory = (value) => {
    const newSearchHistory = searchHistory.filter((item) => item !== value);
    setSearchHistory(newSearchHistory);
    localStorage.setItem(GEEK_SEARCH_KEY, JSON.stringify(newSearchHistory));
  };
  const onClearHistory = () => {
    setSearchHistory([]);
    localStorage.removeItem(GEEK_SEARCH_KEY);
  };


  return (
    <div className={styles.root}>
      // ...
      {searchHistory.length > 0 && (
        <div
          className="history"
          style={{
            display: suggestion.length <= 0 ? 'none' : 'block',
          }}
        >
          <div className="history-header">
            // ...
            <span onClick={onClearHistory}>
              <Icon type="iconbtn_del" />
              æ¸…é™¤å…¨éƒ¨
            </span>
          </div>


          <div className="history-list">
            // ...
            <Icon
              type="iconbtn_essay_close"
              onClick={() => onDeleteHistory(item)}
            />
          </div>
        </div>
      )}
    </div>
  );
};
```

## 13-è·å–æœç´¢ç»“æœæ•°æ®

**ç›®æ ‡**ï¼šèƒ½å¤Ÿè·å–æœç´¢ç»“æœæ•°æ®

**åˆ†æè¯´æ˜**ï¼š

å¯ä»¥é€šè¿‡ DOM è‡ªå¸¦çš„ `URLSearchParams` æ¥è·å–æŸ¥è¯¢å‚æ•°ï¼Œä¹Ÿå°±æ˜¯ URL åœ°å€ä¸­ ? åé¢çš„å‚æ•°

[å‚è€ƒï¼šMDN URLSearchParams](https://developer.mozilla.org/zh-CN/docs/Web/API/URLSearchParams)

**æ­¥éª¤**ï¼š

1. è¿›å…¥é¡µé¢æ—¶ï¼Œè·å–åˆ°æœç´¢å†…å®¹
2. è°ƒç”¨è‡ªå®šä¹‰ hookï¼Œåˆ†å‘ action å‡†å¤‡è·å–æœç´¢ç»“æœæ•°æ®ï¼Œå¹¶ä¼ é€’æœç´¢å†…å®¹ç»™ action
4. åœ¨ action ä¸­å‘é€è¯·æ±‚è·å–æœç´¢ç»“æœæ•°æ®
6. åˆ†å‘ action å°†æœç´¢ç»“æœæ•°æ®ä¿å­˜åˆ° redux ä¸­
7. åœ¨ redcuer ä¸­å¤„ç† action ä»¥æ›´æ–°çŠ¶æ€

**æ ¸å¿ƒä»£ç **ï¼š

Result/index.jsx ä¸­ï¼š

```tsx
const Result = () => {
  // ...


  const params = new URLSearchParams(location.search);
  const q = params.get('q') ?? '';


  const { searchResults } = useInitialState(() => getSearchResult(q), 'search');
  const { results } = searchResults;


  const renderArticleList = () => {
    return results.map((item, index) => {
      // ...
    });
  };
  // ...
};
```

actions/search.js ä¸­ï¼š

```ts
export const getSearchResult = (query) => {
  return async (dispatch) => {
    const res = await http.get('/search', {
      params: {
        q: query,
        page: 1,
      },
    });


    dispatch({ type: 'search/getSearchResult', payload: res.data.data });
  };
};
```

reducers/search.js ä¸­ï¼š

```ts

const initialState = {
  // ...
  searchResults: {
    page: 1,
    per_page: 10,
    total_count: 0,
    results: [],
  },
};


const Search = (state = initialState, action) => {
  switch (action.type) {
    // ...
    case 'search/getSearchResult':
      return {
        ...state,
        searchResults: action.payload,
      };
  }
};
```

## 14-ä¼˜åŒ–ï¼šuseInitialState

**ç›®æ ‡**ï¼šèƒ½å¤Ÿä¼˜åŒ–è·å–çŠ¶æ€æ•°æ®çš„è‡ªå®šä¹‰ hook åªå‘é€ä¸€æ¬¡è¯·æ±‚

**åˆ†æè¯´æ˜**ï¼š

é—®é¢˜ï¼šResult ç»„ä»¶ä¸­ä½¿ç”¨ `useInitialState` è‡ªå®šä¹‰ hook ä¼šé‡å¤å‘é€è¯·æ±‚

é’ˆå¯¹è¯¥é—®é¢˜çš„åˆ†æè¿‡ç¨‹ï¼š

1. å®šä½å‡ºé—®é¢˜çš„ä»£ç ä½ç½®
   - æ—¢ç„¶é€ æˆäº†é‡å¤è¯·æ±‚ï¼Œè¯´æ˜ dispatch åˆ†å‘ action çš„ä»£ç é‡å¤æ‰§è¡Œäº†ã€‚å¯ä»¥é€šè¿‡ console.log æ¥ç¡®è®¤ï¼Œæ˜¯å¦ä¼šé‡å¤æ‰§è¡Œ
2. åˆ†æåŸå› 
   - dispatch æ˜¯åœ¨ useEffect hook ä¸­æ‰§è¡Œçš„ï¼Œè¯´æ˜ effect é‡å¤æ‰§è¡Œã€‚è€Œ effect é‡å¤æ‰§è¡Œçš„åŸå› åªæœ‰ä¸€ä¸ªï¼Œå°±æ˜¯ï¼š**ä¾èµ–é¡¹å‘ç”Ÿæ”¹å˜**
   - ç¬¬ä¸€ä¸ªä¾èµ–é¡¹ `dispatch` å‡½æ•°æ˜¯ä¸å˜çš„
   - åªèƒ½æ˜¯ç¬¬äºŒä¸ªä¾èµ–é¡¹ action å‡½æ•°æ”¹å˜äº†
3. ç¡®è®¤åˆ†ææ˜¯å¦æ­£ç¡®
   - Result ç»„ä»¶ä¸­ `useInitialState` é‡å¤æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯é‡å¤æ›´æ–°äº†çŠ¶æ€ï¼Œæ¯æ¬¡æ›´æ–°çŠ¶æ€éƒ½ä¼šå¯¼è‡´ç»„ä»¶é‡æ–°æ¸²æŸ“
   - ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶ï¼Œä¼šé‡æ–°æ‰§è¡Œç»„ä»¶ä¸­çš„æ‰€æœ‰ä»£ç 
   - è€Œæˆ‘ä»¬ä¼ é€’ç»™ `useInitialState` hook çš„ç¬¬ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œæ¯æ¬¡éƒ½ä¼šé‡æ–°åˆ›å»º

```tsx
const Result = () => {
  // const { searchResults } = useInitialState(() => getSearchResult(q), 'search')
  // è¿™ç§è°ƒç”¨æ–¹å¼ï¼Œç­‰ä»·äºï¼š


  const action = () => getSearchResult(q);
  const { searchResults } = useInitialState(action, 'search');
};
```

æ€»ç»“å‡ºç°é—®é¢˜çš„åŸå› ï¼š

- æ¯æ¬¡ç»„ä»¶æ›´æ–°éƒ½ä¼šç»™ `useInitialState` ä¼ é€’æ–°åˆ›å»ºçš„ action å›è°ƒå‡½æ•°ï¼Œ
- å¯¼è‡´è‡ªå®šä¹‰ hook å†…éƒ¨ useEffect çš„ä¾èµ–é¡¹å‘ç”Ÿæ”¹å˜ï¼Œeffect é‡æ–°æ‰§è¡Œã€‚

ç»™å‡ºè§£å†³æ–¹æ¡ˆ

- ä¿æŒä¼ å…¥çš„ action å¼•ç”¨ä¸å˜ï¼Œå°† action ä» useEffect çš„ä¾èµ–é¡¹ä¸­ç§»é™¤
- å¦‚ä½•å®ç°ï¼Ÿ `useRef` hook

**æ­¥éª¤**ï¼š

1. å¯¼å…¥ useRef hook
2. åˆ›å»º ref å¯¹è±¡ï¼Œé»˜è®¤å€¼ä¸º action å‚æ•°
3. åœ¨ useEffect ä¸­è°ƒç”¨ ref å¼•ç”¨çš„å‡½æ•°
4. ä»ä¾èµ–é¡¹ä¸­å»æ‰ action

**æ ¸å¿ƒä»£ç **ï¼š

```tsx
import { useRef } from 'react';


const useInitialState =(
  action,
  stateName,
) => {
  // ...
  const actionRef = useRef(action);


  useEffect(() => {
    const actionFn = actionRef.current;
    dispatch(actionFn());
  }, [dispatch]);
  // ...
};
// ä½¿ç”¨ï¼š
const Result = () => {
  // æ³¨æ„ï¼šå›è°ƒå‡½æ•°å¿…é¡»è¿”å› action å‡½æ•°
  const { searchResults } = useInitialState(() => getSearchResult(q), 'search');
};
```





### 15-æ¸²æŸ“æœç´¢ç»“æœé¡µæ•°æ®

å®ç°æ€è·¯ï¼š

1. æ‹¿åˆ°çš„æ•°æ®å·²ç»æ˜¯åˆ—è¡¨æ•°æ®ï¼Œç›´æ¥è¿›è¡Œæ¸²æŸ“å³å¯
2. éœ€è¦åŠ¨æ€çš„è·å–è·¯ç”±searchå‚æ•°ï¼Œå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰hookså»å®Œæˆå‚æ•°çš„è·å–ï¼Œå› ä¸ºè·å–å‚æ•°çš„é€»è¾‘å¯ä»¥å¤ç”¨
3. è·å–æ•°æ®ä¹‹åç›´æ¥mapæ•°æ®ï¼Œè°ƒç”¨æ–‡ç« åˆ—è¡¨é¡¹ç»„ä»¶æ¸²æŸ“é¡µé¢å³å¯



:::tip éœ€è¦é‡æ–°ç»„ç»‡æ¥å£è¿”å›çš„æ•°æ®

> ç»„ç»‡å¥½çš„æ•°æ®ä¼ é€’ç»™itemç»„ä»¶å³å¯

```js
    const {
      title,
      pubdate,
      comm_count,
      aut_name,
      cover: { type, images },
      art_id,
    } = item;

    const articleData = {
      title,
      pubdate,
      comm_count,
      aut_name,
      type,
      images,
    };
```



:::

> src/pages/Search/Result/index.jsx

```jsx
import {useHistory} from 'react-router-dom'
import { NavBar } from 'antd-mobile'

import styles from './index.module.scss'
import {useQuery} from "@/utils/useQuery";
import {getSearchResult} from "@/store/actions/search";
import {useInitialState} from "@/utils/use-initial-state";
import ArticleItem from "@/pages/Home/components/ArticleItem";

const Result = () => {
  const history = useHistory()
  // ä½¿ç”¨è‡ªå·±å°è£…çš„æ–¹æ³•è·å–searchç±»å‹çš„å‚æ•°
  const q = useQuery('q')
  const {searchResults:{results}} = useInitialState(() => getSearchResult(q), 'search')
  const renderArticleList = (item, index) => {
    const {
      title,
      pubdate,
      comm_count,
      aut_name,
      cover: { type, images },
      art_id,
    } = item;

    const articleData = {
      title,
      pubdate,
      comm_count,
      aut_name,
      type,
      images,
    };
    return <div onClick={() => history.push(`/article/${art_id}`)} key={index} className="article-item">
      <ArticleItem {...articleData} />
    </div>
  }

  return (
    <div className={styles.root}>
      <NavBar onBack={() => history.go(-1)}>æœç´¢ç»“æœ</NavBar>
      <div className="article-list">
        {
          results.map(renderArticleList)
        }
      </div>
    </div>
  )
}

export default Result


```

> è‡ªå·±å®ç°useQueryå®ç°è·å–searchç±»å‹çš„å‚æ•°

```js
import {useLocation} from "react-router-dom";

export const useQuery = (key) => {
  const location = useLocation()
  const params = new URLSearchParams(location.search);
  return params.get(key) ?? ''
}

```



## 16-ä½¿ç”¨ Image ç»„ä»¶å®ç°å›¾ç‰‡æ‡’åŠ è½½

**ç›®æ ‡**ï¼šèƒ½å¤Ÿä½¿ç”¨ Image ç»„ä»¶ä¼˜åŒ–å›¾ç‰‡å±•ç¤º

**æ ¸å¿ƒä»£ç **ï¼š

ArticleItem/index.jsx ä¸­ï¼š

```tsx
import { Image } from 'antd-mobile';


const ArticleItem = () => {
  return (
    // ...
    <Image
      // å¼€å¯æ‡’åŠ è½½
      lazy
      // è®¾ç½®å›¾ç‰‡å®½é«˜
      style={{
        '--width': '110px',
        '--height': '75px',
      }}
      src={item}
      alt=""
    />
  );
};
```