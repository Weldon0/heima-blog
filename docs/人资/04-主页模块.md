---
title: ğŸ“š 04-ä¸»é¡µæ¨¡å—
---
## ä¸»é¡µçš„tokenæ‹¦æˆªå¤„ç†

**`ç›®æ ‡`**ï¼šæ ¹æ®tokenå¤„ç†ä¸»é¡µçš„è®¿é—®æƒé™é—®é¢˜

### æƒé™æ‹¦æˆªçš„æµç¨‹å›¾

> æˆ‘ä»¬å·²ç»å®Œæˆäº†ç™»å½•çš„è¿‡ç¨‹ï¼Œå¹¶ä¸”å­˜å‚¨äº†tokenï¼Œä½†æ˜¯æ­¤æ—¶ä¸»é¡µå¹¶æ²¡æœ‰å› ä¸ºtokençš„æœ‰æ— è€Œè¢«æ§åˆ¶è®¿é—®æƒé™

æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦å®ç°ä»¥ä¸‹å¦‚ä¸‹çš„æµç¨‹å›¾

![image-20200714093601730](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20200714093601730.png)

> åœ¨åŸºç¡€æ¡†æ¶é˜¶æ®µï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“**`src/permission.js`**æ˜¯ä¸“é—¨å¤„ç†è·¯ç”±æƒé™çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è¿™é‡Œå¤„ç†

### æµç¨‹å›¾è½¬åŒ–ä»£ç 

**æµç¨‹å›¾è½¬åŒ–çš„ä»£ç **

```js
// æƒé™æ‹¦æˆª å¯¼èˆªå®ˆå« è·¯ç”±å®ˆå«  router
import router from '@/router' // å¼•å…¥è·¯ç”±å®ä¾‹
import store from '@/store' // å¼•å…¥vuex storeå®ä¾‹
import NProgress from 'nprogress' // å¼•å…¥ä¸€ä»½è¿›åº¦æ¡æ’ä»¶
import 'nprogress/nprogress.css' // å¼•å…¥è¿›åº¦æ¡æ ·å¼

const whiteList = ['/login', '/404'] // å®šä¹‰ç™½åå•  æ‰€æœ‰ä¸å—æƒé™æ§åˆ¶çš„é¡µé¢
// è·¯ç”±çš„å‰ç½®å®ˆå«
router.beforeEach(function(to, from, next) {
  NProgress.start() // å¼€å¯è¿›åº¦æ¡
  //  é¦–å…ˆåˆ¤æ–­æœ‰æ— token
  if (store.getters.token) {
    //   å¦‚æœæœ‰token ç»§ç»­åˆ¤æ–­æ˜¯ä¸æ˜¯å»ç™»å½•é¡µ
    if (to.path === '/login') {
      //  è¡¨ç¤ºå»çš„æ˜¯ç™»å½•é¡µ
      next('/') // è·³åˆ°ä¸»é¡µ
    } else {
      // ç™½åå•çš„ç•Œé¢(ä¸éœ€è¦æƒé™)
      // éœ€è¦æƒé™çš„ç•Œé¢
      next() // ç›´æ¥æ”¾è¡Œ
    }
  } else {
    // å¦‚æœæ²¡æœ‰token
    if (whiteList.indexOf(to.path) > -1) {
      // å¦‚æœæ‰¾åˆ°äº† è¡¨ç¤ºåœ¨åœ¨åå•é‡Œé¢
      next()
    } else {
      next('/login') // è·³åˆ°ç™»å½•é¡µ
    }
  }
  NProgress.done() // æ‰‹åŠ¨å¼ºåˆ¶å…³é—­ä¸€æ¬¡  ä¸ºäº†è§£å†³ æ‰‹åŠ¨åˆ‡æ¢åœ°å€æ—¶  è¿›åº¦æ¡çš„ä¸å…³é—­çš„é—®é¢˜
})
// åç½®å®ˆå«
router.afterEach(function() {
  NProgress.done() // å…³é—­è¿›åº¦æ¡
})

```

> åœ¨å¯¼èˆªå®ˆå«çš„ä½ç½®ï¼Œæˆ‘ä»¬æ·»åŠ äº†NProgressçš„æ’ä»¶ï¼Œå¯ä»¥å®Œæˆè¿›å…¥æ—¶çš„è¿›åº¦æ¡æ•ˆæœ

**æäº¤ä»£ç **

**æœ¬èŠ‚ä»»åŠ¡**ï¼šå®Œæˆä¸»é¡µä¸­æ ¹æ®æœ‰æ— tokenï¼Œè¿›è¡Œé¡µé¢è®¿é—®çš„å¤„ç†

## ä¸»é¡µçš„å·¦ä¾§å¯¼èˆªæ ·å¼

**ç›®æ ‡**è®¾ç½®å·¦ä¾§çš„å¯¼èˆªæ ·å¼

> æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦å°†å·¦ä¾§å¯¼èˆªè®¾ç½®æˆå¦‚å›¾æ ·å¼

![image-20200714142517337](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20200714142517337.png)

> ä¸»é¡µçš„å¸ƒå±€ç»„ä»¶ä½ç½®**`src/layout`**

**ä¸»é¡µå¸ƒå±€æ¶æ„**



![image-20200812023354631](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20200812023354631.png)

**å·¦ä¾§å¯¼èˆªç»„ä»¶çš„æ ·å¼æ–‡ä»¶**`styles/siderbar.scss`

> æ ·å¼æ–‡ä»¶ç›´æ¥æ›¿æ¢å³å¯

**è®¾ç½®èƒŒæ™¯æ¸å˜è‰²**

```css
.sidebar-container {
      background: -webkit-linear-gradient(bottom, #3d6df8, #5b8cff);
}
```

**è®¾ç½®å·¦ä¾§å¯¼èˆªèƒŒæ™¯å›¾ç‰‡**

```scss
.scrollbar-wrapper { 
    background: url('~@/assets/common/leftnavBg.png') no-repeat 0 100%;
}
```

**æ³¨æ„**ï¼šåœ¨scssä¸­ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦ä½¿ç”¨**`@`**åˆ«åï¼Œéœ€è¦åœ¨å‰é¢åŠ ä¸Šä¸€ä¸ª**`~`**æ‰å¯ä»¥

**è®¾ç½®èœå•é€‰ä¸­é¢œè‰²**

ç›´æ¥æ›¿æ¢åŸæœ‰çš„el-menuæ ·å¼è®¾ç½®

```bash
    .el-menu {
      border: none;
      height: 100%;
      width: 100% !important;
      a{
        li{
          .svg-icon{
            color: #fff;
            font-size: 18px;
            vertical-align: middle;
            .icon{
              color:#fff;
            }
          }
          span{
            color: #fff;
          }
          &:hover{
            .svg-icon{
              color: #43a7fe
            }
            span{
              color: #43a7fe;
            }
          }
        }
      }
    }
```

**`æ³¨æ„`**ï¼šå› ä¸ºæˆ‘ä»¬åæœŸæ²¡æœ‰äºŒçº§èœå•ï¼Œæ‰€ä»¥è¿™é‡Œæš‚æ—¶ä¸ç”¨å¯¹äºŒçº§èœå•çš„æ ·å¼è¿›è¡Œæ§åˆ¶

**æ˜¾ç¤ºå·¦ä¾§logoå›¾ç‰‡** **`src/setttings.js`**

```js
module.exports = {

  title: 'äººåŠ›èµ„æºç®¡ç†å¹³å°',

  /**
   * @type {boolean} true | false
   * @description Whether fix the header
   */
  fixedHeader: false,

  /**
   * @type {boolean} true | false
   * @description Whether show the logo in sidebar
   */
  sidebarLogo: true // æ˜¾ç¤ºlogo
}

```

**è®¾ç½®å¤´éƒ¨å›¾ç‰‡ç»“æ„** **`src/layout/components/Sidebar/Logo.vue`**

ç›´æ¥æ›¿æ¢åŸæœ‰é¡µé¢ç»“æ„

```vue
<div class="sidebar-logo-container" :class="{'collapse':collapse}">
    <transition name="sidebarLogoFade">
      <router-link key="collapse" class="sidebar-logo-link" to="/">
        <img src="@/assets/common/logo.png" class="sidebar-logo  ">
      </router-link>
    </transition>
  </div>
```

**å½“å‰logo.vueä¸‹é¢ä¿®æ”¹æ ·å¼ => è®¾ç½®å¤§å›¾å’Œå°å›¾çš„æ ·å¼**

ä¿®æ”¹é¡µé¢æœ€å &.collapse ä¸‹é¢çš„sidebar-logo

```scss
// å°å›¾æ ·å¼  
&.collapse {
    .sidebar-logo {
      margin-right: 0px;
      width: 32px;
      height: 32px;
    }
  }
```

```scss
// ä¿®æ”¹åŸæœ‰æ ·å¼& .sidebar-logo
// å¤§å›¾æ ·å¼
&.sidebar-logo {
      width: 140px;
      vertical-align: middle;
      margin-right: 12px;
}
```

**å»é™¤logoçš„èƒŒæ™¯è‰²**åŒæ—¶è°ƒæ•´logoåŒºåŸŸé«˜åº¦ä¸º80pxï¼Œ è¡Œé«˜ä¹Ÿè®¾ç½®ä¸º80px

<img src="https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20220114165736336.png" alt="image-20220114165736336" style="zoom:50%;" />

**æäº¤ä»£ç **

**`æœ¬èŠ‚ä»»åŠ¡`**ï¼š å®Œæˆä¸»é¡µçš„å·¦ä¾§å¯¼èˆªæ ·å¼

**`æœ¬èŠ‚æ³¨æ„`**ï¼šæˆ‘ä»¬è¯¥é¡¹ç›®ä¸­æ²¡æœ‰äºŒçº§æ˜¾ç¤ºèœå•ï¼Œæ‰€ä»¥äºŒçº§èœå•çš„æ ·å¼å¹¶æ²¡æœ‰åšè¿‡å¤šå¤„ç†ï¼ŒåŒå­¦ä»¬ä¸å¿…åœ¨æ„

## è®¾ç½®å¤´éƒ¨å†…å®¹çš„å¸ƒå±€å’Œæ ·å¼

**ç›®æ ‡**è®¾ç½®å¤´éƒ¨å†…å®¹çš„å¸ƒå±€å’Œæ ·å¼

> æˆ‘ä»¬éœ€è¦æŠŠé¡µé¢è®¾ç½®æˆå¦‚å›¾æ ·å¼

![image-20200714172602305](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20200714172602305.png)

**å¤´éƒ¨ç»„ä»¶ä½ç½®** **`layout/components/Navbar.vue`**

**æ·»åŠ å…¬å¸åç§°**ï¼Œ**æ³¨é‡Šé¢åŒ…å±‘** 

```html
  <div class="app-breadcrumb">
      æ±Ÿè‹ä¼ æ™ºæ’­å®¢æ•™è‚²ç§‘æŠ€è‚¡ä»½æœ‰é™å…¬å¸
      <span class="breadBtn">ä½“éªŒç‰ˆ</span>
  </div>
 <!-- <breadcrumb class="breadcrumb-container" /> -->

```

**å…¬å¸æ ·å¼**ï¼Œæ·»åŠ ä¸º.navbarçš„å­æ ·å¼

```scss
.app-breadcrumb {
  display: inline-block;
  font-size: 18px;
  line-height: 50px;
  margin-left: 10px;
  color: #ffffff;
  cursor: text;
  .breadBtn {
    background: #84a9fe;
    font-size: 14px;
    padding: 0 10px;
    display: inline-block;
    height: 30px;
    line-height: 30px;
    border-radius: 10px;
    margin-left: 15px;
  }
}
```

**å¤´éƒ¨èƒŒæ™¯æ¸å˜è‰²**ï¼Œæ›¿æ¢åŸæœ‰é¢œè‰²

```scss
.navbar {
    background-image: -webkit-linear-gradient(left, #3d6df8, #5b8cff);
}
```

**æ±‰å ¡ç»„ä»¶å›¾æ ‡é¢œè‰²**  **`src/components/Hamburger/index.vue`**

**`æ³¨æ„`**è¿™é‡Œçš„å›¾æ ‡æˆ‘ä»¬ä½¿ç”¨äº†**`svg`**ï¼Œè®¾ç½®é¢œè‰²éœ€è¦ä½¿ç”¨svgæ ‡ç­¾çš„**`fillå±æ€§`**

> è®¾ç½®svgå›¾æ ‡ä¸ºç™½è‰²

```vue
<svg
      :class="{'is-active':isActive}"
      class="hamburger"
      viewBox="0 0 1024 1024"
      xmlns="http://www.w3.org/2000/svg"
      width="64"
      height="64"
      fill="#fff" 
    >
```

**å³ä¾§ä¸‹æ‹‰èœå•è®¾ç½®**

> å°†ä¸‹æ‹‰èœå•è°ƒèŠ‚æˆ**`é¦–é¡µ/é¡¹ç›®åœ°å€/é€€å‡ºç™»å½•`**

```vue
    <div class="right-menu">
      <el-dropdown class="avatar-container" trigger="click">
        <div class="avatar-wrapper">
          <img src="@/assets/common/bigUserHeader.png" class="user-avatar">
          <span class="name">ç®¡ç†å‘˜</span>
          <i class="el-icon-caret-bottom" style="color:#fff" />
        </div>
        <el-dropdown-menu slot="dropdown" class="user-dropdown">
          <router-link to="/">
            <el-dropdown-item>
              é¦–é¡µ
            </el-dropdown-item>
          </router-link>
          <a target="_blank" href="https://gitee.com/shuiruohanyu/hrsaas53">
            <el-dropdown-item>é¡¹ç›®åœ°å€</el-dropdown-item>
          </a>
          <el-dropdown-item divided @click.native="logout">
            <span style="display:block;">é€€å‡ºç™»å½•</span>
          </el-dropdown-item>
        </el-dropdown-menu>
      </el-dropdown>
    </div>
```

**å¤´åƒå’Œä¸‹æ‹‰èœå•æ ·å¼**

```css
  .user-avatar {
          cursor: pointer;
          width: 30px;
          height: 30px;
          border-radius: 15px;
          vertical-align: middle;

   }
   .name {
          color: #fff;
          vertical-align: middle;
          margin-left:5px;
   }
   .user-dropdown {
           color: #fff;
    }
```

ç”¨æˆ·åå’Œå¤´åƒæˆ‘ä»¬å…ˆç”¨äº†å‡æ•°æ®è¿›è¡Œï¼Œä¸‹å°ç« èŠ‚ï¼Œä¼šè¿›è¡Œè¿™ä»½æ•°æ®çš„è·å–

**æœ€ç»ˆæ•ˆæœ**

![](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20200716015113164.png)

**æäº¤ä»£ç **

##  è·å–ç”¨æˆ·èµ„æ–™æ¥å£å’Œtokenæ³¨å…¥

**`ç›®æ ‡`** å°è£…è·å–ç”¨æˆ·èµ„æ–™çš„èµ„æ–™ä¿¡æ¯

> ä¸Šå°èŠ‚ä¸­ï¼Œæˆ‘ä»¬å®Œæˆäº†å¤´éƒ¨èœå•çš„åŸºæœ¬å¸ƒå±€ï¼Œä½†æ˜¯ç”¨æˆ·çš„å¤´åƒå’Œåç§°å¹¶æ²¡æœ‰ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡æ¥å£è°ƒç”¨çš„æ–¹å¼è·å–å½“å‰ç”¨æˆ·çš„èµ„æ–™ä¿¡æ¯

**è·å–ç”¨æˆ·èµ„æ–™æ¥å£**

åœ¨**`src/api/user.js`**ä¸­å°è£…è·å–ç”¨æˆ·èµ„æ–™çš„æ–¹æ³•

```js
/**
 *  è·å–ç”¨æˆ·çš„åŸºæœ¬èµ„æ–™
 *
 * **/
export function getUserInfo() {
  return request({
    url: '/sys/profile',
    method: 'post'
  })
}
```

> æˆ‘ä»¬å¿½ç•¥äº†ä¸€ä¸ªé—®é¢˜ï¼æˆ‘ä»¬çš„headerså‚æ•°å¹¶æ²¡æœ‰åœ¨è¿™é‡Œä¼ å…¥ï¼Œä¸ºä»€ä¹ˆå‘¢

headersä¸­çš„**Authorization**ç›¸å½“äºæˆ‘ä»¬**å¼€é—¨**ï¼ˆ**è°ƒç”¨æ¥å£**ï¼‰æ—¶**`é’¥åŒ™(token)`**ï¼Œæˆ‘ä»¬åœ¨æ‰“å¼€ä»»ä½•å¸¦å®‰å…¨æƒé™çš„é—¨çš„æ—¶å€™éƒ½éœ€è¦**`é’¥åŒ™(token)`** å¦‚å›¾

![image-20200715233339927](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20200715233339927.png)

æ¯æ¬¡åœ¨æ¥å£ä¸­æºå¸¦**`é’¥åŒ™ï¼ˆtokenï¼‰`**å¾ˆéº»çƒ¦ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨axiosæ‹¦æˆªå™¨ä¸­ç»Ÿä¸€æ³¨å…¥token 

![image-20200716000203862](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20200716000203862.png)

**ç»Ÿä¸€æ³¨å…¥token** **`src/utils/request.js`**

```js
service.interceptors.request.use(config => {
  // åœ¨è¿™ä¸ªä½ç½®éœ€è¦ç»Ÿä¸€çš„å»æ³¨å…¥token
  if (store.getters.token) {
    // å¦‚æœtokenå­˜åœ¨ æ³¨å…¥token
    config.headers['Authorization'] = `Bearer ${store.getters.token}`
  }
  return config // å¿…é¡»è¿”å›é…ç½®
}, error => {
  return Promise.reject(error)
}) 
```

**`æœ¬èŠ‚ä»»åŠ¡`**ï¼š å®Œæˆè·å–ç”¨æˆ·èµ„æ–™æ¥å£å’Œtokenæ³¨å…¥

## å°è£…è·å–ç”¨æˆ·èµ„æ–™çš„actionå¹¶å…±äº«ç”¨æˆ·çŠ¶æ€

**`ç›®æ ‡`**ï¼š åœ¨ç”¨æˆ·çš„vuexæ¨¡å—ä¸­å°è£…è·å–ç”¨æˆ·èµ„æ–™çš„actionï¼Œå¹¶è®¾ç½®ç›¸å…³çŠ¶æ€

> ç”¨æˆ·çŠ¶æ€ä¼šåœ¨åç»­çš„å¼€å‘ä¸­ï¼Œé¢‘ç¹ç”¨åˆ°ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†ç”¨æˆ·çŠ¶æ€åŒæ ·çš„å°è£…åˆ°actionä¸­

![image-20200827111324564](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20200827111324564.png)

**å°è£…è·å–ç”¨æˆ·èµ„æ–™action**   **`action`**  **`src/store/modules/user.js`**

```js
import { login, getUserInfo } from '@/api/user'
  
  // è·å–ç”¨æˆ·èµ„æ–™action
  async getUserInfo (context) {
    const result = await getUserInfo()  // è·å–è¿”å›å€¼
    context.commit('setUserInfo', result) // å°†æ•´ä¸ªçš„ä¸ªäººä¿¡æ¯è®¾ç½®åˆ°ç”¨æˆ·çš„vuexæ•°æ®ä¸­
    return result // è¿™é‡Œä¸ºä»€ä¹ˆè¦è¿”å› ä¸ºåé¢åŸ‹ä¸‹ä¼ç¬”
  }
```

> åŒæ—¶ï¼Œé…å¥—çš„æˆ‘ä»¬è¿˜è¿›è¡Œäº†å…³äºç”¨æˆ·çŠ¶æ€çš„mutationsæ–¹æ³•çš„è®¾è®¡

**åˆå§‹åŒ–state**  **`state`**

```js
const state = {
  token: getToken(), // è®¾ç½®tokenåˆå§‹çŠ¶æ€   tokenæŒä¹…åŒ– => æ”¾åˆ°ç¼“å­˜ä¸­
  userInfo: {} // å®šä¹‰ä¸€ä¸ªç©ºçš„å¯¹è±¡ ä¸æ˜¯null å› ä¸ºåè¾¹æˆ‘è¦å¼€å‘userInfoçš„å±æ€§ç»™åˆ«äººç”¨  userInfo.name
}
```

> userInfoä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸è®¾ç½®ä¸ºnullï¼Œè€Œæ˜¯è®¾ç½®ä¸º {} 

å› ä¸ºæˆ‘ä»¬ä¼šåœ¨**`getters`**ä¸­å¼•ç”¨userinfoçš„å˜é‡ï¼Œå¦‚æœè®¾ç½®ä¸ºnullï¼Œåˆ™ä¼šå¼•èµ·å¼‚å¸¸å’ŒæŠ¥é”™

**è®¾ç½®å’Œåˆ é™¤ç”¨æˆ·èµ„æ–™**   **`mutations`**

```js
 // è®¾ç½®ç”¨æˆ·ä¿¡æ¯
  setUserInfo(state, userInfo) {
    state.userInfo = { ...userInfo } // ç”¨ æµ…æ‹·è´çš„æ–¹å¼å»èµ‹å€¼å¯¹è±¡ å› ä¸ºè¿™æ ·æ•°æ®æ›´æ–°ä¹‹åï¼Œæ‰ä¼šè§¦å‘ç»„ä»¶çš„æ›´æ–°
  },
  // åˆ é™¤ç”¨æˆ·ä¿¡æ¯
  reomveUserInfo(state) {
    state.userInfo = {}
  }
```

> åŒå­¦ä»¬ï¼Œæˆ‘ä»¬å°†æ‰€æœ‰çš„èµ„æ–™è®¾ç½®åˆ°äº†**userInfo**è¿™ä¸ªå¯¹è±¡ä¸­ï¼Œå¦‚æœæƒ³è¦å–å…¶ä¸­ä¸€ä¸ªå€¼ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åœ¨gettersä¸­å»ºç«‹ç›¸åº”çš„æ˜ å°„

å› ä¸ºæˆ‘ä»¬è¦åšæ˜ å°„ï¼Œå¦‚æœåˆå§‹å€¼ä¸ºnullï¼Œä¸€æ—¦å¼•ç”¨äº†gettersï¼Œå°±ä¼šæŠ¥é”™

**å»ºç«‹ç”¨æˆ·åçš„æ˜ å°„**  **`src/store/getters.js`**

```js
const getters = {
  sidebar: state => state.app.sidebar,
  device: state => state.app.device,
  token: state => state.user.token,
  name: state => state.user.userInfo.username // å»ºç«‹ç”¨æˆ·åç§°çš„æ˜ å°„
}
export default getters

```

åˆ°ç°åœ¨ä¸ºæ­¢ï¼Œæˆ‘ä»¬å°†ç”¨æˆ·èµ„æ–™çš„**action =>  mutation => state =>  getters** éƒ½è®¾ç½®å¥½äº†ï¼Œ é‚£ä¹ˆæˆ‘ä»¬åº”è¯¥åœ¨ä»€ä¹ˆä½ç½®æ¥è°ƒç”¨è¿™ä¸ªactionå‘¢ ï¼Ÿ

> åˆ«ç€æ€¥ï¼Œå…ˆæäº¤ä»£ç ï¼Œä¸‹ä¸ªå°èŠ‚ï¼Œæˆ‘ä»¬æ¥æ­æ™“ç­”æ¡ˆ

**æäº¤ä»£ç **

**`æœ¬èŠ‚ä»»åŠ¡`**å°è£…è·å–ç”¨æˆ·èµ„æ–™çš„actionå¹¶å…±äº«ç”¨æˆ·çŠ¶æ€

## æƒé™æ‹¦æˆªå¤„è°ƒç”¨è·å–èµ„æ–™action

**`ç›®æ ‡`**åœ¨æƒé™æ‹¦æˆªå¤„è°ƒç”¨aciton

### æƒé™æ‹¦æˆªå™¨è°ƒç”¨action

> åœ¨ä¸Šå°èŠ‚ä¸­ï¼Œæˆ‘ä»¬å®Œæˆäº†ç”¨æˆ·èµ„æ–™çš„æ•´ä¸ªæµç¨‹ï¼Œé‚£ä¹ˆè¿™ä¸ªactionåœ¨å“ªé‡Œè°ƒç”¨å‘¢ï¼Ÿ

ç”¨æˆ·èµ„æ–™æœ‰ä¸ªç¡¬æ€§è¦æ±‚ï¼Œ**`å¿…é¡»æœ‰token`**æ‰å¯ä»¥è·å–ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åœ¨ç¡®å®šæœ‰tokençš„ä½ç½®å»è·å–ç”¨æˆ·èµ„æ–™

![image-20200716004526838](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20200716004526838.png)

> ç”±ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œä¸€æ—¦ç¡®å®šæˆ‘ä»¬è¿›è¡Œäº†æ”¾è¡Œï¼Œå°±å¯ä»¥è·å–ç”¨æˆ·èµ„æ–™

![image-20200813013009294](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20200813013009294.png)

**è°ƒç”¨action** **`src/permission.js`**

**è·å–ç”¨æˆ·ä¿¡æ¯çš„æ ¸å¿ƒæ€è·¯**ï¼šæœ‰äº†tokenï¼Œä½†æ˜¯æ²¡æœ‰ç”¨æˆ·ä¿¡æ¯ï¼Œç›´æ¥å»è·å–ç”¨æˆ·ä¿¡æ¯

```js
 if(!store.state.user.userInfo.userId) {
       await store.dispatch('user/getUserInfo')
 }
```

å¦‚æœæˆ‘ä»¬è§‰å¾—è·å–ç”¨æˆ·idçš„æ–¹å¼å†™äº†å¤ªå¤šå±‚çº§ï¼Œå¯ä»¥åœ¨vuexä¸­çš„gettersä¸­è®¾ç½®ä¸€ä¸ªæ˜ å°„ **`src/store/getters.js`**

```js
  userId: state => state.user.userInfo.userId // å»ºç«‹ç”¨æˆ·idçš„æ˜ å°„
```

ä»£ç å°±å˜æˆäº†

```js
 if (!store.getters.userId) {
        // å¦‚æœæ²¡æœ‰idè¿™ä¸ªå€¼ æ‰ä¼šè°ƒç”¨ vuexçš„è·å–èµ„æ–™çš„action
        await store.dispatch('user/getUserInfo')
        // ä¸ºä»€ä¹ˆè¦å†™await å› ä¸ºæˆ‘ä»¬æƒ³è·å–å®Œèµ„æ–™å†å»æ”¾è¡Œ
      }
```

æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡dev-toolså·¥å…·åœ¨æ§åˆ¶å°æ¸…æ¥šçš„çœ‹åˆ°æ•°æ®å·²ç»è·å–

<img src="https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20220114190840078.png" alt="image-20220114190840078" style="zoom:50%;" />

> æœ€åä¸€æ­¥ï¼Œåªéœ€è¦å°†å¤´éƒ¨èœå•ä¸­çš„åç§°æ¢æˆçœŸå®çš„ç”¨æˆ·åå³å¯

### è·å–å¤´åƒæ¥å£åˆå¹¶æ•°æ®

**å¤´åƒæ€ä¹ˆåŠï¼Ÿ**

> æˆ‘ä»¬å‘ç°å¤´åƒå¹¶ä¸åœ¨æ¥å£çš„è¿”å›ä½“ä¸­ï¼ˆæ¥å£åŸå› ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¦ä¸€ä¸ªæ¥å£æ¥è·å–å¤´åƒï¼Œå¹¶æŠŠå¤´åƒåˆå¹¶åˆ°å½“å‰çš„èµ„æ–™ä¸­

**å°è£…è·å–ç”¨æˆ·ä¿¡æ¯æ¥å£**  **`src/api/user.js`**

```js
/** *
 *
 * è·å–ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯  ç°åœ¨å†™å®ƒ å®Œå…¨æ˜¯ä¸ºäº†æ˜¾ç¤ºå¤´åƒ
 * **/
export function getUserDetailById(id) {
  return request({
    url: `/sys/user/${id}`
  })
}
```

> è¿™ä¸ªæ¥å£éœ€è¦ç”¨æˆ·çš„userIdï¼Œåœ¨å‰ä¸€ä¸ªæ¥å£å¤„ï¼Œæˆ‘ä»¬å·²ç»è·å–åˆ°äº†ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥åœ¨åé¢çš„å†…å®¹å»è¡”æ¥

```js
import { login, getUserInfo, getUserDetailById } from '@/api/user'
 
// è·å–ç”¨æˆ·èµ„æ–™action
 async getUserInfo(context) {
    const result = await getUserInfo() // resultå°±æ˜¯ç”¨æˆ·çš„åŸºæœ¬èµ„æ–™
    const baseInfo = await getUserDetailById(result.userId) // ä¸ºäº†è·å–å¤´åƒ
    const baseResult = { ...result, ...baseInfo } // å°†ä¸¤ä¸ªæ¥å£ç»“æœåˆå¹¶
    // æ­¤æ—¶å·²ç»è·å–åˆ°äº†ç”¨æˆ·çš„åŸºæœ¬èµ„æ–™ è¿«ä¸å¾—å·² ä¸ºäº†å¤´åƒå†æ¬¡è°ƒç”¨ä¸€ä¸ªæ¥å£
    context.commit('setUserInfo', baseResult) // æäº¤mutations
    // åŠ ä¸€ä¸ªç‚¹ç›ä¹‹ç¬”  è¿™é‡Œè¿™ä¸€æ­¥ï¼Œæš‚æ—¶ç”¨ä¸åˆ°ï¼Œä½†æ˜¯è¯·æ³¨æ„ï¼Œè¿™ç»™æˆ‘ä»¬åè¾¹ä¼šç•™ä¸‹ä¼ç¬”
    return baseResult
  }
```

> ä¸ºäº†æ›´å¥½åœ°è·å–å¤´åƒï¼ŒåŒæ ·å¯ä»¥æŠŠå¤´åƒæ”¾äºgettersä¸­

```js
  staffPhoto: state => state.user.userInfo.staffPhoto // å»ºç«‹ç”¨æˆ·å¤´åƒçš„æ˜ å°„
```

æ­¤æ—¶ï¼Œæˆ‘ä»¬çš„å¤´åƒå’Œåç§°å·²ç»è·å–åˆ°äº†ï¼Œå¯ä»¥ç›´æ¥å°†ä¹‹å‰çš„å‡æ•°æ®æ¢æˆçœŸæ­£çš„å¤´åƒå’Œåç§°

**ç”¨æˆ·å**  **`layout/components/Navbar.vue`**

```js
 ...mapGetters([
      'sidebar',
      'name',
      'staffPhoto'
    ])
     <img :src="staffPhoto" class="user-avatar">
     <span class="name">{{ name }}</span>

```

> é€šè¿‡è®¾ç½®ï¼Œç”¨æˆ·åå·²ç»æ˜¾ç¤ºï¼Œå¤´åƒä¾ç„¶æ²¡æœ‰æ˜¾ç¤ºï¼Œè¿™æ˜¯å› ä¸ºè™½ç„¶æœ‰åœ°å€ï¼Œä½†æ˜¯åœ°å€æ¥æºæ˜¯ç§æœ‰äº‘ï¼Œç›®å‰å·²ç»å¤±æ•ˆï¼Œæ‰€ä»¥éœ€è¦é¢å¤–å¤„ç†ä¸‹å›¾ç‰‡çš„å¼‚å¸¸

![image-20200827140451144](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20200827140451144.png)

è‡³äºå¤„ç†å›¾ç‰‡çš„å¼‚å¸¸ï¼Œæˆ‘ä»¬åœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œå¯é‡‡ç”¨è‡ªå®šä¹‰æŒ‡ä»¤çš„å½¢å¼æ¥è¿›è¡Œå¤„ç†

**`æœ¬èŠ‚ä»»åŠ¡`**ï¼šå®ç°æƒé™æ‹¦æˆªå¤„è°ƒç”¨è·å–èµ„æ–™action

## è‡ªå®šä¹‰æŒ‡ä»¤-è§£å†³å¼‚å¸¸å›¾ç‰‡æƒ…å†µ

**`ç›®æ ‡`**ï¼š é€šè¿‡è‡ªå®šä¹‰æŒ‡ä»¤çš„å½¢å¼è§£å†³å¼‚å¸¸å›¾ç‰‡çš„å¤„ç†

### è‡ªå®šä¹‰æŒ‡ä»¤

æ³¨å†Œè‡ªå®šä¹‰æŒ‡ä»¤

```js
Vue.directive('æŒ‡ä»¤åç§°', {
    // ä¼šåœ¨å½“å‰æŒ‡ä»¤ä½œç”¨çš„domå…ƒç´  æ’å…¥ä¹‹åæ‰§è¡Œ
    // options é‡Œé¢æ˜¯æŒ‡ä»¤çš„è¡¨è¾¾å¼
    inserted: function (dom,options) {
        
    }
})
```

> è‡ªå®šä¹‰æŒ‡ä»¤å¯ä»¥é‡‡ç”¨ç»Ÿä¸€çš„æ–‡ä»¶æ¥ç®¡ç†  **`src/directives/index.js`**,è¿™ä¸ªæ–‡ä»¶è´Ÿè´£ç®¡ç†æ‰€æœ‰çš„è‡ªå®šä¹‰æŒ‡ä»¤

é¦–å…ˆå®šä¹‰ç¬¬ä¸€ä¸ªè‡ªå®šä¹‰æŒ‡ä»¤  **`v-imagerror`**

```js
export const imagerror = {
  // æŒ‡ä»¤å¯¹è±¡ ä¼šåœ¨å½“å‰çš„domå…ƒç´ æ’å…¥åˆ°èŠ‚ç‚¹ä¹‹åæ‰§è¡Œ
  inserted(dom, options) {
    // optionsæ˜¯ æŒ‡ä»¤ä¸­çš„å˜é‡çš„è§£é‡Š  å…¶ä¸­æœ‰ä¸€ä¸ªå±æ€§å«åš value
    // dom è¡¨ç¤ºå½“å‰æŒ‡ä»¤ä½œç”¨çš„domå¯¹è±¡
    // domè®¤ä¸ºæ­¤æ—¶å°±æ˜¯å›¾ç‰‡
    // å½“å›¾ç‰‡æœ‰åœ°å€ ä½†æ˜¯åœ°å€æ²¡æœ‰åŠ è½½æˆåŠŸçš„æ—¶å€™ ä¼šæŠ¥é”™ ä¼šè§¦å‘å›¾ç‰‡çš„ä¸€ä¸ªäº‹ä»¶ => onerror
    dom.onerror = function() {
      // å½“å›¾ç‰‡å‡ºç°å¼‚å¸¸çš„æ—¶å€™ ä¼šå°†æŒ‡ä»¤é…ç½®çš„é»˜è®¤å›¾ç‰‡è®¾ç½®ä¸ºè¯¥å›¾ç‰‡çš„å†…å®¹
      // domå¯ä»¥æ³¨å†Œerroräº‹ä»¶
      dom.src = options.value // è¿™é‡Œä¸èƒ½å†™æ­»
    }
  }
}

```

### åœ¨main.jså®Œæˆè‡ªå®šä¹‰æŒ‡ä»¤å…¨å±€æ³¨å†Œ

ç„¶åï¼Œåœ¨**`main.js`**ä¸­å®Œæˆå¯¹äºè¯¥æ–‡ä»¶ä¸­æ‰€æœ‰æŒ‡ä»¤çš„å…¨å±€æ³¨å†Œ 

```js
  import * as directives from '@/directives'
// æ³¨å†Œè‡ªå®šä¹‰æŒ‡ä»¤
// éå†æ‰€æœ‰çš„å¯¼å‡ºçš„æŒ‡ä»¤å¯¹è±¡ å®Œæˆè‡ªå®šä¹‰å…¨å±€æ³¨å†Œ
Object.keys(directives).forEach(key => {
  // æ³¨å†Œè‡ªå®šä¹‰æŒ‡ä»¤
  Vue.directive(key, directives[key])
})
```

é’ˆå¯¹ä¸Šé¢çš„å¼•å…¥è¯­æ³•  **`import *  as  å˜é‡`**  å¾—åˆ°çš„æ˜¯ä¸€ä¸ªå¯¹è±¡**`{ å˜é‡1ï¼šå¯¹è±¡1ï¼Œå˜é‡2ï¼š å¯¹è±¡2 ...   }`**, æ‰€ä»¥å¯ä»¥é‡‡ç”¨å¯¹è±¡éå†çš„æ–¹æ³•è¿›è¡Œå¤„ç†

æŒ‡ä»¤æ³¨å†ŒæˆåŠŸï¼Œå¯ä»¥åœ¨**`navbar.vue`**ä¸­ç›´æ¥ä½¿ç”¨äº†

```vue
<img v-imageerror="defaultImg" :src="staffPhoto" class="user-avatar">
```

```js
 data() {
    return {
      defaultImg: require('@/assets/common/head.jpg')
    }
  },
```

**`æœ¬èŠ‚ä»»åŠ¡`**ï¼šå®ç°ä¸€ä¸ªè‡ªå®šä¹‰æŒ‡ä»¤ï¼Œè§£å†³å›¾ç‰‡åŠ è½½å¼‚å¸¸çš„é—®é¢˜

## å®ç°ç™»å‡ºåŠŸèƒ½

**`ç›®æ ‡`**ï¼šå®ç°ç”¨æˆ·çš„ç™»å‡ºæ“ä½œ

> ç™»å‡ºä»…ä»…æ˜¯è·³åˆ°ç™»å½•é¡µå—ï¼Ÿ

ä¸ï¼Œå½“ç„¶ä¸æ˜¯ï¼Œæˆ‘ä»¬è¦å¤„ç†å¦‚ä¸‹

![image-20200827143847893](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20200827143847893.png)

åŒæ ·çš„ï¼Œç™»å‡ºåŠŸèƒ½ï¼Œæˆ‘ä»¬åœ¨vuexä¸­çš„ç”¨æˆ·æ¨¡å—ä¸­å®ç°å¯¹åº”çš„**action**

**ç™»å‡ºaction**  **`src/store/modules/user.js`**

```js
// ç™»å‡ºçš„action
  logout(context) {
    // åˆ é™¤token
    context.commit('removeToken') // ä¸ä»…ä»…åˆ é™¤äº†vuexä¸­çš„ è¿˜åˆ é™¤äº†ç¼“å­˜ä¸­çš„
    // åˆ é™¤ç”¨æˆ·èµ„æ–™
    context.commit('removeUserInfo') // åˆ é™¤ç”¨æˆ·ä¿¡æ¯
  }
```

**å¤´éƒ¨èœå•è°ƒç”¨action**  **`src/layout/components/Navbar.vue`**

```js
  async logout() {
      await this.$store.dispatch('user/logout') // è¿™é‡Œä¸è®ºå†™ä¸å†™ await ç™»å‡ºæ–¹æ³•éƒ½æ˜¯åŒæ­¥çš„
      this.$router.push(`/login`) // è·³åˆ°ç™»å½•
  }
```

**`æ³¨æ„`**æˆ‘ä»¬è¿™é‡Œä¹Ÿå¯ä»¥é‡‡ç”¨vuexä¸­çš„æ¨¡å—åŒ–å¼•å…¥è¾…åŠ©å‡½æ•°

```js
import { mapGetters, createNamespacedHelpers  } from 'vuex'
const {  mapActions } = createNamespacedHelpers('user') // è¿™æ˜¯çš„mapActionç›´æ¥å¯¹åº”æ¨¡å—ä¸‹çš„actionè¾…åŠ©å‡½æ•°
  methods: {
    ...mapActions(['lgout']),
  }
```

ä»¥ä¸Šä»£ç ï¼Œå®é™…ä¸Šç›´æ¥å¯¹useræ¨¡å—ä¸‹çš„actionè¿›è¡Œäº†å¼•ç”¨ï¼Œ

**æäº¤ä»£ç **

**`æœ¬èŠ‚ä»»åŠ¡`**ï¼š å®ç°ç™»å‡ºåŠŸèƒ½

## Tokenå¤±æ•ˆçš„ä¸»åŠ¨ä»‹å…¥

**`ç›®æ ‡`**ï¼š å¤„ç†å½“tokenå¤±æ•ˆæ—¶ä¸šåŠ¡

### ä¸»åŠ¨ä»‹å…¥tokenå¤„ç†çš„ä¸šåŠ¡é€»è¾‘

> å¼€é—¨çš„é’¥åŒ™ä¸æ˜¯ä¸€ç›´æœ‰æ•ˆçš„ï¼Œå¦‚æœä¸€ç›´æœ‰æ•ˆï¼Œä¼šæœ‰å®‰å…¨é£é™©ï¼Œæ‰€ä»¥æˆ‘ä»¬å°è¯•åœ¨å®¢æˆ·ç«¯è¿›è¡Œä¸€ä¸‹tokençš„æ—¶é—´æ£€æŸ¥

å…·ä½“ä¸šåŠ¡å›¾å¦‚ä¸‹

50s

![image-20200716231205153](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20200716231205153.png)

<img src="https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20220418101854698.png" alt="image-20220418101854698" style="zoom:50%;" />

### æµç¨‹å›¾è½¬åŒ–ä»£ç 

**æµç¨‹å›¾è½¬åŒ–ä»£ç ** **`src/utils/auth.js`**

```js
const timeKey = 'hrsaas-timestamp-key' // è®¾ç½®ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„key

// è·å–æ—¶é—´æˆ³
export function getTimeStamp() {
  return Cookies.get(timeKey)
}
// è®¾ç½®æ—¶é—´æˆ³
export function setTimeStamp() {
  Cookies.set(timeKey, Date.now())
}
```

**`src/utils/request.js`**

```js
import axios from 'axios'
import store from '@/store'
import router from '@/router'
import { Message } from 'element-ui'
import { getTimeStamp } from '@/utils/auth'
const TimeOut = 3600 // å®šä¹‰è¶…æ—¶æ—¶é—´ å•ä½s

const service = axios.create({
// å½“æ‰§è¡Œ npm run dev  => .evn.development => /api => è·¨åŸŸä»£ç†
  baseURL: process.env.VUE_APP_BASE_API, // npm  run dev  => /api npm run build =>  /prod-api
  timeout: 5000 // è®¾ç½®è¶…æ—¶æ—¶é—´
})
// è¯·æ±‚æ‹¦æˆªå™¨
service.interceptors.request.use(config => {
  // config æ˜¯è¯·æ±‚çš„é…ç½®ä¿¡æ¯
  // æ³¨å…¥token
  if (store.getters.token) {
    // åªæœ‰åœ¨æœ‰tokençš„æƒ…å†µä¸‹ æ‰æœ‰å¿…è¦å»æ£€æŸ¥æ—¶é—´æˆ³æ˜¯å¦è¶…æ—¶
    if (IsCheckTimeOut()) {
      // å¦‚æœå®ƒä¸ºtrueè¡¨ç¤º è¿‡æœŸäº†
      // tokenæ²¡ç”¨äº† å› ä¸ºè¶…æ—¶äº†
      store.dispatch('user/logout') // ç™»å‡ºæ“ä½œ
      // è·³è½¬åˆ°ç™»å½•é¡µ
      router.push('/login')
      return Promise.reject(new Error('tokenè¶…æ—¶äº†'))
    }
    config.headers['Authorization'] = `Bearer ${store.getters.token}`
  }
  return config // å¿…é¡»è¦è¿”å›çš„
}, error => {
  return Promise.reject(error)
})
// å“åº”æ‹¦æˆªå™¨
service.interceptors.response.use(response => {
  // axiosé»˜è®¤åŠ äº†ä¸€å±‚data
  const { success, message, data } = response.data
  //   è¦æ ¹æ®successçš„æˆåŠŸä¸å¦å†³å®šä¸‹é¢çš„æ“ä½œ
  if (success) {
    return data
  } else {
    // ä¸šåŠ¡å·²ç»é”™è¯¯äº† è¿˜èƒ½è¿›then ? ä¸èƒ½ ï¼ åº”è¯¥è¿›catch
    Message.error(message) // æç¤ºé”™è¯¯æ¶ˆæ¯
    return Promise.reject(new Error(message))
  }
}, error => {
  Message.error(error.message) // æç¤ºé”™è¯¯ä¿¡æ¯
  return Promise.reject(error) // è¿”å›æ‰§è¡Œé”™è¯¯ è®©å½“å‰çš„æ‰§è¡Œé“¾è·³å‡ºæˆåŠŸ ç›´æ¥è¿›å…¥ catch
})
// æ˜¯å¦è¶…æ—¶
// è¶…æ—¶é€»è¾‘  (å½“å‰æ—¶é—´  - ç¼“å­˜ä¸­çš„æ—¶é—´) æ˜¯å¦å¤§äº æ—¶é—´å·®
function IsCheckTimeOut() {
  var currentTime = Date.now() // å½“å‰æ—¶é—´æˆ³
  var timeStamp = getTimeStamp() // ç¼“å­˜æ—¶é—´æˆ³
  return (currentTime - timeStamp) / 1000 > TimeOut
}
export default service

```

**`æœ¬èŠ‚æ³¨æ„`**ï¼šæˆ‘ä»¬åœ¨è°ƒç”¨ç™»å½•æ¥å£çš„æ—¶å€™ ä¸€å®šæ˜¯æ²¡æœ‰tokençš„ï¼Œæ‰€ä»¥tokenæ£€æŸ¥ä¸ä¼šå½±å“ç™»å½•æ¥å£çš„è°ƒç”¨

> åŒç†ï¼Œåœ¨ç™»å½•çš„æ—¶å€™ï¼Œå¦‚æœç™»å½•æˆåŠŸï¼Œæˆ‘ä»¬åº”è¯¥è®¾ç½®æ—¶é—´æˆ³

```js
  // å®šä¹‰login action  ä¹Ÿéœ€è¦å‚æ•° è°ƒç”¨actionæ—¶ ä¼ é€’è¿‡æ¥çš„å‚æ•°
  // async æ ‡è®°çš„å‡½æ•°å…¶å®å°±æ˜¯ä¸€ä¸ªå¼‚æ­¥å‡½æ•° -> æœ¬è´¨æ˜¯è¿˜æ˜¯ ä¸€ä¸ªpromise
  async login(context, data) {
    // ç»è¿‡å“åº”æ‹¦æˆªå™¨çš„å¤„ç†ä¹‹å è¿™é‡Œçš„resultå®é™…ä¸Šå°±æ˜¯ token
    const result = await login(data) // å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªpromise  resultå°±æ˜¯æ‰§è¡Œçš„ç»“æœ
    // axiosé»˜è®¤ç»™æ•°æ®åŠ äº†ä¸€å±‚data
    // è¡¨ç¤ºç™»å½•æ¥å£è°ƒç”¨æˆåŠŸ ä¹Ÿå°±æ˜¯æ„å‘³ç€ä½ çš„ç”¨æˆ·åå’Œå¯†ç æ˜¯æ­£ç¡®çš„
    // ç°åœ¨æœ‰ç”¨æˆ·token
    // actions ä¿®æ”¹state å¿…é¡»é€šè¿‡mutations
    context.commit('setToken', result)
    // å†™å…¥æ—¶é—´æˆ³
    setTimeStamp() // å°†å½“å‰çš„æœ€æ–°æ—¶é—´å†™å…¥ç¼“å­˜
  }
```

**æäº¤ä»£ç **

> æœ‰ä¸»åŠ¨å¤„ç†å°±æœ‰è¢«åŠ¨å¤„ç†ï¼Œä¹Ÿå°±æ˜¯åç«¯å‘Šè¯‰æˆ‘ä»¬è¶…æ—¶äº†ï¼Œæˆ‘ä»¬è¢«è¿«åšå‡ºååº”ï¼Œå¦‚æœåç«¯æ¥å£æ²¡æœ‰åšå¤„ç†ï¼Œä¸»åŠ¨ä»‹å…¥å°±æ˜¯ä¸€ç§ç®€å•çš„æ–¹å¼

**`æœ¬èŠ‚ä»»åŠ¡`**ï¼šå®Œæˆtokenè¶…æ—¶çš„ä¸»åŠ¨ä»‹å…¥

## Tokenå¤±æ•ˆçš„è¢«åŠ¨å¤„ç†

**`ç›®æ ‡`**ï¼š å®ç°tokenå¤±æ•ˆçš„è¢«åŠ¨å¤„ç†

> é™¤äº†tokençš„ä¸»åŠ¨ä»‹å…¥ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å¯¹tokenè¿›è¡Œè¢«åŠ¨çš„å¤„ç†ï¼Œå¦‚å›¾

![image-20200818155842864](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20200818155842864.png)

tokenè¶…æ—¶çš„é”™è¯¯ç æ˜¯**`10002`**

**ä»£ç å®ç°**  **`src/utils/request.js`**

```js
error => {
  // error ä¿¡æ¯ é‡Œé¢ responseçš„å¯¹è±¡
  if (error.response && error.response.data && error.response.data.code === 10002) {
    // å½“ç­‰äº10002çš„æ—¶å€™ è¡¨ç¤º åç«¯å‘Šè¯‰æˆ‘tokenè¶…æ—¶äº†
    store.dispatch('user/logout') // ç™»å‡ºaction åˆ é™¤token
    router.push('/login')
  } else {
    Message.error(error.message) // æç¤ºé”™è¯¯ä¿¡æ¯
  }
  return Promise.reject(error)
}
```

> æ— è®ºæ˜¯ä¸»åŠ¨ä»‹å…¥è¿˜æ˜¯è¢«åŠ¨å¤„ç†ï¼Œè¿™äº›æ“ä½œéƒ½æ˜¯ä¸ºäº†æ›´å¥½åœ°å¤„ç†tokenï¼Œå‡å°‘é”™è¯¯å¼‚å¸¸çš„å¯èƒ½æ€§

**`æœ¬èŠ‚ä»»åŠ¡`**  Tokenå¤±æ•ˆçš„è¢«åŠ¨å¤„ç†

## æ€»ç»“

æœ¬ç« èŠ‚æˆ‘ä»¬ä¸€æ­¥æ­¥å®ç°äº†å¦‚ä¸‹çš„æ•ˆæœ

![image-20200716015113164](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20200716015113164.png)

å®é™…çš„ä¸šåŠ¡èµ°å‘

![image-20200827152601712](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20200827152601712.png)

å®é™…ä¸Šï¼Œæˆ‘ä»¬çš„ä¸»é¡µåŠŸèƒ½æœ‰ä¸€ä¸ªé‡è¦çš„**è§’è‰²æƒ**åŠŸèƒ½è¿˜æ²¡æœ‰å®Œæˆï¼Œæ­¤åŠŸèƒ½ç­‰åˆ°æˆ‘ä»¬å®ŒæˆåŸºæœ¬ä¸šåŠ¡ä¹‹åå†è¿›è¡Œå±•å¼€

ä¸­å°å¤§å‹åç«¯å¹³å°çš„æ·±å…¥æ˜¯ä¸€ä¸ª**æŠ½ä¸å‰¥èŒ§**çš„è¿‡ç¨‹ï¼Œå¾ªåºæ¸è¿›çš„æ˜ç™½æ¯ä¸€æ­¥çš„æ“ä½œæ˜¯éå¸¸å…³é”®çš„ã€‚

