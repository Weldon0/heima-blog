---
title: ğŸ“š 06-ç»„ç»‡æ¶æ„
---
## ç»„ç»‡æ¶æ„æ ‘å½¢ç»“æ„å¸ƒå±€

**`ç›®æ ‡`**ï¼šä½¿ç”¨element-UIç»„ä»¶å¸ƒå±€ç»„ç»‡æ¶æ„çš„åŸºæœ¬å¸ƒå±€

### è®¤è¯†ç»„ç»‡æ¶æ„

[ç»„ç»‡æ¶æ„äº§å“prd]([http://czpm.itcast.cn/ihrm/#g=1&p=%E7%BB%84%E7%BB%87%E6%9E%B6%E6%9E%84](http://czpm.itcast.cn/ihrm/#g=1&p=ç»„ç»‡æ¶æ„))

![image-20200828105046683](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20200828105046683.png)

> ä¸€ä¸ªä¼ä¸šçš„ç»„ç»‡æ¶æ„æ˜¯è¯¥ä¼ä¸šçš„çµé­‚ï¼Œç»„ç»‡æ¶æ„å¤šå¸¸é‡‡ç”¨æ ‘å½¢é‡‘å­—å¡”å¼ç»“æ„ï¼Œæœ¬ç« èŠ‚ï¼Œæˆ‘ä»¬å¸ƒå±€å‡ºé¡µé¢çš„åŸºæœ¬ç»“æ„

![image-20200720010954202](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20200720010954202.png) 

æ–‡ä»¶åœ°å€ï¼š`src/views/departments/index.vue`

### å®ç°ç»„ç»‡æ¶æ„çš„å¤´éƒ¨å†…å®¹

é¦–å…ˆå®ç°å¤´éƒ¨çš„ç»“æ„ï¼Œé‡‡ç”¨elementçš„**è¡Œåˆ—å¸ƒå±€**

```vue
   <el-card class="tree-card">
        <!-- ç”¨äº†ä¸€ä¸ªè¡Œåˆ—å¸ƒå±€ -->
        <el-row type="flex" justify="space-between" align="middle" style="height: 40px">
          <el-col>
            <span>æ±Ÿè‹ä¼ æ™ºæ’­å®¢æ•™è‚²ç§‘æŠ€è‚¡ä»½æœ‰é™å…¬å¸</span>
          </el-col>
          <el-col :span="4">
            <el-row type="flex" justify="end">
              <!-- ä¸¤ä¸ªå†…å®¹ -->
              <el-col>è´Ÿè´£äºº</el-col>
              <el-col>
                <!-- ä¸‹æ‹‰èœå• element -->
                <el-dropdown>
                  <span>
                    æ“ä½œ<i class="el-icon-arrow-down" />
                  </span>
                  <!-- ä¸‹æ‹‰èœå• -->
                  <el-dropdown-menu slot="dropdown">
                    <el-dropdown-item>æ·»åŠ å­éƒ¨é—¨</el-dropdown-item>
                  </el-dropdown-menu>
                </el-dropdown>
              </el-col>
            </el-row>
          </el-col>
        </el-row>
      </el-card>
```

**æ ·å¼**

```css
<style scoped>
.tree-card {
  padding: 30px  140px;
  font-size:14px;
}
</style>

```

![image-20200720180221662](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20200720180221662.png)

### æ ‘å½¢ç»„ä»¶è®¤è¯†

æ¥ä¸‹æ¥ï¼Œå®ç°æ ‘å½¢çš„ç»“æ„ï¼Œé‡‡ç”¨elementçš„**[treeç»„ä»¶](https://element.eleme.cn/#/zh-CN/component/tree)**ï¼Œ å¦‚å›¾æ•ˆæœ

![image-20200828105634138](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20200828105634138.png)

> æ ‘å½¢ç»„ä»¶å±æ€§

| å‚æ•°               | è¯´æ˜                                                 | ç±»å‹    | å¯é€‰å€¼ | é»˜è®¤å€¼ |
| :----------------- | ---------------------------------------------------- | :------ | :----- | :----- |
| default-expand-all | æ˜¯å¦é»˜è®¤å±•å¼€æ‰€æœ‰èŠ‚ç‚¹                                 | boolean | â€”      | â€”      |
| data               | å±•ç¤ºæ•°æ®                                             | array   | â€”      | â€”      |
| node-key           | æ¯ä¸ªæ ‘èŠ‚ç‚¹ç”¨æ¥ä½œä¸ºå”¯ä¸€æ ‡è¯†çš„å±æ€§ï¼Œæ•´æ£µæ ‘åº”è¯¥æ˜¯å”¯ä¸€çš„ | String  | â€”      | â€”      |
| props              | é…ç½®é€‰é¡¹ï¼Œå…·ä½“çœ‹ä¸‹è¡¨                                 | object  | â€”      | â€”      |

**propså±æ€§**

| å‚æ•°     | è¯´æ˜                                                     | ç±»å‹                          | å¯é€‰å€¼ | é»˜è®¤å€¼ |
| :------- | :------------------------------------------------------- | :---------------------------- | :----- | :----- |
| label    | æŒ‡å®šèŠ‚ç‚¹æ ‡ç­¾ä¸ºèŠ‚ç‚¹å¯¹è±¡çš„æŸä¸ªå±æ€§å€¼                       | string, function(data, node)  | â€”      | â€”      |
| children | æŒ‡å®šå­æ ‘ä¸ºèŠ‚ç‚¹å¯¹è±¡çš„æŸä¸ªå±æ€§å€¼                           | string                        | â€”      | â€”      |
| disabled | æŒ‡å®šèŠ‚ç‚¹é€‰æ‹©æ¡†æ˜¯å¦ç¦ç”¨ä¸ºèŠ‚ç‚¹å¯¹è±¡çš„æŸä¸ªå±æ€§å€¼             | boolean, function(data, node) | â€”      | â€”      |
| isLeaf   | æŒ‡å®šèŠ‚ç‚¹æ˜¯å¦ä¸ºå¶å­èŠ‚ç‚¹ï¼Œä»…åœ¨æŒ‡å®šäº† lazy å±æ€§çš„æƒ…å†µä¸‹ç”Ÿæ•ˆ | boolean, function(data, node) | â€”      | â€”      |

**data**æ˜¯ç»„æˆæ ‘å½¢æ•°æ®çš„å…³é”®ï¼Œå¦‚ä¸‹çš„æ•°æ®ä¾¿èƒ½æ„å»ºæ ‘å½¢æ•°æ®

```json
 [{
          label: 'ä¸€çº§ 1',
          children: [{
            label: 'äºŒçº§ 1-1',
            children: [{
              label: 'ä¸‰çº§ 1-1-1'
            }]
          }]
        }, {
          label: 'ä¸€çº§ 2',
          children: [{
            label: 'äºŒçº§ 2-1',
            children: [{
              label: 'ä¸‰çº§ 2-1-1'
            }]
          }, {
            label: 'äºŒçº§ 2-2',
            children: [{
              label: 'ä¸‰çº§ 2-2-1'
            }]
          }]
        }, {
          label: 'ä¸€çº§ 3',
          children: [{
            label: 'äºŒçº§ 3-1',
            children: [{
              label: 'ä¸‰çº§ 3-1-1'
            }]
          }, {
            label: 'äºŒçº§ 3-2',
            children: [{
              label: 'ä¸‰çº§ 3-2-1'
            }]
          }]
        }]
```

![image-20200720232914114](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20200720232914114.png)

### å®ç°æ ‘å½¢çš„é™æ€ç»„ç»‡æ¶æ„

ç”±æ­¤ï¼Œæˆ‘ä»¬é¦–å…ˆå®ç°é™æ€æ•°æ®çš„ç»„ç»‡æ¶æ„

```vue
 <!--æ”¾ç½®ä¸€ä¸ªå±æ€§   è¿™é‡Œçš„propså’Œæˆ‘ä»¬ä¹‹å‰å­¦ä¹ çš„çˆ¶ä¼ å­ çš„propsæ²¡å…³ç³»-->
 <el-tree :data="departs" :props="defaultProps" />
export default {
  data() {
    return {
      defaultProps: {
        label: 'name'
      },
      departs: [{ name: 'æ€»è£åŠ', children: [{ name: 'è‘£äº‹ä¼š' }] },
        { name: 'è¡Œæ”¿éƒ¨' }, { name: 'äººäº‹éƒ¨' }]
    }
  }
}
```

> æ¥ä¸‹æ¥ï¼Œå¯¹æ¯ä¸ªå±‚çº§èŠ‚ç‚¹å¢åŠ æ˜¾ç¤ºå†…å®¹ï¼Œæ­¤æ—¶éœ€è¦ç”¨åˆ°treeçš„æ’æ§½

```vue
 <el-tree :data="departs" :props="defaultProps" :default-expand-all="true">
          <!-- ä¼ å…¥å†…å®¹ æ’æ§½å†…å®¹ ä¼šå¾ªç¯å¤šæ¬¡ æœ‰å¤šå°‘èŠ‚ç‚¹ å°±å¾ªç¯å¤šå°‘æ¬¡ -->
          <!-- ä½œç”¨åŸŸæ’æ§½ slot-scope="obj" æ¥æ”¶ä¼ é€’ç»™æ’æ§½çš„æ•°æ®   data æ¯ä¸ªèŠ‚ç‚¹çš„æ•°æ®å¯¹è±¡-->
          <el-row slot-scope="{ data }" type="flex" justify="space-between" align="middle" style="height: 40px; width: 100%">
            <el-col>
              <!-- å·¦ä¾§å†…å®¹ -->
              <span>{{ data.name }}</span>
            </el-col>
            <el-col :span="4">
              <el-row type="flex" justify="end">
                <el-col>{{ data.manager }}</el-col>
                <el-col>
                  <!-- æ”¾ç½®ä¸‹æ‹‰èœå• -->
                  <el-dropdown>
                    <!-- å†…å®¹ -->
                    <span>æ“ä½œ
                      <i class="el-icon-arrow-down" />
                    </span>
                    <!-- å…·åæ’æ§½ -->
                    <el-dropdown-menu slot="dropdown">
                      <!-- ä¸‹æ‹‰é€‰é¡¹ -->
                      <el-dropdown-item>æ·»åŠ å­éƒ¨é—¨</el-dropdown-item>
                      <el-dropdown-item>ç¼–è¾‘éƒ¨é—¨</el-dropdown-item>
                      <el-dropdown-item>åˆ é™¤éƒ¨é—¨</el-dropdown-item>

                    </el-dropdown-menu>
                  </el-dropdown>
                </el-col>
              </el-row>

            <!-- å³ä¾§å†…å®¹ -->
            </el-col>
          </el-row>        </el-tree>
<script>
export default {
  data() {
    return {
      departs: [{ name: 'æ€»è£åŠ', manager: 'æ›¹æ“', children: [{ name: 'è‘£äº‹ä¼š', manager: 'æ›¹ä¸•' }] },
        { name: 'è¡Œæ”¿éƒ¨', manager: 'åˆ˜å¤‡' },
        { name: 'äººäº‹éƒ¨', manager: 'å­™æƒ' }],
      defaultProps: {
        label: 'name' // è¡¨ç¤º ä»è¿™ä¸ªå±æ€§æ˜¾ç¤ºå†…å®¹
      }
    }
  }
}
</script>
```

æœ€ç»ˆå½¢æˆé™æ€ç»“æ„æ•ˆæœ

![image-20200912150032528](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20200912150032528.png)

**æäº¤ä»£ç **

**`æœ¬èŠ‚ä»»åŠ¡`**ï¼šå®Œæˆæ ‘å½¢ç»“æ„çš„æ˜¾ç¤º

##  å°†æ ‘å½¢çš„æ“ä½œå†…å®¹å•ç‹¬æŠ½ææˆç»„ä»¶

**`ç›®æ ‡`**ï¼š å°†æ ‘å½¢çš„æ“ä½œå†…å®¹å•ç‹¬æŠ½ææˆç»„ä»¶

### å°è£…å•ç‹¬çš„æ ‘æ“ä½œæ ç»„ä»¶

> é€šè¿‡ç¬¬ä¸€ä¸ªç« èŠ‚ï¼Œæˆ‘ä»¬å‘ç°ï¼Œæ ‘å½¢çš„é¡¶çº§å†…å®¹å®é™…å’Œå­èŠ‚ç‚¹çš„å†…å®¹æ˜¯ä¸€è‡´çš„ï¼Œæ­¤æ—¶å¯ä»¥å°†è¯¥éƒ¨åˆ†æŠ½ææˆä¸€ä¸ªç»„ä»¶ï¼ŒèŠ‚çœä»£ç 

ç»„ä»¶ **`src/views/departments/components/tree-tools.vue`**

```vue
<template>
  <el-row type="flex" justify="space-between" align="middle" style="height: 40px;width: 100%">
    <el-col>
      <!-- åç§°åº”è¯¥å˜æˆ å¯¹åº”çš„èŠ‚ç‚¹ä¸­çš„name -->
      <span>{{ treeNode.name }}</span>
    </el-col>
    <el-col :span="4">
      <el-row type="flex" justify="end">
        <!-- ä¸¤ä¸ªå†…å®¹ -->
        <el-col>{{ treeNode.manager }}</el-col>
        <el-col>
          <!-- ä¸‹æ‹‰èœå• element -->
          <el-dropdown>
            <span>
              æ“ä½œ<i class="el-icon-arrow-down" />
            </span>
            <!-- ä¸‹æ‹‰èœå• -->
            <el-dropdown-menu slot="dropdown">
              <el-dropdown-item>æ·»åŠ å­éƒ¨é—¨</el-dropdown-item>
              <el-dropdown-item>ç¼–è¾‘éƒ¨é—¨</el-dropdown-item>
              <el-dropdown-item>åˆ é™¤éƒ¨é—¨</el-dropdown-item>
            </el-dropdown-menu>
          </el-dropdown>
        </el-col>
      </el-row>
    </el-col>
  </el-row>
</template>

<script>
// è¯¥ç»„ä»¶éœ€è¦å¯¹å¤–å¼€æ”¾å±æ€§ å¤–éƒ¨éœ€è¦æä¾›ä¸€ä¸ªå¯¹è±¡ å¯¹è±¡é‡Œéœ€è¦æœ‰name  manager
export default {
  // propså¯ä»¥ç”¨æ•°ç»„æ¥æ¥æ”¶æ•°æ® ä¹Ÿå¯ä»¥ç”¨å¯¹è±¡æ¥æ¥æ”¶
  // props: {   propså±æ€§: {  é…ç½®é€‰é¡¹ }  }
  props: {
    // å®šä¹‰ä¸€ä¸ªpropså±æ€§
    treeNode: {
      type: Object, // å¯¹è±¡ç±»å‹
      required: true // è¦æ±‚å¯¹æ–¹ä½¿ç”¨æ‚¨çš„ç»„ä»¶çš„æ—¶å€™ å¿…é¡»ä¼ treeNodeå±æ€§ å¦‚æœä¸ä¼  å°±ä¼šæŠ¥é”™
    }
  }
}
</script>


```

### åœ¨ç»„ç»‡æ¶æ„ä¸­åº”ç”¨æ“ä½œæ ç»„ä»¶

æ¥ä¸‹æ¥ï¼Œåœ¨**`src/views/departments/index.vue`**è¿›è¡Œä»£ç çš„ç®€åŒ–

```vue
<template>
  <div class="dashboard-container">
    <div class="app-container">
      <!-- å®ç°é¡µé¢çš„åŸºæœ¬å¸ƒå±€ -->
      <el-card class="tree-card">
        <!-- ç”¨äº†ä¸€ä¸ªè¡Œåˆ—å¸ƒå±€ -->
        <!-- ç¼ºå°‘treeNode -->
        <tree-tools :tree-node="company" />
        <!--æ”¾ç½®ä¸€ä¸ªå±æ€§   è¿™é‡Œçš„propså’Œæˆ‘ä»¬ä¹‹å‰å­¦ä¹ çš„çˆ¶ä¼ å­ çš„propsæ²¡å…³ç³»-->
        <el-tree :data="departs" :props="defaultProps" default-expand-all>
          <!-- è¯´æ˜el-treeé‡Œé¢çš„è¿™ä¸ªå†…å®¹ å°±æ˜¯æ’æ§½å†…å®¹ => å¡«å‘å†…å®¹  => æœ‰å¤šå°‘ä¸ªèŠ‚ç‚¹å¾ªç¯å¤šå°‘æ¬¡ -->
          <!-- scope-scope æ˜¯ treeç»„ä»¶ä¼ ç»™æ¯ä¸ªèŠ‚ç‚¹çš„æ’æ§½çš„å†…å®¹çš„æ•°æ® -->
          <!-- é¡ºåºä¸€å®šæ˜¯ æ‰§è¡Œslot-scopeçš„èµ‹å€¼ æ‰å»æ‰§è¡Œ propsçš„ä¼ å€¼ -->
          <tree-tools slot-scope="{ data }" :tree-node="data" />
        </el-tree>
      </el-card>
    </div>
  </div>
</template>

```

ä¸Šé¢ä»£ç ä¸­ï¼Œcompanyå˜é‡éœ€è¦åœ¨dataä¸­å®šä¹‰

```js
company: { name: 'æ±Ÿè‹ä¼ æ™ºæ’­å®¢æ•™è‚²ç§‘æŠ€è‚¡ä»½æœ‰é™å…¬å¸', manager: 'è´Ÿè´£äºº' },
```

åŒæ—¶ï¼Œç”±äºåœ¨ä¸¤ä¸ªä½ç½®éƒ½ä½¿ç”¨äº†è¯¥ç»„ä»¶ï¼Œä½†æ˜¯æ”¾ç½®åœ¨æœ€ä¸Šå±‚çš„ç»„ä»¶æ˜¯ä¸éœ€è¦æ˜¾ç¤º **`åˆ é™¤éƒ¨é—¨`**å’Œ**`ç¼–è¾‘éƒ¨é—¨`**çš„

æ‰€ä»¥ï¼Œå¢åŠ ä¸€ä¸ªæ–°çš„å±æ€§ **`isRootï¼ˆæ˜¯å¦æ ¹èŠ‚ç‚¹ï¼‰`**è¿›è¡Œæ§åˆ¶

```js
 props: {
    treeNode: {
      required: true, // è®¾ç½®å½“å‰æ•°æ®ä¸ºå¿…å¡«
      type: Object // ç±»å‹æ˜¯Object
    },
    isRoot: {
      type: Boolean,
      default: false
    }
  }
 <tree-tools :tree-node="company" :is-root="true" />
     
```

ç»„ä»¶ä¸­ï¼Œ æ ¹æ®isRootåˆ¤æ–­æ˜¾ç¤º

```vue
     <!-- ç¼–è¾‘éƒ¨é—¨å’Œåˆ é™¤éƒ¨é—¨åªä¼šåœ¨å­èŠ‚ç‚¹ä¸Šæ˜¾ç¤º -->
          <el-dropdown-item v-if="!isRoot">ç¼–è¾‘éƒ¨é—¨</el-dropdown-item>
         <el-dropdown-item v-if="!isRoot">åˆ é™¤éƒ¨é—¨</el-dropdown-item>
```

> é€šè¿‡å°è£…ï¼Œä»£ç çœ‹ä¸Šå»æ›´åŠ ç´§å‡‘ï¼Œç®€æ´ï¼Œè¿™å°±æ˜¯å°è£…çš„é­…åŠ›

**æäº¤ä»£ç **

**`æœ¬èŠ‚ä»»åŠ¡`**ï¼šå°†æ ‘å½¢å†…å®¹å•ç‹¬æŠ½æç»„ä»¶

## è·å–ç»„ç»‡æ¶æ„æ•°æ®ï¼Œå¹¶è¿›è¡Œæ ‘å½¢å¤„ç†

**`ç›®æ ‡`**è·å–çœŸå®çš„ç»„ç»‡æ¶æ„æ•°æ®ï¼Œå¹¶å°†å…¶è½¬åŒ–æˆæ ‘å½¢æ•°æ®æ˜¾ç¤ºåœ¨é¡µé¢ä¸Š

### å°è£…APIæ¥å£ï¼Œè·å–ç»„ç»‡æ¶æ„æ•°æ®

> ç°åœ¨åŸºæœ¬çš„é™æ€ç»“æ„å·²ç»å½¢æˆï¼Œæ¥ä¸‹æ¥éœ€è¦è·å–çœŸå®çš„æ•°æ®

é¦–å…ˆï¼Œ**å°è£…è·å–ç»„ç»‡æ¶æ„çš„è¯·æ±‚** **`src/api/departments.js`**

```js
/** *
 * è·å–ç»„ç»‡æ¶æ„æ•°æ®
 * **/
export function getDepartments() {
  return request({
    url: '/company/department'
  })
}
```

åœ¨é’©å­å‡½æ•°ä¸­è°ƒç”¨æ¥å£

```js
import TreeTools from './components/tree-tools'
import { getDepartments } from '@/api/departments'
export default {
  components: {
    TreeTools
  },
  data() {
    return {
      company: { }, // å°±æ˜¯å¤´éƒ¨çš„æ•°æ®ç»“æ„
      departs: [],
      defaultProps: {
        label: 'name' // è¡¨ç¤º ä»è¿™ä¸ªå±æ€§æ˜¾ç¤ºå†…å®¹
      }
    }
  },
  created() {
    this.getDepartments() // è°ƒç”¨è‡ªèº«çš„æ–¹æ³•
  },
  methods: {
    async getDepartments() {
      const result = await getDepartments()
      this.company = { name: result.companyName, manager: 'è´Ÿè´£äºº' }
        this.departs = result.depts // éœ€è¦å°†å…¶è½¬åŒ–æˆæ ‘å½¢ç»“æ„
      console.log(result)
    }
  }
}
```

### å°†æ•°ç»„æ•°æ®è½¬åŒ–æˆæ ‘å½¢ç»“æ„

<img src="https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20220115201533437.png" alt="image-20220115201533437" style="zoom:50%;" />

ç„¶åï¼Œæˆ‘ä»¬éœ€è¦å°†åˆ—è¡¨å‹çš„æ•°æ®ï¼Œè½¬åŒ–æˆæ ‘å½¢æ•°æ®ï¼Œè¿™é‡Œéœ€è¦ç”¨åˆ°**é€’å½’ç®—æ³•**

pidçˆ¶äº²çš„id  idè‡ªå·±çš„id

![image-20200721010931214](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20200721010931214.png)

<img src="https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20220419115155084.png" alt="image-20220419115155084" style="zoom:50%;" />

å°è£…ä¸€ä¸ªå·¥å…·æ–¹æ³•ï¼Œ**`src/utils/index.js`**

```js
/** *
 *
 *  å°†åˆ—è¡¨å‹çš„æ•°æ®è½¬åŒ–æˆæ ‘å½¢æ•°æ® => é€’å½’ç®—æ³• => è‡ªèº«è°ƒç”¨è‡ªèº« => ä¸€å®šæ¡ä»¶ä¸èƒ½ä¸€æ ·ï¼Œ å¦åˆ™å°±ä¼šæ­»å¾ªç¯
 *  éå†æ ‘å½¢ æœ‰ä¸€ä¸ªé‡ç‚¹ è¦å…ˆæ‰¾ä¸€ä¸ªå¤´å„¿
 * ***/
export function tranListToTreeData(list, rootValue) {
  var arr = []
  list.forEach(item => {
    if (item.pid === rootValue) {
      // ç›®æ ‡ï¼šæ‰¾å½“å‰èŠ‚ç‚¹çš„äº²å„¿å­
      // æŠŠå½“å‰çš„ä¸€çº§èŠ‚ç‚¹çš„idä¼ å…¥transDataå†è¿›è¡Œåˆ¤æ–­ï¼Œè·å–åˆ°å½“å‰ä¸€çº§èŠ‚ç‚¹å¯¹åº”çš„å„¿å­
      const children = tranListToTreeData(list, item.id)
      if (children.length) {
        // å¦‚æœchildrençš„é•¿åº¦å¤§äº0 è¯´æ˜æ‰¾åˆ°äº†å­èŠ‚ç‚¹
        item.children = children
      }
      arr.push(item) // å°†å†…å®¹åŠ å…¥åˆ°æ•°ç»„ä¸­
    }
  })
  return arr
}
```

è°ƒç”¨è½¬åŒ–æ–¹æ³•ï¼Œè½¬åŒ–æ ‘å½¢ç»“æ„

```js
  this.company = { name: result.companyName, manager: 'è´Ÿè´£äºº' }; // è¿™é‡Œå®šä¹‰ä¸€ä¸ªç©ºä¸²  å› ä¸º å®ƒæ˜¯æ ¹ æ‰€æœ‰çš„å­èŠ‚ç‚¹çš„æ•°æ®pid éƒ½æ˜¯ ""
  this.departs = transListToTreeData(result.depts, '');
```

è¿™æ ·ä¸€æ¥ï¼Œæ ‘å½¢æ•°æ®å°±æœ‰äº†ï¼Œä¸‹ä¸€ç« èŠ‚ï¼Œå°±å¯ä»¥é’ˆå¯¹éƒ¨é—¨è¿›è¡Œæ“ä½œ

**æäº¤ä»£ç **

**`æœ¬èŠ‚ä»»åŠ¡`** è·å–ç»„ç»‡æ¶æ„æ•°æ®ï¼Œå¹¶è¿›è¡Œæ ‘å½¢å¤„ç†

## åˆ é™¤éƒ¨é—¨åŠŸèƒ½å®ç°

**`ç›®æ ‡`**å®ç°æ“ä½œåŠŸèƒ½çš„åˆ é™¤åŠŸèƒ½

### å°è£…åˆ é™¤æ¥å£ï¼Œæ³¨å†Œä¸‹æ‹‰èœå•äº‹ä»¶

é¦–å…ˆï¼Œå°è£…åˆ é™¤åŠŸèƒ½æ¨¡å— **`src/api/departments.js`**

```js
/** *
 *  æ ¹æ®idæ ¹æ®éƒ¨é—¨  æ¥å£æ˜¯æ ¹æ®restfulçš„è§„åˆ™è®¾è®¡çš„   åˆ é™¤ delete  æ–°å¢ post  ä¿®æ”¹put è·å– get
 * **/
export function delDepartments(id) {
  return request({
    url: `/company/department/${id}`,
    method: 'delete'
  })
}
```

ç„¶åï¼Œåœ¨tree-toolsç»„ä»¶ä¸­ï¼Œç›‘å¬ä¸‹æ‹‰èœå•çš„ç‚¹å‡»äº‹ä»¶  **`src/views/departments/index.vue`**

```vue
          <el-dropdown @command="operateDepts">
            <span>
              æ“ä½œ<i class="el-icon-arrow-down" />
            </span>
            <!-- ä¸‹æ‹‰èœå• -->
            <el-dropdown-menu slot="dropdown">
              <el-dropdown-item command="add">æ·»åŠ å­éƒ¨é—¨</el-dropdown-item>
              <!-- ç¼–è¾‘éƒ¨é—¨å’Œåˆ é™¤éƒ¨é—¨åªä¼šåœ¨å­èŠ‚ç‚¹ä¸Šæ˜¾ç¤º -->
              <el-dropdown-item v-if="!isRoot" command="edit">ç¼–è¾‘éƒ¨é—¨</el-dropdown-item>
              <el-dropdown-item v-if="!isRoot" command="del">åˆ é™¤éƒ¨é—¨</el-dropdown-item>
            </el-dropdown-menu>
          </el-dropdown>
```

>dropdownä¸‹æ‹‰èœå•çš„ç›‘å¬äº‹ä»¶command

```js
    // æ“ä½œèŠ‚ç‚¹è°ƒç”¨çš„æ–¹æ³•
    operateDepts(type) {
      if (type === 'add') {
        // æ·»åŠ å­éƒ¨é—¨çš„æ“ä½œ
      } else if (type === 'edit') {
        //  ç¼–è¾‘éƒ¨é—¨çš„æ“ä½œ
      } else {
        //  åˆ é™¤æ“ä½œ
      }
    }
```

### è°ƒç”¨åˆ é™¤æ¥å£ï¼Œé€šçŸ¥çˆ¶ç»„ä»¶æ›´æ–°æ•°æ®

> åˆ é™¤ä¹‹å‰ï¼Œæç¤ºç”¨æˆ·æ˜¯å¦åˆ é™¤ï¼Œç„¶åè°ƒç”¨åˆ é™¤æ¥å£

```js
    // æ“ä½œèŠ‚ç‚¹è°ƒç”¨çš„æ–¹æ³•
    operateDepts(type) {
      if (type === 'add') {
        // æ·»åŠ å­éƒ¨é—¨çš„æ“ä½œ
      } else if (type === 'edit') {
        //  ç¼–è¾‘éƒ¨é—¨çš„æ“ä½œ
      } else {
        //  åˆ é™¤æ“ä½œ
        this.$confirm('ç¡®å®šè¦åˆ é™¤è¯¥éƒ¨é—¨å—').then(() => {
          // å¦‚æœç‚¹å‡»äº†ç¡®å®šå°±ä¼šè¿›å…¥then
          return delDepartments(this.treeNode.id) // è¿”å›promiseå¯¹è±¡
        }).then(() => {
          //  å¦‚æœåˆ é™¤æˆåŠŸäº†  å°±ä¼šè¿›å…¥è¿™é‡Œ
        })
      }
    }
```

> ä¸Šé¢ä»£ç ä¸­ï¼Œæˆ‘ä»¬å·²ç»æˆåŠŸåˆ é™¤äº†å‘˜å·¥æ•°æ®ï¼Œä½†æ˜¯æ€ä¹ˆé€šçŸ¥çˆ¶ç»„ä»¶è¿›è¡Œæ›´æ–°å‘¢

åœ¨å‰é¢çš„è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬å·²ç»å­¦ä¹ è¿‡å¯ä»¥é€šè¿‡è‡ªå®šä¹‰äº‹ä»¶**`this.$emit`**çš„æ–¹å¼æ¥è¿›è¡Œ

```js
  //  å¦‚æœåˆ é™¤æˆåŠŸäº†  å°±ä¼šè¿›å…¥è¿™é‡Œ
          this.$emit('delDepts') // è§¦å‘è‡ªå®šä¹‰äº‹ä»¶
          this.$message.success('åˆ é™¤éƒ¨é—¨æˆåŠŸ')
```

çˆ¶ç»„ä»¶ç›‘å¬äº‹ä»¶ **`src/views/department/index.vue`**

```vue
<tree-tools slot-scope="obj" :tree-node="obj.data" @delDepts="getDepartments" />
```

**æäº¤ä»£ç **

**`æœ¬èŠ‚ä»»åŠ¡`**ï¼šåˆ é™¤éƒ¨é—¨åŠŸèƒ½å®ç°

## æ–°å¢éƒ¨é—¨åŠŸèƒ½-å»ºç«‹ç»„ä»¶

**`ç›®æ ‡`**ï¼šå®ç°æ–°å¢éƒ¨é—¨åŠŸèƒ½çš„ç»„ä»¶å»ºç«‹

### å°è£…æ–°å¢æ¥å£ï¼Œæ–°å»ºç»„ä»¶ä¸­çš„å¼¹å±‚ç»“æ„

é¦–å…ˆï¼Œ å°è£…æ–°å¢éƒ¨é—¨çš„apiæ¨¡å—  **`src/api/departments.js`**

```js
/**
 *  æ–°å¢éƒ¨é—¨æ¥å£
 *
 * ****/
export function addDepartments(data) {
  return request({
    url: '/company/department',
    method: 'post',
    data
  })
}

```

ç„¶åï¼Œæˆ‘ä»¬éœ€è¦æ„å»ºä¸€ä¸ªæ–°å¢éƒ¨é—¨çš„çª—ä½“ç»„ä»¶ **`src/views/department/components/add-dept.vue`**

å…¶ä¸­çš„äº¤äº’è®¾è®¡å¦‚ä¸‹

![image-20200828162901390](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20200828162901390.png)

[è®¾è®¡è¦æ±‚]([http://czpm.itcast.cn/ihrm/#g=1&p=%E7%BB%84%E7%BB%87%E6%9E%B6%E6%9E%84](http://czpm.itcast.cn/ihrm/#g=1&p=ç»„ç»‡æ¶æ„))

```vue
<template>
  <!-- æ–°å¢éƒ¨é—¨çš„å¼¹å±‚ -->
  <el-dialog title="æ–°å¢éƒ¨é—¨">
    <!-- è¡¨å•ç»„ä»¶  el-form   label-widthè®¾ç½®labelçš„å®½åº¦   -->
    <!-- åŒ¿åæ’æ§½ -->
    <el-form label-width="120px">
      <el-form-item label="éƒ¨é—¨åç§°">
        <el-input style="width:80%" placeholder="1-50ä¸ªå­—ç¬¦" />
      </el-form-item>
      <el-form-item label="éƒ¨é—¨ç¼–ç ">
        <el-input style="width:80%" placeholder="1-50ä¸ªå­—ç¬¦" />
      </el-form-item>
      <el-form-item label="éƒ¨é—¨è´Ÿè´£äºº">
        <el-select style="width:80%" placeholder="è¯·é€‰æ‹©" />
      </el-form-item>
      <el-form-item label="éƒ¨é—¨ä»‹ç»">
        <el-input style="width:80%" placeholder="1-300ä¸ªå­—ç¬¦" type="textarea" :rows="3" />
      </el-form-item>
    </el-form>
    <!-- el-dialogæœ‰ä¸“é—¨æ”¾ç½®åº•éƒ¨æ“ä½œæ çš„ æ’æ§½  å…·åæ’æ§½ -->
    <el-row slot="footer" type="flex" justify="center">
      <!-- åˆ—è¢«åˆ†ä¸º24 -->
      <el-col :span="6">
        <el-button type="primary" size="small">ç¡®å®š</el-button>
        <el-button size="small">å–æ¶ˆ</el-button>
      </el-col>
    </el-row>
  </el-dialog>
</template>
```

### ç‚¹å‡»æ–°å¢å­éƒ¨é—¨æ˜¾ç¤ºå¼¹å±‚ç»„ä»¶

ç„¶åï¼Œæˆ‘ä»¬éœ€è¦ç”¨å±æ€§æ§åˆ¶ç»„ä»¶çš„æ˜¾ç¤ºæˆ–è€…éšè—

```js
  // éœ€è¦ä¼ å…¥ä¸€ä¸ªpropså˜é‡æ¥æ§åˆ¶ æ˜¾ç¤ºæˆ–è€…éšè—
  props: {
    showDialog: {
      type: Boolean,
      default: false
    }
  }
```

```vue
<el-dialog title="æ–°å¢éƒ¨é—¨" :visible="showDialog">
```

åœ¨**`departments/index.vue`** ä¸­å¼•å…¥è¯¥ç»„ä»¶

```js
import AddDept from './components/add-dept' // å¼•å…¥æ–°å¢éƒ¨é—¨ç»„ä»¶
export default {
  components: { AddDept }
}
```

å®šä¹‰æ§åˆ¶çª—ä½“æ˜¾ç¤ºçš„å˜é‡**`showDialog`**

```js
 data() {
    return {
      showDialog: false // æ˜¾ç¤ºçª—ä½“
    }
  },
    <!-- æ”¾ç½®æ–°å¢å¼¹å±‚ç»„ä»¶  -->
    <add-dept :show-dialog="showDialog" />
```

å½“ç‚¹å‡»æ–°å¢éƒ¨é—¨æ—¶ï¼Œå¼¹å‡ºç»„ä»¶

>  æ³¨æ„ï¼Œç‚¹å‡»æ–°å¢æ—¶tree-toolsç»„ä»¶ï¼Œæ‰€ä»¥è¿™é‡Œï¼Œæˆ‘ä»¬ä¾ç„¶éœ€è¦å­ç»„ä»¶è°ƒç”¨çˆ¶ç»„ä»¶

**å­ç»„ä»¶è§¦å‘æ–°å¢äº‹ä»¶**Â· **`src/views/departments/tree-tools.vue`** 

```js
  if (type === 'add') {
        // æ·»åŠ å­éƒ¨é—¨çš„æ“ä½œ
        // å‘Šè¯‰çˆ¶ç»„ä»¶ æ˜¾ç¤ºå¼¹å±‚
        this.$emit('addDepts', this.treeNode) // ä¸ºä½•ä¼ å‡ºtreeNode å› ä¸ºæ˜¯æ·»åŠ å­éƒ¨é—¨ éœ€è¦å½“å‰éƒ¨é—¨çš„æ•°æ®
      }
```

**çˆ¶ç»„ä»¶ç›‘å¬äº‹ä»¶**   

```vue
 <tree-tools slot-scope="obj" :tree-node="obj.data" @delDepts="getDepartments" @addDepts="addDepts"  />

```

**æ–¹æ³•ä¸­å¼¹å‡ºå±‚,è®°å½•åœ¨å“ªä¸ªèŠ‚ç‚¹ä¸‹æ·»åŠ å­éƒ¨é—¨**

```js
 addDepts(node) {
      this.showDialog = true // æ˜¾ç¤ºå¼¹å±‚
      // å› ä¸ºnodeæ˜¯å½“å‰çš„ç‚¹å‡»çš„éƒ¨é—¨ï¼Œ æ­¤æ—¶è¿™ä¸ªéƒ¨é—¨åº”è¯¥è®°å½•ä¸‹æ¥,
      this.node = node
    }
```

æäº¤ä»£ç 

<img src="https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20220118113427461.png" alt="image-20220118113427461" style="zoom:50%;" />

**æœ¬èŠ‚ä»»åŠ¡**ï¼šæ–°å¢éƒ¨é—¨åŠŸèƒ½-å»ºç«‹ç»„ä»¶

## å®Œæˆæ–°å¢éƒ¨é—¨çš„è§„åˆ™æ ¡éªŒ



:::tip ç›®æ ‡

**ç›®æ ‡**: å®Œæˆæ–°å¢éƒ¨é—¨åŠŸèƒ½çš„è§„åˆ™æ ¡éªŒå’Œæ•°æ®æäº¤éƒ¨åˆ†

:::

### å®Œæˆæ–°å¢è¡¨å•çš„åŸºæœ¬æ ¡éªŒæ¡ä»¶

éƒ¨é—¨åç§°ï¼ˆnameï¼‰ï¼šå¿…å¡« 1-50ä¸ªå­—ç¬¦  / åŒçº§éƒ¨é—¨ä¸­ç¦æ­¢å‡ºç°é‡å¤éƒ¨é—¨

éƒ¨é—¨ç¼–ç ï¼ˆcodeï¼‰ï¼šå¿…å¡« 1-50ä¸ªå­—ç¬¦  / éƒ¨é—¨ç¼–ç åœ¨æ•´ä¸ªæ¨¡å—ä¸­éƒ½ä¸å…è®¸é‡å¤

éƒ¨é—¨è´Ÿè´£äººï¼ˆmanagerï¼‰ï¼šå¿…å¡«

éƒ¨é—¨ä»‹ç» ( introduce)ï¼šå¿…å¡« 1-300ä¸ªå­—ç¬¦

> å®šä¹‰æ•°æ®ç»“æ„

```js
  formData: {
        name: '', // éƒ¨é—¨åç§°
        code: '', // éƒ¨é—¨ç¼–ç 
        manager: '', // éƒ¨é—¨ç®¡ç†è€…
        introduce: '' // éƒ¨é—¨ä»‹ç»
  },
```

> å®Œæˆè¡¨å•æ ¡éªŒéœ€è¦çš„å‰ç½®æ¡ä»¶

* el-formé…ç½®modelå’Œruleså±æ€§
* el-form-itemé…ç½®propå±æ€§
* è¡¨å•è¿›è¡Œv-modelåŒå‘ç»‘å®š

### é…ç½®æ–°å¢è¡¨å•çš„åŸºæœ¬æ ¡éªŒè§„åˆ™

> æ ¹æ®è¿™äº›è¦æ±‚ï¼Œæ ¡éªŒè§„åˆ™

```js
  data() {
    return {
      // å®šä¹‰è¡¨å•æ•°æ®
      formData: {
        name: '', // éƒ¨é—¨åç§°
        code: '', // éƒ¨é—¨ç¼–ç 
        manager: '', // éƒ¨é—¨ç®¡ç†è€…
        introduce: '' // éƒ¨é—¨ä»‹ç»
      },
      // å®šä¹‰æ ¡éªŒè§„åˆ™
      rules: {
        name: [{ required: true, message: 'éƒ¨é—¨åç§°ä¸èƒ½ä¸ºç©º', trigger: 'blur' },
          { min: 1, max: 50, message: 'éƒ¨é—¨åç§°è¦æ±‚1-50ä¸ªå­—ç¬¦', trigger: 'blur' }],
        code: [{ required: true, message: 'éƒ¨é—¨ç¼–ç ä¸èƒ½ä¸ºç©º', trigger: 'blur' },
          { min: 1, max: 50, message: 'éƒ¨é—¨ç¼–ç è¦æ±‚1-50ä¸ªå­—ç¬¦', trigger: 'blur' }],
        manager: [{ required: true, message: 'éƒ¨é—¨è´Ÿè´£äººä¸èƒ½ä¸ºç©º', trigger: 'blur' }],
        introduce: [{ required: true, message: 'éƒ¨é—¨ä»‹ç»ä¸èƒ½ä¸ºç©º', trigger: 'blur' },
          { trigger: 'blur', min: 1, max: 300, message: 'éƒ¨é—¨ä»‹ç»è¦æ±‚1-50ä¸ªå­—ç¬¦' }]
      }
    }
  }
```

### éƒ¨é—¨åç§°å’Œéƒ¨é—¨ç¼–ç çš„è‡ªå®šä¹‰æ ¡éªŒ

> éƒ¨é—¨åç§°æ·»åŠ çš„æ ¡éªŒè§„åˆ™é€»è¾‘ï¼š
>
> 1ã€ç‚¹å‡»æ·»åŠ éƒ¨é—¨ï¼Œæ–°æ·»åŠ çš„éƒ¨é—¨ä¼šæˆä¸ºå½“å‰éƒ¨é—¨çš„å­éƒ¨é—¨
>
> 2ã€åŒçº§éƒ¨é—¨çš„åç§°ä¸èƒ½ç›¸åŒ
>
> å¤„ç†é€»è¾‘ï¼š
>
> 1ã€ç­›é€‰å‡ºpidç­‰äºå½“å‰ç‚¹å‡»çš„éƒ¨é—¨çš„idçš„æ‰€æœ‰éƒ¨é—¨(å½“å‰éƒ¨é—¨çš„å­éƒ¨é—¨)
>
> 2ã€ç„¶ååˆ¤æ–­å½“å‰è¡¨å•çš„nameæ˜¯å¦æœ‰è·Ÿç­›é€‰å‡ºæ¥çš„æ•°æ®çš„nameé‡å¤çš„(åŒçº§æ•°æ®çš„nameä¸èƒ½é‡å¤)

> éƒ¨é—¨ç¼–ç æ·»åŠ çš„æ ¡éªŒè§„åˆ™
>
> 1ã€æ‰€æœ‰éƒ¨é—¨ç¼–ç ä¸èƒ½é‡å¤
>
> 2ã€å¦‚æœå½“å‰è¡¨å•ç¼–ç ä¸ºç©ºï¼Œåˆ™ç›´æ¥é€šè¿‡ï¼Œå› ä¸ºæ•°æ®ä¸­æœ‰éƒ¨åˆ†æ•°æ®codeæ²¡æœ‰

**`æ³¨æ„`**ï¼šéƒ¨é—¨åç§°å’Œéƒ¨é—¨ç¼–ç çš„è§„åˆ™ æœ‰ä¸¤æ¡æˆ‘ä»¬éœ€è¦é€šè¿‡**`è‡ªå®šä¹‰æ ¡éªŒå‡½æ•°validator`**æ¥å®ç°

> é¦–å…ˆï¼Œåœ¨æ ¡éªŒåç§°å’Œç¼–ç æ—¶ï¼Œè¦è·å–æœ€æ–°çš„ç»„ç»‡æ¶æ„ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬è¿™é‡Œtriggeré‡‡ç”¨blurçš„åŸå› ï¼Œå› ä¸ºchangeå¯¹äºè®¿é—®çš„é¢‘ç‡è¿‡é«˜ï¼Œæˆ‘ä»¬éœ€è¦æ§åˆ¶è®¿é—®é¢‘ç‡

```js
      // é¦–å…ˆè·å–æœ€æ–°çš„ç»„ç»‡æ¶æ„æ•°æ®
      const { depts } = await getDepartments()
```

> éƒ¨é—¨åç§°ä¸èƒ½å’Œ**`åŒçº§åˆ«`**çš„é‡å¤ï¼Œè¿™é‡Œæ³¨æ„ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°æ‰€æœ‰åŒçº§åˆ«çš„æ•°æ®ï¼Œè¿›è¡Œæ ¡éªŒï¼Œæ‰€ä»¥è¿˜éœ€è¦å¦ä¸€ä¸ªå‚æ•°pid

```js
props: {
    //   ç”¨æ¥æ§åˆ¶çª—ä½“æ˜¯å¦æ˜¾ç¤ºæˆ–è€…éšè—
    showDialog: {
      type: Boolean,
      default: false
    },
    // å½“å‰æ“ä½œçš„èŠ‚ç‚¹
    treeNode: {
      type: Object,
      default: null
    }
  },
  <add-dept :show-dialog="showDialog" :tree-node="node" />
```

æ ¹æ®å½“å‰éƒ¨é—¨idï¼Œæ‰¾åˆ°æ‰€æœ‰å­éƒ¨é—¨ç›¸å…³çš„æ•°æ®ï¼Œåˆ¤æ–­æ˜¯å¦é‡å¤

```js
 // ç°åœ¨å®šä¹‰ä¸€ä¸ªå‡½æ•° è¿™ä¸ªå‡½æ•°çš„ç›®çš„æ˜¯ å»æ‰¾ åŒçº§éƒ¨é—¨ä¸‹ æ˜¯å¦æœ‰é‡å¤çš„éƒ¨é—¨åç§°
    const checkName = async(rules, value) => {
      // 1ã€ æ¥å£è·å–æ‰€æœ‰çš„éƒ¨é—¨
      const { depts } = await getDepartments()
      // 2ã€æ‰¾åˆ°å½“å‰ç‚¹å‡»çš„éƒ¨é—¨çš„æ‰€æœ‰å­éƒ¨é—¨
      const currentNodeChilren = depts.filter(item => item.pid === this.treeNode.id)
      // 3ã€åˆ¤æ–­å½“å‰éƒ¨é—¨çš„æ‰€æœ‰å­éƒ¨é—¨åç§°æ˜¯å¦åŒ…å«ç”¨æˆ·è¾“å…¥çš„éƒ¨é—¨åç§°
      const isRepeat = currentNodeChilren.some(item => item.name === value)
      // 4ã€å¦‚æœåŒ…å«è¯´æ˜åç§°é‡å¤
      if (isRepeat) {
        return Promise.reject(new Error('éƒ¨é—¨åç§°é‡å¤'))
      }
      // --> æ ¸å¿ƒé€»è¾‘ï¼šç”¨æˆ·è¾“å…¥çš„éƒ¨é—¨åç§°è·Ÿå½“å‰ç‚¹å‡»çš„éƒ¨é—¨çš„æ‰€æœ‰çš„å­éƒ¨é—¨çš„åç§°ä¸èƒ½é‡å¤
    }
```

æ£€æŸ¥éƒ¨é—¨ç¼–ç çš„è¿‡ç¨‹åŒç†

```js
const checkCode = async(rules, value) => {
  // 1ã€ æ¥å£è·å–æ‰€æœ‰çš„éƒ¨é—¨
  const { depts } = await getDepartments()

  //  2ã€ç›´æ¥åˆ¤æ–­å½“å‰ç”¨æˆ·æ·»å†™çš„codeæ˜¯å¦åŒ…å«åœ¨å·²å­˜åœ¨çš„æ•°æ®é‡Œé¢
  const isRepeat = depts.some(item => (item.code === value))

  if (isRepeat) {
    return Promise.reject('éƒ¨é—¨codeé‡å¤')
  }
  // --> æ ¸å¿ƒé€»è¾‘ï¼šç”¨æˆ·è¾“å…¥çš„éƒ¨é—¨codeè·Ÿä»»ä½•éƒ¨é—¨çš„codeéƒ½ä¸èƒ½é‡å¤
}
```

åœ¨è§„åˆ™ä¸­å®šä¹‰

```json
     // å®šä¹‰æ ¡éªŒè§„åˆ™
      rules: {
        name: [{ required: true, message: 'éƒ¨é—¨åç§°ä¸èƒ½ä¸ºç©º', trigger: 'blur' },
          { min: 1, max: 50, message: 'éƒ¨é—¨åç§°è¦æ±‚1-50ä¸ªå­—ç¬¦', trigger: 'blur' }, {
            trigger: 'blur',
            validator: checkNameRepeat // è‡ªå®šä¹‰å‡½æ•°çš„å½¢å¼æ ¡éªŒ
          }],
        code: [{ required: true, message: 'éƒ¨é—¨ç¼–ç ä¸èƒ½ä¸ºç©º', trigger: 'blur' },
          { min: 1, max: 50, message: 'éƒ¨é—¨ç¼–ç è¦æ±‚1-50ä¸ªå­—ç¬¦', trigger: 'blur' }, {
            trigger: 'blur',
            validator: checkCodeRepeat
          }],
        manager: [{ required: true, message: 'éƒ¨é—¨è´Ÿè´£äººä¸èƒ½ä¸ºç©º', trigger: 'blur' }],
        introduce: [{ required: true, message: 'éƒ¨é—¨ä»‹ç»ä¸èƒ½ä¸ºç©º', trigger: 'blur' },
          { trigger: 'blur', min: 1, max: 300, message: 'éƒ¨é—¨ä»‹ç»è¦æ±‚1-50ä¸ªå­—ç¬¦' }]
      }
```

### å¤„ç†é¦–éƒ¨å†…å®¹çš„pidæ•°æ®

**`éœ€è¦æ³¨æ„`**ï¼šåœ¨æœ€æ ¹çº§çš„**`tree-tools`**ç»„ä»¶ä¸­ï¼Œç”±äºtreenodeå±æ€§ä¸­æ²¡æœ‰idï¼Œidä¾¿æ˜¯undefinedï¼Œä½†æ˜¯é€šè¿‡undefinedè¿›è¡Œç­‰å€¼åˆ¤æ–­æ˜¯å¯»æ‰¾ä¸åˆ°å¯¹åº”çš„æ ¹èŠ‚ç‚¹çš„ï¼Œ æ‰€ä»¥åœ¨ä¼ å€¼æ—¶ï¼Œæˆ‘ä»¬å°†idå±æ€§è®¾ç½®ä¸º **`â€œâ€`**

**`src/views/departments/index.vue`**

```js
 async getDepartments() {
      const result = await getDepartments()
      this.departs = transListToTreeData(result.depts, '')
      this.company = { name: result.companyName, manager: 'è´Ÿè´£äºº', id: '' }
 },
```

**æäº¤ä»£ç **

**`æœ¬èŠ‚ä»»åŠ¡`**ï¼šå®Œæˆæ–°å¢éƒ¨é—¨çš„è§„åˆ™æ ¡éªŒ

## æ–°å¢éƒ¨é—¨åŠŸèƒ½-éƒ¨é—¨è´Ÿè´£äººæ•°æ®

:::tip ç›®æ ‡

è·å–æ–°å¢è¡¨å•ä¸­çš„éƒ¨é—¨è´Ÿè´£äººä¸‹æ‹‰æ•°æ®

:::

> åœ¨ä¸ŠèŠ‚çš„è¡¨å•ä¸­ï¼Œéƒ¨é—¨è´Ÿè´£äººæ˜¯ä¸‹æ‹‰æ•°æ®ï¼Œæˆ‘ä»¬åº”è¯¥ä»**`å‘˜å·¥æ¥å£`**ä¸­è·å–è¯¥æ•°æ®

é¦–å…ˆï¼Œå°è£…è·å–ç®€å•å‘˜å·¥åˆ—è¡¨çš„æ¨¡å— **`src/api/employees.js`**

```js
import request from '@/utils/request'

/**
 *  è·å–å‘˜å·¥çš„ç®€å•åˆ—è¡¨
 * **/
export function getEmployeeSimple() {
  return request({
    url: '/sys/user/simple'
  })
}

```

ç„¶åï¼Œåœ¨**`add-dept.vue`**ä¸­çš„selectèšç„¦äº‹ä»¶**`focus`**ä¸­è°ƒç”¨è¯¥æ¥å£ï¼Œå› ä¸ºæˆ‘ä»¬è¦è·å–å®æ—¶çš„æœ€æ–°æ•°æ®

```vue
   <el-select v-model="formData.manager" style="width:80%" placeholder="è¯·é€‰æ‹©" @focus="getEmployeeSimple">
          <!-- éœ€è¦å¾ªç¯ç”Ÿæˆé€‰é¡¹   è¿™é‡Œåšä¸€ä¸‹ç®€å•çš„å¤„ç† æ˜¾ç¤ºçš„æ˜¯ç”¨æˆ·å å­˜çš„ä¹Ÿæ˜¯ç”¨æˆ·å-->
          <el-option v-for="item in peoples" :key="item.id" :label="item.username" :value="item.username" />
        </el-select>
```

è·å–å‘˜å·¥åˆ—è¡¨

```js
import  { getEmployeeSimple }   from '@/api/employees'
  methods: {
    // è·å–å‘˜å·¥ç®€å•åˆ—è¡¨æ•°æ®
    async  getEmployeeSimple() {
      this.peoples = await getEmployeeSimple()
    }
  }
  peoples: [] // æ¥æ”¶è·å–çš„å‘˜å·¥ç®€å•åˆ—è¡¨çš„æ•°æ®

```

**æäº¤ä»£ç **

**`æœ¬èŠ‚ä»»åŠ¡`**ï¼šæ–°å¢éƒ¨é—¨åŠŸèƒ½-éƒ¨é—¨è´Ÿè´£äººæ•°æ®

## æ–°å¢åŠŸèƒ½-æäº¤-å–æ¶ˆ-å…³é—­

:::tip ç›®æ ‡

å®Œæˆæ–°å¢æ¨¡å—çš„æäº¤-å–æ¶ˆ-å…³é—­ç­‰åŠŸèƒ½

:::

### æ ¡éªŒé€šè¿‡ï¼Œè°ƒç”¨æ–°å¢æ¥å£

> å½“ç‚¹å‡»æ–°å¢é¡µé¢çš„ç¡®å®šæŒ‰é’®æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å®Œæˆå¯¹è¡¨å•çš„æ•´ä½“æ ¡éªŒï¼Œå¦‚æœæ ¡éªŒæˆåŠŸï¼Œè¿›è¡Œæäº¤

é¦–å…ˆï¼Œåœ¨ç‚¹å‡»ç¡®å®šæ—¶ï¼Œæ ¡éªŒè¡¨å•

**ç»™el-formå®šä¹‰ä¸€ä¸ªrefå±æ€§**

```vue
    <el-form ref="deptForm" :model="formData" :rules="rules" label-width="120px">
```

```js
    // ç‚¹å‡»ç¡®å®šæ—¶è§¦å‘
    btnOK() {
      this.$refs.deptForm.validate(isOK => {
        if (isOK) {
          // è¡¨ç¤ºå¯ä»¥æäº¤äº†
        }
      })
    }
```

ç„¶åï¼Œåœ¨æ ¡éªŒé€šè¿‡æ—¶ï¼Œè°ƒç”¨æ–°å¢æ¥å£

> å› ä¸ºæ˜¯æ·»åŠ å­éƒ¨é—¨ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†æ–°å¢çš„éƒ¨é—¨pidè®¾ç½®æˆå½“å‰éƒ¨é—¨çš„idï¼Œæ–°å¢çš„éƒ¨é—¨å°±æˆäº†è‡ªå·±çš„å­éƒ¨é—¨

```js
    // ç‚¹å‡»ç¡®å®šæ—¶è§¦å‘
    btnOK() {
      this.$refs.deptForm.validate(async isOK => {
        if (isOK) {
          // è¡¨ç¤ºå¯ä»¥æäº¤äº†
          await addDepartments({ ...this.formData, pid: this.treeNode.id }) // è°ƒç”¨æ–°å¢æ¥å£ æ·»åŠ çˆ¶éƒ¨é—¨çš„id
        }
      })
    }
```

åŒæ ·ï¼Œåœ¨æ–°å¢æˆåŠŸä¹‹åï¼Œè°ƒç”¨å‘Šè¯‰çˆ¶ç»„ä»¶ï¼Œé‡æ–°æ‹‰å–æ•°æ®

```js
 this.$emit('addDepts')
```

çˆ¶ç»„ä»¶

```vue
 <add-dept :show-dialog="showDialog" :tree-node="node" @addDepts="getDepartments" />

```

**`æœ¬èŠ‚æ³¨æ„`**ï¼šåŒå­¦ä»¬å¯èƒ½ä¼šç–‘æƒ‘ï¼Œæˆ‘ä»¬**`tree-tools.vue`** å’Œ**`add-dept.vue`**ä¸¤ä¸ªç»„ä»¶éƒ½è§¦å‘äº†addDeptsäº‹ä»¶ï¼Œä¸å†²çªå—ï¼Ÿ

è¿™é‡Œï¼Œæˆ‘ä»¬è§¦å‘çš„è‡ªå®šä¹‰äº‹ä»¶éƒ½æ˜¯ç»„ä»¶è‡ªèº«çš„ï¼Œä»–ä»¬ä¹‹é—´æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œåªæ˜¯åå­—ç›¸åŒè€Œå·²ï¼Œå¤§å®¶ä¸è¦æ··æ·†

### åˆ©ç”¨syncä¿®é¥°ç¬¦å…³é—­æ–°å¢å¼¹å±‚

> è¿™é‡Œæˆ‘ä»¬å­¦ä¹ ä¸€ä¸ªæ–°çš„æŠ€å·§ï¼Œ**`syncä¿®é¥°ç¬¦`**

 æŒ‰ç…§å¸¸è§„ï¼Œæƒ³è¦è®©çˆ¶ç»„ä»¶æ›´æ–°**`showDialog`**çš„è¯ï¼Œéœ€è¦è¿™æ ·åš 

```js
// å­ç»„ä»¶
this.$emit('changedialog', false) //è§¦å‘äº‹ä»¶
// çˆ¶ç»„ä»¶
<child @changedialog="method" :showDialog="showDialog" />
 method(value) {
    this.showDialog = value
}
```

> ä½†æ˜¯ï¼Œvuejsä¸ºæˆ‘ä»¬æä¾›äº†**`syncä¿®é¥°ç¬¦`**ï¼Œå®ƒæä¾›äº†ä¸€ç§ç®€å†™æ¨¡å¼ ä¹Ÿå°±æ˜¯

```js
// å­ç»„ä»¶ update:å›ºå®šå†™æ³• (update:propsåç§°, å€¼)
this.$emit('update:showDialog', false) //è§¦å‘äº‹ä»¶
// çˆ¶ç»„ä»¶ syncä¿®é¥°ç¬¦
<child  :showDialog.sync="showDialog" />

```

åªè¦ç”¨syncä¿®é¥°ï¼Œå°±å¯ä»¥çœç•¥çˆ¶ç»„ä»¶çš„ç›‘å¬å’Œæ–¹æ³•ï¼Œç›´æ¥å°†å€¼èµ‹å€¼ç»™showDialog

**å–æ¶ˆæŒ‰é’®å’Œå…³é—­**

```js
// ç‚¹å‡»ç¡®å®šæ—¶è§¦å‘
    btnOK() {
      this.$refs.deptForm.validate(async isOK => {
        if (isOK) {
          // è¡¨ç¤ºå¯ä»¥æäº¤äº†
          await addDepartments({ ...this.formData, pid: this.treeNode.id }) // è°ƒç”¨æ–°å¢æ¥å£ æ·»åŠ çˆ¶éƒ¨é—¨çš„id
          this.$emit('addDepts') // å‘Šè¯‰çˆ¶ç»„ä»¶ æ–°å¢æ•°æ®æˆåŠŸ é‡æ–°æ‹‰å–æ•°æ®
          // update:propsåç§°
          this.$emit('update:showDialog', false)
        }
      })
    }
```

### å–æ¶ˆæ—¶é‡ç½®æ•°æ®å’Œæ ¡éªŒ

```js
btnCancel() {
      this.$refs.deptForm.resetFields() // é‡ç½®æ ¡éªŒå­—æ®µ
      this.$emit('update:showDialog', false) // å…³é—­
    }
```

éœ€è¦åœ¨el-dialogä¸­ç›‘å¬å…¶closeäº‹ä»¶

```vue
  <el-dialog title="æ–°å¢éƒ¨é—¨" :visible="showDialog" @close="btnCancel">
```

**`æœ¬èŠ‚ä»»åŠ¡`** æ–°å¢åŠŸèƒ½-æäº¤-å–æ¶ˆ-å…³é—­

## ç¼–è¾‘éƒ¨é—¨åŠŸèƒ½å®ç°æ•°æ®å›å†™

:::tip ç›®æ ‡

å®ç°ç¼–è¾‘éƒ¨é—¨çš„åŠŸèƒ½

:::

### ç‚¹å‡»ç¼–è¾‘å¼¹å‡ºå±‚ï¼Œè®°å½•å½“å‰èŠ‚ç‚¹

> ç¼–è¾‘éƒ¨é—¨åŠŸèƒ½å®é™…ä¸Šå’Œæ–°å¢çª—ä½“é‡‡ç”¨çš„æ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œåªä¸è¿‡æˆ‘ä»¬éœ€è¦å°†æ–°å¢åœºæ™¯å˜æˆç¼–è¾‘åœºæ™¯

![image-20200831112149246](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20200831112149246.png)

é¦–å…ˆç‚¹å‡»ç¼–è¾‘éƒ¨é—¨æ—¶ï¼Œ è°ƒç”¨**çˆ¶ç»„ä»¶ç¼–è¾‘æ–¹æ³•** **`tree-tools.vue`**

```js
this.$emit('editDepts', this.treeNode)
```

**çˆ¶ç»„ä»¶å¼¹å±‚ï¼Œèµ‹å€¼å½“å‰ç¼–è¾‘èŠ‚ç‚¹**

```vue
         <tree-tools slot-scope="obj" :tree-node="obj.data" @delDepts="getDepartments" @editDepts="editDepts" />

// ç¼–è¾‘éƒ¨é—¨èŠ‚ç‚¹
    editDepts(node) {
      // é¦–å…ˆæ‰“å¼€å¼¹å±‚
      this.showDialog = true
      this.node = node // èµ‹å€¼æ“ä½œçš„èŠ‚ç‚¹
    }
```

### çˆ¶ç»„ä»¶è°ƒç”¨å­ç»„ä»¶çš„è·å–è¯¦æƒ…æ–¹æ³•

>  éœ€æ±‚ï¼šç‚¹å‡»äº†ç¼–è¾‘æŒ‰é’®çš„æ—¶å€™ï¼Œéœ€è¦æŠŠå½“å‰ç‚¹å‡»çš„èŠ‚ç‚¹ä¿¡æ¯å±•ç¤ºåˆ°å¼¹å±‚å†…éƒ¨

> ç¼–è¾‘æ—¶ï¼Œæˆ‘ä»¬éœ€è¦è·å–ç‚¹å‡»éƒ¨é—¨çš„ä¿¡æ¯

**å°è£…è·å–éƒ¨é—¨ä¿¡æ¯çš„æ¨¡å—** **`src/api/departments.js`**

```js
/** *
 * è·å–éƒ¨é—¨è¯¦æƒ…
 * ***/
export function getDepartDetail(id) {
  return request({
    url: `/company/department/${id}`
  })
}

```

> åœ¨ä»€ä¹ˆæ—¶å€™è·å–éƒ¨é—¨è¯¦æƒ…?

æˆ‘ä»¬å¯ä»¥åœ¨è°ƒç”¨**ç¼–è¾‘æ–¹æ³•** **`editDepts`**ä¸­é€šè¿‡**`ref`**è°ƒç”¨**`add-dept.vue`**çš„å®ä¾‹æ–¹æ³•

```js
 // è·å–éƒ¨é—¨è¯¦æƒ…  add-dept.vueç»„ä»¶å†…éƒ¨
    async  getDepartDetail(id) {
      this.formData = await getDepartDetail(id)
  }
```

```js
   // ç‚¹å‡»ç¼–è¾‘è§¦å‘çš„çˆ¶ç»„ä»¶çš„æ–¹æ³•
    editDepts(node) {
      this.showDialog = true // æ˜¾ç¤ºæ–°å¢ç»„ä»¶å¼¹å±‚
      this.node = node // å­˜å‚¨ä¼ é€’è¿‡æ¥çš„nodeæ•°æ®
      // æˆ‘ä»¬éœ€è¦åœ¨è¿™ä¸ªä½ç½® è°ƒç”¨å­ç»„ä»¶çš„æ–¹æ³•
      // çˆ¶ç»„ä»¶ è°ƒç”¨å­ç»„ä»¶çš„æ–¹æ³•
      this.$refs.addDept.getDepartDetail(node.id) // ç›´æ¥è°ƒç”¨å­ç»„ä»¶ä¸­çš„æ–¹æ³• ä¼ å…¥ä¸€ä¸ªid
    }
```

### æ ¹æ®è®¡ç®—å±æ€§æ˜¾ç¤ºæ§åˆ¶æ ‡é¢˜

> éœ€è¦æ ¹æ®å½“å‰çš„åœºæ™¯åŒºåˆ†æ˜¾ç¤ºçš„æ ‡é¢˜

è®¡ç®—å±æ€§

> å¦‚ä½•åˆ¤æ–­æ–°å¢è¿˜æ˜¯ç¼–è¾‘

```js
computed: {
    showTitle() {
      return this.formData.id ? 'ç¼–è¾‘éƒ¨é—¨' : 'æ–°å¢å­éƒ¨é—¨'
    }
  },
```

åŒæ—¶å‘ç°ï¼Œel-formä¸­çš„resetFieldsä¸èƒ½é‡ç½®éè¡¨å•ä¸­çš„æ•°æ®ï¼Œæ‰€ä»¥åœ¨å–æ¶ˆçš„ä½ç½®éœ€è¦å¼ºåˆ¶åŠ ä¸Š é‡ç½®æ•°æ®

```js
    btnCancel() {
      // é‡ç½®æ•°æ®  å› ä¸ºresetFields åªèƒ½é‡ç½® è¡¨å•ä¸Šçš„æ•°æ® éè¡¨å•ä¸Šçš„ æ¯”å¦‚ ç¼–è¾‘ä¸­id ä¸èƒ½é‡ç½®
      this.formData = {
        name: '',
        code: '',
        manager: '',
        introduce: ''
      }
      // å…³é—­å¼¹å±‚
      this.$emit('update:showDialog', false)
      // æ¸…é™¤ä¹‹å‰çš„æ ¡éªŒ  å¯ä»¥é‡ç½®æ•°æ® åªèƒ½é‡ç½® å®šä¹‰åœ¨dataä¸­çš„æ•°æ®
      this.$refs.deptForm.resetFields()
    }
```



## åŒæ—¶æ”¯æŒç¼–è¾‘å’Œæ–°å¢åœºæ™¯

### å°è£…ç¼–è¾‘æ¥å£ï¼Œä¿å­˜åŒºåˆ†åœºæ™¯

> æ¥ä¸‹æ¥ï¼Œéœ€è¦åœ¨ç‚¹å‡»ç¡®å®šæ—¶ï¼ŒåŒæ—¶æ”¯æŒæ–°å¢éƒ¨é—¨å’Œç¼–è¾‘éƒ¨é—¨ä¸¤ä¸ªåœºæ™¯ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®formDataæ˜¯å¦æœ‰idè¿›è¡ŒåŒºåˆ†

**å°è£…ç¼–è¾‘éƒ¨é—¨æ¥å£**   **`src/api/departments.js`**

```js
/**
 * ç¼–è¾‘éƒ¨é—¨
 * ***/
export function updateDepartments(data) {
  return request({
    url: `/company/department/${data.id}`,
    method: 'put',
    data
  })
}
```

> ç‚¹å‡»ç¡®å®šæ—¶ï¼Œè¿›è¡Œåœºæ™¯åŒºåˆ†

1. æ£€æŸ¥nameé‡å¤

```js
   // ç‚¹å‡»ç¡®å®šæ—¶è§¦å‘
    btnOK() {
      this.$refs.deptForm.validate(async isOK => {
        if (isOK) {
          // è¦åˆ†æ¸…æ¥šç°åœ¨æ˜¯ç¼–è¾‘è¿˜æ˜¯æ–°å¢
          if (this.formData.id) {
            // ç¼–è¾‘æ¨¡å¼  è°ƒç”¨ç¼–è¾‘æ¥å£
            await updateDepartments(this.formData)
          } else {
            // æ–°å¢æ¨¡å¼
            await addDepartments({ ...this.formData, pid: this.treeNode.id }) // è°ƒç”¨æ–°å¢æ¥å£ æ·»åŠ çˆ¶éƒ¨é—¨çš„id
          }
          // è¡¨ç¤ºå¯ä»¥æäº¤äº†
          this.$emit('addDepts') // å‘Šè¯‰çˆ¶ç»„ä»¶ æ–°å¢æ•°æ®æˆåŠŸ é‡æ–°æ‹‰å–æ•°æ®
          // update:propsåç§°
          this.$emit('update:showDialog', false)
        }
      })
    },
```

### æ ¡éªŒè§„åˆ™æ”¯æŒç¼–è¾‘åœºæ™¯ä¸‹çš„æ ¡éªŒ

>é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬å‘ç°åŸæ¥çš„æ ¡éªŒè§„åˆ™å®é™…å’Œç¼–è¾‘éƒ¨é—¨æœ‰äº›å†²çªï¼Œæ‰€ä»¥éœ€è¦è¿›ä¸€æ­¥å¤„ç†

```js{5-12}
    const checkName = async(rules, value) => {
      // 1ã€ æ¥å£è·å–æ‰€æœ‰çš„éƒ¨é—¨
      const { depts } = await getDepartments()
      // 2ã€æ‰¾åˆ°å½“å‰ç‚¹å‡»çš„éƒ¨é—¨çš„æ‰€æœ‰å­éƒ¨é—¨
      let currentNodeChilren
      // --> ç¼–è¾‘çš„åˆ¤æ–­é€»è¾‘ï¼šç¼–è¾‘ç¼–è¾‘çš„æ˜¯è‡ªèº«
      //    --> ç¼–è¾‘æƒ…å†µä¸‹è·å–çš„æ•°æ®ä¸ºï¼šç‚¹å‡»çš„éƒ¨é—¨çš„åŒçº§éƒ¨é—¨åŒæ—¶ä¸èƒ½ä¸ºè‡ªå·±(ç¼–è¾‘é€»è¾‘å¿½ç•¥è‡ªèº«)
      if (this.formData.id) {
        currentNodeChilren = depts.filter(item => item.pid === this.treeNode.pid && item.id !== this.treeNode.id)
      } else {
        currentNodeChilren = depts.filter(item => item.pid === this.treeNode.id)
      }
      // 3ã€åˆ¤æ–­å½“å‰éƒ¨é—¨çš„æ‰€æœ‰å­éƒ¨é—¨åç§°æ˜¯å¦åŒ…å«ç”¨æˆ·è¾“å…¥çš„éƒ¨é—¨åç§°
      const isRepeat = currentNodeChilren.some(item => item.name === value)
      // 4ã€å¦‚æœåŒ…å«è¯´æ˜åç§°é‡å¤
      if (isRepeat) {
        return Promise.reject(new Error('éƒ¨é—¨åç§°é‡å¤'))
      }
      // --> æ ¸å¿ƒé€»è¾‘ï¼šç”¨æˆ·è¾“å…¥çš„éƒ¨é—¨åç§°è·Ÿå½“å‰ç‚¹å‡»çš„éƒ¨é—¨çš„æ‰€æœ‰çš„å­éƒ¨é—¨çš„åç§°ä¸èƒ½é‡å¤
    }
```



2. æ£€æŸ¥ç¼–ç é‡å¤

```js{6-12}
    const checkCode = async(rules, value) => {
      // 1ã€ æ¥å£è·å–æ‰€æœ‰çš„éƒ¨é—¨
      const { depts } = await getDepartments()

      //  2ã€ç›´æ¥åˆ¤æ–­å½“å‰ç”¨æˆ·æ·»å†™çš„codeæ˜¯å¦åŒ…å«åœ¨å·²å­˜åœ¨çš„æ•°æ®é‡Œé¢
      let isRepeat
      if (this.formData.id) {
        // --> æ–°å¢çš„ç¼–è¾‘åˆ¤æ–­é€»è¾‘ï¼šç¼–è¾‘çš„æ—¶å€™ï¼Œéœ€è¦æŠŠè‡ªå·±è¿‡æ»¤æ‰å†è¿›è¡Œåˆ¤æ–­
        isRepeat = depts.some(item => item.code === value && item.id !== this.treeNode.id)
      } else {
        isRepeat = depts.some(item => (item.code === value))
      }

      if (isRepeat) {
        return Promise.reject('éƒ¨é—¨codeé‡å¤')
      }
      // --> æ ¸å¿ƒé€»è¾‘ï¼šç”¨æˆ·è¾“å…¥çš„éƒ¨é—¨codeè·Ÿä»»ä½•éƒ¨é—¨çš„codeéƒ½ä¸èƒ½é‡å¤
    }
```



>è‡³æ­¤ï¼Œæ•´ä¸ªç»„ç»‡æ¶æ„ï¼Œ æˆ‘ä»¬å®Œæˆäº†ï¼Œç»„ç»‡æ¶æ„è¯»å– /  æ–°å¢éƒ¨é—¨ / åˆ é™¤éƒ¨é—¨  / ç¼–è¾‘éƒ¨é—¨

å¦‚å›¾

![image-20200722134415195](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20200722134415195.png)

**æäº¤ä»£ç **

**`æœ¬èŠ‚ä»»åŠ¡`**ç¼–è¾‘éƒ¨é—¨åŠŸèƒ½å®ç°

## ç»™æ•°æ®è·å–æ·»åŠ åŠ è½½è¿›åº¦æ¡

**`ç›®æ ‡`**  ç»™å½“å‰ç»„ç»‡æ¶æ„æ·»åŠ åŠ è½½è¿›åº¦æ¡

ç”±äºè·å–æ•°æ®çš„å»¶è¿Ÿæ€§ï¼Œä¸ºäº†æ›´å¥½çš„ä½“éªŒï¼Œå¯ä»¥ç»™é¡µé¢å¢åŠ ä¸€ä¸ªLoadingè¿›åº¦æ¡ï¼Œé‡‡ç”¨elementçš„æŒ‡ä»¤è§£å†³æ–¹æ¡ˆå³å¯

**å®šä¹‰loadingå˜é‡**

```js
loading: false // ç”¨æ¥æ§åˆ¶è¿›åº¦å¼¹å±‚çš„æ˜¾ç¤ºå’Œéšè—
```

**èµ‹å€¼å˜é‡ç»™æŒ‡ä»¤**

```vue
  <div v-loading="loading" class="dashboard-container">
```

**è·å–æ–¹æ³•å‰åè®¾ç½®å˜é‡**

```js
async getDepartments() {
      this.loading = true
      const result = await getDepartments()
      this.departs = transListToTreeData(result.depts, '')
      this.company = { name: result.companyName, manager: 'è´Ÿè´£äºº', id: '' }
      this.loading = false
}
```

