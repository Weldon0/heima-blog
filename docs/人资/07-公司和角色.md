---
title: ğŸ“š 07-å…¬å¸å’Œè§’è‰²
---
## å»ºç«‹å…¬å¸è§’è‰²é¡µé¢çš„åŸºæœ¬ç»“æ„

**`ç›®æ ‡`**å»ºç«‹å…¬å¸é¡µé¢çš„åŸºæœ¬ç»“æ„

![image-20200722221903217](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20200722221903217.png)

![image-20200722221910776](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20200722221910776.png)

æ ¹æ®ä»¥ä¸Šçš„ç»“æ„ï¼Œæˆ‘ä»¬é‡‡ç”¨element-uiçš„ç»„ä»¶å®ç°

**`src/views/setting/index.vue`**

```vue
<template>
  <div class="dashboard-container">
    <div class="app-container">
      <el-card>
        <el-tabs>
          <!-- æ”¾ç½®é¡µç­¾ -->
          <el-tab-pane label="è§’è‰²ç®¡ç†">
            <!-- æ–°å¢è§’è‰²æŒ‰é’® -->
            <el-row style="height:60px">
              <el-button
                icon="el-icon-plus"
                size="small"
                type="primary"
              >æ–°å¢è§’è‰²</el-button>
            </el-row>
            <!-- è¡¨æ ¼ -->
            <el-table border="">
              <el-table-column label="åºå·" width="120" />
              <el-table-column label="è§’è‰²åç§°" width="240" />
              <el-table-column label="æè¿°" />
              <el-table-column label="æ“ä½œ">
                <el-button size="small" type="success">åˆ†é…æƒé™</el-button>
                <el-button size="small" type="primary">ç¼–è¾‘</el-button>
                <el-button size="small" type="danger">åˆ é™¤</el-button>
              </el-table-column>
            </el-table>
            <!-- åˆ†é¡µç»„ä»¶ -->
            <el-row type="flex" justify="center" align="middle" style="height: 60px">
              <!-- åˆ†é¡µç»„ä»¶ -->
              <el-pagination layout="prev,pager,next" />
            </el-row>
          </el-tab-pane>
          <el-tab-pane label="å…¬å¸ä¿¡æ¯">
            <el-alert
              title="å¯¹å…¬å¸åç§°ã€å…¬å¸åœ°å€ã€è¥ä¸šæ‰§ç…§ã€å…¬å¸åœ°åŒºçš„æ›´æ–°ï¼Œå°†ä½¿å¾—å…¬å¸èµ„æ–™è¢«é‡æ–°å®¡æ ¸ï¼Œè¯·è°¨æ…ä¿®æ”¹"
              type="info"
              show-icon
              :closable="false"
            />
            <el-form label-width="120px" style="margin-top:50px">
              <el-form-item label="å…¬å¸åç§°">
                <el-input disabled style="width:400px" />
              </el-form-item>
              <el-form-item label="å…¬å¸åœ°å€">
                <el-input disabled style="width:400px" />
              </el-form-item>
              <el-form-item label="é‚®ç®±">
                <el-input disabled style="width:400px" />
              </el-form-item>
              <el-form-item label="å¤‡æ³¨">
                <el-input type="textarea" :rows="3" disabled style="width:400px" />
              </el-form-item>
            </el-form>
          </el-tab-pane>

        </el-tabs>
      </el-card>
    </div>
  </div>
</template>
```

**æäº¤ä»£ç **

**`æœ¬èŠ‚ä»»åŠ¡`**å»ºç«‹å…¬å¸é¡µé¢çš„åŸºæœ¬ç»“æ„

## è¯»å–å…¬å¸è§’è‰²ä¿¡æ¯

**`ç›®æ ‡`**ï¼š å°è£…å…¬å¸è§’è‰²è¯·æ±‚ï¼Œè¯»å–å…¬å¸è§’è‰²ä¿¡æ¯

### è¯»å–è§’è‰²åˆ—è¡¨æ•°æ®

é¦–å…ˆï¼Œå°è£…è¯»å–è§’è‰²çš„ä¿¡æ¯çš„è¯·æ±‚ **`src/api/setting.js`**

```js
/**
 * è·å–è§’è‰²åˆ—è¡¨
 * ***/
export function getRoleList(params) {
  return request({
    url: '/sys/role',
    params
  })
}
```

> paramsæ˜¯æŸ¥è¯¢å‚æ•°ï¼Œé‡Œé¢éœ€è¦æºå¸¦åˆ†é¡µä¿¡æ¯

ç„¶åï¼Œåœ¨é¡µé¢ä¸­è°ƒç”¨æ¥å£è·å–æ•°æ®ï¼Œç»‘å®šè¡¨æ ¼æ•°æ® **`src/views/setting/index.vue`**

```js
import { getRoleList } from '@/api/setting'
export default {
  data() {
    return {
      list: [], // æ‰¿æ¥æ•°ç»„
      page: {
        // æ”¾ç½®é¡µç åŠç›¸å…³æ•°æ®
        page: 1,
        pagesize: 10,
        total: 0 // è®°å½•æ€»æ•°
      }
    }
  },
  created() {
    this.getRoleList() // è·å–è§’è‰²åˆ—è¡¨
  },
  methods: {
    async getRoleList() {
      const { total, rows } = await getRoleList(this.page)
      this.page.total = total
      this.list = rows
    },
    changePage(newPage) {
      // newPageæ˜¯å½“å‰ç‚¹å‡»çš„é¡µç 
      this.page.page = newPage // å°†å½“å‰é¡µç èµ‹å€¼ç»™å½“å‰çš„æœ€æ–°é¡µç 
      this.getRoleList()
    }
  }
}
```

 **ç»‘å®šè¡¨æ ¼æ•°æ®**

```vue
  <el-table border="" :data="list">
              <el-table-column align="center" type="index" label="åºå·" width="120" />
              <el-table-column align="center" prop="name" label="åç§°" width="240" />
              <el-table-column align="center" prop="description" label="æè¿°" />
              <el-table-column align="center" label="æ“ä½œ">
                <el-button size="small" type="success">åˆ†é…æƒé™</el-button>
                <el-button size="small" type="primary">ç¼–è¾‘</el-button>
                <el-button size="small" type="danger">åˆ é™¤</el-button>
              </el-table-column>

            </el-table>
        
```

**ç»‘å®šåˆ†é¡µæ•°æ®**

```vue
    <!-- æ”¾ç½®åˆ†é¡µç»„ä»¶ -->
            <el-row type="flex" justify="center" align="middle" style="height:60px">
              <el-pagination
                :current-page="page.page"
                :page-size="page.pagesize"
                :total="page.total"
                layout="prev, pager, next"
                @current-change="changePage"
              />
            </el-row>
```

### è¯»å–å…¬å¸ä¿¡æ¯æ•°æ®

> ç¬¬äºŒä¸ªtabé¡µï¼Œæˆ‘ä»¬åŒæ ·éœ€è¦è¯»å–æ•°æ®

å°è£…è¯»å–å…¬å¸ä¿¡æ¯çš„api  **`src/api/setting.js`**

```js
/**
 * è·å–å…¬å¸ä¿¡æ¯
 * **/
export function getCompanyInfo(companyId) {
  return request({
    url: `/company/${companyId}`
  })
}
```

**ç»‘å®šå…¬å¸è¡¨å•æ•°æ®**

```vue
   <el-form label-width="120px" style="margin-top:50px">
              <el-form-item label="å…¬å¸åç§°">
                <el-input v-model="formData.name" disabled style="width:400px" />
              </el-form-item>
              <el-form-item label="å…¬å¸åœ°å€">
                <el-input v-model="formData.companyAddress" disabled style="width:400px" />
              </el-form-item>
              <el-form-item label="é‚®ç®±">
                <el-input v-model="formData.mailbox" disabled style="width:400px" />
              </el-form-item>
              <el-form-item label="å¤‡æ³¨">
                <el-input v-model="formData.remarks" type="textarea" :rows="3" disabled style="width:400px" />
              </el-form-item>
            </el-form>
```

> è¯·æ±‚ä¸­çš„companyIdæ¥è‡ªå“ªé‡Œï¼Ÿå®ƒæ¥è‡ªæˆ‘ä»¬ç™»å½•æˆåŠŸä¹‹åçš„ç”¨æˆ·èµ„æ–™ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨è¯¥ç»„ä»¶ä¸­ä½¿ç”¨vuexæ•°æ®

 **`src/store/getters.js`**

```vue
  companyId: state => state.user.userInfo.companyId // å»ºç«‹å¯¹äºuseræ¨¡å—çš„companyIdçš„å¿«æ·è®¿é—®
  computed: {
    ...mapGetters(['companyId'])
  },
```

**åˆå§‹åŒ–æ—¶è°ƒç”¨æ¥å£**

```js
    // è·å–çš„å…¬å¸çš„ä¿¡æ¯
    async getCompanyInfo() {
      this.formData = await getCompanyInfo(this.companyId)
    }
 created() {
    this.getRoleList() // è·å–è§’è‰²åˆ—è¡¨
    this.getCompanyInfo()
  },
```

**æäº¤ä»£ç **

**`æœ¬èŠ‚ä»»åŠ¡`**è¯»å–å…¬å¸è§’è‰²ä¿¡æ¯

## åˆ é™¤è§’è‰²åŠŸèƒ½

**`ç›®æ ‡`**  å®ç°åˆ é™¤è§’è‰²çš„åŠŸèƒ½

**å°è£…åˆ é™¤è§’è‰²çš„api**

```js
/** **
 *  åˆ é™¤è§’è‰²
 *
 * ****/
export function deleteRole(id) {
  return request({
    url: `/sys/role/${id}`,
    method: 'delete'
  })
}
```

**åˆ é™¤åŠŸèƒ½å®ç°**

```js
    async deleteRole(id) {
      //  æç¤º
      try {
        await this.$confirm('ç¡®è®¤åˆ é™¤è¯¥è§’è‰²å—')
        // åªæœ‰ç‚¹å‡»äº†ç¡®å®š æ‰èƒ½è¿›å…¥åˆ°ä¸‹æ–¹
        await deleteRole(id) // è°ƒç”¨åˆ é™¤æ¥å£
        this.getRoleList() // é‡æ–°åŠ è½½æ•°æ®
        this.$message.success('åˆ é™¤è§’è‰²æˆåŠŸ')
      } catch (error) {
        console.log(error)
      }
    }
```

**åˆ é™¤æŒ‰é’®æ³¨å†Œäº‹ä»¶**

```vue
 <!-- ä½œç”¨åŸŸæ’æ§½ -->
          <template slot-scope="{ row }">
                  <el-button size="small" type="success">åˆ†é…æƒé™</el-button>
                  <el-button size="small" type="primary">ç¼–è¾‘</el-button>
                  <el-button size="small" type="danger" @click="deleteRole(row.id)">åˆ é™¤</el-button>
          </template>
```

::: details å‡ºç°çš„é—®é¢˜ï¼šåˆ é™¤å½“å‰é¡µé¢æœ€åä¸€æ¡æ•°æ®ï¼šå‘ç°é¡µé¢ä¸ä¼šè‡ªåŠ¨è·³è½¬ä¸Šä¸€é¡µï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ
```js{2,6-9}
	async delRole(id) {
      const len = this.list.length
      await this.$confirm('æ˜¯å¦åˆ é™¤å½“å‰è§’è‰²')
      await deleteRole(id)
      this.$message('åˆ é™¤æˆåŠŸ')
      // æ˜¯å¦æœ€åä¸€é¡µçš„åˆ¤æ–­
      if (len === 1 && this.page.page > 1) {
        this.page.page--
      }
      await this.getRoleList()
    },
```
:::

**æäº¤ä»£ç **

## ç¼–è¾‘è§’è‰²åŠŸèƒ½

**`ç›®æ ‡`**ï¼š å®ç°ç¼–è¾‘è§’è‰²çš„åŠŸèƒ½

### å°è£…ç¼–è¾‘æ¥å£ï¼Œæ–°å»ºç¼–è¾‘å¼¹å±‚

**å°è£…ç¼–è¾‘è§’è‰²çš„åŠŸèƒ½api**

```js
/** *
 * ä¿®æ”¹è§’è‰²
 * ***/
export function updateRole(data) {
  return request({
    url: `/sys/role/${data.id}`,
    data,
    method: 'put'
  })
}
/**
 * è·å–è§’è‰²è¯¦æƒ…
 * **/
export function getRoleDetail(id) {
  return request({
    url: `/sys/role/${id}`
  })
}
```

**å®šä¹‰ç¼–è¾‘å¼¹å±‚æ•°æ®**

```js
      showDialog: false,
      // ä¸“é—¨æ¥æ”¶æ–°å¢æˆ–è€…ç¼–è¾‘çš„ç¼–è¾‘çš„è¡¨å•æ•°æ®
      roleForm: {},
      rules: {
        name: [{ required: true, message: 'è§’è‰²åç§°ä¸èƒ½ä¸ºç©º', trigger: 'blur' }]
      },
```

**ç¼–è¾‘å¼¹å±‚ç»“æ„**

```vue
 <el-dialog title="ç¼–è¾‘å¼¹å±‚" :visible="showDialog" @close="btnCancel">
      <el-form ref="roleForm" :model="roleForm" :rules="rules" label-width="120px">
        <el-form-item label="è§’è‰²åç§°" prop="name">
          <el-input v-model="roleForm.name" />
        </el-form-item>
        <el-form-item label="è§’è‰²æè¿°">
          <el-input v-model="roleForm.description" />
        </el-form-item>
      </el-form>
      <!-- åº•éƒ¨ -->
      <el-row slot="footer" type="flex" justify="center">
        <el-col :span="6">
          <el-button size="small" @click="btnCancel">å–æ¶ˆ</el-button>
          <el-button size="small" type="primary" @click="btnOK">ç¡®å®š</el-button>
        </el-col>
      </el-row>
    </el-dialog>
```

### å®ç°ç¼–è¾‘åŠŸèƒ½ï¼Œä¸ºæ–°å¢åŠŸèƒ½ç•™å£

**ç¼–è¾‘åŠŸèƒ½å®ç°ï¼ˆä¸ºæ–°å¢åŠŸèƒ½ç•™å£ï¼‰**

```js
    async editRole(id) {
      this.roleForm = await getRoleDetail(id)
      this.showDialog = true // ä¸ºäº†ä¸å‡ºç°é—ªçƒçš„é—®é¢˜ å…ˆè·å–æ•°æ® å†å¼¹å‡ºå±‚
    },
      async btnOK() {
      try {
        await this.$refs.roleForm.validate()
        // åªæœ‰æ ¡éªŒé€šè¿‡çš„æƒ…å†µä¸‹ æ‰ä¼šæ‰§è¡Œawaitçš„ä¸‹æ–¹å†…å®¹
        // roleFormè¿™ä¸ªå¯¹è±¡æœ‰idå°±æ˜¯ç¼–è¾‘ æ²¡æœ‰idå°±æ˜¯æ–°å¢
        if (this.roleForm.id) {
          await updateRole(this.roleForm)
        } else {
          // æ–°å¢ä¸šåŠ¡
        }
        // é‡æ–°æ‹‰å–æ•°æ®
        this.getRoleList()
        this.$message.success('æ“ä½œæˆåŠŸ')
        this.showDialog = false
      } catch (error) {
        console.log(error)
      }
    },
```

**ç¼–è¾‘æŒ‰é’®æ³¨å†Œäº‹ä»¶**

```vue
 <el-button size="small" type="primary" @click="editRole(row.id)">ç¼–è¾‘</el-button>
```

**æäº¤ä»£ç **

## æ–°å¢è§’è‰²åŠŸèƒ½

**`ç›®æ ‡`**å®ç°æ–°å¢è§’è‰²åŠŸèƒ½

**å°è£…æ–°å¢è§’è‰²åŠŸèƒ½api**

```js

/** *
 * æ–°å¢è§’è‰²
 * ***/
export function addRole(data) {
  return request({
    url: '/sys/role',
    data,
    method: 'post'
  })
}

```

**æ–°å¢åŠŸèƒ½å®ç°å’Œç¼–è¾‘åŠŸèƒ½åˆå¹¶ï¼ˆå¤„ç†å…³é—­ï¼‰**

```js
    async btnOK() {
      try {
        await this.$refs.roleForm.validate()
        // åªæœ‰æ ¡éªŒé€šè¿‡çš„æƒ…å†µä¸‹ æ‰ä¼šæ‰§è¡Œawaitçš„ä¸‹æ–¹å†…å®¹
        // roleFormè¿™ä¸ªå¯¹è±¡æœ‰idå°±æ˜¯ç¼–è¾‘ æ²¡æœ‰idå°±æ˜¯æ–°å¢
        if (this.roleForm.id) {
          await updateRole(this.roleForm)
        } else {
          // æ–°å¢ä¸šåŠ¡
          await addRole(this.roleForm)
        }
        // é‡æ–°æ‹‰å–æ•°æ®
        this.getRoleList()
        this.$message.success('æ“ä½œæˆåŠŸ')
        this.showDialog = false // å…³é—­å¼¹å±‚  =>  è§¦å‘el-dialogçš„äº‹ä»¶closeäº‹ä»¶
      } catch (error) {
        console.log(error)
      }
    },
    btnCancel() {
      this.roleForm = {
        name: '',
        description: ''
      }
      // ç§»é™¤æ ¡éªŒ
      this.$refs.roleForm.resetFields()
      this.showDialog = false
    }
```

**æ–°å¢æŒ‰é’®æ³¨å†Œäº‹ä»¶**

```vue
<el-button type="primary" size="small" @click="showDialog = true">æ–°å¢è§’è‰²</el-button>
```

**æäº¤ä»£ç **

**`æœ¬èŠ‚ä»»åŠ¡`** æ–°å¢è§’è‰²åŠŸèƒ½

## æ€»ç»“

![image-20200831160134281](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20200831160134281.png)

æˆ‘ä»¬å®Œæˆäº†å…¬å¸ä¸­è§’è‰²ç®¡ç†çš„éƒ¨åˆ†ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰å®Œæˆåˆ†é…æƒé™çš„éƒ¨åˆ†ï¼Œè¯¥éƒ¨é—¨ä¼šåœ¨æƒé™è®¾è®¡å’Œç®¡ç†çš„éƒ¨é—¨é‡ç‚¹æåŠ
