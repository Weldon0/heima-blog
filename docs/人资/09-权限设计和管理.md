---
title: ğŸ“š 09-æƒé™è®¾è®¡å’Œç®¡ç†
---
## æƒé™è®¾è®¡-RBACçš„æƒé™è®¾è®¡æ€æƒ³

> é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆäº†è§£ä¸‹ä»€ä¹ˆæ˜¯ä¼ ç»Ÿçš„æƒé™è®¾è®¡

åˆ†é…æƒé™ ==> æŸ¥çœ‹é¡µé¢æƒé™ æ“ä½œæŒ‰é’®æƒé™ ==> æ–¹ä¾¿ç®¡ç†



![image-20200901150655343](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20200901150655343.png)

ä»ä¸Šé¢çš„å›¾ä¸­ï¼Œæˆ‘ä»¬å‘ç°ï¼Œä¼ ç»Ÿçš„æƒé™è®¾è®¡æ˜¯å¯¹æ¯ä¸ªäººè¿›è¡Œå•ç‹¬çš„æƒé™è®¾ç½®ï¼Œä½†è¿™ç§æ–¹å¼å·²ç»ä¸é€‚åˆç›®å‰ä¼ä¸šçš„é«˜æ•ˆç®¡æ§æƒé™çš„å‘å±•éœ€æ±‚ï¼Œå› ä¸ºæ¯ä¸ªäººéƒ½è¦å•ç‹¬å»è®¾ç½®æƒé™

>   åŸºäºæ­¤ï¼ŒRBACçš„æƒé™æ¨¡å‹å°±åº”è¿è€Œç”Ÿäº†ï¼ŒRBAC(Role-Based Access control) ï¼Œä¹Ÿå°±æ˜¯åŸºäºè§’è‰²çš„æƒé™åˆ†é…è§£å†³æ–¹æ¡ˆï¼Œç›¸å¯¹äºä¼ ç»Ÿæ–¹æ¡ˆï¼ŒRBACæä¾›äº†ä¸­é—´å±‚Roleï¼ˆè§’è‰²ï¼‰ï¼Œå…¶æƒé™æ¨¡å¼å¦‚ä¸‹

![image-20200901151025021](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20200901151025021.png)

RBACå®ç°äº†ç”¨æˆ·å’Œæƒé™ç‚¹çš„åˆ†ç¦»ï¼Œæƒ³å¯¹æŸä¸ªç”¨æˆ·è®¾ç½®æƒé™ï¼Œåªéœ€è¦å¯¹è¯¥ç”¨æˆ·è®¾ç½®ç›¸åº”çš„è§’è‰²å³å¯ï¼Œè€Œè¯¥è§’è‰²å°±æ‹¥æœ‰äº†å¯¹åº”çš„æƒé™ï¼Œè¿™æ ·ä¸€æ¥ï¼Œæƒé™çš„åˆ†é…å’Œè®¾è®¡å°±åšåˆ°äº†æç®€ï¼Œé«˜æ•ˆï¼Œå½“æƒ³å¯¹ç”¨æˆ·æ”¶å›æƒé™æ—¶ï¼Œåªéœ€è¦æ”¶å›è§’è‰²å³å¯ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±åœ¨è¯¥é¡¹ç›®ä¸­å®æ–½è¿™ä¸€è®¾æƒ³

## ç»™åˆ†é…å‘˜å·¥è§’è‰²

**`ç›®æ ‡`**åœ¨å‘˜å·¥ç®¡ç†é¡µé¢ï¼Œåˆ†é…è§’è‰²

### æ–°å»ºåˆ†é…è§’è‰²çª—ä½“

> åœ¨ä¸Šä¸€èŠ‚ç« èŠ‚ä¸­ï¼Œå‘˜å·¥ç®¡ç†çš„è§’è‰²åŠŸèƒ½ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰å®ç°ï¼Œæ­¤ç« èŠ‚æˆ‘ä»¬å®ç°ç»™å‘˜å·¥åˆ†é…è§’è‰²

![image-20200901151151286](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20200901151151286.png)

ä»ä¸Šå›¾ä¸­ï¼Œå¯ä»¥çœ‹å‡ºï¼Œç”¨æˆ·å’Œè§’è‰²æ˜¯**`1å¯¹å¤š`**çš„å…³ç³»ï¼Œå³ä¸€ä¸ªç”¨æˆ·å¯ä»¥æ‹¥æœ‰å¤šä¸ªè§’è‰²ï¼Œæ¯”å¦‚å…¬å¸çš„è‘£äº‹é•¿å¯ä»¥æ‹¥æœ‰æ€»ç»ç†å’Œç³»ç»Ÿç®¡ç†å‘˜ä¸€æ ·çš„è§’è‰²

é¦–å…ˆï¼Œæ–°å»ºåˆ†é…è§’è‰²çª—ä½“ **src/employees/components/assign-role.vue** 	Ã¥

![image-20200728172853451](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20200728172853451.png)

```vue
<template>
  <el-dialog title="åˆ†é…è§’è‰²" :visible="showRoleDialog">
    <!-- el-checkbox-groupé€‰ä¸­çš„æ˜¯ å½“å‰ç”¨æˆ·æ‰€æ‹¥æœ‰çš„è§’è‰²  éœ€è¦ç»‘å®š å½“å‰ç”¨æˆ·æ‹¥æœ‰çš„è§’è‰²-->
    <el-checkbox-group>
      <!-- é€‰é¡¹ -->
    </el-checkbox-group>
    <el-row slot="footer" type="flex" justify="center">
      <el-col :span="12">
        <el-button type="primary" size="small">ç¡®å®š</el-button>
        <el-button size="small">å–æ¶ˆ</el-button>
      </el-col>
    </el-row>
  </el-dialog>
</template>

<script>
export default {
  props: {
    showRoleDialog: {
      type: Boolean,
      default: false
    },
    // ç”¨æˆ·çš„id ç”¨æ¥æŸ¥è¯¢å½“å‰ç”¨æˆ·çš„è§’è‰²ä¿¡æ¯
    userId: {
      type: String,
      default: null
    }
  }
}
</script>


```

### è·å–è§’è‰²åˆ—è¡¨å’Œå½“å‰ç”¨æˆ·è§’è‰²

:::tip

é€‰ä¸­çŠ¶æ€çš„å€¼å¯¹åº”çš„å±æ€§ä¸ºlabel

:::

<img src="https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20220210091755710.png" alt="image-20220210091755710" style="zoom:50%;" />

**è·å–æ‰€æœ‰è§’è‰²åˆ—è¡¨**

```vue
  <!-- åˆ†é…è§’è‰² -->
    <el-checkbox-group v-model="roleIds">
      <el-checkbox v-for="item in list" :key="item.id" :label="item.id">
        {{
          item.name
        }}
      </el-checkbox>
    </el-checkbox-group>
  
```

**è·å–è§’è‰²åˆ—è¡¨**

```js
import { getRoleList } from '@/api/setting'

export default {
  props: {
    showRoleDialog: {
      type: Boolean,
      default: false
    },
    userId: {
      type: String,
      default: null
    }
  },
  data() {
    return {
      list: [], // è§’è‰²åˆ—è¡¨
      roleIds: []
    }
  },
  created() {
    this.getRoleList()
  },
  methods: {
    //  è·å–æ‰€æœ‰è§’è‰²
    async getRoleList() {
      const { rows } = await getRoleList()
      this.list = rows
    }
  }
}
```

**è·å–ç”¨æˆ·çš„å½“å‰è§’è‰²**  

```js
import { getUserDetailById } from '@/api/user'

 async getUserDetailById(id) {
      const { roleIds } = await getUserDetailById(id)
      this.roleIds = roleIds // èµ‹å€¼æœ¬ç”¨æˆ·çš„è§’è‰²
  }
```

**ç‚¹å‡»è§’è‰²å¼¹å‡ºå±‚**

```vue
// ç¼–è¾‘è§’è‰²
 async  editRole(id) {
      this.userId = id // propsä¼ å€¼ æ˜¯å¼‚æ­¥çš„
      await this.$refs.assignRole.getUserDetailById(id) // çˆ¶ç»„ä»¶è°ƒç”¨å­ç»„ä»¶æ–¹æ³•
      this.showRoleDialog = true
    },
  <!-- æ”¾ç½®è§’è‰²åˆ†é…ç»„ä»¶ -->
 <assign-role ref="assignRole" :show-role-dialog.sync="showRoleDialog" :user-id="userId" />
```

### ç»™å‘˜å·¥åˆ†é…è§’è‰²

**åˆ†é…è§’è‰²æ¥å£**  **`api/employees.js`**

```js
/** *
 * ç»™ç”¨æˆ·åˆ†é…è§’è‰²
 * ***/
export function assignRoles(data) {
  return request({
    url: '/sys/user/assignRoles',
    data,
    method: 'put'
  })
}
```

**ç¡®å®šä¿å­˜**  **`assign-role`**

```js
async btnOK() {
      await assignRoles({ id: this.userId, roleIds: this.roleIds })
      //   å…³é—­çª—ä½“
      this.$emit('update:showRoleDialog', false)
    },
```

**å–æ¶ˆæˆ–è€…å…³é—­ **  **`assign-role`** 

```js
btnCancel() {
      this.roleIds = [] // æ¸…ç©ºåŸæ¥çš„æ•°ç»„
      this.$emit('update:showRoleDialog', false)
    }
```

**æäº¤ä»£ç **

**`æœ¬èŠ‚ä»»åŠ¡`** åˆ†é…å‘˜å·¥æƒé™

## 	

**`ç›®æ ‡`**ï¼š å®Œæˆæƒé™ç‚¹é¡µé¢çš„å¼€å‘å’Œç®¡ç†

### æ–°å»ºæƒé™ç‚¹ç®¡ç†é¡µé¢

::: tip

å¤ä¹ ä¸€ä¸‹æƒé™ç®¡ç†æµç¨‹

:::

<img src="https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20220207202149007.png" alt="image-20220207202149007" style="zoom:50%;" />

> äººå·²ç»æœ‰äº†è§’è‰²ï¼Œ é‚£ä¹ˆæƒé™æ˜¯ä»€ä¹ˆ

åœ¨ä¼ä¸šæœåŠ¡ä¸­ï¼Œæƒé™ä¸€èˆ¬åˆ†å‰²ä¸º **é¡µé¢è®¿é—®æƒé™**ï¼Œ**æŒ‰é’®æ“ä½œæƒé™**ï¼Œ**APIè®¿é—®æƒé™**

> APIæƒé™å¤šè§äºåœ¨åç«¯è¿›è¡Œæ‹¦æˆªï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™ä¸€ç‰ˆæœ¬åªåš**`é¡µé¢è®¿é—®`**å’Œ**`æŒ‰é’®æ“ä½œæˆæƒ`/**

ç”±æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€æ±‚è®¾è®¡æƒé™ç®¡ç†é¡µé¢

![image-20200901160508382](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20200901160508382.png)

**å®Œæˆæƒé™é¡µé¢ç»“æ„** **`src/views/permission/index.vue`**

```vue
<template>
  <div class="dashboard-container">
    <div class="app-container">
      <!-- é å³çš„æŒ‰é’® -->
      <page-tools>
        <template v-slot:after>
          <el-button type="primary" size="small">æ·»åŠ æƒé™</el-button>
        </template>
      </page-tools>
      <!-- è¡¨æ ¼ -->
      <el-table border >
        <el-table-column align="center" label="åç§°" />
        <el-table-column align="center" label="æ ‡è¯†" />
        <el-table-column align="center" label="æè¿°" />
        <el-table-column align="center" label="æ“ä½œ" >
          <template>
            <el-button type="text">æ·»åŠ </el-button>
            <el-button type="text">ç¼–è¾‘</el-button>
            <el-button type="text">åˆ é™¤</el-button>
          </template>
        </el-table-column>

      </el-table>
    </div>
  </div>
</template>
```

**å°è£…æƒé™ç®¡ç†çš„å¢åˆ æ”¹æŸ¥è¯·æ±‚**  **`src/api/permisson.js`**

```js
// è·å–æƒé™
export function getPermissionList(params) {
  return request({
    url: '/sys/permission',
    params
  })
}
// æ–°å¢æƒé™
export function addPermission(data) {
  return request({
    url: '/sys/permission',
    method: 'post',
    data
  })
}

// æ›´æ–°æƒé™
export function updatePermission(data) {
  return request({
    url: `/sys/permission/${data.id}`,
    method: 'put',
    data
  })
}

// åˆ é™¤æƒé™
export function delPermission(id) {
  return request({
    url: `/sys/permission/${id}`,
    method: 'delete'
  })
}
// è·å–æƒé™è¯¦æƒ…
export function getPermissionDetail(id) {
  return request({
    url: `/sys/permission/${id}`
  })
}

```

### è·å–æƒé™æ•°æ®å¹¶è½¬åŒ–æ ‘å½¢

:::tip ç›®æ ‡ï¼š

1ã€å®Œæˆæ ‘å½¢ç»“æ„çš„å±•ç¤º(éœ€è¦ç»™el-tableæ·»åŠ  row-keyå³å¯)

2ã€å®ŒæˆçœŸå®æ•°æ®çš„çš„å±•ç¤ºï¼Œæ³¨æ„ï¼šæŒ‰é’®éœ€è¦æŒ‰ç…§æƒé™å»åŒºåˆ†å±•ç¤º

:::

![image-20220208170004362](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20220208170004362.png)

1ã€**åˆ—è¡¨==>æ ‘å½¢ç»“æ„(è·å–æ¥å£æ•°æ®ã€å†è½¬åŒ–æ•°æ®)**

```vue
<script>
import { getPermissionList } from '@/api/permission'
import { transListToTreeData } from '@/utils'
export default {
data() {
    return {
      // éœ€è¦å±•ç¤ºçš„æ•°æ®
      list: [],
      // formDataæ•°æ®å’Œrulesæ•°æ®å¯ä»¥ç­‰åˆ°å¼¹æ¡†åšå®Œçš„æ—¶å€™å†å»å®šä¹‰ï¼Œ
      formData: {
        name: '', // åç§°
        code: '', // æ ‡è¯†
        description: '', // æè¿°
        type: '', // ç±»å‹ è¯¥ç±»å‹ ä¸éœ€è¦æ˜¾ç¤º å› ä¸ºç‚¹å‡»æ·»åŠ çš„æ—¶å€™å·²ç»çŸ¥é“ç±»å‹äº†
        pid: '', // å› ä¸ºåšçš„æ˜¯æ ‘ éœ€è¦çŸ¥é“æ·»åŠ åˆ°å“ªä¸ªèŠ‚ç‚¹ä¸‹äº†
        enVisible: '0' // å¼€å¯
      },
      // æ–°å¢æˆ–è€…ç¼–è¾‘å¼¹æ¡†çš„æ ¡éªŒè§„åˆ™ï¼Œ
      rules: {
        name: [{ required: true, message: 'æƒé™åç§°ä¸èƒ½ä¸ºç©º', trigger: 'blur' }],
        code: [{ required: true, message: 'æƒé™æ ‡è¯†ä¸èƒ½ä¸ºç©º', trigger: 'blur' }]
      },
      // æ˜¯å¦å±•ç¤ºæ–°å¢æˆ–è€…ç¼–è¾‘å¼¹æ¡†
      showDialog: false
    }
  },
  created() {
    this.getPermissionList()
  },
  computed: {
    showText() {
      return this.formData.id ? 'ç¼–è¾‘' : 'æ–°å¢'
    }
  },
  methods: {
    async getPermissionList() {
      this.list = transListToTreeData(await getPermissionList(), '0')
    }
  }

}
</script>
```

2ã€**ç»‘å®šè¡¨æ ¼æ•°æ®éœ€è¦æ³¨æ„æ·»åŠ æŒ‰é’®çš„åŒºåˆ†å±•ç¤º**

```vue
  <el-table :data="list" border="" row-key="id">
      <el-table-column label="åç§°" prop="name" />
      <el-table-column label="æ ‡è¯†" prop="code" />
      <el-table-column label="æè¿°" prop="description" />
      <el-table-column label="æ“ä½œ">
        <template slot-scope="{ row }">
          <el-button v-if="row.type === 1" type="text" @click="addPermission(row.id, 2)">æ·»åŠ </el-button>
          <el-button type="text" @click="editPermission(row.id)">ç¼–è¾‘</el-button>
          <el-button type="text" @click="delPermission(row.id)"> åˆ é™¤</el-button>
        </template>
      </el-table-column>
  </el-table>
```

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ å¦‚æœéœ€è¦æ ‘è¡¨ï¼Œ éœ€è¦ç»™**el-table**é…ç½®**row-key**å±æ€§  id

> å½“typeä¸º1æ—¶ä¸ºè®¿é—®æƒé™ï¼Œtypeä¸º2æ—¶ä¸ºåŠŸèƒ½æƒé™

> å’Œå‰é¢å†…å®¹ä¸€æ ·ï¼Œæˆ‘ä»¬éœ€è¦å®Œæˆ æ–°å¢æƒé™ / åˆ é™¤æƒé™ / ç¼–è¾‘æƒé™

## æ–°å¢ç¼–è¾‘æƒé™çš„å¼¹å±‚

<img src="https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20211104132319110.png" alt="image-20211104132319110" style="zoom:50%;" />

<img src="https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20211104111654237.png" alt="image-20211104111654237" style="zoom:33%;" />

>  ç›®æ ‡
>
>   1ã€å®Œæˆæ·»åŠ èœå•ã€æ·»åŠ æŒ‰é’®ã€ç¼–è¾‘æŒ‰é’®çš„å¼¹å±‚æ•ˆæœ

1ã€ç»˜åˆ¶æ ·å¼==>**æ–°å¢æƒé™/ç¼–è¾‘æƒé™å¼¹å±‚**

nameå’Œcodeä¸èƒ½ä¸ºç©º

```vue
  <!-- æ”¾ç½®ä¸€ä¸ªå¼¹å±‚ ç”¨æ¥ç¼–è¾‘æ–°å¢èŠ‚ç‚¹ -->
   <el-dialog :title="`${showText}æƒé™ç‚¹`" :visible="showDialog" @close="btnCancel">
      <!-- è¡¨å• -->
      <el-form ref="perForm" :model="formData" :rules="rules" label-width="120px">
        <el-form-item label="æƒé™åç§°" prop="name">
          <el-input v-model="formData.name" style="width:90%" />
        </el-form-item>
        <el-form-item label="æƒé™æ ‡è¯†" prop="code">
          <el-input v-model="formData.code" style="width:90%" />
        </el-form-item>
        <el-form-item label="æƒé™æè¿°">
          <el-input v-model="formData.description" style="width:90%" />
        </el-form-item>
        <el-form-item label="å¼€å¯">
          /* å½“å€¼ä¸º1(active-value)æ—¶ï¼Œæ¿€æ´»èŠ‚ç‚¹ï¼Œå½“å€¼ä¸º(inactive-value)0æ—¶ï¼Œä¸æ¿€æ´» */
          /* v-modelç»‘å®šçš„ä¸ºå½“å‰switchå¯¹åº”çš„å€¼ */
          <el-switch
            v-model="formData.enVisible"
            active-value="1"
            inactive-value="0"
          />
        </el-form-item>
      </el-form>
      <el-row slot="footer" type="flex" justify="center">
        <el-col :span="6">
          <el-button size="small" type="primary" @click="btnOK">ç¡®å®š</el-button>
          <el-button size="small" @click="btnCancel">å–æ¶ˆ</el-button>
        </el-col>
      </el-row>
    </el-dialog>
```

2ã€**ç»™å¼¹å‡ºå±‚ç»‘å®šæ‰€éœ€è¦çš„æ•°æ®**

â€‹	1. è¡¨å•å±æ€§ç»‘å®š => æ•°æ®å®šä¹‰

â€‹	2. æ ¡éªŒè§„åˆ™å®šä¹‰ => codeå’Œnameä¸èƒ½ä¸ºç©º

â€‹	3. æ˜¯å¦åšå±•ç¤ºçš„æ ‡è¯† => showDialog

 	4. å¼¹æ¡†æ ‡é¢˜çš„åŒºåˆ†å±•ç¤º(å¦‚æœç¼–è¾‘çš„æ—¶å€™ï¼Œéœ€è¦è®°å½•å½“å‰æ•°æ®çš„idï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡idå»åšåˆ¤æ–­)





```vue
<script>
import { getPermissionList } from '@/api/permission'
import { transListToTreeData } from '@/utils'
export default {
data() {
    return {
      // éœ€è¦å±•ç¤ºçš„æ•°æ®
      list: [],
      // formDataæ•°æ®å’Œrulesæ•°æ®
      formData: {
        name: '', // åç§°
        code: '', // æ ‡è¯†
        description: '', // æè¿°
        type: '', // ç±»å‹ è¯¥ç±»å‹ ä¸éœ€è¦æ˜¾ç¤º å› ä¸ºç‚¹å‡»æ·»åŠ çš„æ—¶å€™å·²ç»çŸ¥é“ç±»å‹äº†
        pid: '', // å› ä¸ºåšçš„æ˜¯æ ‘ éœ€è¦çŸ¥é“æ·»åŠ åˆ°å“ªä¸ªèŠ‚ç‚¹ä¸‹äº†
        enVisible: '0' // å¼€å¯
      },
      // æ–°å¢æˆ–è€…ç¼–è¾‘å¼¹æ¡†çš„æ ¡éªŒè§„åˆ™ï¼Œ
      rules: {
        name: [{ required: true, message: 'æƒé™åç§°ä¸èƒ½ä¸ºç©º', trigger: 'blur' }],
        code: [{ required: true, message: 'æƒé™æ ‡è¯†ä¸èƒ½ä¸ºç©º', trigger: 'blur' }]
      },
      // æ˜¯å¦å±•ç¤ºæ–°å¢æˆ–è€…ç¼–è¾‘å¼¹æ¡†
      showDialog: false
    }
  },
  created() {
    this.getPermissionList()
  },
  computed: {
    showText() {
      return this.formData.id ? 'ç¼–è¾‘' : 'æ–°å¢'
    }
  },
  methods: {
    async getPermissionList() {
      this.list = transListToTreeData(await getPermissionList(), '0')
    }
  }
}
</script>
```





## æ–°å¢ï¼Œç¼–è¾‘ï¼Œåˆ é™¤æƒé™ç‚¹

:::tip å®ç°æ€è·¯

1. **æ·»åŠ èŠ‚ç‚¹ ==> é¡¶å±‚æŒ‰é’®æ·»åŠ é¡µé¢çš„è®¿é—®æƒï¼Œæ•°æ®åˆ—è¡¨åé¢çš„æ·»åŠ æŒ‰é’®ï¼Œæ·»åŠ é¡µé¢çš„æ“ä½œæƒ**
   1. ç‚¹å‡»æ·»åŠ æŒ‰é’®ï¼Œå¼¹å‡ºå¼¹å‡ºå±‚(æ ‡è¯†å˜ä¸ºtrue)
   2. è®°å½•å½“å‰èŠ‚ç‚¹ç‚¹å‡»çš„id(è®°å½•åˆ°formdataçš„pidå±æ€§ä¸­)ï¼Œç›®çš„æ˜¯è·å–æ·»åŠ çš„èŠ‚ç‚¹éœ€è¦æ·»åŠ åˆ°é‚£ä¸ªèŠ‚ç‚¹ä¸‹é¢(å¦‚æœè®¿é—®æƒé™çš„åˆ™pidä¸º'0')
   3. è®°å½•typeå±æ€§ï¼Œè®°å½•typeå±æ€§çš„ç›®çš„æ˜¯çŸ¥é“æ·»åŠ çš„æ˜¯æ“ä½œæƒé™(2)è¿˜æ˜¯è®¿é—®æƒé™(1),å¯ä»¥åœ¨è°ƒç”¨æ–¹æ³•çš„æ—¶å€™ä¼ è¿‡æ¥
   4. å¼¹å‡ºå¼¹å‡ºå±‚
   5. å¼¹å‡ºå±‚æäº¤çš„æ—¶å€™æ ¡éªŒæ•°æ®æäº¤æ¥å£
   6. æäº¤æˆåŠŸå…³é—­å¼¹å‡ºå±‚æç¤ºç”¨æˆ·æ·»åŠ æˆåŠŸ
2. **åˆ é™¤èŠ‚ç‚¹**
   1. åˆ é™¤æŒ‰é’®ç»‘å®šdeläº‹ä»¶ï¼Œä¼ å…¥å½“å‰çš„æ•°æ®id
   2. deläº‹ä»¶å†…éƒ¨ï¼Œå¼¹å‡ºconfimæ¡†ï¼Œç‚¹å‡»ç¡®å®šçš„æ—¶å€™åˆ é™¤æ•°æ®ï¼ŒåŒæ—¶æç¤ºç”¨æˆ·åˆ é™¤æˆåŠŸ
   3. åˆ é™¤æˆåŠŸä»¥åéœ€è¦é‡æ–°è·å–åˆ—è¡¨æ•°æ®`getPermissionList`
3. **ç¼–è¾‘é€»è¾‘**
   1. ç»‘å®šç¼–è¾‘äº‹ä»¶ï¼Œä¼ å…¥å½“å‰æ•°æ®id
   2. å¼¹å±‚
   3. é€šè¿‡idè¯»å–å½“å‰ç‚¹å‡»çš„æ•°æ®çš„è¯¦æƒ…ï¼Œç„¶åèµ‹å€¼ç»™formData(æ•°æ®å›æ˜¾)
   4. ç”±äºä½¿ç”¨çš„æ˜¯åŒä¸€ä¸ªå¼¹å±‚ï¼Œå¯ä»¥é€šè¿‡æ•°æ®æ˜¯å¦åŒ…å«idï¼Œæ¥ç¡®å®šæ˜¯å¦ä¸ºç¼–è¾‘(å¦‚æœç¼–è¾‘åˆ™è°ƒç”¨ç¼–è¾‘æ¥å£)
   5. æˆåŠŸä»¥åæç¤ºç”¨æˆ·æˆåŠŸæ¶ˆæ¯
   6. å…³é—­å¼¹å±‚
4. **å–æ¶ˆæŒ‰é’®çš„é€»è¾‘**
   1. æ•°æ®è¿˜åŸ
   2. è¡¨å•æ ¡éªŒæ¸…ç©º
   3. å¼¹å±‚å…³é—­
5. **å¼¹å‡ºå±‚æ ‡é¢˜å±•ç¤ºç¼–è¾‘æˆ–è€…æ–°å¢**
   1. åˆ¤æ–­è®¡ç®—æ ‘å½¢åˆ¤æ–­å½“å‰æ•°æ®æ˜¯å¦æœ‰formData.idå¦‚æœæœ‰ä¸ºç¼–è¾‘ï¼Œå¦åˆ™ä¸ºæ–°å¢
   2. dialogæ ‡é¢˜åŠ¨æ€è®¾ç½®

:::

**æ–°å¢/åˆ é™¤/ç¼–è¾‘é€»è¾‘**

ä¸»ä½“æ€è·¯ï¼š

1ã€æ·»åŠ åŠŸèƒ½éœ€è¦

```js
import { updatePermission, addPermission, getPermissionDetail, delPermission, getPermissionList } from '@/api/permission'
  methods: {
     // åˆ é™¤æ“ä½œ
    async delPermission(id) {
      try {
        await this.$confirm('ç¡®å®šè¦åˆ é™¤è¯¥æ•°æ®å—')
        await delPermission(id)
        this.getPermissionList()
        this.$message.success('åˆ é™¤æˆåŠŸ')
      } catch (error) {
        console.log(error)
      }
    },
    btnOK() {
      this.$refs.perForm.validate().then(() => {
        // åˆ¤æ–­å½“å‰æ•°æ®æ˜¯å¦æœ‰idï¼Œå¦‚æœæœ‰è¯´æ˜å°±æ˜¯ç¼–è¾‘å¦åˆ™å°±æ˜¯æ–°å¢
        if (this.formData.id) {
          return updatePermission(this.formData)
        }
        return addPermission(this.formData)
      }).then(() => {
        //  æç¤ºæ¶ˆæ¯
        this.$message.success('æ–°å¢æˆåŠŸ')
        this.getPermissionList()
        this.showDialog = false
      })
    },
    btnCancel() {
      this.formData = {
        name: '', // åç§°
        code: '', // æ ‡è¯†
        description: '', // æè¿°
        type: '', // ç±»å‹ è¯¥ç±»å‹ ä¸éœ€è¦æ˜¾ç¤º å› ä¸ºç‚¹å‡»æ·»åŠ çš„æ—¶å€™å·²ç»çŸ¥é“ç±»å‹äº†
        pid: '', // å› ä¸ºåšçš„æ˜¯æ ‘ éœ€è¦çŸ¥é“æ·»åŠ åˆ°å“ªä¸ªèŠ‚ç‚¹ä¸‹äº†
        enVisible: '0' // å¼€å¯
      }
      this.$refs.perForm.resetFields()
      this.showDialog = false
    },
    addPermission(pid, type) {
      this.formData.pid = pid
      this.formData.type = type
      this.showDialog = true
    },
    async editPermission(id) {
      // æ ¹æ®è·å–idè·å–è¯¦æƒ…
      this.formData = await getPermissionDetail(id)
      this.showDialog = true
    }
  }
 
```

**æäº¤ä»£ç **

**`æœ¬èŠ‚ä»»åŠ¡`**: æƒé™ç‚¹ç®¡ç†é¡µé¢å¼€å‘

## ç»™è§’è‰²åˆ†é…æƒé™

**`ç›®æ ‡`**ï¼š å®Œæˆç»™è§’è‰²åˆ†é…æƒé™çš„ä¸šåŠ¡ /views/setting

<img src="https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20211104140426193.png" alt="image-20211104140426193" style="zoom:50%;" />



<img src="https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20211104140856566.png" alt="image-20211104140856566" style="zoom:50%;" />

::: tip å®ç°æ€è·¯ï¼š

#### æ ·å¼ç»˜åˆ¶éƒ¨åˆ†ï¼š

1. ç‚¹å‡»åˆ†é…æƒé™æŒ‰é’®å¼¹å‡ºå¼¹å‡ºå±‚(æ„å»ºä¸€ä¸ªå¼¹å±‚)
2. å…³é—­çš„æ—¶å€™@closeå…³é—­å¼¹å±‚
3. ä¸ºå¼¹å±‚æ„å»ºè§’è‰²çš„æ ‘ç»“æ„
   1. å¼¹å±‚éœ€è¦refæ ‘å½¢
   2. :dataæ ‘å½¢
   3. propsæ–¹ä¾¿çŸ¥é“è°æ˜¯label
   4. :show-checkbox="true" å±•ç¤ºé€‰æ‹©æ¡†
   5. :check-strictly='true' çˆ¶å­ä¸è”åŠ¨
   6. :default-expand-allå…¨éƒ¨å±•å¼€
   7. :default-checked-keys="selectCheck" é»˜è®¤é€‰ä¸­çš„èŠ‚ç‚¹
   8. node-key='id' èŠ‚ç‚¹çš„keyä¸ºå½“å‰æ•°æ®çš„id
4. dataä¸­ç»™å¼¹å±‚å®šä¹‰æ‰€éœ€è¦çš„æ•°æ®(è¯¦ç»†è§ä»£ç )



#### é€»è¾‘å®ç°éƒ¨åˆ†



1. è·å–æ•´ä¸ªæ ‘ç»“æ„ï¼Œå¡«å……åˆ°permData(è½¬æ ‘ç»“æ„)

2. æ ¹æ®å½“å‰ç‚¹å‡»çš„æ•°æ®idï¼Œè·å–å½“å‰è§’è‰²çš„æƒé™é€‰ä¸­æ‰€å¯¹åº”çš„å¤é€‰æ¡†
3. æäº¤æ—¶å€™é€šè¿‡refè·å–å½“å‰ç»„ä»¶å®ä¾‹æ–¹æ³•å’Œè·å–é€‰ä¸­èŠ‚ç‚¹ï¼ŒåŒæ—¶æ‹¼æ¥å½“å‰æ•°æ®çš„idæäº¤åˆ°æœåŠ¡å™¨ç«¯
4. ç”¨æˆ·ä½“éªŒç›¸å…³æç¤º

:::

### æ–°å»ºåˆ†é…æƒé™å¼¹å‡ºå±‚

> åœ¨å…¬å¸è®¾ç½®çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰å®ç°åˆ†é…æƒé™çš„åŠŸèƒ½ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬æ¥å®ç°ä¸€ä¸‹

**å°è£…åˆ†é…æƒé™çš„api**  **`src/api/setting.js`**

```js
// ç»™è§’è‰²åˆ†é…æƒé™
export function assignPerm(data) {
  return request({
    url: '/sys/role/assignPrem',
    method: 'put',
    data
  })
}

```
**ç»™è§’è‰²åˆ†é…æƒé™å¼¹å‡ºå±‚**

:::tip

â€‹	è®°å¾—ç»™æ ‘èŠ‚ç‚¹æ·»åŠ node-key="id" å”¯ä¸€æ ‡è¯†

:::

```vue
<el-dialog title="åˆ†é…æƒé™" :visible="showPermDialog" @close="btnPermCancel">
      <!-- æƒé™æ˜¯ä¸€é¢—æ ‘ -->
      <!-- å°†æ•°æ®ç»‘å®šåˆ°ç»„ä»¶ä¸Š -->
      <!-- check-strictly å¦‚æœä¸ºtrue é‚£è¡¨ç¤ºçˆ¶å­å‹¾é€‰æ—¶  ä¸äº’ç›¸å…³è” å¦‚æœä¸ºfalseå°±äº’ç›¸å…³è” -->
      <!-- idä½œä¸ºå”¯ä¸€æ ‡è¯† -->
      <el-tree
        ref="permTree"
        :data="permData"
        :props="defaultProps"
        :show-checkbox="true"
        :check-strictly="true"
        :default-expand-all="true"
        :default-checked-keys="selectCheck"
        node-key="id"
      />
      <!-- ç¡®å®š å–æ¶ˆ -->
      <el-row slot="footer" type="flex" justify="center">
        <el-col :span="6">
          <el-button type="primary" size="small" @click="btnPermOK">ç¡®å®š</el-button>
          <el-button size="small" @click="btnPermCancel">å–æ¶ˆ</el-button>
        </el-col>
      </el-row>
    </el-dialog>
```

**å®šä¹‰æ•°æ®**

```js
      showPermDialog: false, // æ§åˆ¶åˆ†é…æƒé™å¼¹å±‚çš„æ˜¾ç¤ºåè€…éšè—
      defaultProps: {
        label: 'name'
      },
       permData: [], // ä¸“é—¨ç”¨æ¥æ¥æ”¶æƒé™æ•°æ® æ ‘å½¢æ•°æ®
      selectCheck: [], // å®šä¹‰ä¸€ä¸ªæ•°ç»„æ¥æ¥æ”¶ å·²ç»é€‰ä¸­çš„èŠ‚ç‚¹
      roleId: null // ç”¨æ¥è®°å½•åˆ†é…è§’è‰²çš„id
```

**ç‚¹å‡»åˆ†é…æƒé™**

```vue
<el-button size="small" type="success" @click="assignPerm(row.id)">åˆ†é…æƒé™</el-button>
```

### ç»™è§’è‰²åˆ†é…æƒé™

**åˆ†é…æƒé™**/**æ ‘å½¢æ•°æ®**

```js
 import { transListToTreeData } from '@/utils'
import { getPermissionList } from '@/api/permission'
methods: {
    // ç‚¹å‡»åˆ†é…æƒé™
  // è·å–æƒé™ç‚¹æ•°æ® åœ¨ç‚¹å‡»çš„æ—¶å€™è°ƒç”¨ è·å–æƒé™ç‚¹æ•°æ®
    async assignPerm(id) {
      this.permData = tranListToTreeData(await getPermissionList(), '0') // è½¬åŒ–liståˆ°æ ‘å½¢æ•°æ®
      this.roleId = id
      // åº”è¯¥å»è·å– è¿™ä¸ªidçš„ æƒé™ç‚¹
      // æœ‰id å°±å¯ä»¥ idåº”è¯¥å…ˆè®°å½•ä¸‹æ¥
      const { permIds } = await getRoleDetail(id) // permIdsæ˜¯å½“å‰è§’è‰²æ‰€æ‹¥æœ‰çš„æƒé™ç‚¹æ•°æ®
      this.selectCheck = permIds // å°†å½“å‰è§’è‰²æ‰€æ‹¥æœ‰çš„æƒé™idèµ‹å€¼
      this.showPermDialog = true
    },
    async  btnPermOK() {
      // è°ƒç”¨el-treeçš„æ–¹æ³•
      // console.log(this.$refs.permTree.getCheckedKeys())
      await assignPerm({ permIds: this.$refs.permTree.getCheckedKeys(), id: this.roleId })
      this.$message.success('åˆ†é…æƒé™æˆåŠŸ')
      this.showPermDialog = false
    },
    btnPermCancel() {
      this.selectCheck = [] // é‡ç½®æ•°æ®
      this.showPermDialog = false
    }
}

```

**æäº¤ä»£ç **

**`æœ¬èŠ‚ä»»åŠ¡`** ç»™è§’è‰²åˆ†é…æƒé™

## å‰ç«¯æƒé™åº”ç”¨-é¡µé¢è®¿é—®å’Œèœå•

**`ç›®æ ‡`**ï¼š åœ¨å½“å‰é¡¹ç›®åº”ç”¨ç”¨æˆ·çš„é¡µé¢è®¿é—®æƒé™

### æƒé™å—æ§çš„ä¸»ä½“æ€è·¯

> åˆ°äº†æœ€å…³é”®çš„ç¯èŠ‚ï¼Œæˆ‘ä»¬è®¾ç½®çš„æƒé™å¦‚ä½•åº”ç”¨ï¼Ÿ

åœ¨ä¸Šé¢çš„å‡ ä¸ªå°èŠ‚ä¸­ï¼Œæˆ‘ä»¬å·²ç»æŠŠç»™ç”¨æˆ·åˆ†é…äº†è§’è‰²ï¼Œ ç»™è§’è‰²åˆ†é…äº†æƒé™ï¼Œé‚£ä¹ˆåœ¨ç”¨æˆ·ç™»å½•è·å–èµ„æ–™çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨æŸ¥å‡ºè¯¥ç”¨æˆ·æ‹¥æœ‰å“ªäº›æƒé™ï¼Œè¿™ä¸ªæƒé™éœ€è¦å’Œæˆ‘ä»¬çš„èœå•è¿˜æœ‰è·¯ç”±æœ‰æ•ˆç»“åˆèµ·æ¥

> æˆ‘ä»¬åœ¨è·¯ç”±å’Œé¡µé¢ç« èŠ‚ä¸­ï¼Œå·²ç»ä»‹ç»è¿‡ï¼ŒåŠ¨æ€æƒé™å…¶å®å°±æ˜¯æ ¹æ®ç”¨æˆ·çš„å®é™…æƒé™æ¥è®¿é—®çš„ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ“ä½œä¸€ä¸‹

![image-20200730002842243](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20200730002842243.png)

åœ¨æƒé™ç®¡ç†é¡µé¢ä¸­ï¼Œæˆ‘ä»¬è®¾ç½®äº†ä¸€ä¸ª**æ ‡è¯†**ï¼Œ è¿™ä¸ªæ ‡è¯†å¯ä»¥å’Œæˆ‘ä»¬çš„è·¯ç”±æ¨¡å—è¿›è¡Œå…³è”ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœç”¨æˆ·æ‹¥æœ‰è¿™ä¸ªæ ‡è¯†ï¼Œé‚£ä¹ˆç”¨æˆ·å°±å¯ä»¥**æ‹¥æœ‰è¿™ä¸ªè·¯ç”±æ¨¡å—**ï¼Œå¦‚æœæ²¡æœ‰è¿™ä¸ªæ ‡è¯†ï¼Œå°±ä¸èƒ½**è®¿é—®è·¯ç”±æ¨¡å—**

> ç”¨ä»€ä¹ˆæ¥å®ç°ï¼Ÿ

vue-routeræä¾›äº†ä¸€ä¸ªå«åš[addRoutes](https://router.vuejs.org/zh/api/#router-addroutes)çš„APIæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•çš„å«ä¹‰æ˜¯**åŠ¨æ€æ·»åŠ è·¯ç”±è§„åˆ™**

æ€è·¯å¦‚ä¸‹

![image-20200901164312005](assets/image-20200901164312005.png)

### æ–°å»ºVuexä¸­ç®¡ç†æƒé™çš„æ¨¡å—

>  åœ¨**ä¸»é¡µæ¨¡å—**ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ç”¨æˆ·çš„èµ„æ–™è®¾ç½®åˆ°vuexä¸­ï¼Œå…¶ä¸­ä¾¿æœ‰æƒé™æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥å°±æ­¤è¿›è¡Œæ“ä½œ

æˆ‘ä»¬å¯ä»¥åœ¨vuexä¸­æ–°å¢ä¸€ä¸ªpermissionæ¨¡å—

**`src/store/modules/permission.js`**

```js
// vuexçš„æƒé™æ¨¡å—
import { constantRoutes } from '@/router'
// vuexä¸­çš„permissionæ¨¡å—ç”¨æ¥å­˜æ”¾å½“å‰çš„ é™æ€è·¯ç”± + å½“å‰ç”¨æˆ·çš„ æƒé™è·¯ç”±
const state = {
  routes: constantRoutes // æ‰€æœ‰äººé»˜è®¤æ‹¥æœ‰é™æ€è·¯ç”±
}
const mutations = {
  // newRouteså¯ä»¥è®¤ä¸ºæ˜¯ ç”¨æˆ·ç™»å½• é€šè¿‡æƒé™æ‰€å¾—åˆ°çš„åŠ¨æ€è·¯ç”±çš„éƒ¨åˆ†
  setRoutes(state, newRoutes) {
    // ä¸‹é¢è¿™ä¹ˆå†™ä¸å¯¹ ä¸æ˜¯è¯­æ³•ä¸å¯¹ æ˜¯ä¸šåŠ¡ä¸å¯¹
    // state.routes = [...state.routes, ...newRoutes]
    // æœ‰ä¸€ç§æƒ…å†µ  å¼ ä¸‰ ç™»å½• è·å–äº†åŠ¨æ€è·¯ç”± è¿½åŠ åˆ°è·¯ç”±ä¸Š  æå››ç™»å½• 4ä¸ªåŠ¨æ€è·¯ç”±
    // åº”è¯¥æ˜¯æ¯æ¬¡æ›´æ–° éƒ½åº”è¯¥åœ¨é™æ€è·¯ç”±çš„åŸºç¡€ä¸Šè¿›è¡Œè¿½åŠ 
    state.routes = [...constantRoutes, ...newRoutes]
  }
}
const actions = {}
export default {
  namespaced: true,
  state,
  mutations,
  actions
}

```

åœ¨Vuexç®¡ç†æ¨¡å—ä¸­å¼•å…¥permissonæ¨¡å—

```js
import permission from './modules/permission'
	
const store = new Vuex.Store({
  modules: {
    // å­æ¨¡å—   $store.state.app.
    // mapGetters([])
    app,
    settings,
    user,
    permission
  },
  getters
})
```

### Vuexç­›é€‰æƒé™è·¯ç”±

> å®ç°æƒé™æ ¡éªŒçš„æ•´ä½“æ€è·¯ï¼š
>
> 
>
> 1ã€åœ¨è·å–ä¿¡æ¯çš„åœ°æ–¹åšæ‹¦æˆª(vuexè·¯ç”±å‰ç½®å¯¼èˆªå®ˆå«)
>
> 
>
> 2ã€è·å–åˆ°ç”¨æˆ·çš„è§’è‰²ä¿¡æ¯ä¹‹åï¼Œä¼ å…¥åˆ°actionè¿›è¡Œå¤„ç†(è¿›è¡ŒåŠ¨æ€æƒé™çš„åˆå¹¶)
>
> â€‹	1ã€ä»ç”¨æˆ·çš„menusæƒé™ä¸­ç­›é€‰å‡ºåŠ¨æ€è·¯ç”±ä¸­çš„è·¯ç”±ä¿¡æ¯æ•°æ®ï¼Œç„¶åå’Œé™æ€è·¯ç”±åˆå¹¶åˆ°vuexçš„stateçŠ¶æ€å†…éƒ¨
>
> â€‹	2ã€åŒæ—¶æŠŠåˆå¹¶å¥½çš„routersä¿¡æ¯è¿”å›å›å»å¯ä»¥åœ¨å‰ç½®å®ˆå«ä¸­è¿›è¡Œè·¯ç”±ä¿¡æ¯çš„åˆ¤æ–­
>
> 3ã€è·¯ç”±åŠ«æŒçš„åœ°æ–¹ï¼Œè·å–åˆ°actionå†…éƒ¨çš„è·¯ç”±ä¿¡æ¯ï¼Œç„¶ååœ¨è·¯ç”±åŠ«æŒçš„åœ°æ–¹è¿›è¡Œ`router.addRoutes([...routes, { path: '*', redirect: '/404', hidden: true }])`
>
> 4ã€addå®Œæˆä¹‹åç«‹é©¬next(to.path) è¿›è¡Œä¸€æ¬¡è·³è½¬
>
> 
>
> 5ã€å·¦ä¾§å¯¼èˆªå±•ç¤ºæ•ˆæœï¼šæŠŠvuexä¸­çš„routeræ–°å»ºå¿«æ·è®¿é—®å…¥å£ï¼Œåœ¨siderbarç»„ä»¶ä¸­è¿›è¡Œå¼•å…¥ï¼Œå¯ä»¥æ¸²æŸ“å·¦ä¾§èœå•é€‰é¡¹

>  OKï¼Œ é‚£ä¹ˆæˆ‘ä»¬åœ¨å“ªå°†ç”¨æˆ·çš„æ ‡è¯†å’Œæƒé™è¿›è¡Œå…³è”å‘¢ ï¼Ÿ

![image-20200815184203715](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20200815184203715.png)

æˆ‘ä»¬å¯ä»¥åœ¨è¿™å¼ å›¾ä¸­ï¼Œè¿›ä¸€æ­¥çš„è¿›è¡Œæ“ä½œ

![image-20200815184407204](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20200815184407204.png)



è®¿é—®æƒé™çš„æ•°æ®åœ¨ç”¨æˆ·å±æ€§**`menus`**ä¸­ï¼Œ**`menus`**ä¸­çš„æ ‡è¯†è¯¥æ€ä¹ˆå’Œè·¯ç”±å¯¹åº”å‘¢ï¼Ÿ

![image-20200815185230597](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20200815185230597.png)

>   å¯ä»¥å°†è·¯ç”±æ¨¡å—çš„æ ¹èŠ‚ç‚¹**`name`**å±æ€§å‘½åå’Œæƒé™æ ‡è¯†ä¸€è‡´ï¼Œè¿™æ ·åªè¦æ ‡è¯†èƒ½å¯¹ä¸Šï¼Œå°±è¯´æ˜ç”¨æˆ·æ‹¥æœ‰äº†è¯¥æƒé™

è¿™ä¸€æ­¥ï¼Œåœ¨æˆ‘ä»¬å‘½åè·¯ç”±çš„æ—¶å€™å·²ç»æ“ä½œè¿‡äº†

![image-20200730011629326](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20200730011629326.png)

æ¥ä¸‹æ¥ï¼Œ vuexçš„permissionä¸­æä¾›ä¸€ä¸ªactionï¼Œè¿›è¡Œå…³è”

```js
import { asyncRoutes, constantRoutes } from '@/router'

const actions = {
  // ç­›é€‰æƒé™è·¯ç”±
  // ç¬¬äºŒä¸ªå‚æ•°ä¸ºå½“å‰ç”¨æˆ·çš„æ‰€æ‹¥æœ‰çš„èœå•æƒé™
  // menus: ["settings","permissions"]
  // asyncRoutesæ˜¯æ‰€æœ‰çš„åŠ¨æ€è·¯ç”±
  // asyncRoutes  [{path: 'setting',name: 'setting'},{}]
  filterRoutes(context, menus) {
    const routes = []
    //   ç­›é€‰å‡º åŠ¨æ€è·¯ç”±ä¸­å’Œmenusä¸­èƒ½å¤Ÿå¯¹ä¸Šçš„è·¯ç”±
    menus.forEach(key => {
      // keyå°±æ˜¯æ ‡è¯†
      // asyncRoutes æ‰¾ æœ‰æ²¡æœ‰å¯¹è±¡ä¸­çš„nameå±æ€§ç­‰äº keyçš„ å¦‚æœæ‰¾ä¸åˆ°å°±æ²¡æƒé™ å¦‚æœæ‰¾åˆ°äº† è¦ç­›é€‰å‡ºæ¥
      routes.push(...asyncRoutes.filter(item => item.name === key)) // å¾—åˆ°ä¸€ä¸ªæ•°ç»„ æœ‰å¯èƒ½ æœ‰å…ƒç´  ä¹Ÿæœ‰å¯èƒ½æ˜¯ç©ºæ•°ç»„
    })
    // å¾—åˆ°çš„routesæ˜¯æ‰€æœ‰æ¨¡å—ä¸­æ»¡è¶³æƒé™è¦æ±‚çš„è·¯ç”±æ•°ç»„
    // routeså°±æ˜¯å½“å‰ç”¨æˆ·æ‰€æ‹¥æœ‰çš„ åŠ¨æ€è·¯ç”±çš„æƒé™
    context.commit('setRoutes', routes) // å°†åŠ¨æ€è·¯ç”±æäº¤ç»™mutations
    return routes // è¿™é‡Œä¸ºä»€ä¹ˆè¿˜è¦return  stateæ•°æ® æ˜¯ç”¨æ¥ æ˜¾ç¤ºå·¦ä¾§èœå•ç”¨çš„  return  æ˜¯ç»™è·¯ç”±addRoutesç”¨çš„
  }
```

### æƒé™æ‹¦æˆªå‡ºè°ƒç”¨ç­›é€‰æƒé™Action

åœ¨æ‹¦æˆªçš„ä½ç½®ï¼Œè°ƒç”¨å…³è”actionï¼Œ è·å–æ–°å¢routesï¼Œå¹¶ä¸”**addRoutes**

```js
// æƒé™æ‹¦æˆªåœ¨è·¯ç”±è·³è½¬  å¯¼èˆªå®ˆå«

import router from '@/router'
import store from '@/store' // å¼•å…¥storeå®ä¾‹ å’Œç»„ä»¶ä¸­çš„this.$storeæ˜¯ä¸€å›äº‹
import nprogress from 'nprogress' // å¼•å…¥è¿›åº¦æ¡
import 'nprogress/nprogress.css' // å¼•å…¥è¿›åº¦æ¡æ ·å¼
// ä¸éœ€è¦å¯¼å‡º  å› ä¸ºåªéœ€è¦è®©ä»£ç æ‰§è¡Œå³å¯
// å‰ç½®å®ˆå«
// nextæ˜¯å‰ç½®å®ˆå«å¿…é¡»å¿…é¡»å¿…é¡»æ‰§è¡Œçš„é’©å­  nextå¿…é¡»æ‰§è¡Œ å¦‚æœä¸æ‰§è¡Œ é¡µé¢å°±æ­»äº†
// next()  æ”¾è¿‡
// next(false) è·³è½¬ç»ˆæ­¢
// next(åœ°å€) è·³è½¬åˆ°æŸä¸ªåœ°å€
const whiteList = ['/login', '/404'] // å®šä¹‰ç™½åå•
router.beforeEach(async(to, from, next) => {
  nprogress.start() // å¼€å¯è¿›åº¦æ¡çš„æ„æ€
  if (store.getters.token) {
    // åªæœ‰æœ‰tokençš„æƒ…å†µä¸‹ æ‰èƒ½è·å–èµ„æ–™
    //   å¦‚æœæœ‰token
    if (to.path === '/login') {
      // å¦‚æœè¦è®¿é—®çš„æ˜¯ ç™»å½•é¡µ
      next('/') // è·³åˆ°ä¸»é¡µ  // æœ‰token ç”¨å¤„ç†å—ï¼Ÿä¸ç”¨
    } else {
      // åªæœ‰æ”¾è¿‡çš„æ—¶å€™æ‰å»è·å–ç”¨æˆ·èµ„æ–™
      // æ˜¯æ¯æ¬¡éƒ½è·å–å—
      // å¦‚æœå½“å‰vuexä¸­æœ‰ç”¨æˆ·çš„èµ„æ–™çš„id è¡¨ç¤º å·²ç»æœ‰èµ„æ–™äº† ä¸éœ€è¦è·å–äº† å¦‚æœæ²¡æœ‰idæ‰éœ€è¦è·å–
      if (!store.getters.userId) {
        // å¦‚æœæ²¡æœ‰idæ‰è¡¨ç¤ºå½“å‰ç”¨æˆ·èµ„æ–™æ²¡æœ‰è·å–è¿‡
        // async å‡½æ•°æ‰€returnçš„å†…å®¹ ç”¨ awaitå°±å¯ä»¥æ¥æ”¶åˆ°
        const { roles } = await store.dispatch('user/getUserInfo')
        // å¦‚æœè¯´åç»­ éœ€è¦æ ¹æ®ç”¨æˆ·èµ„æ–™è·å–æ•°æ®çš„è¯ è¿™é‡Œå¿…é¡»æ”¹æˆ åŒæ­¥
        // ç­›é€‰ç”¨æˆ·çš„å¯ç”¨è·¯ç”±
        // actionsä¸­å‡½æ•° é»˜è®¤æ˜¯Promiseå¯¹è±¡ è°ƒç”¨è¿™ä¸ªå¯¹è±¡ æƒ³è¦è·å–è¿”å›çš„å€¼è¯ å¿…é¡» åŠ  awaitæˆ–è€…æ˜¯then
        // actionsæ˜¯åšå¼‚æ­¥æ“ä½œçš„
        const routes = await store.dispatch('permission/filterRoutes', roles.menus)
        // routeså°±æ˜¯ç­›é€‰å¾—åˆ°çš„åŠ¨æ€è·¯ç”±
        // åŠ¨æ€è·¯ç”± æ·»åŠ åˆ° è·¯ç”±è¡¨ä¸­ é»˜è®¤çš„è·¯ç”±è¡¨ åªæœ‰é™æ€è·¯ç”± æ²¡æœ‰åŠ¨æ€è·¯ç”±
        // addRoutes  å¿…é¡» ç”¨ next(åœ°å€) ä¸èƒ½ç”¨next()
        router.addRoutes(routes) // æ·»åŠ åŠ¨æ€è·¯ç”±åˆ°è·¯ç”±è¡¨  é“ºè·¯
        // æ·»åŠ å®ŒåŠ¨æ€è·¯ç”±ä¹‹å
        next(to.path) // ç›¸å½“äºè·³åˆ°å¯¹åº”çš„åœ°å€  ç›¸å½“äºå¤šåšä¸€æ¬¡è·³è½¬ ä¸ºä»€ä¹ˆè¦å¤šåšä¸€æ¬¡è·³è½¬
        // è¿›é—¨äº†ï¼Œä½†æ˜¯è¿›é—¨ä¹‹åæˆ‘è¦å»çš„åœ°æ–¹çš„è·¯è¿˜æ²¡æœ‰é“ºå¥½ï¼Œç›´æ¥èµ°ï¼Œæ‰å‘é‡Œï¼Œå¤šåšä¸€æ¬¡è·³è½¬ï¼Œå†ä»é—¨å¤–å¾€é‡Œè¿›ä¸€æ¬¡ï¼Œè·³è½¬ä¹‹å‰ æŠŠè·¯é“ºå¥½ï¼Œå†æ¬¡è¿›æ¥çš„æ—¶å€™ï¼Œè·¯å°±é“ºå¥½äº†
      } else {
        next()
      }
    }
  } else {
    //   æ²¡æœ‰tokençš„æƒ…å†µä¸‹
    if (whiteList.indexOf(to.path) > -1) {
      //  è¡¨ç¤ºè¦å»çš„åœ°å€åœ¨ç™½åå•
      next()
    } else {
      next('/login')
    }
  }
  nprogress.done() // è§£å†³æ‰‹åŠ¨åˆ‡æ¢åœ°å€æ—¶ è¿›åº¦æ¡ä¸å…³é—­çš„é—®é¢˜
})
// åç½®å®ˆå«
router.afterEach(() => {
  nprogress.done() // å…³é—­è¿›åº¦æ¡
})

```

### é™æ€è·¯ç”±åŠ¨æ€è·¯ç”±è§£é™¤åˆå¹¶

**æ³¨æ„**ï¼š è¿™é‡Œæœ‰ä¸ªéå¸¸å®¹æ˜“å‡ºé—®é¢˜çš„ä½ç½®ï¼Œå½“æˆ‘ä»¬åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å·²ç»æ·»åŠ è·¯ç”±çš„å‰åï¼Œä¸èƒ½éƒ½æ˜¯ç”¨**next()**ï¼Œ

åœ¨æ·»åŠ è·¯ç”±ä¹‹ååº”è¯¥ä½¿ç”¨ **next(to.path)**ï¼Œ å¦åˆ™ä¼šä½¿åˆ·æ–°é¡µé¢ä¹‹å æƒé™æ¶ˆå¤±ï¼Œè¿™å±äºä¸€ä¸ªvue-routerçš„**å·²çŸ¥ç¼ºé™·**

åŒæ—¶ï¼Œä¸è¦å¿˜è®°ï¼Œæˆ‘ä»¬å°†åŸæ¥çš„é™æ€è·¯ç”± + åŠ¨æ€è·¯ç”±åˆä½“çš„æ¨¡å¼ æ”¹æˆ åªæœ‰é™æ€è·¯ç”±  **`src/router/index.js`**

![image-20200730012805239](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20200730012805239.png)



>   æ­¤æ—¶ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†æƒé™è®¾ç½®çš„ä¸€åŠï¼Œ æ­¤æ—¶æˆ‘ä»¬å‘ç°å·¦ä¾§èœå•å¤±å»äº†å†…å®¹ï¼Œè¿™æ˜¯å› ä¸ºå·¦ä¾§èœå•è¯»å–çš„æ˜¯å›ºå®šçš„è·¯ç”±ï¼Œæˆ‘ä»¬è¦æŠŠå®ƒæ¢æˆå®æ—¶çš„æœ€æ–°è·¯ç”±

åœ¨**`src/store/getters.js`**é…ç½®å¯¼å‡ºroutes

```js
const getters = {
  sidebar: state => state.app.sidebar,
  device: state => state.app.device,
  token: state => state.user.token,
  name: state => state.user.userInfo.username, // å»ºç«‹ç”¨æˆ·åç§°çš„æ˜ å°„
  userId: state => state.user.userInfo.userId, // å»ºç«‹ç”¨æˆ·idçš„æ˜ å°„
  companyId: state => state.user.userInfo.companyId, // å»ºç«‹ç”¨æˆ·çš„å…¬å¸Idæ˜ å°„
  routes: state => state.permission.routes // å¯¼å‡ºå½“å‰çš„è·¯ç”±
}
export default getters

```

åœ¨å·¦ä¾§èœå•ç»„ä»¶ä¸­ï¼Œ å¼•å…¥routes

æŠŠå·¦ä¾§èœå•éå†çš„æ•°æ®æ›¿æ¢æˆvuexä¸­çš„æ•°æ®

```js
  computed: {
    ...mapGetters([
      'sidebar',
      'routes'
    ]),
```

>  OKï¼Œåˆ°ç°åœ¨ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥å®ç°ä¸åŒç”¨æˆ·ç™»å½•çš„æ—¶å€™ï¼Œèœå•æ˜¯åŠ¨æ€çš„äº†

**æäº¤ä»£ç **

**`æœ¬èŠ‚ä»»åŠ¡`** å‰ç«¯æƒé™åº”ç”¨-é¡µé¢è®¿é—®å’Œèœå•



## ç™»å‡ºæ—¶ï¼Œé‡ç½®è·¯ç”±æƒé™å’Œ 404é—®é¢˜

**ç›®æ ‡**ï¼š å¤„ç†å½“ç™»å‡ºé¡µé¢æ—¶ï¼Œè·¯ç”±ä¸æ­£ç¡®çš„é—®é¢˜

>  ä¸Šä¸€å°èŠ‚ï¼Œæˆ‘ä»¬çœ‹ä¼¼å®Œæˆäº†è®¿é—®æƒé™çš„åŠŸèƒ½ï¼Œå®åˆ™ä¸ç„¶ï¼Œå› ä¸ºå½“æˆ‘ä»¬ç™»å‡ºæ“ä½œä¹‹åï¼Œè™½ç„¶çœ‹ä¸åˆ°èœå•ï¼Œä½†æ˜¯ç”¨æˆ·å®é™…ä¸Šå¯ä»¥è®¿é—®é¡µé¢ï¼Œç›´æ¥åœ¨åœ°å€æ è¾“å…¥åœ°å€å°±èƒ½è®¿é—®

è¿™æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ

>  è¿™æ˜¯å› ä¸ºæˆ‘ä»¬å‰é¢åœ¨**addRoutes**çš„æ—¶å€™ï¼Œä¸€ç›´éƒ½æ˜¯åœ¨**åŠ **ï¼Œç™»å‡ºçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰åˆ ï¼Œä¹Ÿæ²¡æœ‰é‡ç½®ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬ä¹‹å‰åŠ çš„è·¯ç”±åœ¨ç™»å‡ºä¹‹åä¸€ç›´åœ¨ï¼Œè¿™æ€ä¹ˆå¤„ç†ï¼Ÿ

å¤§å®¶ç•™æ„æˆ‘ä»¬çš„**router/index.js**æ–‡ä»¶ï¼Œå‘ç°ä¸€ä¸ªé‡ç½®è·¯ç”±æ–¹æ³•

```js
// é‡ç½®è·¯ç”±
export function resetRouter() {
  const newRouter = createRouter()
  router.matcher = newRouter.matcher // é‡æ–°è®¾ç½®è·¯ç”±çš„å¯åŒ¹é…è·¯å¾„
}
```

æ²¡é”™ï¼Œè¿™ä¸ªæ–¹æ³•å°±æ˜¯å°†è·¯ç”±é‡æ–°å®ä¾‹åŒ–ï¼Œç›¸å½“äºæ¢äº†ä¸€ä¸ªæ–°çš„è·¯ç”±ï¼Œä¹‹å‰**`åŠ çš„è·¯ç”±`**è‡ªç„¶ä¸å­˜åœ¨äº†ï¼Œåªéœ€è¦åœ¨ç™»å‡ºçš„æ—¶å€™ï¼Œ å¤„ç†ä¸€ä¸‹å³å¯



é€€å‡ºç™»å½•çš„æ—¶å€™éœ€è¦åšçš„äº‹æƒ…ï¼š

>1ã€é‡ç½®è·¯ç”±çš„åŒ¹é…ä¿¡æ¯
>
>
>
>2ã€é‡ç½®vuexä¸­çš„è·¯ç”±ä¿¡æ¯

```js
  // ç™»å‡ºçš„action
  lgout(context) {
    // åˆ é™¤token
    context.commit('removeToken') // ä¸ä»…ä»…åˆ é™¤äº†vuexä¸­çš„ è¿˜åˆ é™¤äº†ç¼“å­˜ä¸­çš„
    // åˆ é™¤ç”¨æˆ·èµ„æ–™
    context.commit('removeUserInfo') // åˆ é™¤ç”¨æˆ·ä¿¡æ¯
    // é‡ç½®è·¯ç”±
    resetRouter()
    // è¿˜æœ‰ä¸€æ­¥  vuexä¸­çš„æ•°æ®æ˜¯ä¸æ˜¯è¿˜åœ¨
    // è¦æ¸…ç©ºpermissionæ¨¡å—ä¸‹çš„stateæ•°æ®
    // vuexä¸­ userå­æ¨¡å—  permissionå­æ¨¡å—
    // å­æ¨¡å—è°ƒç”¨å­æ¨¡å—çš„action  é»˜è®¤æƒ…å†µä¸‹ å­æ¨¡å—çš„contextæ˜¯å­æ¨¡å—çš„
    // çˆ¶æ¨¡å— è°ƒç”¨ å­æ¨¡å—çš„action
    context.commit('permission/setRoutes', [], { root: true })
    // å­æ¨¡å—è°ƒç”¨å­æ¨¡å—çš„action å¯ä»¥ å°† commitçš„ç¬¬ä¸‰ä¸ªå‚æ•° è®¾ç½®æˆ  { root: true } å°±è¡¨ç¤ºå½“å‰çš„contextä¸æ˜¯å­æ¨¡å—äº† è€Œæ˜¯çˆ¶æ¨¡å—
  }
```

é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬å‘ç°åœ¨é¡µé¢åˆ·æ–°çš„æ—¶å€™ï¼Œæœ¬æ¥åº”è¯¥æ‹¥æœ‰æƒé™çš„é¡µé¢å‡ºç°äº†404ï¼Œè¿™æ˜¯å› ä¸º404çš„åŒ¹é…æƒé™æ”¾åœ¨äº†é™æ€è·¯ç”±ï¼Œè€ŒåŠ¨æ€è·¯ç”±åœ¨æ²¡æœ‰addRoutesä¹‹å‰ï¼Œæ‰¾ä¸åˆ°å¯¹åº”çš„åœ°å€ï¼Œå°±ä¼šæ˜¾ç¤º404ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†404æ”¾ç½®åˆ°åŠ¨æ€è·¯ç”±çš„æœ€å

**`src/permission.js`**

```js
router.addRoutes([...routes, { path: '*', redirect: '/404', hidden: true }]) // æ·»åŠ åˆ°è·¯ç”±è¡¨
```

**æäº¤ä»£ç **

## åŠŸèƒ½æƒé™åº”ç”¨

**ç›®æ ‡**ï¼š å®ç°åŠŸèƒ½æƒé™çš„åº”ç”¨

### åŠŸèƒ½æƒé™çš„å—æ§æ€è·¯

>  ä¸Šå°èŠ‚ä¸­ï¼Œå½“æˆ‘ä»¬æ‹¥æœ‰äº†ä¸€ä¸ªæ¨¡å—ï¼Œä¸€ä¸ªé¡µé¢çš„è®¿é—®æƒé™ä¹‹åï¼Œé¡µé¢ä¸­çš„æŸäº›åŠŸèƒ½ï¼Œç”¨æˆ·å¯èƒ½æœ‰ï¼Œä¹Ÿå¯èƒ½æ²¡æœ‰ï¼Œè¿™å°±æ˜¯åŠŸèƒ½æƒé™

è¿™å°±æ˜¯ä¸Šå°èŠ‚ï¼ŒæŸ¥è¯¢å‡ºæ¥çš„æ•°æ®ä¸­çš„**`points`**

>  æ¯”å¦‚ï¼Œæˆ‘ä»¬æƒ³å¯¹å‘˜å·¥ç®¡ç†çš„åˆ é™¤åŠŸèƒ½åšä¸ªæƒé™æ€ä¹ˆåšï¼Ÿ

é¦–å…ˆéœ€è¦åœ¨å‘˜å·¥ç®¡ç†çš„æƒé™ç‚¹ä¸‹ï¼Œ æ–°å¢ä¸€ä¸ªåˆ é™¤æƒé™ç‚¹ï¼Œå¯ç”¨

![image-20200730020732919](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20200730020732919.png)

>   æˆ‘ä»¬è¦åšçš„å°±æ˜¯çœ‹çœ‹ç”¨æˆ·ï¼Œæ˜¯å¦æ‹¥æœ‰**point-user-delete**è¿™ä¸ªpointï¼Œæœ‰å°±å¯ä»¥è®©åˆ é™¤èƒ½ç”¨ï¼Œæ²¡æœ‰å°±éšè—æˆ–è€…ç¦ç”¨

### ä½¿ç”¨MixinæŠ€æœ¯å°†æ£€æŸ¥æ–¹æ³•æ³¨å…¥

æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨ä¸€ä¸ªæ–°çš„æŠ€æœ¯ [mixin(æ··å…¥)](https://cn.vuejs.org/v2/guide/mixins.html)æ¥è®©æ‰€æœ‰çš„ç»„ä»¶å¯ä»¥æ‹¥æœ‰ä¸€ä¸ªå…¬å…±çš„æ–¹æ³•

**`src/mixin/checkPermission.js`**

```js
import store from '@/store'
export default {
  methods: {
    checkPermission(key) {
      const { userInfo } = store.state.user
      if (userInfo.roles.points && userInfo.roles.points.length) {
        return userInfo.roles.points.some(item => item === key)
      }
      return false
    }
  }
}

```



**åœ¨å‘˜å·¥ç»„ä»¶ä¸­æ£€æŸ¥æƒé™ç‚¹**

```vue
 <el-button :disabled="!checkPermission('POINT-USER-UPDATE')" type="text" size="small" @click="$router.push(`/employees/detail/${obj.row.id}`)">æŸ¥çœ‹</el-button>

```

æ­¤æ—¶ï¼Œå¯ä»¥é€šè¿‡é…ç½®æƒé™çš„æ–¹å¼ï¼Œæ£€æŸ¥æƒé™çš„å¯ç”¨æ€§äº†

:::details mixinç”¨æ³•

> æ··å…¥ (mixin) æä¾›äº†ä¸€ç§éå¸¸çµæ´»çš„æ–¹å¼ï¼Œæ¥åˆ†å‘ Vue ç»„ä»¶ä¸­çš„å¯å¤ç”¨åŠŸèƒ½ã€‚ä¸€ä¸ªæ··å…¥å¯¹è±¡å¯ä»¥åŒ…å«ä»»æ„ç»„ä»¶é€‰é¡¹ã€‚å½“ç»„ä»¶ä½¿ç”¨æ··å…¥å¯¹è±¡æ—¶ï¼Œæ‰€æœ‰æ··å…¥å¯¹è±¡çš„é€‰é¡¹å°†è¢«â€œæ··åˆâ€è¿›å…¥è¯¥ç»„ä»¶æœ¬èº«çš„é€‰é¡¹ã€‚

ä¾‹å­ï¼š

```js
// å®šä¹‰ä¸€ä¸ªæ··å…¥å¯¹è±¡
var myMixin = {
  created: function () {
    this.hello()
  },
  methods: {
    hello: function () {
      console.log('hello from mixin!')
    }
  }
}

export default {
  mixins: [myMixin]
}
```

### æ³¨æ„

1. å½“ç»„ä»¶å’Œæ··å…¥å¯¹è±¡å«æœ‰åŒåé€‰é¡¹æ—¶ï¼Œè¿™äº›é€‰é¡¹å°†ä»¥æ°å½“çš„æ–¹å¼è¿›è¡Œâ€œåˆå¹¶â€ã€‚æ¯”å¦‚ï¼Œæ•°æ®å¯¹è±¡åœ¨å†…éƒ¨ä¼šè¿›è¡Œé€’å½’åˆå¹¶ï¼Œå¹¶åœ¨å‘ç”Ÿå†²çªæ—¶ä»¥ç»„ä»¶æ•°æ®ä¼˜å…ˆã€‚



2. åŒåé’©å­å‡½æ•°å°†åˆå¹¶ä¸ºä¸€ä¸ªæ•°ç»„ï¼Œå› æ­¤éƒ½å°†è¢«è°ƒç”¨ã€‚å¦å¤–ï¼Œæ··å…¥å¯¹è±¡çš„é’©å­å°†åœ¨ç»„ä»¶è‡ªèº«é’©å­**ä¹‹å‰**è°ƒç”¨ã€‚

```js
var mixin = {
  data: function () {
    return {
      message: 'hello',
      foo: 'abc'
    }
  }
}

new Vue({
  mixins: [mixin],
  data: function () {
    return {
      message: 'goodbye',
      bar: 'def'
    }
  },
  created: function () {
    console.log(this.$data)
    // => { message: "goodbye", foo: "abc", bar: "def" }
  }
})
```

:::

**æäº¤ä»£ç **

