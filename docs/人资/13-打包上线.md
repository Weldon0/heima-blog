---
title: ğŸ“š 13-æ‰“åŒ…ä¸Šçº¿
---
## **æ‰“åŒ…ä¹‹å‰çš„è·¯ç”±æ¨¡å¼**

**`ç›®æ ‡`**é…ç½®æ‰“åŒ…ä¹‹å‰çš„è·¯ç”±æ¨¡å¼

> åœ¨SPAå•é¡µåº”ç”¨ä¸­ï¼Œæœ‰ä¸¤ç§è·¯ç”±æ¨¡å¼

**hashæ¨¡å¼** ï¼š #åé¢æ˜¯è·¯ç”±è·¯å¾„ï¼Œç‰¹ç‚¹æ˜¯å‰ç«¯è®¿é—®ï¼Œ#åé¢çš„å˜åŒ–ä¸ä¼šç»è¿‡æœåŠ¡å™¨

**historyæ¨¡å¼**ï¼šæ­£å¸¸çš„/è®¿é—®æ¨¡å¼ï¼Œç‰¹ç‚¹æ˜¯åç«¯è®¿é—®ï¼Œä»»æ„åœ°å€çš„å˜åŒ–éƒ½ä¼šè®¿é—®æœåŠ¡å™¨

> å¼€å‘åˆ°ç°åœ¨ï¼Œæˆ‘ä»¬ä¸€ç›´éƒ½åœ¨ç”¨hashæ¨¡å¼ï¼Œæ‰“åŒ…æˆ‘ä»¬å°è¯•ç”¨historyæ¨¡å¼

æ”¹æˆhistoryæ¨¡å¼éå¸¸ç®€å•ï¼Œåªéœ€è¦å°†è·¯ç”±çš„modeç±»å‹æ”¹æˆhistoryå³å¯

```js
const createRouter = () => new Router({
  mode: 'history', // require service support
  scrollBehavior: () => ({ y: 0 }), // ç®¡ç†æ»šåŠ¨è¡Œä¸º å¦‚æœå‡ºç°æ»šåŠ¨ åˆ‡æ¢å°±è®© è®©é¡µé¢å›åˆ°é¡¶éƒ¨
  routes: [...constantRoutes] // æ”¹æˆåªæœ‰é™æ€è·¯ç”±`
})
```

> å‡è®¾æˆ‘ä»¬çš„åœ°å€æ˜¯è¿™æ ·çš„  **`www.xxxx/com/hr`**/a **`www.xxxx/com/hr`**/b

æˆ‘ä»¬ä¼šå‘ç°ï¼Œå…¶å®åŸŸåæ˜¯**`www.xxxx/com`**ï¼Œhræ˜¯ç‰¹å®šçš„å‰ç¼€åœ°å€ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥é…ç½®ä¸€ä¸ªbaseå±æ€§ï¼Œé…ç½®ä¸ºhr

```js
const createRouter = () => new Router({
  mode: 'history', // require service support
  base: '/hr/', // é…ç½®é¡¹ç›®çš„åŸºç¡€åœ°å€
  scrollBehavior: () => ({ y: 0 }), // ç®¡ç†æ»šåŠ¨è¡Œä¸º å¦‚æœå‡ºç°æ»šåŠ¨ åˆ‡æ¢å°±è®© è®©é¡µé¢å›åˆ°é¡¶éƒ¨
  routes: [...constantRoutes] // æ”¹æˆåªæœ‰é™æ€è·¯ç”±
})
```

æ­¤æ—¶ï¼Œæˆ‘ä»¬ä¼šå‘ç°åœ°å€å·²ç»å˜æˆæˆ‘ä»¬æƒ³è¦çš„æ ·å­äº†

![image-20200804014626686](assets/image-20200804014626686.png)

**æäº¤ä»£ç **

## æ€§èƒ½åˆ†æå’ŒCDNçš„åº”ç”¨

**`ç›®æ ‡`**ï¼š å¯¹å¼€å‘çš„åº”ç”¨è¿›è¡Œæ€§èƒ½åˆ†æå’ŒCDNçš„åº”ç”¨

### æ€§èƒ½åˆ†æ

> æˆ‘ä»¬é›†æˆäº† åŠŸèƒ½ï¼Œå†™äº†å¾ˆå¤šç»„ä»¶ï¼Œæœ€ç»ˆéƒ½ä¼šæ‰“åŒ…æˆä¸€å †æ–‡ä»¶ï¼Œé‚£ä¹ˆçœŸå®è¿è¡Œçš„æ€§èƒ½å¦‚ä½•å‘¢ï¼Ÿ

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨vue-cliæœ¬èº«æä¾›çš„æ€§èƒ½åˆ†æå·¥å…·ï¼Œå¯¹æˆ‘ä»¬å¼€å‘çš„æ‰€æœ‰åŠŸèƒ½è¿›è¡Œæ‰“åŒ…åˆ†æ

å®ƒçš„åº”ç”¨éå¸¸ç®€å•

```bash
$ npm run preview -- --report
```

è¿™ä¸ªå‘½ä»¤ä¼šä»æˆ‘ä»¬çš„**`å…¥å£main.js`**è¿›è¡Œä¾èµ–åˆ†æï¼Œåˆ†æå‡ºæœ€å¤§çš„åŒ…ï¼Œæ–¹ä¾¿æˆ‘ä»¬è¿›è¡Œè§‚å¯Ÿå’Œä¼˜åŒ–

æ‰§è¡Œå®Œè¿™ä¸ªå‘½ä»¤ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°å¦‚ä¸‹çš„é¡µé¢

![image-20200804015849396](assets/image-20200804015849396.png)

å¦‚å›¾æ‰€ä»¥ï¼Œæ–¹å—è¶Šå¤§ï¼Œè¯´æ˜è¯¥æ–‡ä»¶å ç”¨çš„æ–‡ä»¶è¶Šå¤§ï¼Œæ–‡ä»¶è¶Šå¤§ï¼Œå¯¹äºç½‘ç»œå¸¦å®½å’Œè®¿é—®é€Ÿåº¦çš„è¦æ±‚å°±è¶Šé«˜ï¼Œè¿™ä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¼˜åŒ–çš„æ–¹å‘

> åƒè¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬æ€ä¹ˆä¼˜åŒ–ä¸€ä¸‹å‘¢

### webpackæ’é™¤æ‰“åŒ…

CDNæ˜¯ä¸€ä¸ªæ¯”è¾ƒå¥½çš„æ–¹å¼

> æ–‡ä»¶ä¸æ˜¯å¤§å—ï¼Ÿæˆ‘ä»¬å°±ä¸è¦æŠŠè¿™äº›å¤§çš„æ–‡ä»¶å’Œé‚£äº›å°çš„æ–‡ä»¶æ‰“åŒ…åˆ°ä¸€èµ·äº†ï¼Œåƒè¿™ç§xlsx,elementè¿™ç§åŠŸèƒ½æ€§å¾ˆå…¨çš„æ’ä»¶ï¼Œ
>
> æˆ‘ä»¬å¯ä»¥æ”¾åˆ°CDNæœåŠ¡å™¨ä¸Šï¼Œä¸€æ¥ï¼Œå‡è½»æ•´ä½“åŒ…çš„å¤§å°ï¼ŒäºŒæ¥CDNçš„åŠ é€ŸæœåŠ¡å¯ä»¥åŠ å¿«æˆ‘ä»¬å¯¹äºæ’ä»¶çš„è®¿é—®é€Ÿåº¦

**ä½¿ç”¨æ–¹å¼**

å…ˆæ‰¾åˆ° `vue.config.js`ï¼Œ æ·»åŠ  `externals` è®© `webpack` ä¸æ‰“åŒ… `xlsx` å’Œ `element`   

**`vue.config.js`** ==> configureWebpackä¸‹é¢

```js
 // æ’é™¤ elementUI xlsx  å’Œ vue 
  externals:
      {
        'vue': 'Vue',
        'element-ui': 'ELEMENT',
        'xlsx': 'XLSX'
     }
```

å†æ¬¡è¿è¡Œï¼Œæˆ‘ä»¬ä¼šå‘ç°åŒ…çš„å¤§å°å·²ç»å¤§å¹…å‡å°

### CDNæ–‡ä»¶é…ç½®

> ä½†æ˜¯ï¼Œæ²¡æœ‰è¢«æ‰“åŒ…çš„å‡ ä¸ªæ¨¡å—æ€ä¹ˆå¤„ç†ï¼Ÿ

å¯ä»¥é‡‡ç”¨CDNçš„æ–¹å¼ï¼Œåœ¨é¡µé¢æ¨¡æ¿ä¸­é¢„å…ˆå¼•å…¥

**`vue.config.js`**

```js
const cdn = {
  css: [
    // element-ui css
    'https://unpkg.com/element-ui/lib/theme-chalk/index.css' // æ ·å¼è¡¨
  ],
  js: [
    // vue must at first!
    'https://unpkg.com/vue@2.6.10/dist/vue.js', // vuejs Vue $ new Vue
    // element-ui js
    'https://unpkg.com/element-ui/lib/index.js', // elementUI
      'https://cdn.jsdelivr.net/npm/xlsx@0.16.6/dist/jszip.min.js',
    'https://cdn.jsdelivr.net/npm/xlsx@0.16.6/dist/xlsx.full.min.js'
  ]
}
```

> ä½†æ˜¯è¯·æ³¨æ„ï¼Œè¿™æ—¶çš„é…ç½®å®é™…ä¸Šæ˜¯å¯¹å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒéƒ½ç”Ÿæ•ˆçš„ï¼Œåœ¨å¼€å‘ç¯å¢ƒæ—¶ï¼Œæ²¡æœ‰å¿…è¦ä½¿ç”¨CDNï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç¯å¢ƒå˜é‡æ¥è¿›è¡ŒåŒºåˆ†

```js
let cdn = { css: [], js: [] }
// é€šè¿‡ç¯å¢ƒå˜é‡ æ¥åŒºåˆ†æ˜¯å¦ä½¿ç”¨cdn
const isProd = process.env.ENV === 'production' // åˆ¤æ–­æ˜¯å¦æ˜¯ç”Ÿäº§ç¯å¢ƒ
let externals = {}
if (isProd) {
  // å¦‚æœæ˜¯ç”Ÿäº§ç¯å¢ƒ å°±æ’é™¤æ‰“åŒ… å¦åˆ™ä¸æ’é™¤
  externals = {
    // key(åŒ…å) / value(è¿™ä¸ªå€¼ æ˜¯ éœ€è¦åœ¨CDNä¸­è·å–js, ç›¸å½“äº è·å–çš„jsä¸­ çš„è¯¥åŒ…çš„å…¨å±€çš„å¯¹è±¡çš„åå­—)
    'vue': 'Vue', // åé¢çš„åå­—ä¸èƒ½éšä¾¿èµ· åº”è¯¥æ˜¯ jsä¸­çš„å…¨å±€å¯¹è±¡å
    'element-ui': 'ELEMENT', // éƒ½æ˜¯jsä¸­å…¨å±€å®šä¹‰çš„
    'xlsx': 'XLSX' // éƒ½æ˜¯jsä¸­å…¨å±€å®šä¹‰çš„
  }
  cdn = {
    css: [
      'https://unpkg.com/element-ui/lib/theme-chalk/index.css' // æå‰å¼•å…¥elementUIæ ·å¼
    ], // æ”¾ç½®cssæ–‡ä»¶ç›®å½•
    js: [
      'https://unpkg.com/vue/dist/vue.js', // vuejs
      'https://unpkg.com/element-ui/lib/index.js', // element
      'https://cdn.jsdelivr.net/npm/xlsx@0.16.6/dist/xlsx.full.min.js', // xlsx ç›¸å…³
      'https://cdn.jsdelivr.net/npm/xlsx@0.16.6/dist/jszip.min.js' // xlsx ç›¸å…³
    ] // æ”¾ç½®jsæ–‡ä»¶ç›®å½•
  }
}
```

### æ³¨å…¥CDNæ–‡ä»¶åˆ°æ¨¡æ¿

ä¹‹åé€šè¿‡ `html-webpack-plugin`æ³¨å…¥åˆ° `index.html`ä¹‹ä¸­:

```js
config.plugin('html').tap(args => {
  args[0].cdn = cdn
  return args
})
```

æ‰¾åˆ° `public/index.html`ã€‚é€šè¿‡ä½ é…ç½®çš„`CDN Config` ä¾æ¬¡æ³¨å…¥ css å’Œ jsã€‚

```vue
<head>
  <!-- å¼•å…¥æ ·å¼ -->
  
  <% for(var css of htmlWebpackPlugin.options.cdn.css) { %>
    <link rel="stylesheet" href="<%=css%>">
  <% } %>
</head>

<!-- å¼•å…¥JS -->
<% for(var js of htmlWebpackPlugin.options.cdn.js) { %>
  <script src="<%=js%>"></script>
<% } %>
```

æœ€åï¼Œè¿›è¡Œæ‰“åŒ… 

```bash
$ npm run build:prod
```

## åœ¨nodejsç¯å¢ƒä¸­åº”ç”¨å¹¶ä»£ç†è·¨åŸŸ

**`ç›®æ ‡`**å°†æ‰“åŒ…å¥½çš„ä»£ç æ‰“åŒ…ä¸Šçº¿ï¼Œå¹¶åœ¨nodejsä¸­ä»£ç†è·¨åŸŸ

### ä½¿ç”¨koaæ¡†æ¶éƒ¨ç½²é¡¹ç›®

> åˆ°ç°åœ¨ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†ä¸€ä¸ªå‰ç«¯å·¥ç¨‹å¸ˆçš„å¼€å‘æµç¨‹ï¼ŒæŒ‰ç…§å¸¸è§„çš„åšæ³•ï¼Œæ­¤æ—¶ï¼Œè¿ç»´ä¼šå°†æˆ‘ä»¬çš„ä»£ç éƒ¨ç½²åˆ°é˜¿é‡Œäº‘çš„ngixæœåŠ¡ä¸Šï¼Œå¯¹äºæˆ‘ä»¬è€Œè¨€ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶éƒ¨ç½²åˆ°æœ¬æœºçš„nodejsç¯å¢ƒä¸­

éƒ¨ç½² è‡ªåŠ¨åŒ–éƒ¨ç½² /æ‰‹åŠ¨éƒ¨ç½²

ç¬¬ä¸€æ­¥ï¼Œå»ºç«‹webæœåŠ¡æ–‡ä»¶å¤¹  **`hrServer`**

```bash 
$ mkdir hrServer #å»ºç«‹hrServeræ–‡ä»¶å¤¹ 
```

ç¬¬äºŒæ­¥ï¼Œåœ¨è¯¥æ–‡ä»¶å¤¹ä¸‹ï¼Œåˆå§‹åŒ–npm

```bash
$ npm init -y
```

ç¬¬ä¸‰æ­¥ï¼Œå®‰è£…æœåŠ¡ç«¯æ¡†æ¶koa(ä¹Ÿå¯ä»¥é‡‡ç”¨expressæˆ–è€…egg)

```bash
$ npm i koa koa-static // express koa
```

ç¬¬å››æ­¥ï¼Œæ‹·è´ä¸Šå°èŠ‚æ‰“åŒ…çš„distç›®å½•åˆ°**`hrServer/public`**ä¸‹

ç¬¬äº”æ­¥ï¼Œåœ¨æ ¹ç›®å½•ä¸‹åˆ›å»ºapp.jsï¼Œä»£ç å¦‚ä¸‹

```js
const Koa  = require('koa')
const serve = require('koa-static');

const app = new Koa();
app.use(serve(__dirname + "/public")); //å°†publicä¸‹çš„ä»£ç é™æ€åŒ–
app.listen(3333, () => {
     console.log('äººèµ„é¡¹ç›®å¯åŠ¨')
})
```

> æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è®¿é—®ï¼Œhttp://localhost:3333

é¡µé¢å‡ºæ¥äº†

![image-20200805012430884](assets/image-20200805012430884.png)

### è§£å†³historyé¡µé¢è®¿é—®é—®é¢˜

ä½†æ˜¯ï¼Œæ­¤æ—¶å­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼Œ

1. **å½“æˆ‘ä»¬åˆ·æ–°é¡µé¢ï¼Œå‘ç°404**

>   è¿™æ˜¯å› ä¸ºæˆ‘ä»¬é‡‡ç”¨äº†historyçš„æ¨¡å¼ï¼Œåœ°å€çš„å˜åŒ–ä¼šå¼•èµ·æœåŠ¡å™¨çš„åˆ·æ–°ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨app.jså¯¹æ‰€æœ‰çš„åœ°å€è¿›è¡Œä¸€ä¸‹å¤„ç†å³å¯

å®‰è£… koaä¸­é—´ä»¶ 

```bash 
$ npm i koa2-connect-history-api-fallback #ä¸“é—¨å¤„ç†historyæ¨¡å¼çš„ä¸­é—´ä»¶
```

**æ³¨å†Œä¸­é—´ä»¶**

```js
const Koa  = require('koa')
const serve = require('koa-static');
const  { historyApiFallback } = require('koa2-connect-history-api-fallback');
const path = require('path')
const app = new Koa();
// è¿™å¥è¯ çš„æ„æ€æ˜¯é™¤æ¥å£ä¹‹å¤–æ‰€æœ‰çš„è¯·æ±‚éƒ½å‘é€ç»™äº† index.html
app.use(historyApiFallback({ 
     whiteList: ['/prod-api']
 }));  // è¿™é‡Œçš„whiteListæ˜¯ ç™½åå•çš„æ„æ€
app.use(serve(__dirname + "/public")); //å°†publicä¸‹çš„ä»£ç é™æ€åŒ–

app.listen(3333, () => {
     console.log('äººèµ„é¡¹ç›®å¯åŠ¨')
})
```

### è§£å†³ç”Ÿäº§ç¯å¢ƒè·¨åŸŸé—®é¢˜

1. å½“ç‚¹å‡»ç™»å½•æ—¶ï¼Œå‘ç°æ¥å£404

>   å‰é¢æˆ‘ä»¬è®²è¿‡ï¼Œvue-cliçš„ä»£ç†åªå­˜åœ¨äºå¼€å‘æœŸï¼Œå½“æˆ‘ä»¬ä¸Šçº¿åˆ°nodeç¯å¢ƒæˆ–è€…ngixç¯å¢ƒæ—¶ï¼Œéœ€è¦æˆ‘ä»¬å†æ¬¡åœ¨ç¯å¢ƒä¸­ä»£ç†

åœ¨nodejsä¸­ä»£ç†

å®‰è£…è·¨åŸŸä»£ç†ä¸­é—´ä»¶

```bash
$ npm i koa2-proxy-middleware
```

é…ç½®è·¨è¶Šä»£ç†

```js
const proxy = require('koa2-proxy-middleware')

app.use(proxy({
  targets: {
    // (.*) means anything
    '/prod-api/(.*)': {
        target: 'http://ihrm-java.itheima.net/api', //åç«¯æœåŠ¡å™¨åœ°å€
        changeOrigin: true,
        pathRewrite: { 	
            '/prod-api': ""
        }
    }
  }
}))
```

æ³¨æ„ï¼šè¿™é‡Œä¹‹æ‰€ä»¥ç”¨äº†**pathRewrite**ï¼Œæ˜¯å› ä¸ºç”Ÿäº§ç¯å¢ƒçš„è¯·æ±‚åŸºç¡€åœ°å€æ˜¯ **/prod-api**ï¼Œéœ€è¦å°†è¯¥åœ°å€å»æ‰

æ­¤æ—¶ï¼Œæˆ‘ä»¬çš„é¡¹ç›®å°±å¯ä»¥è·¨åŸŸè®¿é—®äº†ï¼

>  åˆ°ç°åœ¨ä¸ºæ­¢ï¼Œæˆ‘ä»¬åœ¨åå‡ å¤©çš„æ—¶é—´é‡Œï¼Œå®Œæˆäº†ä¸€ä¸ªè¾ƒä¸ºå¤æ‚çš„ä¸­å°é¡¹ç›®çš„è§£å‰–å’Œå¼€å‘ï¼Œä»»ä½•ä¸€ä¸ªå¤æ‚çš„é¡¹ç›®éƒ½æ˜¯å„ç§å„æ ·çš„åŠŸèƒ½é€šè¿‡åˆç†çš„è®¾è®¡å’Œå¸ƒå±€ç»„è£…è€Œæˆçš„ï¼Œæ‰€ä»¥æœªæ¥æˆ‘ä»¬æ¯ä¸ªåŒå­¦è¦æŒæ¡çš„èƒ½åŠ›å°±æ˜¯ä¸è®ºé¡¹ç›®çš„éš¾åº¦å’Œå¤æ‚åº¦ï¼Œéƒ½è¦å­¦ä¼šæŠ€æœ¯çš„è§£è€¦å’Œè®¾è®¡ï¼Œè¿™æ ·æˆ‘ä»¬çš„å¼€å‘èƒ½åŠ›å°±ä¼šå˜å¾—è¶Šæ¥è¶Šå¼º

**That is  All !** 

**æ„Ÿè°¢ ! ! !**

> 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

ç»“æŸ!!!!!!!!!!
