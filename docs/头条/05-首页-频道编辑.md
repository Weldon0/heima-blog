---
title: ğŸ“š 05-é¦–é¡µ-é¢‘é“ç¼–è¾‘
---
# äº”ã€é¦–é¡µâ€”é¢‘é“ç¼–è¾‘

<img src="https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/2022/01/23/1566541118035.png" width="300">





## 5.1 å¤„ç†é¡µé¢å¼¹å‡ºå±‚

Vant ä¸­å†…ç½®äº† [Popup å¼¹å‡ºå±‚](https://youzan.github.io/vant/#/zh-CN/popup) ç»„ä»¶ã€‚

> views/home/index.vueç»„ä»¶ä¸­

1ã€åœ¨ `data`ä¸­æ·»åŠ ä¸€ä¸ªæ•°æ®ç”¨æ¥æ§åˆ¶å¼¹å±‚çš„æ˜¾ç¤ºå’Œéšè—

```js
data () {
  return {
    ...
    isChannelEditShow: true // è¿™é‡Œæˆ‘ä»¬å…ˆè®¾ç½®ä¸º true å°±èƒ½çœ‹åˆ°å¼¹çª—çš„é¡µé¢äº†
  }
}
```

2ã€ç„¶ååœ¨é¦–é¡µæ¨¡æ¿ä¸­çš„é¢‘é“åˆ—è¡¨åé¢æ·»åŠ å¼¹å‡ºå±‚ç»„ä»¶

```html
<!-- é¢‘é“ç¼–è¾‘ -->
<van-popup
  class="edit-channel-popup"
  v-model="isEditChannelShow"
  position="bottom"
  :style="{ height: '80%' }"
  closeable
  close-icon-position="top-left"
>å†…å®¹</van-popup>
<!-- /é¢‘é“ç¼–è¾‘ -->
```

```less
.edit-channel-popup {
  padding-top: 100px;
	box-sizing: border-box;
}
```

3ã€ç‚¹å‡»æ±‰å ¡æŒ‰é’®ä¿®æ”¹isEditChannelShow

```html
<div slot="nav-right" class="hamburger-btn">
    <i @click="isEditChannelShow = true" class="toutiao toutiao-gengduo"></i>
</div>
```



## 5.2 åˆ›å»ºé¢‘é“ç¼–è¾‘ç»„ä»¶

1ã€åˆ›å»º `views/home/components/channel-edit.vue`

```html
<template>
  <div class="channel-edit">é¢‘é“ç¼–è¾‘</div>
</template>

<script>
export default {
  name: 'ChannelEdit',
  components: {},
  props: {},
  data () {
    return {}
  },
  computed: {},
  watch: {},
  created () {},
  mounted () {},
  methods: {}
}
</script>

<style scoped lang="less"></style>

```

2ã€åœ¨é¦–é¡µä¸­åŠ è½½æ³¨å†Œ

```js
import ChannelEdit from './components/channel-edit'
```

```js
export default {
  ...
  components: {
    ...
    ChannelEdit
  }
}
```

3ã€åœ¨å¼¹å‡ºå±‚ä¸­ä½¿ç”¨é¢‘é“ç¼–è¾‘ç»„ä»¶

```html
<!-- é¢‘é“ç¼–è¾‘ -->
<van-popup
  v-model="isChannelEditShow"
  position="bottom"
  closeable
  close-icon-position="top-left"
  :style="{ height: '100%' }"
>
+  <channel-edit />
</van-popup>
<!-- /é¢‘é“ç¼–è¾‘ -->
```

## 5.3 é¡µé¢å¸ƒå±€

> buttonç›¸å…³å±æ€§
>
> | å‚æ•° | è¯´æ˜                                               | ç±»å‹     | é»˜è®¤å€¼    |
> | :--- | :------------------------------------------------- | :------- | :-------- |
> | type | ç±»å‹ï¼Œå¯é€‰å€¼ä¸º `primary` `info` `warning` `danger` | *string* | `default` |
> | size | å°ºå¯¸ï¼Œå¯é€‰å€¼ä¸º large small mini| string| `normal`|
> | round | æ˜¯å¦ä¸ºåœ†å½¢æŒ‰é’® | *boolean* | `false` |
> | plain | æ˜¯å¦ä¸ºæœ´ç´ æŒ‰é’® | *boolean* | `false` |
>
> 

```html
<template>
  <div class="channel-edit">
    <van-cell title="æˆ‘çš„é¢‘é“" :border="false">
      <van-button
        size="mini"
        round
        type="danger"
        plain
      >ç¼–è¾‘</van-button>
    </van-cell>
    <van-grid :gutter="10">
      <van-grid-item
        class="channel-item"
        v-for="value in 8"
        :key="value"
        text="æ–‡å­—"
      />
    </van-grid>
    <van-cell title="é¢‘é“æ¨è" :border="false"></van-cell>
    <van-grid :gutter="10">
      <van-grid-item
        class="channel-item"
        v-for="value in 8"
        :key="value"
        text="æ–‡å­—"
      />
    </van-grid>
  </div>
</template>

<script>
export default {
  name: 'ChannelEdit',
  components: {},
  props: {},
  data () {
    return {}
  },
  computed: {},
  watch: {},
  created () {},
  mounted () {},
  methods: {}
}
</script>

<style scoped lang="less">

</style>

```

## 5.4 æ ·å¼è°ƒæ•´

### 5.4.1 å®ç°åŸºæœ¬æ ·å¼

1ã€é»˜è®¤æ ·å¼

```css
.channel-edit {
  .channel-item {
    height: 86px;
    /deep/ .van-grid-item__content {
      background-color: #f5f5f6;
      .van-grid-item__text {
        color: #222;
        font-size: 28px;
      }
    }
  }
}
```

### 5.4.2 æ¨èé¢‘é“+å·å¤„ç†

> Van-grid-item å¯ä»¥é€šè¿‡iconå±æ€§æŒ‡å®šä½¿ç”¨çš„å›¾æ ‡ç±»å‹
>
> icon=plus: â•å›¾æ ‡
>
> icon=close: å…³é—­å›¾æ ‡
>
> ç„¶åé€šè¿‡cssè°ƒæ•´åˆ°åˆé€‚ä½ç½®å³å¯

```html
<van-grid class="recommend-grid" :gutter="10">
        <van-grid-item
          class="channel-item"
          v-for="value in 8"
          :key="value"
          text="æ–‡å­—å­—"
          icon="plus"
        />
      </van-grid>
```

```css
/deep/ .recommend-grid {
    .van-grid-item__content {
        flex-direction: row;
        color: #222;
        .van-icon {
            font-size: 24px;
        }

        .van-grid-item__text {
            font-size: 20px;
            margin-top: 0;
        }
    }
}
```

### 5.4.3 æˆ‘çš„é¢‘é“å³ä¸Šè§’å…³é—­å›¾æ ‡

```html
<van-grid :gutter="10">
    <van-grid-item
                   class="channel-item"
                   v-for="value in 8"
                   :key="value"
                   text="æ–‡å­—"
                   icon="close"
                   />
</van-grid>
```

```css
/deep/ .van-icon-close {
    position: absolute;
    right: -10px;
    top: -10px;
    font-size: 36px;
    color: #ccc;
}
```



## 5.5 å±•ç¤ºæˆ‘çš„é¢‘é“

1ã€åœ¨çˆ¶ç»„ä»¶ä¸­æŠŠ `channels` ä¼ é€’ç»™é¢‘é“ç¼–è¾‘ç»„ä»¶

```html
<!-- é¢‘é“ç¼–è¾‘ -->
    <van-popup
      class="edit-channel-popup"
      v-model="isEditChannelShow"
      position="bottom"
      :style="{ height: '98%' }"
      closeable
      close-icon-position="top-left"
    >
      <!-- ä¼ é€’channels -->
      <channel-edit :myChannels="channels" />
    </van-popup>
    <!-- /é¢‘é“ç¼–è¾‘ -->
```



2ã€åœ¨é¢‘é“ç¼–è¾‘ç»„ä»¶ä¸­å£°æ˜æ¥æ”¶çˆ¶ç»„ä»¶çš„ `userChannels` é¢‘é“åˆ—è¡¨æ•°æ®å¹¶éå†å±•ç¤º

```js
name: 'channel-edit',
  props: {
    myChannels: {
      type: Array,
      required: true
    }
  }
```

```html
<!-- æˆ‘çš„é¢‘é“ -->
<van-grid :gutter="10">
    <van-grid-item
                   class="channel-item"
                   v-for="(channelItem, index) in myChannels"
                   :key="index"
                   :text="channelItem.name"
                   icon="close"
                   />
</van-grid>
```



## 5.6 å¤„ç†æ¿€æ´»é¢‘é“é«˜äº®

1ã€è®²é¦–é¡µçš„activeä¼ é€’ç»™ç¼–è¾‘é¢‘é“ç»„ä»¶

```html
<!-- ä¼ é€’channels ä¼ é€’activeé«˜äº®ç´¢å¼•-->
<channel-edit :active="active" :myChannels="channels" />
```

2ã€ç¼–è¾‘é¢‘é“ç»„ä»¶æ¥æ”¶æ•°æ®

```js
props: {
    myChannels: {
      type: Array,
      required: true
    },
    active: {
      type: Number,
      required: true
    }
  }
```

3ã€ä¿®æ”¹ç»“æ„ï¼Œæ ¹æ®activeè®¾ç½®é«˜äº®ç±»å

```html
<van-grid-item
               class="channel-item"
               v-for="(channelItem, index) in myChannels"
               :key="index"
               icon="close"
               >
    <span class="text" :class="{active: active === index}" slot="text">{{ channelItem.name }}</span>
</van-grid-item>
```

4ã€æ·»åŠ activeæ ·å¼ï¼Œå’Œtextæ ·å¼

```css
/deep/ .van-grid-item__content {
      background-color: #f5f5f6;
      .van-grid-item__text, .text {
        color: #222;
        font-size: 20px;
        white-space: nowrap;
      }

      .active {
        color: red;
      }
    }
```

## 5.7 å±•ç¤ºæ¨èé¢‘é“åˆ—è¡¨

<img src="https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/2022/01/23/1571040968593.png" alt="1571040968593" style="zoom:50%;" />

æ²¡æœ‰ç”¨æ¥è·å–æ¨èé¢‘é“çš„æ•°æ®æ¥å£ï¼Œä½†æ˜¯æˆ‘ä»¬æœ‰è·å–æ‰€æœ‰é¢‘é“åˆ—è¡¨çš„æ•°æ®æ¥å£ã€‚

æ‰€ä»¥ï¼š`æ‰€æœ‰é¢‘é“åˆ—è¡¨ - æˆ‘çš„é¢‘é“ = å‰©ä½™æ¨èçš„é¢‘é“`ã€‚

å®ç°è¿‡ç¨‹æ‰€ä»¥ä¸€å…±åˆ†ä¸ºä¸¤å¤§æ­¥ï¼š

- è·å–æ‰€æœ‰é¢‘é“
- åŸºäºæ‰€æœ‰é¢‘é“å’Œæˆ‘çš„é¢‘é“è®¡ç®—è·å–å‰©ä½™çš„æ¨èé¢‘é“

### 5.7.1 è·å–æ‰€æœ‰é¢‘é“

1ã€å°è£…æ•°æ®æ¥å£

```js
/**
 * è·å–æ‰€æœ‰é¢‘é“
 */
export const getAllChannels = () => {
  return request({
    method: 'GET',
    url: '/app/v1_0/channels'
  })
}
```

2ã€å¼•å…¥getAllChannels

```js
import { getAllChannels } from '@/api/article.js'
```

3ã€åœ¨ç¼–è¾‘é¢‘é“ç»„ä»¶ä¸­è¯·æ±‚è·å–æ‰€æœ‰é¢‘é“æ•°æ®

```js
methods: {
    // åŠ è½½æ‰€æœ‰é¢‘é“
    async loadAllChannels () {
      try {
        const { data } = await getAllChannels()
        this.allChannels = data.data.channels
      } catch (err) {
        this.$toast('è·å–é¢‘é“åˆ—è¡¨æ•°æ®å¤±è´¥')
      }
    }
  }
```

4ã€è°ƒç”¨è¯¥æ–¹æ³•ï¼Œå¹¶åˆå§‹åŒ–channels

```js
data () {
    return {
      allChannels: []
    }
  },
  created () {
    this.loadAllChannels()
  },
```

5ã€åœ¨è°ƒè¯•å·¥å…·ä¸­æµ‹è¯•æ˜¯å¦æœ‰æ‹¿åˆ°æ•°æ®

### 5.7.2 å¤„ç†å±•ç¤ºæ¨èé¢‘é“

æ€è·¯ï¼š`æ‰€æœ‰é¢‘é“ - ç”¨æˆ·é¢‘é“ = æ¨èé¢‘é“`

1ã€å°è£…è®¡ç®—å±æ€§ç­›é€‰æ•°æ®

> æ€è·¯ï¼šä» æ‰€æœ‰é¢‘é“é‡Œé¢è¿‡æ»¤æ‰æˆ‘çš„é¢‘é“é‡Œé¢çš„æ•°æ®ï¼Œå‰©ä¸‹çš„å°±æ˜¯æ¨èé¢‘é“

```js
recommendChannels () {
   return this.allChannels.filter((item) => {
     return !this.myChannels.some((myItem) => myItem.id === item.id);
   });
}
```

- éå†æ‰€æœ‰é¢‘é“
- å¯¹æ¯ä¸€ä¸ªé¢‘é“éƒ½åˆ¤æ–­ï¼šè¯¥é¢‘é“æ˜¯å¦å±äºæˆ‘çš„é¢‘é“
- å¦‚æœä¸å±äºæˆ‘çš„é¢‘é“ï¼Œåˆ™æ”¶é›†èµ·æ¥
- ç›´åˆ°éå†ç»“æŸï¼Œå‰©ä¸‹æ¥å°±æ˜¯é‚£äº›å‰©ä½™çš„æ¨èé¢‘é“

2ã€æ¨¡æ¿ç»‘å®š

```html
<van-grid class="recommend-grid" :gutter="10">
        <van-grid-item
          class="channel-item"
          v-for="channel in recommendChannels"
          :key="channel.id"
          :text="channel.name"
          icon="plus"
        />
      </van-grid>
```

:::tip æ‹“å±•ï¼šä½¿ç”¨lodashè®¡ç®—æ¨èé¢‘é“æ•°æ®

[https://www.lodashjs.com/docs/lodash.differenceBy#_differencebyarray-values-iteratee_identity](https://www.lodashjs.com/docs/lodash.differenceBy#_differencebyarray-values-iteratee_identity)

1. å®‰è£…lodash `yarn add lodash -S`

2. å¼•å…¥lodash ` import _ from 'lodash'`

3. ç”¨æ³•ç¤ºä¾‹

   ```js
   // The `_.property` iteratee shorthand.
   _.differenceBy([{ 'x': 2 }, { 'x': 1 }], [{ 'x': 1 }], 'x');
   // => [{ 'x': 2 }]
   ```

   

```js
computed: {
    // recommendChannles() {
    //   return this.allChannels.filter((item) => {
    //     return !this.myChannels.some((myItem) => myItem.id === item.id);
    //   });
    // },
    recommendChannles() {
      return _.differenceBy(this.allChannels, this.myChannels, "id");
    },
  },
```



:::

## 5.8 æ·»åŠ é¢‘é“

<img src="https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/2022/01/23/pin-dao-guan-litian-jia-pin-dao.gif" alt="é¢‘é“ç®¡ç†-æ·»åŠ é¢‘é“" width="250" />

æ€è·¯ï¼š

- ç»™æ¨èé¢‘é“åˆ—è¡¨ä¸­æ¯ä¸€é¡¹æ³¨å†Œç‚¹å‡»äº‹ä»¶
- è·å–ç‚¹å‡»çš„é¢‘é“é¡¹
- å°†é¢‘é“é¡¹æ·»åŠ åˆ°æˆ‘çš„é¢‘é“ä¸­
- ~~å°†å½“å‰ç‚¹å‡»çš„é¢‘é“é¡¹ä»æ¨èé¢‘é“ä¸­ç§»é™¤~~
  - ä¸éœ€è¦åˆ é™¤ï¼Œå› ä¸ºæˆ‘ä»¬è·å–æ•°æ®ä½¿ç”¨çš„æ˜¯è®¡ç®—å±æ€§ï¼Œå½“æˆ‘é¢‘é“å‘ç”Ÿæ”¹å˜ï¼Œè®¡ç®—å±æ€§é‡æ–°æ±‚å€¼äº†

1ã€ç»™æ¨èé¢‘é“ä¸­çš„é¢‘é“æ³¨å†Œç‚¹å‡»äº‹ä»¶

<img src="https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/2022/01/23/image20200316030501261.png" alt="image-20200316030501261" style="zoom:50%;" />

2ã€åœ¨æ·»åŠ é¢‘é“äº‹ä»¶å¤„ç†å‡½æ•°ä¸­

<img src="https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/2022/01/23/image20200316030518012.png" alt="image-20200316030518012" style="zoom:50%;" />

ç„¶åä½ ä¼šç¥å¥‡çš„å‘ç°ç‚¹å‡»çš„é‚£ä¸ªæ¨èé¢‘é“è·‘åˆ°æˆ‘çš„é¢‘é“ä¸­äº†ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰å»æ‰‹åŠ¨çš„åˆ é™¤ç‚¹å‡»çš„è¿™ä¸ªæ¨èé¢‘é“ï¼Œä½†æ˜¯å®ƒæ²¡äº†ï¼

ä¸»è¦æ˜¯å› ä¸ºæ¨èé¢‘é“æ˜¯é€šè¿‡ä¸€ä¸ªè®¡ç®—å±æ€§è·å–çš„ï¼Œè®¡ç®—å±æ€§ä¸­ä½¿ç”¨äº† channelsï¼ˆæˆ‘çš„é¢‘é“ï¼‰æ•°æ®ï¼Œæ‰€ä»¥åªè¦æˆ‘çš„é¢‘é“ä¸­çš„æ•°æ®å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆè®¡ç®—å±æ€§å°±ä¼šé‡æ–°è¿ç®—è·å–æœ€æ–°çš„æ•°æ®ã€‚

:::details ç›´æ¥ä¿®æ”¹propsæ•°æ®eslintæŠ¥é”™ï¼Ÿ

> é…ç½®.eslintrc.jsæ–‡ä»¶

```js
rules: {
  "no-console": process.env.NODE_ENV === "production" ? "warn" : "off",
  "no-debugger": process.env.NODE_ENV === "production" ? "warn" : "off",
  "vue/multi-word-component-names": 0,
  "vue/no-mutating-props": 0,
},
```



:::

## 5.9 ç¼–è¾‘é¢‘é“

æ€è·¯ï¼š

- ç»™æˆ‘çš„é¢‘é“ä¸­çš„é¢‘é“é¡¹æ³¨å†Œç‚¹å‡»äº‹ä»¶
- åœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­
  - å¦‚æœæ˜¯ç¼–è¾‘çŠ¶æ€ï¼Œåˆ™æ‰§è¡Œåˆ é™¤é¢‘é“æ“ä½œ
  - å¦‚æœæ˜¯éç¼–è¾‘çŠ¶æ€ï¼Œåˆ™æ‰§è¡Œåˆ‡æ¢é¢‘é“æ“ä½œ

### 5.9.1 å¤„ç†ç¼–è¾‘çŠ¶æ€

éœ€æ±‚ï¼š

1. é¡¶éƒ¨ç¼–è¾‘/å®ŒæˆæŒ‰é’®
   1. ç¼–è¾‘çŠ¶æ€ >> åŠ¨æ€å±•ç¤º

2. é¢‘é“é¡¹å…³é—­æŒ‰é’®
   1. ç¼–è¾‘çŠ¶æ€ & ä¸æ˜¯æ¨èé¢‘é“ > å±•ç¤ºå…³é—­æŒ‰é’®
   2. Else ä¸å±•ç¤ºç¼–è¾‘æŒ‰é’®



#### å®ç°æ­¥éª¤

1. åœ¨ data ä¸­æ·»åŠ æ•°æ®ç”¨æ¥æ§åˆ¶ç¼–è¾‘çŠ¶æ€çš„æ˜¾ç¤º

<img src="https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/2022/01/23/image20200316033317098.png" alt="image-20200316033317098" style="zoom:50%;" />

2. åœ¨æˆ‘çš„é¢‘é“é¡¹ä¸­æ·»åŠ åˆ é™¤å›¾æ ‡

ç”±äºè¦åŠ¨æ€æ§åˆ¶å…³é—­å›¾æ ‡å±•ç¤ºæˆ–éšè—ï¼Œæ‰€ä»¥å›¾æ ‡éœ€è¦é€šè¿‡æ’æ§½æ˜¾ç¤ºï¼Œæ‰æ–¹ä¾¿åŠ¨æ€æ§åˆ¶æ˜¾ç¤ºéšè—

> å‡ºç°é—®é¢˜ï¼šå›¾æ ‡é”™ä½
>
> åŸå› ï¼šå›¾æ ‡çš„çˆ¶å®¹å™¨å®šä½ä¸ºrealtiveï¼Œå¯¼è‡´å®šä½ä¸å‡†
>
> ä¿®å¤ï¼š.van-grid-item__icon-wrapperçš„å®šä½ä¿®æ”¹ä¸ºunset

```html
<van-grid :gutter="10">
        <van-grid-item
          class="channel-item"
          v-for="(channelItem, index) in myChannels"
          :key="index"
        >
          <span class="text" :class="{active: active === index}" slot="text">{{ channelItem.name }}</span>
          <!-- é€šè¿‡æ’æ§½è‡ªå®šä¹‰å›¾æ ‡ -->
          <van-icon v-show="isEdit" slot="icon" name="close" />
        </van-grid-item>
      </van-grid>
```

```css
  /deep/ .van-grid-item__icon-wrapper {
    position: unset;
  }
```



3ã€å¤„ç†ç‚¹å‡»ç¼–è¾‘æŒ‰é’®

```html
<van-cell title="æˆ‘çš„é¢‘é“" :border="false">
        <van-button
          size="mini"
          round
          type="danger"
          plain
          @click="isEdit = !isEdit"
        >{{ isEdit ? 'å®Œæˆ': 'ç¼–è¾‘' }}</van-button>
      </van-cell>
```

4ã€æ§åˆ¶æ¨èä¸åˆ é™¤

```html
<van-icon v-show="isEdit && index!==0" slot="icon" name="close" />
```

### 5.9.2 åˆ‡æ¢é¢‘é“

#### 5.9.2.1 åˆ‡æ¢é¢‘é“åŠŸèƒ½

åŠŸèƒ½éœ€æ±‚ï¼šåœ¨éç¼–è¾‘å™¨çŠ¶æ€ä¸‹åˆ‡æ¢é¢‘é“

1ã€ç»™æˆ‘çš„é¢‘é“é¡¹æ³¨å†Œç‚¹å‡»äº‹ä»¶

```html
<van-grid-item
          class="channel-item"
          v-for="(channelItem, index) in myChannels"
          :key="index"
          @click="onMyChannelClick(channelItem, index)"
        >
          <span class="text" :class="{active: active === index}" slot="text">{{ channelItem.name }}</span>
          <!-- é€šè¿‡æ’æ§½è‡ªå®šä¹‰å›¾æ ‡ -->
          <van-icon v-show="isEdit && index!==0" slot="icon" name="close" />
        </van-grid-item>
```

2ã€å¤„ç†å‡½æ•°

```js
// ç‚¹å‡»æˆ‘çš„é¢‘é“
    onMyChannelClick (channelItem, index) {
      if (this.isEdit) {
        // æ‰§è¡Œåˆ é™¤æ“ä½œ
      } else {
        // æ‰§è¡Œè·³è½¬æ“ä½œ
        this.$emit('update-active', index)
      }
    }
```

3ã€åœ¨çˆ¶ç»„ä»¶ä¸­ç›‘å¬å¤„ç†è‡ªå®šä¹‰äº‹ä»¶

```html
<!-- ä¼ é€’channels ä¼ é€’activeé«˜äº®ç´¢å¼• å®šä¹‰update-activeäº‹ä»¶-->
<channel-edit @update-active="onUpdateActive" :active="active" :myChannels="channels" />
```

4ã€å®šä¹‰äº‹ä»¶å‡½æ•°

```js
onUpdateActive (index) {
    this.active = index
    this.isEditChannelShow = false
}
```



#### 5.9.2.1 è®©æ¿€æ´»é¢‘é“é«˜äº®

æ€è·¯ï¼š

- å°†é¦–é¡µä¸­çš„æ¿€æ´»çš„æ ‡ç­¾ç´¢å¼•ä¼ é€’ç»™é¢‘é“ç¼–è¾‘ç»„ä»¶
- åœ¨é¢‘é“ç¼–è¾‘ç»„ä»¶ä¸­éå†æˆ‘çš„é¢‘é“åˆ—è¡¨çš„æ—¶å€™åˆ¤æ–­éå†é¡¹çš„ç´¢å¼•æ˜¯å¦ç­‰äºæ¿€æ´»çš„é¢‘é“æ ‡ç­¾ç´¢å¼•ï¼Œå¦‚æœä¸€æ ·åˆ™ä½œç”¨ä¸€ä¸ªé«˜äº®çš„ CSS ç±»å



1ã€å°†é¦–é¡µç»„ä»¶ä¸­çš„ `active` ä¼ é€’åˆ°é¢‘é“ç¼–è¾‘ç»„ä»¶ä¸­

<img src="https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/2022/01/23/image20200316004637299.png" alt="image-20200316004637299" style="zoom:50%;" />

2ã€åœ¨é¢‘é“ç¼–è¾‘ç»„ä»¶ä¸­å£°æ˜ props æ¥æ”¶

<img src="https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/2022/01/23/image20200316004657340.png" alt="image-20200316004657340" style="zoom:50%;" />

3ã€åˆ¤æ–­éå†é¡¹ï¼Œå¦‚æœ `éå†é¡¹ç´¢å¼• === active`ï¼Œåˆ™ç»™è¿™ä¸ªé¢‘é“é¡¹è®¾ç½®é«˜äº®æ ·å¼

<img src="https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/2022/01/23/image20200316004830847.png" alt="image-20200316004830847" style="zoom:50%;" />

<img src="https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/2022/01/23/image20200316004847629.png" alt="image-20200316004847629" style="zoom:50%;" />

### 5.9.3 åˆ é™¤é¢‘é“



::: info éœ€æ±‚åˆ†æ

ç¼–è¾‘çŠ¶æ€ >> ç‚¹å‡»é¢‘é“ >> åˆ é™¤é¢‘é“

1. ç‚¹å‡»ç´¢å¼• å¤§äº é€‰ä¸­ç´¢å¼•(active) --> ç›´æ¥åˆ é™¤
2. ç‚¹å‡»ç´¢å¼•å°äºç­‰äº >> é€‰ä¸­ç´¢å¼•(active) >> å…ˆåˆ é™¤/é€‰ä¸­çŠ¶æ€-1(åŒæ—¶å½“å‰é¢‘é“å¼¹å±‚ä¸èƒ½å…³é—­)

:::

åŠŸèƒ½éœ€æ±‚ï¼šåœ¨ç¼–è¾‘çŠ¶æ€ä¸‹åˆ é™¤é¢‘é“ã€‚

1ã€å®Œå–„æ‰§è¡Œåˆ é™¤æ“ä½œ

```js
// ç‚¹å‡»æˆ‘çš„é¢‘é“
onMyChannelClick (channelItem, index) {
    if (this.isEdit) {
        // æ‰§è¡Œåˆ é™¤æ“ä½œ
        if (index <= this.active) {
            this.$emit('update-active', this.active - 1, true)
        }
        this.myChannels.splice(index, 1)
    } else {
        // æ‰§è¡Œè·³è½¬æ“ä½œ
        this.$emit('update-active', index, false)
    }
}
```

2ã€å®Œå–„update-activeæ–¹æ³•(é€šè¿‡ä¼ å…¥å‚æ•°çŠ¶æ€å†³å®šå¼¹å±‚æ˜¯å¦éšè—)

```js
onUpdateActive (index, isEditChannelShow) {
      this.active = index
      this.isEditChannelShow = isEditChannelShow
    }
```

3ã€åˆ¤æ–­æ˜¯å¦ä¸ºæ¨è

```js
// ç‚¹å‡»æˆ‘çš„é¢‘é“
    onMyChannelClick (channelItem, index) {
      if (this.isEdit) {
        // å¦‚æœåˆ é™¤çš„æ˜¯æ¨èé¢‘é“ï¼Œåˆ™ç»ˆæ­¢ä»£ç æ‰§è¡Œ/ç»™å‡ºæç¤º
        if (index === 0) return this.$toast('æ¨èé¢‘é“ä¸å…è®¸åˆ é™¤')
        if (index <= this.active) {
          this.$emit('update-active', this.active - 1, true)
        }
        this.myChannels.splice(index, 1)
      } else {
        // æ‰§è¡Œè·³è½¬æ“ä½œ
        this.$emit('update-active', index, false)
      }
    }
```



## 5.10 é¢‘é“æ•°æ®æŒä¹…åŒ–

### 5.10.1 ä¸šåŠ¡åˆ†æ

é¢‘é“ç¼–è¾‘è¿™ä¸ªåŠŸèƒ½ï¼Œæ— è®ºç”¨æˆ·æ˜¯å¦ç™»å½•ç”¨æˆ·éƒ½å¯ä»¥ä½¿ç”¨ã€‚

ä¸ç™»å½•ä¹Ÿèƒ½ä½¿ç”¨

- æ•°æ®å­˜å‚¨åœ¨æœ¬åœ°
- ä¸æ”¯æŒåŒæ­¥åŠŸèƒ½

ç™»å½•ä¹Ÿèƒ½ä½¿ç”¨

- æ•°æ®å­˜å‚¨åœ¨çº¿ä¸Šåå°æœåŠ¡å™¨
- æ›´æ¢ä¸åŒçš„è®¾å¤‡å¯ä»¥åŒæ­¥æ•°æ®

### 5.10.2 æ·»åŠ é¢‘é“

æ€è·¯ï¼š

- å¦‚æœæœªç™»å½•ï¼Œåˆ™å­˜å‚¨åˆ°æœ¬åœ°
- å¦‚æœå·²ç™»å½•ï¼Œåˆ™å­˜å‚¨åˆ°çº¿ä¸Š
  - æ‰¾åˆ°æ•°æ®æ¥å£
  - å°è£…è¯·æ±‚æ–¹æ³•
  - è¯·æ±‚è°ƒç”¨

1ã€å¯¼å…¥vuexä¸­çš„mapStateã€storageä¸­çš„æ–¹æ³•

```js
import { mapState } from 'vuex'
import { setItem } from '@/utils/storage.js'
```

```js
computed: {
    recommendChannels () {
        return this.allChannels.filter(channel => {
            const mychannel = this.myChannels.find(myChannel => {
                return myChannel.id === channel.id
            })
            return !mychannel
        })
    },
    // è·å–user
    ...mapState(['user'])
},
```

2ã€æ ¹æ®useråˆ¤æ–­æ˜¯å¦ç™»é™†

```js
// ç‚¹å‡»æ·»åŠ é¢‘é“
onAddChannel (channels) {
    this.myChannels.push(channels)
    if (this.user) {
        // å·²ç™»å½•
    } else {
        // æœªç™»é™†
        setItem('TOUTIAO_CHANNELS', this.myChannels)
    }
}
```

3ã€å¦‚æœå·²ç™»å½•ï¼Œå°è£…æ·»åŠ é¢‘é“çš„è¯·æ±‚æ–¹æ³•

```js
/**
 * æ·»åŠ ç”¨æˆ·é¢‘é“
 */
export const addUserChannel = channel => {
  return request({
    method: 'PATCH',
    url: '/app/v1_0/user/channels',
    data: {
      channels: [channel]
    }
  })
}
```

4ã€å¼•å…¥addUserChannelæ–¹æ³•

5ã€ä¿®æ”¹æ·»åŠ é¢‘é“çš„å¤„ç†é€»è¾‘

```js
// ç‚¹å‡»æ·»åŠ é¢‘é“
async onAddChannel (channels) {
    this.myChannels.push(channels)
    if (this.user) {
        try {
            // å·²ç™»å½•ï¼Œæ•°æ®å­˜å‚¨åˆ°çº¿ä¸Š
            await addUserChannel({
                id: channels.id, // é¢‘é“ id
                seq: this.myChannels.length // é¢‘é“çš„ åºå·
            })
            this.$toast('æ·»åŠ æˆåŠŸ')
        } catch (err) {
            this.$toast('ä¿å­˜å¤±è´¥')
        }
    } else {
        // æœªç™»é™†
        setItem('TOUTIAO_CHANNELS', this.myChannels)
    }
}
```

### 5.10.3 åˆ é™¤é¢‘é“

æ€è·¯ï¼š

- å¦‚æœæœªç™»å½•ï¼Œåˆ™å­˜å‚¨åˆ°æœ¬åœ°
- å¦‚æœå·²ç™»å½•ï¼Œåˆ™å­˜å‚¨åˆ°çº¿ä¸Š
  - æ‰¾åˆ°æ•°æ®æ¥å£
  - å°è£…è¯·æ±‚æ–¹æ³•
  - è¯·æ±‚è°ƒç”¨



1ã€å°è£…åˆ é™¤ç”¨æˆ·é¢‘é“è¯·æ±‚æ–¹æ³•

```js
/**
 * åˆ é™¤ç”¨æˆ·é¢‘é“
 */
export const deleteUserChannel = channelId => {
  return request({
    method: 'DELETE',
    url: `/app/v1_0/user/channels/${channelId}`
  })
}
```

2ã€åœ¨**onMyChannelClick**å‡½æ•°ä¸­æ‰§è¡Œåˆ é™¤æ“ä½œæœ€åé¢è°ƒç”¨åˆ é™¤æŒä¹…åŒ–çš„æ–¹æ³•

```js
// ç‚¹å‡»æˆ‘çš„é¢‘é“
onMyChannelClick (channelItem, index) {
    if (this.isEdit) {
        // æ‰§è¡Œåˆ é™¤æ“ä½œ
        if (index === 0) return
        if (index <= this.active) {
            this.$emit('update-active', this.active - 1, true)
        }
        this.myChannels.splice(index, 1)
        // åˆ é™¤æ•°æ®æŒä¹…åŒ–
        this.deleteChannel(channelItem)
    } else {
        // æ‰§è¡Œè·³è½¬æ“ä½œ
        this.$emit('update-active', index, false)
    }
}
```

3ã€å®šä¹‰deleteChannelæ–¹æ³•

```js
async deleteChannel (channel) {
  try {
    if (this.user) {
      // å·²ç™»å½•ï¼Œå°†æ•°æ®å­˜å‚¨åˆ°çº¿ä¸Š
      await deleteUserChannel(channel.id)
    } else {
      // æœªç™»å½•ï¼Œå°†æ•°æ®å­˜å‚¨åˆ°æœ¬åœ°
      setItem('channles', this.userChannels)
    }
  } catch (err) {
    console.log(err)
    this.$toast('åˆ é™¤é¢‘é“å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•')
  }
}
```



## 5.11 æ­£ç¡®çš„è·å–é¦–é¡µé¢‘é“åˆ—è¡¨æ•°æ®

![é¦–é¡µ-è·å–é¢‘é“åˆ—è¡¨](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/2022/01/23/shou-yehuo-qu-pin-dao-lie-biao.png)





:::tip æ ¸å¿ƒé€»è¾‘ï¼š



1. ç”¨æˆ·ç™»å½•æƒ…å†µ || æœ¬åœ°å­˜å‚¨æ²¡æœ‰æ•°æ® >> æ¥å£æ‹¿æ•°æ®
2. å…¶ä»–æƒ…å†µ >> è·å–æœ¬åœ°å­˜å‚¨æ•°æ®

:::

> æç¤ºï¼šè·å–ç™»å½•ç”¨æˆ·çš„é¢‘é“åˆ—è¡¨å’Œè·å–é»˜è®¤æ¨èçš„é¢‘é“åˆ—è¡¨æ˜¯åŒä¸€ä¸ªæ•°æ®æ¥å£ã€‚åç«¯ä¼šæ ¹æ®æ¥å£ä¸­çš„ token æ¥åˆ¤å®šè¿”å›æ•°æ®ã€‚

1ã€å¯¼å…¥mapstateè·å–user

```js
import { mapState } from 'vuex'

computed: {
    ...mapState(['user'])
},
```

```js
 async loadChannels() {
      // å¦‚æœç”¨æˆ·ç™»å½•äº† >> æ¥å£è·å–æ•°æ®
      // å¦‚æœæœ¬åœ°å­˜å‚¨æ²¡æœ‰æ•°æ® >> æ¥å£è·å–æ•°æ®

      // å…¶ä»–ï¼šè·å–æœ¬åœ°å­˜å‚¨æ•°æ®
      try {
        const token = this.$store?.state?.user?.token;
        let channel = JSON.parse(localStorage.getItem(channelKey));
        if (token || !channel) {
          const res = await getUserChannels();
          channel = res.data.data.channels;
        }
        this.channels = channel;
      } catch (e) {
        this.$toast.fail("è·å–é¢‘é“æ•°æ®å¤±è´¥");
      }
    },
```



