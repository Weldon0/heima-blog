---
title: ğŸ“š 06-æ–‡ç« æœç´¢
---
# å…­ã€æ–‡ç« æœç´¢

<img src="https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/2022/01/23/1566431801892.png" width="250">



## 6.1 åˆ›å»ºç»„ä»¶å¹¶é…ç½®è·¯ç”±

1ã€ç»™æœç´¢æŒ‰é’®æ·»åŠ toå±æ€§

```html
<!-- å¯¼èˆªæ  -->
    <van-nav-bar class="page-nav-bar" fixed>
      <van-button
        class="search-btn"
        slot="title"
        type="info"
        size="small"
        round
        icon="search"
        to="/search"
      >æœç´¢</van-button>
    </van-nav-bar>
    <!-- /å¯¼èˆªæ  -->
```

1ã€åˆ›å»º `src/views/search/index.vue`

```html
<template>
  <div class="search-container">æœç´¢é¡µé¢</div>
</template>

<script>
  export default {
    name: "SearchPage",
    components: {},
    props: {},
    data() {
      return {};
    },
    computed: {},
    watch: {},
    created() {},
    methods: {}
  };
</script>

<style scoped></style>
```

2ã€ç„¶åæŠŠæœç´¢é¡µé¢çš„è·¯ç”±é…ç½®åˆ°æ ¹ç»„ä»¶è·¯ç”±ï¼ˆä¸€çº§è·¯ç”±ï¼‰

```js
{
  path: '/search',
  omponent: Search
}
```

æœ€åè®¿é—® `/search` æµ‹è¯•ã€‚

<img src="https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20211229220815366.png" alt="image-20211229220815366" style="zoom:50%;" />

## 6.2 é¡µé¢å¸ƒå±€

### 6.2.1 æœç´¢æ 

1ã€æœç´¢æ ç»“æ„, vantç»„ä»¶æœç´¢æ ä¸­çš„äº‹ä»¶ç›‘å¬

> show-action æ˜¯å¦å±•ç¤ºå³ä¾§å–æ¶ˆæŒ‰é’®

```html
<template>
  <div class="search-container">
    <!-- æœç´¢æ ã€‹äº‹ä»¶ç›‘å¬ -->
    <form action="/">
      <van-search
        v-model="value"
        show-action
        placeholder="è¯·è¾“å…¥æœç´¢å…³é”®è¯"
        @search="onSearch"
        @cancel="onCancel"
      />
    </form>
  </div>
</template>

<script>
export default {
  name: 'search-container',
  data () {
    return {
      value: ''
    }
  },

  created () {

  },

  methods: {
    onSearch (val) {
      this.$toast(val)
    },
    onCancel () {
      this.$toast('å–æ¶ˆ')
    }
  }
}
</script>

<style scoped lang='less'>

</style>

```

### 6.2.2 å®Œæˆ - æœç´¢å†å²

> å†å²ç•Œé¢æœ‰ä¸¤ç§çŠ¶æ€ï¼Œåˆ é™¤çŠ¶æ€å’Œæ­£å¸¸çŠ¶æ€

<img src="https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/CleanShot%202022-07-07%20at%2022.22.51@2x.png" alt="CleanShot 2022-07-07 at 22.22.51@2x" style="zoom:50%;" />

1ã€åˆ›å»º `src/views/search/components/search-history.vue`

```html
<template>
  <div class="search-history">
    <van-cell title="æœç´¢å†å²">
      <span>å…¨éƒ¨åˆ é™¤</span>
      <span>å®Œæˆ</span>
      <van-icon name="delete" />
    </van-cell>
    <van-cell title="hello">
      <van-icon name="close" />
    </van-cell>
    <van-cell title="hello">
      <van-icon name="close" />
    </van-cell>
    <van-cell title="hello">
      <van-icon name="close" />
    </van-cell>
    <van-cell title="hello">
      <van-icon name="close" />
    </van-cell>
  </div>
</template>

<script>
export default {
  name: 'SearchHistory',
  components: {},
  props: {},
  data () {
    return {}
  },
  computed: {},
  watch: {},
  created () {},
  mounted () {},
  methods: {}
}
</script>

<style scoped lang="less"></style>

```

### 6.2.3 å®Œæˆ - è”æƒ³å»ºè®®

<img src="https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20220707224032751.png" alt="image-20220707224032751" style="zoom: 50%;" />

2ã€åˆ›å»º `src/views/search/components/search-suggestion.vue`

```html
<template>
  <div class="search-suggestion">
    <van-cell title="é»‘é©¬ç¨‹åºå‘˜..." icon="search"></van-cell>
    <van-cell title="é»‘é©¬ç¨‹åºå‘˜..." icon="search"></van-cell>
    <van-cell title="é»‘é©¬ç¨‹åºå‘˜..." icon="search"></van-cell>
    <van-cell title="é»‘é©¬ç¨‹åºå‘˜..." icon="search"></van-cell>
    <van-cell title="é»‘é©¬ç¨‹åºå‘˜..." icon="search"></van-cell>
  </div>
</template>

<script>
export default {
  name: 'SearchSuggestion',
  components: {},
  props: {},
  data () {
    return {}
  },
  computed: {},
  watch: {},
  created () {},
  mounted () {},
  methods: {}
}
</script>

<style scoped lang="less"></style>

```

### 6.2.4 å®Œæˆ - æœç´¢ç»“æœ

<img src="https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20211229213334751.png" alt="image-20211229213334751" style="zoom:50%;" />

3ã€åˆ›å»º `src/views/search/components/search-result.vue`

```html
<template>
  <div class="search-result">
    <van-list
      v-model="loading"
      :finished="finished"
      finished-text="æ²¡æœ‰æ›´å¤šäº†"
      @load="onLoad"
    >
      <van-cell v-for="item in list" :key="item" :title="item" />
    </van-list>
  </div>
</template>

<script>
export default {
  name: 'SearchResult',
  components: {},
  props: {},
  data () {
    return {
      list: [],
      loading: false,
      finished: false
    }
  },
  computed: {},
  watch: {},
  created () {},
  mounted () {},
  methods: {
    onLoad () {
      // å¼‚æ­¥æ›´æ–°æ•°æ®
      // setTimeout ä»…åšç¤ºä¾‹ï¼ŒçœŸå®åœºæ™¯ä¸­ä¸€èˆ¬ä¸º ajax è¯·æ±‚
      setTimeout(() => {
        for (let i = 0; i < 10; i++) {
          this.list.push(this.list.length + 1)
        }

        // åŠ è½½çŠ¶æ€ç»“æŸ
        this.loading = false

        // æ•°æ®å…¨éƒ¨åŠ è½½å®Œæˆ
        if (this.list.length >= 40) {
          this.finished = true
        }
      }, 1000)
    }
  }
}
</script>

<style scoped lang="less"></style>

```



4ã€æœç´¢ç»„ä»¶å†…å®¹å¦‚ä¸‹ï¼š

```html
<template>
  <div class="search-container">
    <!-- æœç´¢æ  -->
    <!--
      Tips: åœ¨ van-search å¤–å±‚å¢åŠ  form æ ‡ç­¾ï¼Œä¸” action ä¸ä¸ºç©ºï¼Œå³å¯åœ¨ iOS è¾“å…¥æ³•ä¸­æ˜¾ç¤ºæœç´¢æŒ‰é’®
     -->
    <form action="/">
      <van-search
        v-model="searchText"
        show-action
        placeholder="è¯·è¾“å…¥æœç´¢å…³é”®è¯"
        background="#3296fa"
        @search="onSearch"
        @cancel="onCancel"
      />
    </form>
    <!-- /æœç´¢æ  -->

    <!-- æœç´¢å†å²è®°å½• -->
    <search-history />
    <!-- /æœç´¢å†å²è®°å½• -->

    <!-- è”æƒ³å»ºè®® -->
    <search-suggestion />
    <!-- /è”æƒ³å»ºè®® -->

    <!-- å†å²è®°å½• -->
    <search-result />
    <!-- /å†å²è®°å½• -->
  </div>
</template>

<script>
import SearchHistory from './components/search-history'
import SearchSuggestion from './components/search-suggestion'
import SearchResult from './components/search-result'

export default {
  name: 'SearchIndex',
  components: {
    SearchHistory,
    SearchSuggestion,
    SearchResult
  },
  props: {},
  data () {
    return {
      searchText: ''
    }
  },
  computed: {},
  watch: {},
  created () {},
  mounted () {},
  methods: {
    onSearch (val) {
      console.log(val)
    },
    onCancel () {
      this.$router.back()
    }
  }
}
</script>

<style scoped lang="less">
.search-container {
  .van-search__action {
    color: #fff;
  }
}
</style>

```



## 6.3 å¤„ç†é¡µé¢å±•ç¤ºé€»è¾‘

:::info

1. isResultæ§åˆ¶æ˜¯å¦å±•ç¤ºæœç´¢ç»“æœ(é»˜è®¤ä¸ºfalse)
2. searchText(è¾“å…¥æ¡†å†…å®¹)å¦‚æœå­˜åœ¨ï¼Œå±•ç¤ºæœç´¢å»ºè®®
3. å¦åˆ™å±•ç¤ºæœç´¢ç»“æœé¡µé¢(ä¼˜å…ˆçº§æœ€ä½)



> å¤„ç†é€»è¾‘

1. isResultä¸ºtrue >> æœç´¢ç»“æœ
2. seachTextå­˜åœ¨&isResultsä¸ºfalse >> æœç´¢å»ºè®®
3. searchTextä¸å­˜åœ¨ && isResultä¸ºfalse >> æœç´¢å†å²



> å¦‚æœè¾“å…¥æ¡†èšç„¦ >> isResultä¸ºfalse ï¼ˆä¸èƒ½å±•ç¤ºæœç´¢ç»“æœ >> ç”¨æˆ·å¼€å§‹è¾“å…¥ï¼‰

:::

1ã€åœ¨ `data` ä¸­æ·»åŠ æ•°æ®ç”¨æ¥æ§åˆ¶æœç´¢ç»“æœçš„æ˜¾ç¤ºçŠ¶æ€

```js
data () {
  ...
  isResultShow: false
}
```

2ã€åœ¨æ¨¡æ¿ä¸­ç»‘å®šæ¡ä»¶æ¸²æŸ“

```html
<!-- æœç´¢ç»“æœ -->
<search-result v-if="isResult" />
<!-- /æœç´¢ç»“æœ -->

<!-- è”æƒ³å»ºè®® -->
<search-suggestion v-else-if="searchText" />
<!-- /è”æƒ³å»ºè®® -->

<!-- æœç´¢å†å²è®°å½• -->
<search-history v-else />
<!-- /æœç´¢å†å²è®°å½• -->
```

3ã€è§¦å‘æœç´¢ï¼Œæ˜¾ç¤ºæœç´¢ç»“æœ

```js
onSearch (val) {
      this.isResult = true
    }
```

4ã€è·å–ç„¦ç‚¹,éšè—æœç´¢ç»“æœ

```html
<van-search
        v-model="searchText"
        show-action
        placeholder="è¯·è¾“å…¥æœç´¢å…³é”®è¯"
        @search="onSearch"
        @cancel="onCancel"
        @focus="isResult = false"
      />
```





## 6.4 æœç´¢è”æƒ³å»ºè®®

åŸºæœ¬æ€è·¯ï¼š

- å½“æœç´¢æ¡†è¾“å…¥å†…å®¹çš„æ—¶å€™ï¼Œè¯·æ±‚åŠ è½½è”æƒ³å»ºè®®çš„æ•°æ®
- å°†è¯·æ±‚å¾—åˆ°çš„ç»“æœç»‘å®šåˆ°æ¨¡æ¿ä¸­



### 6.4.1 è·å–å¹¶ç›‘å¬è¾“å…¥æ¡†å†…å®¹çš„å˜åŒ–

ä¸€ã€å°†çˆ¶ç»„ä»¶ä¸­æœç´¢æ¡†è¾“å…¥çš„å†…å®¹ä¼ ç»™è”æƒ³å»ºè®®å­ç»„ä»¶

```html
<search-suggestion :searchText="searchText" v-else></search-suggestion>
```

äºŒã€åœ¨å­ç»„ä»¶ä¸­ç›‘è§†æœç´¢æ¡†è¾“å…¥å†…å®¹çš„å˜åŒ–ï¼Œå¦‚æœå˜åŒ–åˆ™è¯·æ±‚è·å–è”æƒ³å»ºè®®æ•°æ®

```js
props: {
    searchText: {
      type: String,
      required: true
    }
  },
  watch: {
    searchText: {
      // ç›‘è§†çš„å¤„ç†å‡½æ•°
      handler (val) {
        console.log(val)
      },
      // é¦–æ¬¡ç›‘è§†è§¦å‘
      immediate: true
    }
  }
```



### 6.4.2 è¯·æ±‚è·å–å±•ç¤ºæ•°æ®

ä¸€ã€å°†è·å–åˆ°çš„è”æƒ³å»ºè®®æ•°æ®å±•ç¤ºåˆ°åˆ—è¡¨ä¸­

1. å®šä¹‰è·å–å»ºè®®çš„æ–¹æ³•  search.js

   ```js
   import request from '@/utils/request'
   
   /**
    * è·å–æœç´¢è”æƒ³å»ºè®®
    */
   export const getSearchSuggestion = q => {
     return request({
       method: 'GET',
       url: '/app/v1_0/suggestion',
       params: {
         q
       }
     })
   }
   ```

2. å¼•å…¥getSearchSuggestion

   ```js
   import { getSearchSuggestion } from '@/api/search.js'
   ```

3. å®šä¹‰åŠ è½½æ•°æ®çš„æ–¹æ³•å¹¶è°ƒç”¨getSearchSuggestion

   ```js
   watch: {
       searchText: {
         // ç›‘è§†çš„å¤„ç†å‡½æ•°
         handler (val) {
           this.loadSearchSuggestion(val)
         },
         // é¦–æ¬¡ç›‘è§†è§¦å‘
         immediate: true
       }
     },
     created () {},
     mounted () {},
     methods: {
       async loadSearchSuggestion (q) {
         try {
           const { data } = await getSearchSuggestion(q)
           this.suggestions = data.data.options
         } catch {
           this.$toast('è·å–å¤±è´¥')
         }
       }
     }
   ```

4. æ¨¡æ¿æ¸²æŸ“

   ```html
   <div class="search-suggestion">
       <van-cell
       v-for="(item, index) in suggestions"
       :key="index"
       :title="item"
       icon="search"></van-cell>
     </div>
   ```

   

   

### 6.4.3 é˜²æŠ–ä¼˜åŒ–

1ã€å®‰è£… lodash

```sh
# yarn add lodash
npm i lodash
```

2ã€é˜²æŠ–å¤„ç†

```js
// lodash æ”¯æŒæŒ‰éœ€åŠ è½½ï¼Œæœ‰åˆ©äºæ‰“åŒ…ç»“æœä¼˜åŒ–
import { debounce } from "lodash"
```

> ä¸å»ºè®®ä¸‹é¢è¿™æ ·ä½¿ç”¨ï¼Œå› ä¸ºè¿™æ ·ä¼šåŠ è½½æ•´ä¸ªæ¨¡å—ã€‚
>
> ```js
> import _ from 'lodash'
> _.debounce()
> ```

```js
// debounce å‡½æ•°
// å‚æ•°1ï¼šå‡½æ•°
// å‚æ•°2ï¼šé˜²æŠ–æ—¶é—´
// è¿”å›å€¼ï¼šé˜²æŠ–ä¹‹åçš„å‡½æ•°ï¼Œå’Œå‚æ•°1åŠŸèƒ½æ˜¯ä¸€æ ·çš„
handler: debounce(function (val) {
    this.loadSearchSuggestion(val)
}, 1000)
```



### 6.4.5 æœç´¢å…³é”®å­—é«˜äº®

#### 6.4.5.1 æ€è·¯åˆ†æ 

å¦‚ä½•å°†å­—ç¬¦ä¸²ä¸­çš„æŒ‡å®šå­—ç¬¦åœ¨**ç½‘é¡µ**ä¸­é«˜äº®å±•ç¤ºï¼Ÿ

```js
"Hello World";
```

å°†éœ€è¦é«˜äº®çš„å­—ç¬¦åŒ…è£¹ HTML æ ‡ç­¾ï¼Œä¸ºå…¶å•ç‹¬è®¾ç½®é¢œè‰²ã€‚

```js
"Hello <span style="color: red">World</span>"
```

åœ¨ Vue ä¸­å¦‚ä½•æ¸²æŸ“å¸¦æœ‰ HTML æ ‡ç­¾çš„å­—ç¬¦ä¸²ï¼Ÿ

```js
data () {
  return {
    htmlStr: 'Hello <span style="color: red">World</span>'
  }
}
```



```html
<div>{{ htmlStr }}</div>
<div v-html="htmlStr"></div>
```

![image-20200112154732044](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/2022/01/23/image20200112154732044.png)

å¦‚ä½•æŠŠå­—ç¬¦ä¸²ä¸­æŒ‡å®šå­—ç¬¦ç»Ÿä¸€æ›¿æ¢ä¸ºé«˜äº®ï¼ˆåŒ…è£¹äº† HTMLï¼‰çš„å­—ç¬¦ï¼Ÿ

```js
const str = "Hello World"

// ç»“æœï¼š<span style="color: red">Hello</span> World
"Hello World".replace('Hello', '<span style="color: red">Hello</span>')

// éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œreplace æ–¹æ³•çš„å­—ç¬¦ä¸²åŒ¹é…åªèƒ½æ›¿æ¢ç¬¬1ä¸ªæ»¡è¶³çš„å­—ç¬¦
// <span style="color: red">Hello</span> World Hello abc
"Hello World Hello abc".replace('Hello', '<span style="color: red">Hello</span>')

// å¦‚æœæƒ³è¦å…¨æ–‡æ›¿æ¢ï¼Œä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼
// g å…¨å±€
// i å¿½ç•¥å¤§å°å†™
// <span style="color: red">Hello</span> World <span style="color: red">Hello</span> abc
"Hello World Hello abc".replace(/Hello/gi, '<span style="color: red">Hello</span>')
```

> ä¸€ä¸ªå°æ‰©å±•ï¼šä½¿ç”¨å­—ç¬¦ä¸²çš„ split ç»“åˆæ•°ç»„çš„ join æ–¹æ³•å®ç°é«˜äº®
>
> ```js
> var str = "hello world ä½ å¥½ hello";
>
> // ["", " world ä½ å¥½ ", ""]
> const arr = str.split("hello");
>
> // "<span>hello</span> world ä½ å¥½ <span>hello</span>"
> arr.join("<span>hello</span>");
> ```

#### 6.4.5.2 æœç´¢å…³é”®å­—é«˜äº® 

æå‰å°†æ–‡æœ¬è®¾ç½®ä¸ºæ’æ§½

```html
<van-cell
          v-for="(item, index) in suggestions"
          :key="index"
          icon="search">
    <span slot="title" v-html="item"></span>
</van-cell>
```



1ã€åœ¨ methods ä¸­æ·»åŠ ä¸€ä¸ªæ–¹æ³•å¤„ç†é«˜äº®

```js
/**
     * å¤„ç†é«˜äº®æ–‡æœ¬
     * æ€è·¯ï¼š
     * 1. æƒ³è¦åœ¨ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ï¼Œå°†å›ºå®šçš„å­—ç¬¦ç‰¹æ®Šæ˜¾ç¤ºï¼ˆæ”¹å˜é¢œè‰²ï¼‰
     * 2. é‚£ä¹ˆå°±éœ€è¦åœ¨è¿™ä¸ªå­—ç¬¦ä¸²ä¸­ï¼Œæ‰¾å‡ºè¯¥å­—ç¬¦ï¼Œç„¶åä¸ºè¯¥å­—ç¬¦è®¾ç½®å•ç‹¬çš„æ ·å¼ï¼ˆspan.activeï¼‰
     * æ‹†è§£ï¼š
     *     1. æ‰¾å‡ºå­—ç¬¦
     *     2. æ›¿æ¢å­—ç¬¦
     *     3. è®¾ç½®å•ç‹¬çš„æ ·å¼æ¯”è¾ƒå®¹æ˜“ï¼ˆæ›¿æ¢å­—ç¬¦ï¼‰ï¼Œéš¾ç‚¹åœ¨äºæ‰¾å‡ºå­—ç¬¦
     * å¦‚ä½•æ‰¾å‡ºå­—ç¬¦ï¼š
     * 1. é‚£ä¹ˆã€Šå¤„ç†é«˜äº®æ–‡æœ¬ã€‹çš„é—®é¢˜ï¼Œå°±å˜æˆï¼Œã€Šå¦‚ä½•åœ¨å­—ç¬¦ä¸²ä¸­æ‰¾å‡ºå›ºå®šçš„å­—ç¬¦ã€‹
     * 2. åœ¨å­—ç¬¦ä¸²ä¸­æ‰¾å‡ºå›ºå®šå­—ç¬¦ï¼Œå¤§å®¶é¦–å…ˆæƒ³åˆ°çš„å°±åº”è¯¥æ˜¯ä½¿ç”¨ -ã€‹ æ­£åˆ™è¡¨è¾¾å¼
     * 3. ç®€å•ä½¿ç”¨æ­£åˆ™ï¼ˆtext.replace(/åŒ¹é…çš„å†…å®¹/gi, highlightStr)ï¼‰ , æ— æ³•æ’å…¥å“åº”å¼æ•°æ®
     * 4. æ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨äº† RegExp å¯¹è±¡ã€‚RegExp æ„é€ å‡½æ•°åˆ›å»ºäº†ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡ï¼Œç”¨äºå°†æ–‡æœ¬ä¸ä¸€ä¸ªæ¨¡å¼åŒ¹é…ã€‚MDN: https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/RegExp
     * 5. é€šè¿‡ RegExp æ¥å®Œæˆå“åº”å¼æ•°æ®çš„æ­£åˆ™åŒ¹é…
     */
    highlightText(text) {
      const highlightStr = `<span class="active">${this.searchText}</span>`;
      // æ­£åˆ™è¡¨è¾¾å¼ // ä¸­é—´çš„å†…å®¹éƒ½ä¼šå½“ä½œåŒ¹é…å­—ç¬¦æ¥ä½¿ç”¨ï¼Œè€Œä¸æ˜¯æ•°æ®å˜é‡
      // å¦‚æœéœ€è¦æ ¹æ®æ•°æ®å˜é‡åŠ¨æ€çš„åˆ›å»ºæ­£åˆ™è¡¨è¾¾å¼ï¼Œåˆ™æ‰‹åŠ¨ new RegExp
      // RegExp æ­£åˆ™è¡¨è¾¾å¼æ„é€ å‡½æ•°
      //    å‚æ•°1ï¼šåŒ¹é…æ¨¡å¼å­—ç¬¦ä¸²ï¼Œå®ƒä¼šæ ¹æ®è¿™ä¸ªå­—ç¬¦ä¸²åˆ›å»ºæ­£åˆ™å¯¹è±¡
      //    å‚æ•°2ï¼šåŒ¹é…æ¨¡å¼ï¼Œè¦å†™åˆ°å­—ç¬¦ä¸²ä¸­
      const reg = new RegExp(this.searchText, 'gi');
      // text.replace(/åŒ¹é…çš„å†…å®¹/gi, highlightStr)
      return text.replace(reg, highlightStr);
    }
```

2ã€ç„¶ååœ¨è”æƒ³å»ºè®®åˆ—è¡¨é¡¹ä¸­ç»‘å®šè°ƒç”¨

```html
<!-- è”æƒ³å»ºè®® -->
<van-cell-group v-else-if="searchContent">
  <van-cell
    icon="search"
    v-for="(item, index) in suggestions"
    :key="index"
    @click="onSearch(item)"
  >
    <div slot="title" v-html="highlight(item)"></div>
  </van-cell>
</van-cell-group>
<!-- /è”æƒ³å»ºè®® -->
```

## 6.5 æœç´¢ç»“æœ

æ€è·¯ï¼š

- æ‰¾åˆ°æ•°æ®æ¥å£
- è¯·æ±‚è·å–æ•°æ®
- å°†æ•°æ®å±•ç¤ºåˆ°æ¨¡æ¿ä¸­

### 6.5.1 ç‚¹å‡»å»ºè®®ï¼Œä¼ é€’æœç´¢å†…å®¹

ç‚¹å‡»è”æƒ³è¿›è¡Œæœç´¢

```html
<van-cell
          v-for="(item, index) in suggestions"
          :key="index"
          @click="$emit('search', item)"
          icon="search">
    <span slot="title" v-html="highlight(item)"></span>
</van-cell>
```

å®šä¹‰è‡ªå®šä¹‰äº‹ä»¶å’Œå‡½æ•°

```html
<!-- æœç´¢è”æƒ³ -->
<search-suggestion @search="onSearch" v-else :search-text="value" />
```

```js
// äº‹ä»¶å‡½æ•°
onSearch (val) {
    this.value = val
    this.isShowSearchResult = true
}
```

### 6.5.2 å¤„ç†å®Œæˆ



#### 6.5.2.1 å†…å®¹è·å–æœç´¢å…³é”®å­— - å¤„ç†å®Œæˆ

ä¸€ã€è·å–æœç´¢å…³é”®å­—

1ã€å£°æ˜æ¥æ”¶çˆ¶ç»„ä»¶ä¸­çš„æœç´¢æ¡†è¾“å…¥çš„å†…å®¹

```js
props: {
    searchText: {
        type: String,
        require: true
    }
}
```

2ã€åœ¨çˆ¶ç»„ä»¶ç»™å­ç»„ä»¶ä¼ é€’æ•°æ®

```html
<!-- æœç´¢ç»“æœ -->
<search-result v-if="isResultShow" :searchText="searchText" />
<!-- /æœç´¢ç»“æœ -->
```



æœ€ååœ¨è°ƒè¯•å·¥å…·ä¸­æŸ¥çœ‹ç¡®è®¤æ˜¯å¦æ¥æ”¶åˆ° props æ•°æ®ã€‚

![image-20200112162223915](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/2022/01/23/image20200112162223915.png)

äºŒã€è¯·æ±‚è·å–æ•°æ®

1ã€åœ¨ `api/serach.js` æ·»åŠ å°è£…è·å–æœç´¢ç»“æœçš„è¯·æ±‚æ–¹æ³•

```js
/**
 * è·å–æœç´¢ç»“æœ
 */
export function getSearch(params) {
  return request({
    method: "GET",
    url: "/app/v1_0/search",
    params
  })
}
```

2ã€è¯·æ±‚è·å–

```js
+ import { getSearch } from '@/api/search'

export default {
  name: 'SearchResult',
  components: {},
  props: {
    q: {
      type: String,
      require: true
    }
  },
  data () {
    return {
      list: [],
      loading: false,
      finished: false,
+      page: 1,
+      perPage: 20
    }
  },
  computed: {},
  watch: {},
  created () {},
  mounted () {},
  methods: {
+++ async onLoad () {
      // 1. è¯·æ±‚è·å–æ•°æ®
      const { data } = await getSearch({
        page: this.page, // é¡µç 
        per_page: this.perPage, // æ¯é¡µå¤§å°
        q: this.q // æœç´¢å…³é”®å­—
      })

      // 2. å°†æ•°æ®æ·»åŠ åˆ°åˆ—è¡¨ä¸­
      const { results } = data.data
      this.list.push(...results)

      // 3. è®¾ç½®åŠ è½½çŠ¶æ€ç»“æŸ
      this.loading = false

      // 4. åˆ¤æ–­æ•°æ®æ˜¯å¦åŠ è½½å®Œæ¯•
      if (results.length) {
        this.page++ // æ›´æ–°è·å–ä¸‹ä¸€é¡µæ•°æ®çš„é¡µç 
      } else {
        this.finished = true // æ²¡æœ‰æ•°æ®äº†ï¼Œå°†åŠ è½½çŠ¶æ€è®¾ç½®ç»“æŸï¼Œä¸å† onLoad
      }
    }
  }
}
```

ä¸‰ã€æœ€åï¼Œæ¨¡æ¿ç»‘å®š

```html
<van-list
  v-model="loading"
  :finished="finished"
  finished-text="æ²¡æœ‰æ›´å¤šäº†"
  @load="onLoad"
>
  <van-cell
+    v-for="(article, index) in list"
+    :key="index"
+    :title="article.title"
  />
</van-list>
```

#### 6.5.2.2 é”™è¯¯æç¤º

```html
<van-list
          v-model="loading"
          :finished="finished"
          finished-text="æ²¡æœ‰æ›´å¤šäº†"
          :error.sync="error"
          error-text="è¯·æ±‚å¤±è´¥ï¼Œç‚¹å‡»é‡æ–°åŠ è½½"
          @load="onLoad"
          >
    <van-cell v-for="item in list" :key="item.art_id" :title="item.title" />
</van-list>
```

```js
catch (err) {
    this.error = true
    this.loading = false
}
```

#### 6.5.2.3  é¡¶éƒ¨å›ºå®š

```css
.search {
    padding-top: 106px;
    .van-search {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 1;
    }
    .van-search__action {
        color: #fff;
    }
}
```

 

## 6.6 æœç´¢å†å²è®°å½•

> index.vue >> çˆ¶ç»„ä»¶ä¸­ç»´æŠ¤æœç´¢å†å²è®°å½•æ•°æ®ï¼Œå½“ç‚¹å‡»æœç´¢çš„æ—¶å€™ä¿®æ”¹å†å²æ•°æ®åˆ—è¡¨

### 6.6.1 æ·»åŠ å†å²è®°å½•

å½“å‘ç”Ÿæœç´¢çš„æ—¶å€™æˆ‘ä»¬æ‰éœ€è¦è®°å½•å†å²è®°å½•ã€‚

1ã€åœ¨ data ä¸­æ·»åŠ ä¸€ä¸ªæ•°æ®ç”¨æ¥å­˜å‚¨å†å²è®°å½•

```js
data () {
  return {
    ...
    searchHistories: []
  }
}
```

2ã€åœ¨è§¦å‘æœç´¢çš„æ—¶å€™ï¼Œè®°å½•å†å²è®°å½•

```js
onSearch (val) {
  // æ›´æ–°æ–‡æœ¬æ¡†å†…å®¹
  this.searchText = val

  // å­˜å‚¨æœç´¢å†å²è®°å½•
  // è¦æ±‚ï¼šä¸è¦æœ‰é‡å¤å†å²è®°å½•ã€æœ€æ–°çš„æ’åœ¨æœ€å‰é¢
  const index = this.searchHistories.indexOf(val)
  if (index !== -1) {
    this.searchHistories.splice(index, 1)
  }
  this.searchHistories.unshift(val)

  // æ¸²æŸ“æœç´¢ç»“æœ
  this.isResultShow = true
},
```



### 6.6.2 å±•ç¤ºå†å²è®°å½•

å°†æ•°æ®ä¼ é€’ç»™æœç´¢å†å²ç»„ä»¶

```html
<!-- æœç´¢å†å² -->
<search-history v-else-if="!value" :searchHistory="searchHistory" />
```

æœç´¢å†å²ç»„ä»¶æ¥æ”¶æ•°æ®

```js
props: {
    searchHistory: {
        type: Array,
        required: true
    }
}
```

æ˜¾ç¤ºæœç´¢å†å²

```html
<!-- å†å²è®°å½• -->
<van-cell-group v-else>
  <van-cell title="å†å²è®°å½•">
    <van-icon name="delete" />
    <span>å…¨éƒ¨åˆ é™¤</span>
    &nbsp;&nbsp;
    <span>å®Œæˆ</span>
  </van-cell>
  <van-cell
    :title="item"
    v-for="(item, index) in searchHistory"
    :key="index"
  >
    <van-icon name="close"></van-icon>
  </van-cell>
</van-cell-group>
<!-- /å†å²è®°å½• -->
```



### 6.6.3 åˆ é™¤å†å²è®°å½•

åŸºæœ¬æ€è·¯ï¼š

- ç»™å†å²è®°å½•ä¸­çš„æ¯ä¸€é¡¹æ³¨å†Œç‚¹å‡»äº‹ä»¶
- åœ¨å¤„ç†å‡½æ•°ä¸­åˆ¤æ–­
  - å¦‚æœæ˜¯åˆ é™¤çŠ¶æ€ï¼Œåˆ™æ‰§è¡Œåˆ é™¤æ“ä½œ
  - å¦‚æœæ˜¯éåˆ é™¤çŠ¶æ€ï¼Œåˆ™æ‰§è¡Œæœç´¢æ“ä½œ



#### 6.6.3.1 å¤„ç†åˆ é™¤ç›¸å…³å…ƒç´ çš„å±•ç¤ºçŠ¶æ€

1ã€åœ¨ data ä¸­æ·»åŠ ä¸€ä¸ªæ•°æ®ç”¨æ¥æ§åˆ¶åˆ é™¤ç›¸å…³å…ƒç´ çš„æ˜¾ç¤ºçŠ¶æ€

```js
data () {
  return {
    ...
    isDeleteShow: false
  }
}
```

2ã€ç»‘å®šä½¿ç”¨

```html
<!-- å†å²è®°å½• -->
<van-cell-group v-else>
  <van-cell title="å†å²è®°å½•">
    <template v-if="isDeleteShow">
      <span @click="searchHistories = []">å…¨éƒ¨åˆ é™¤</span>
      &nbsp;&nbsp;
      <span @click="isDeleteShow = false">å®Œæˆ</span>
    </template>
    <van-icon v-else name="delete" @click="isDeleteShow = true"></van-icon>
  </van-cell>
  <van-cell
    :title="item"
    v-for="(item, index) in searchHistories"
    :key="index"
    @click="onSearch(item)"
  >
    <van-icon
      v-show="isDeleteShow"
      name="close"
      @click="searchHistories.splice(index, 1)"
    ></van-icon>
  </van-cell>
</van-cell-group>
<!-- /å†å²è®°å½• -->
```

#### 6.6.3.2 å¤„ç†åˆ é™¤æ“ä½œ

```html
<!-- å†å²è®°å½• -->
<van-cell-group v-else>
  <van-cell title="å†å²è®°å½•">
    <template v-if="isDeleteShow">
+      <span @click="searchHistories = []">å…¨éƒ¨åˆ é™¤</span>
      &nbsp;&nbsp;
      <span @click="isDeleteShow = false">å®Œæˆ</span>
    </template>
    <van-icon v-else name="delete" @click="isDeleteShow = true" />
  </van-cell>
  <van-cell
    :title="item"
    v-for="(item, index) in searchHistories"
    :key="index"
+    @click="onHistoryClick(item, index)"
  >
    <van-icon v-show="isDeleteShow" name="close"></van-icon>
  </van-cell>
</van-cell-group>
<!-- /å†å²è®°å½• -->
```

```js
onHistoryClick (item, index) {
  // å¦‚æœæ˜¯åˆ é™¤çŠ¶æ€ï¼Œåˆ™æ‰§è¡Œåˆ é™¤æ“ä½œ
  if (this.isDeleteShow) {
    this.searchHistory.splice(index, 1)
  } else {
    // å¦åˆ™æ‰§è¡Œæœç´¢æ“ä½œ
  }
}
```

åˆ é™¤å…¨éƒ¨

```html
<van-cell title="æœç´¢å†å²">
    <div v-if="isDeleteShow">
        <span @click="$emit('clear-search-history')" style="margin-right: 10px;">å…¨éƒ¨åˆ é™¤</span>
        <span @click="isDeleteShow = false">å®Œæˆ</span>
    </div>
    <van-icon v-else @click="isDeleteShow = true" name="delete" />
</van-cell>
<van-cell
          :title="item"
          v-for="(item, index) in searchHistory"
          :key="index"
          @click="onHistoryClick(item, index)"
          >
    <van-icon v-if="isDeleteShow" name="close"></van-icon>
</van-cell>
```

```html
<search-history @clear-search-history="searchHistories = []" :searchHistory="searchHistories" v-else-if="!searchText"></search-history>
```

ç‚¹å‡»æœç´¢

```js
onHistoryClick (item, index) {
  // å¦‚æœæ˜¯åˆ é™¤çŠ¶æ€ï¼Œåˆ™æ‰§è¡Œåˆ é™¤æ“ä½œ
  if (this.isDeleteShow) {
    this.searchHistory.splice(index, 1)
  } else {
    // å¦åˆ™æ‰§è¡Œæœç´¢æ“ä½œ
    this.$emit('search', item)
  }
}
```

```html
<search-history @search="onSearch" @clear-search-history="searchHistories = []" :searchHistory="searchHistories" v-else-if="!searchText"></search-history>
```



### 6.6.4 æ•°æ®æŒä¹…åŒ–

> çˆ¶ç»„ä»¶index.vueé‡Œé¢è¿›è¡Œæ•°æ®çš„ç›‘å¬

1ã€åˆ©ç”¨ watch ç›‘è§†ç»Ÿä¸€å­˜å‚¨æ•°æ®

```js
watch: {
  searchHistories (val) {
    // åŒæ­¥åˆ°æœ¬åœ°å­˜å‚¨
    setItem('serach-histories', val)
  }
},
```



2ã€åˆå§‹åŒ–çš„æ—¶å€™ä»æœ¬åœ°å­˜å‚¨è·å–æ•°æ®

```js
data () {
  return {
    ...
    searchHistories: getItem('serach-histories') || [],
  }
}
```

