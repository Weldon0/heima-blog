---
title: ğŸ“š 07-æ–‡ç« è¯¦æƒ…
---
# ä¸ƒã€æ–‡ç« è¯¦æƒ…

## åˆ›å»ºç»„ä»¶å¹¶é…ç½®è·¯ç”±

1ã€åˆ›å»º `views/article/index.vue` ç»„ä»¶

```html
<template>
  <div class="article-container">æ–‡ç« è¯¦æƒ…</div>
</template>

<script>
export default {
  name: 'ArticleIndex',
  components: {},
  props: {
    articleId: {
      type: [Number, String],
      required: true
    }
  },
  data () {
    return {}
  },
  computed: {},
  watch: {},
  created () {},
  mounted () {},
  methods: {}
}
</script>

<style scoped lang="less"></style>

```

2ã€ç„¶åå°†è¯¥é¡µé¢é…ç½®åˆ°æ ¹çº§è·¯ç”±

```js
{
  path: '/article/:articleId',
  name: 'article',
  component: () => import('@/views/article'),
  // å°†è·¯ç”±åŠ¨æ€å‚æ•°æ˜ å°„åˆ°ç»„ä»¶çš„ props ä¸­ï¼Œæ›´æ¨èè¿™ç§åšæ³•
  props: true
}
```

3ã€é€šè¿‡propsè·å–è·¯ç”±å‚æ•°

```js
props: {
    articleId: {
      type: [Number, String],
      required: true
    }
  }
```



> [å®˜æ–¹æ–‡æ¡£ï¼šè·¯ç”± props ä¼ å‚](https://router.vuejs.org/zh/guide/essentials/passing-props.html)



## é¡µé¢å¸ƒå±€

ä½¿ç”¨åˆ°çš„ Vant ä¸­çš„ç»„ä»¶ï¼š

- [NavBar å¯¼èˆªæ ](https://youzan.github.io/vant/#/zh-CN/nav-bar)

- [Loading åŠ è½½](https://youzan.github.io/vant/#/zh-CN/loading)
- [Cell å•å…ƒæ ¼](https://youzan.github.io/vant/#/zh-CN/cell)
- [Button æŒ‰é’®](https://youzan.github.io/vant/#/zh-CN/button)
- [Image å›¾ç‰‡](https://youzan.github.io/vant/#/zh-CN/image)
- [Divider åˆ†å‰²çº¿](https://youzan.github.io/vant/#/zh-CN/divider)
- [Icon å›¾æ ‡](https://youzan.github.io/vant/#/zh-CN/icon)

```html
<template>
  <div class="article-container">
    <!-- å¯¼èˆªæ  -->
    <van-nav-bar
      class="page-nav-bar"
      left-arrow
      title="é»‘é©¬å¤´æ¡"
    ></van-nav-bar>
    <!-- /å¯¼èˆªæ  -->

    <div class="main-wrap">
      <!-- åŠ è½½ä¸­ -->
      <div class="loading-wrap">
        <van-loading
          color="#3296fa"
          vertical
        >åŠ è½½ä¸­</van-loading>
      </div>
      <!-- /åŠ è½½ä¸­ -->

      <!-- åŠ è½½å®Œæˆ-æ–‡ç« è¯¦æƒ… -->
      <div class="article-detail">
        <!-- æ–‡ç« æ ‡é¢˜ -->
        <h1 class="article-title">è¿™æ˜¯æ–‡ç« æ ‡é¢˜</h1>
        <!-- /æ–‡ç« æ ‡é¢˜ -->

        <!-- ç”¨æˆ·ä¿¡æ¯ -->
        <van-cell class="user-info" center :border="false">
          <van-image
            class="avatar"
            slot="icon"
            round
            fit="cover"
            src="https://img.yzcdn.cn/vant/cat.jpeg"
          />
          <div slot="title" class="user-name">é»‘é©¬å¤´æ¡å·</div>
          <div slot="label" class="publish-date">14å°æ—¶å‰</div>
          <van-button
            class="follow-btn"
            type="info"
            color="#3296fa"
            round
            size="small"
            icon="plus"
          >å…³æ³¨</van-button>
          <!-- <van-button
            class="follow-btn"
            round
            size="small"
          >å·²å…³æ³¨</van-button> -->
        </van-cell>
        <!-- /ç”¨æˆ·ä¿¡æ¯ -->

        <!-- æ–‡ç« å†…å®¹ -->
        <div class="article-content">è¿™æ˜¯æ–‡ç« å†…å®¹</div>
        <van-divider>æ­£æ–‡ç»“æŸ</van-divider>
      </div>
      <!-- /åŠ è½½å®Œæˆ-æ–‡ç« è¯¦æƒ… -->

      <!-- åŠ è½½å¤±è´¥ï¼š404 -->
      <div class="error-wrap">
        <van-icon name="failure" />
        <p class="text">è¯¥èµ„æºä¸å­˜åœ¨æˆ–å·²åˆ é™¤ï¼</p>
      </div>
      <!-- /åŠ è½½å¤±è´¥ï¼š404 -->

      <!-- åŠ è½½å¤±è´¥ï¼šå…¶å®ƒæœªçŸ¥é”™è¯¯ï¼ˆä¾‹å¦‚ç½‘ç»œåŸå› æˆ–æœåŠ¡ç«¯å¼‚å¸¸ï¼‰ -->
      <div class="error-wrap">
        <van-icon name="failure" />
        <p class="text">å†…å®¹åŠ è½½å¤±è´¥ï¼</p>
        <van-button class="retry-btn">ç‚¹å‡»é‡è¯•</van-button>
      </div>
      <!-- /åŠ è½½å¤±è´¥ï¼šå…¶å®ƒæœªçŸ¥é”™è¯¯ï¼ˆä¾‹å¦‚ç½‘ç»œåŸå› æˆ–æœåŠ¡ç«¯å¼‚å¸¸ï¼‰ -->
    </div>

    <!-- åº•éƒ¨åŒºåŸŸ -->
    <div class="article-bottom">
      <van-button
        class="comment-btn"
        type="default"
        round
        size="small"
      >å†™è¯„è®º</van-button>
      <van-icon
        name="comment-o"
        info="123"
        color="#777"
      />
      <van-icon
        color="#777"
        name="star-o"
      />
      <van-icon
        color="#777"
        name="good-job-o"
      />
      <van-icon name="share" color="#777777"></van-icon>
    </div>
    <!-- /åº•éƒ¨åŒºåŸŸ -->
  </div>
</template>

<script>
export default {
  name: 'ArticleIndex',
  components: {},
  props: {
    articleId: {
      type: [Number, String],
      required: true
    }
  },
  data () {
    return {}
  },
  computed: {},
  watch: {},
  created () {},
  mounted () {},
  methods: {}
}
</script>

<style scoped lang="less">
.article-container {
  .main-wrap {
    position: fixed;
    left: 0;
    right: 0;
    top: 92px;
    bottom: 88px;
    overflow-y: scroll;
    background-color: #fff;
  }
  .article-detail {
    .article-title {
      font-size: 40px;
      padding: 50px 32px;
      margin: 0;
      color: #3a3a3a;
    }

    .user-info {
      padding: 0 32px;
      .avatar {
        width: 70px;
        height: 70px;
        margin-right: 17px;
      }
      .van-cell__label {
        margin-top: 0;
      }
      .user-name {
        font-size: 24px;
        color: #3a3a3a;
      }
      .publish-date {
        font-size: 23px;
        color: #b7b7b7;
      }
      .follow-btn {
        width: 170px;
        height: 58px;
      }
    }

    .article-content {
      padding: 55px 32px;
      /deep/ p {
        text-align: justify;
      }
    }
  }

  .loading-wrap {
    padding: 200px 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: #fff;
  }

  .error-wrap {
    padding: 200px 32px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background-color: #fff;
    .van-icon {
      font-size: 122px;
      color: #b4b4b4;
    }
    .text {
      font-size: 30px;
      color: #666666;
      margin: 33px 0 46px;
    }
    .retry-btn {
      width: 280px;
      height: 70px;
      line-height: 70px;
      border: 1px solid #c3c3c3;
      font-size: 30px;
      color: #666666;
    }
  }

  .article-bottom {
    position: fixed;
    left: 0;
    right: 0;
    bottom: 0;
    display: flex;
    justify-content: space-around;
    align-items: center;
    box-sizing: border-box;
    height: 88px;
    border-top: 1px solid #d8d8d8;
    background-color: #fff;
    .comment-btn {
      width: 282px;
      height: 46px;
      border: 2px solid #eeeeee;
      font-size: 30px;
      line-height: 46px;
      color: #a7a7a7;
    }
    .van-icon {
      font-size: 40px;
      .van-info {
        font-size: 16px;
        background-color: #e22829;
      }
    }
  }
}
</style>

```

## è·å–æ–‡ç« è¯¦æƒ…æ•°æ®

1ã€å°è£…è¯·æ±‚æ–‡ç« è¯¦æƒ…æ–¹æ³•

```js
/**
 * æ–‡ç« æ¥å£æ¨¡å—
 */
import request from '@/utils/request'

/**
 * è·å–é¢‘é“çš„æ–‡ç« åˆ—è¡¨
 */
export const getArticleById = articleId => {
  return request({
    method: 'GET',
    url: '/app/v1_0/articles/' + articleId
  })
}
```



2ã€å¼•å…¥æ–¹æ³•

```js
import { getArticleById } from '@/api/article.js'
```



3ã€å®šä¹‰åŠ è½½æ•°æ®æ–¹æ³•

```js
async loadArtcileInfo () {
    try {
        const res = await getArticleById(this.articleId)
        console.log(res)
    } catch (err) {
        this.$toast('è·å–å¤±è´¥')
    }
}
```



## å…³äºåç«¯è¿”å›æ•°æ®ä¸­çš„å¤§æ•°å­—é—®é¢˜

ä¹‹æ‰€ä»¥è¯·æ±‚æ–‡ç« è¯¦æƒ…è¿”å› 404 æ˜¯å› ä¸ºæˆ‘ä»¬è¯·æ±‚å‘é€çš„æ–‡ç«  ID ï¼ˆarticle.art_idï¼‰ä¸æ­£ç¡®ã€‚

JavaScript èƒ½å¤Ÿå‡†ç¡®è¡¨ç¤ºçš„æ•´æ•°èŒƒå›´åœ¨`-2^53`åˆ°`2^53`ä¹‹é—´ï¼ˆä¸å«ä¸¤ä¸ªç«¯ç‚¹ï¼‰ï¼Œè¶…è¿‡è¿™ä¸ªèŒƒå›´ï¼Œæ— æ³•ç²¾ç¡®è¡¨ç¤ºè¿™ä¸ªå€¼ï¼Œè¿™ä½¿å¾— JavaScript ä¸é€‚åˆè¿›è¡Œç§‘å­¦å’Œé‡‘èæ–¹é¢çš„ç²¾ç¡®è®¡ç®—ã€‚

```javascript
Math.pow(2, 53) // 9007199254740992

9007199254740992  // 9007199254740992
9007199254740993  // 9007199254740992

Math.pow(2, 53) === Math.pow(2, 53) + 1
// true
```

ä¸Šé¢ä»£ç ä¸­ï¼Œè¶…å‡º 2 çš„ 53 æ¬¡æ–¹ä¹‹åï¼Œä¸€ä¸ªæ•°å°±ä¸ç²¾ç¡®äº†ã€‚
ES6 å¼•å…¥äº†`Number.MAX_SAFE_INTEGER`å’Œ`Number.MIN_SAFE_INTEGER`è¿™ä¸¤ä¸ªå¸¸é‡ï¼Œç”¨æ¥è¡¨ç¤ºè¿™ä¸ªèŒƒå›´çš„ä¸Šä¸‹é™ã€‚

```javascript
Number.MAX_SAFE_INTEGER === Math.pow(2, 53) - 1
// true
Number.MAX_SAFE_INTEGER === 9007199254740991
// true

Number.MIN_SAFE_INTEGER === -Number.MAX_SAFE_INTEGER
// true
Number.MIN_SAFE_INTEGER === -9007199254740991
// true
```

ä¸Šé¢ä»£ç ä¸­ï¼Œå¯ä»¥çœ‹åˆ° JavaScript èƒ½å¤Ÿç²¾ç¡®è¡¨ç¤ºçš„æé™ã€‚

åç«¯è¿”å›çš„æ•°æ®ä¸€èˆ¬éƒ½æ˜¯ **JSON æ ¼å¼çš„å­—ç¬¦ä¸²**ã€‚

```json
'{ "id": 9007199254740995, "name": "Jack", "age": 18 }'
```

å¦‚æœè¿™ä¸ªå­—ç¬¦ä¸åšä»»ä½•å¤„ç†ï¼Œä½ èƒ½æ–¹ä¾¿çš„è·å–åˆ°å­—ç¬¦ä¸²ä¸­çš„æŒ‡å®šæ•°æ®å—ï¼Ÿéå¸¸éº»çƒ¦ã€‚æ‰€ä»¥æˆ‘ä»¬è¦æŠŠå®ƒè½¬æ¢ä¸º JavaScript å¯¹è±¡æ¥ä½¿ç”¨å°±å¾ˆæ–¹ä¾¿äº†ã€‚

å¹¸è¿çš„æ˜¯ axios ä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬ä½¿ç”¨æ•°æ®ï¼Œå®ƒä¼šåœ¨å†…éƒ¨ä½¿ç”¨ `JSON.parse()` æŠŠåç«¯è¿”å›çš„æ•°æ®è½¬ä¸º JavaScript å¯¹è±¡ã€‚

```javascript
// { id: 9007199254740996, name: 'Jack', age: 18 }
JSON.parse('{ "id": 9007199254740995, "name": "Jack", "age": 18 }')
```

å¯ä»¥çœ‹åˆ°ï¼Œè¶…å‡ºå®‰å…¨æ•´æ•°èŒƒå›´çš„ id æ— æ³•ç²¾ç¡®è¡¨ç¤ºï¼Œè¿™ä¸ªé—®é¢˜å¹¶ä¸æ˜¯ axios çš„é”™ã€‚

äº†è§£äº†ä»€ä¹ˆæ˜¯å¤§æ•´æ•°çš„æ¦‚å¿µï¼Œæ¥ä¸‹æ¥çš„é—®é¢˜æ˜¯å¦‚ä½•è§£å†³ï¼Ÿ

## åˆ©ç”¨json-bigintå¤„ç†å¤§æ•°å­—é—®é¢˜

[json-bigint](https://github.com/sidorares/json-bigint) æ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹åŒ…ï¼Œå®ƒå¯ä»¥å¸®æˆ‘ä»¬å¾ˆå¥½çš„å¤„ç†è¿™ä¸ªé—®é¢˜ã€‚

ä½¿ç”¨å®ƒçš„ç¬¬ä¸€æ­¥å°±æ˜¯æŠŠå®ƒå®‰è£…åˆ°ä½ çš„é¡¹ç›®ä¸­ã€‚

```shell
npm i json-bigint
```

ä¸‹é¢æ˜¯ä½¿ç”¨å®ƒçš„ä¸€ä¸ªç®€å•ç¤ºä¾‹ã€‚

> ä½œç”¨ï¼š
>
> 1. jsoné‡Œé¢çš„å¤§æ•°å­— >> BigNumberå¯¹è±¡ï¼ˆä½¿ç”¨çš„æ—¶å€™è¦toStringï¼‰
> 2. åŒ…å«BigNumberå¯¹è±¡ >> åŒ…å«å¤§æ•°å­—çš„json

```javascript
const jsonStr = '{ "art_id": 1245953273786007552 }'

console.log(JSON.parse(jsonStr)) // 1245953273786007600
// JSON.stringify()

// JSONBig å¯ä»¥å¤„ç†æ•°æ®ä¸­è¶…å‡º JavaScript å®‰å…¨æ•´æ•°èŒƒå›´çš„é—®é¢˜
console.log(JSONBig.parse(jsonStr)) // æŠŠ JSON æ ¼å¼çš„å­—ç¬¦ä¸²è½¬ä¸º JavaScript å¯¹è±¡

// ä½¿ç”¨çš„æ—¶å€™éœ€è¦æŠŠ BigNumber ç±»å‹çš„æ•°æ®è½¬ä¸ºå­—ç¬¦ä¸²æ¥ä½¿ç”¨
console.log(JSONBig.parse(jsonStr).art_id.toString()) // 1245953273786007552

console.log(JSON.stringify(JSONBig.parse(jsonStr)))

console.log(JSONBig.stringify(JSONBig.parse(jsonStr))) // æŠŠ JavaScript å¯¹è±¡ è½¬ä¸º JSON æ ¼å¼çš„å­—ç¬¦ä¸²è½¬
```

![image.png](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/2022/01/23/15820993158655e8054257abf4cf29df3acc2ef8f9bb9.png)
> json-bigint ä¼šæŠŠè¶…å‡º JS å®‰å…¨æ•´æ•°èŒƒå›´çš„æ•°å­—è½¬ä¸ºä¸€ä¸ª BigNumber ç±»å‹çš„å¯¹è±¡ï¼Œå¯¹è±¡æ•°æ®æ˜¯å®ƒå†…éƒ¨çš„ä¸€ä¸ªç®—æ³•å¤„ç†ä¹‹åçš„ï¼Œæˆ‘ä»¬è¦åšçš„å°±æ˜¯åœ¨ä½¿ç”¨çš„æ—¶å€™è½¬ä¸ºå­—ç¬¦ä¸²æ¥ä½¿ç”¨ã€‚

é€šè¿‡ Axios è¯·æ±‚å¾—åˆ°çš„æ•°æ®éƒ½æ˜¯ Axios å¤„ç†ï¼ˆJSON.parseï¼‰ä¹‹åçš„ï¼Œæˆ‘ä»¬åº”è¯¥åœ¨ Axios æ‰§è¡Œå¤„ç†ä¹‹å‰æ‰‹åŠ¨ä½¿ç”¨ json-bigint æ¥è§£æå¤„ç†ã€‚Axios æä¾›äº†è‡ªå®šä¹‰å¤„ç†åŸå§‹åç«¯è¿”å›æ•°æ®çš„ APIï¼š`transformResponse` ã€‚

> å½“æ•°å­—è¿˜æ˜¯jsonçš„æ—¶å€™å†å»å¤„ç†ï¼Œå¦‚æœå·²ç»è½¬æ¢æˆå¯¹è±¡ >> æ•°å­—å·²ç»å¤±å»ç²¾åº¦äº†

```javascript
import axios from 'axios'

import jsonBig from 'json-bigint'

var json = '{ "value" : 9223372036854775807, "v2": 123 }'

console.log(jsonBig.parse(json))

const request = axios.create({
  baseURL: 'http://ttapi.research.itcast.cn/', // æ¥å£åŸºç¡€è·¯å¾„

  // transformResponse å…è®¸è‡ªå®šä¹‰åŸå§‹çš„å“åº”æ•°æ®ï¼ˆå­—ç¬¦ä¸²ï¼‰
  transformResponse: [function (data) {
    try {
      // å¦‚æœè½¬æ¢æˆåŠŸåˆ™è¿”å›è½¬æ¢çš„æ•°æ®ç»“æœ
      return jsonBig.parse(data)
    } catch (err) {
      // å¦‚æœè½¬æ¢å¤±è´¥ï¼Œåˆ™åŒ…è£…ä¸ºç»Ÿä¸€æ•°æ®æ ¼å¼å¹¶è¿”å›
      return {
        data
      }
    }
  }]
})

export default request

```

ä¿®æ”¹propsç±»å‹

```js
props: {
    articleId: {
      type: [Number, String, Object],
      required: true
    }
  }
```



> æ‰©å±•ï¼šES2020 BigInt
>
> ES2020 å¼•å…¥äº†ä¸€ç§æ–°çš„æ•°æ®ç±»å‹ BigIntï¼ˆå¤§æ•´æ•°ï¼‰ï¼Œæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚BigInt åªç”¨æ¥è¡¨ç¤ºæ•´æ•°ï¼Œæ²¡æœ‰ä½æ•°çš„é™åˆ¶ï¼Œä»»ä½•ä½æ•°çš„æ•´æ•°éƒ½å¯ä»¥ç²¾ç¡®è¡¨ç¤ºã€‚
>
> å‚è€ƒé“¾æ¥ï¼š
>
> - [https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/BigInt](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/BigInt)
> - [http://es6.ruanyifeng.com/#docs/number#BigInt-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B](http://es6.ruanyifeng.com/#docs/number#BigInt-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B)



## å±•ç¤ºæ–‡ç« è¯¦æƒ…

æ€è·¯ï¼š

- æ‰¾åˆ°æ•°æ®æ¥å£
- å°è£…è¯·æ±‚æ–¹æ³•
- è¯·æ±‚è·å–æ•°æ®
- æ¨¡æ¿ç»‘å®š



ä¸€ã€è¯·æ±‚å¹¶å±•ç¤ºæ–‡ç« è¯¦æƒ…

1ã€åœ¨ `api/article.js` ä¸­æ–°å¢å°è£…æ¥å£æ–¹æ³•

```js
/**
 * æ ¹æ® id è·å–æŒ‡å®šæ–‡ç« 
 */
export const getArticleById = articleId => {
  return request({
    method: 'GET',
    url: `/app/v1_0/articles/${articleId}`
  })
}
```

2ã€åœ¨ç»„ä»¶ä¸­è°ƒç”¨è·å–æ–‡ç« è¯¦æƒ…

```js
+ import { getArticleById } from '@/api/article'

export default {
  name: 'ArticlePage',
  components: {},
  props: {
    articleId: {
      type: String,
      required: true
    }
  },
  data () {
    return {
+      article: {} // æ–‡ç« è¯¦æƒ…
    }
  },
  computed: {},
  watch: {},
  created () {
+    this.loadArticle()
  },
  mounted () {},
  methods: {
+++    async loadArticle () {
      try {
        const { data } = await getArticleById(this.articleId)
        this.article = data.data
      } catch (err) {
        console.log(err)
      }
    }
  }
}

```

3ã€æ¨¡æ¿ç»‘å®š

```html
<!-- åŠ è½½å®Œæˆ-æ–‡ç« è¯¦æƒ… -->
      <div class="article-detail">
        <!-- æ–‡ç« æ ‡é¢˜ -->
        <h1 class="article-title">{{ article.title }}</h1>
        <!-- /æ–‡ç« æ ‡é¢˜ -->

        <!-- ç”¨æˆ·ä¿¡æ¯ -->
        <van-cell class="user-info" center :border="false">
          <van-image
            class="avatar"
            slot="icon"
            round
            fit="cover"
            :src="article.aut_photo"
          />
          <div slot="title" class="user-name">{{ article.aut_name }}</div>
          <div slot="label" class="publish-date">{{ article.pubdate | relativeTime }}</div>
          <van-button
            class="follow-btn"
            type="info"
            color="#3296fa"
            round
            size="small"
            icon="plus"
          >å…³æ³¨</van-button>
          <!-- <van-button
            class="follow-btn"
            round
            size="small"
          >å·²å…³æ³¨</van-button> -->
        </van-cell>
        <!-- /ç”¨æˆ·ä¿¡æ¯ -->

        <!-- æ–‡ç« å†…å®¹ -->
        <div class="article-content" v-html="article.content"></div>
        <van-divider>æ­£æ–‡ç»“æŸ</van-divider>
      </div>
      <!-- /åŠ è½½å®Œæˆ-æ–‡ç« è¯¦æƒ… -->
```



## å¤„ç†å†…å®¹åŠ è½½çŠ¶æ€

éœ€æ±‚ï¼š

- åŠ è½½ä¸­ï¼Œæ˜¾ç¤º loading
- åŠ è½½æˆåŠŸï¼Œæ˜¾ç¤ºæ–‡ç« è¯¦æƒ…
- åŠ è½½å¤±è´¥ï¼Œæ˜¾ç¤ºé”™è¯¯æç¤º
  - å¦‚æœ 404ï¼Œæç¤ºèµ„æºä¸å­˜åœ¨
  - å…¶å®ƒçš„ï¼Œæç¤ºåŠ è½½å¤±è´¥ï¼Œç”¨æˆ·å¯ä»¥ç‚¹å‡»é‡è¯•é‡æ–°åŠ è½½

```html
<!-- åŠ è½½ä¸­ -->
<div class="loading-wrap" v-if="isLoading">
<!-- åŠ è½½å®Œæˆ-æ–‡ç« è¯¦æƒ… -->
<div v-else-if="article.title" class="article-detail">
<!-- åŠ è½½å¤±è´¥ï¼š404 -->
<div v-else-if="errStatus === 404" class="error-wrap">
<!-- åŠ è½½å¤±è´¥ï¼šå…¶å®ƒæœªçŸ¥é”™è¯¯ï¼ˆä¾‹å¦‚ç½‘ç»œåŸå› æˆ–æœåŠ¡ç«¯å¼‚å¸¸ï¼‰ -->
<div v-else class="error-wrap">
```

```js
async loadArticleInfo () {
    try {
        // éšæœºé”™è¯¯
        thorw Error()
        const { data } = await getArticleInfo(this.articleId)
        this.article = data.data
    } catch (err) {
        // åŠ è½½å¤±è´¥ 404
        if (err.response && err.response.status === 404) {
            this.errStatus = 404
        }
        this.$toast('è·å–å¤±è´¥')
    }
    // åŠ è½½å®Œæˆ
    this.isLoading = false
}
```

ç‚¹å‡»é‡æ–°åŠ è½½

```html
<!-- åŠ è½½å¤±è´¥ï¼šå…¶å®ƒæœªçŸ¥é”™è¯¯ï¼ˆä¾‹å¦‚ç½‘ç»œåŸå› æˆ–æœåŠ¡ç«¯å¼‚å¸¸ï¼‰ -->
<div v-else class="error-wrap">
    <van-icon name="failure" />
    <p class="text">å†…å®¹åŠ è½½å¤±è´¥ï¼</p>
    <van-button @click="loadArtcileInfo" class="retry-btn">ç‚¹å‡»é‡è¯•</van-button>
</div>
```

åœ¨loadArtcileInfoä¸­é‡æ–°æ˜¾ç¤ºåŠ è½½loading



## å…³äºæ–‡ç« æ­£æ–‡çš„æ ·å¼

æ–‡ç« æ­£æ–‡åŒ…æ‹¬å„ç§æ•°æ®ï¼šæ®µè½ã€æ ‡é¢˜ã€åˆ—è¡¨ã€é“¾æ¥ã€å›¾ç‰‡ã€è§†é¢‘ç­‰èµ„æºã€‚

- å°† [github-markdown-css](https://github.com/sindresorhus/github-markdown-css) æ ·å¼æ–‡ä»¶ä¸‹è½½åˆ°é¡¹ç›®ä¸­

- å¯¼å…¥

  ```js
  import './github-markdown.css'
  ```

- æ·»åŠ ç±»å

  ```html
  <div class="article-content markdown-body" v-html="article.content"></div>
  ```

- é…ç½®ä¸è¦è½¬æ¢æ ·å¼æ–‡ä»¶ä¸­çš„å­—å·

  ```js
  'postcss-pxtorem': {
        rootValue ({ file }) {
          return file.indexOf('vant') !== -1 ? 37.5 : 75
        },
        propList: ['*'],
        exclude: 'github-markdown'
      }
  ```

  

## å›¾ç‰‡ç‚¹å‡»é¢„è§ˆ

ä¸€ã€[ImagePreview å›¾ç‰‡é¢„è§ˆ](https://youzan.github.io/vant/#/zh-CN/image-preview) çš„ä½¿ç”¨

1ã€å¯¼å…¥

```js
import { ImagePreview } from 'vant';
```

2ã€ä½¿ç”¨

```js
ImagePreview({
  images: [
    'https://img.yzcdn.cn/vant/apple-1.jpg',
    'https://img.yzcdn.cn/vant/apple-2.jpg'
  ],
  // é¢„è§ˆå›¾ç‰‡çš„èµ·å§‹ä½ç½®
  startPosition: 1,
  // ç‚¹å‡»å…³é—­
  onClose () {
    // do something
  }
})
```

äºŒã€å¤„ç†å›¾ç‰‡ç‚¹å‡»é¢„è§ˆ

æ€è·¯ï¼š8167 å¸¦å›¾ç‰‡

:::info å®ç°æ€è·¯

1. ç•Œé¢æ¸²æŸ“å®Œä»¥åè·å–æ‰€æœ‰å›¾ç‰‡domå…ƒç´ 
2. éå†å›¾ç‰‡domå…ƒç´ ï¼Œä¿å­˜srcåˆ°ä¸€ä¸ªæ•°ç»„é‡Œé¢ >> å›¾ç‰‡é“¾æ¥
3. å›¾ç‰‡ >> ç»‘ç‚¹å‡»äº‹ä»¶ >> é¢„è§ˆå›¾ç‰‡æ–¹æ³•(images: åˆšæ‰ä¿å­˜çš„å›¾ç‰‡é“¾æ¥)

:::

1ã€é¡µé¢æ¸²æŸ“å®Œæˆä»æ–‡ç« å†…å®¹ä¸­è·å–åˆ°æ‰€æœ‰çš„ img DOM èŠ‚ç‚¹

```js
async loadArticleInfo () {
      try {
        thorwError()
        const { data } = await getArticleInfo(this.articleId)
        this.article = data.data
        // æ•°æ®åŠ è½½å®Œæˆ
        setTimeout(() => {
          this.previewImg()
        }, 10)
      } catch (err) {
        if (err.response && err.response.status === 404) {
          this.errStatus = 404
        }
        this.$toast('è·å–å¤±è´¥')
      }
      this.isLoading = false
    }
```

```js
previewImg () {
    const contentEl = this.$refs.contentRef
    const allImg = contentEl.querySelectorAll('img')
}
```

2ã€è·å–æ–‡ç« å†…å®¹ä¸­æ‰€æœ‰çš„å›¾ç‰‡åœ°å€

```js
previewImg () {
    const contentEl = this.$refs.contentRef
    const allImg = contentEl.querySelectorAll('img')
    console.log(allImg)
}
```



3ã€éå†æ‰€æœ‰ img èŠ‚ç‚¹ï¼Œç»™æ¯ä¸ªèŠ‚ç‚¹æ³¨å†Œç‚¹å‡»äº‹ä»¶

```js
previewImg () {
    const contentEl = this.$refs.contentRef
    const allImg = contentEl.querySelectorAll('img')
    const images = []
    allImg.forEach((element, index) => {
        images.push(element.src)
        element.onclick = () => {
        }
    })
}
```



4ã€åœ¨ img ç‚¹å‡»äº‹ä»¶å¤„ç†å‡½æ•°ä¸­ï¼Œè°ƒç”¨ ImagePreview é¢„è§ˆ

```js
previewImg () {
    const contentEl = this.$refs.contentRef
    const allImg = contentEl.querySelectorAll('img')
    const images = []
    allImg.forEach((element, index) => {
        images.push(element.src)
        element.onclick = () => {
            ImagePreview({
                images,
                startPosition: index
            })
        }
    })
}
```

## å…³æ³¨ç”¨æˆ·

æ€è·¯ï¼š

- ç»™æŒ‰é’®æ³¨å†Œç‚¹å‡»äº‹ä»¶
- åœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­
  - å¦‚æœå·²å…³æ³¨ï¼Œåˆ™å–æ¶ˆå…³æ³¨
  - å¦‚æœæ²¡æœ‰å…³æ³¨ï¼Œåˆ™æ·»åŠ å…³æ³¨

ä¸‹é¢æ˜¯å…·ä½“å®ç°ã€‚

### è§†å›¾å¤„ç†

### åŠŸèƒ½å¤„ç†

- æ‰¾åˆ°æ•°æ®æ¥å£
- å°è£…è¯·æ±‚æ–¹æ³•
- è¯·æ±‚è°ƒç”¨
- è§†å›¾æ›´æ–°



1ã€åœ¨ `api/user.js` ä¸­æ·»åŠ å°è£…è¯·æ±‚æ–¹æ³•

```js
/**
 * æ·»åŠ å…³æ³¨
 */
export const addFollow = userId => {
  return request({
    method: 'POST',
    url: '/app/v1_0/user/followings',
    data: {
      target: userId
    }
  })
}

/**
 * å–æ¶ˆå…³æ³¨
 */
export const deleteFollow = userId => {
  return request({
    method: 'DELETE',
    url: `/app/v1_0/user/followings/${userId}`
  })
}
```

2ã€ç»™å…³æ³¨/å–æ¶ˆå…³æ³¨æŒ‰é’®æ³¨å†Œç‚¹å‡»äº‹ä»¶

3ã€åœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­

```js
import { addFollow, deleteFollow } from '@/api/user'
```

```js
async onFollow () {
  // å¼€å¯æŒ‰é’®çš„ loading çŠ¶æ€
  this.isFollowLoading = true

  try {
    // å¦‚æœå·²å…³æ³¨ï¼Œåˆ™å–æ¶ˆå…³æ³¨
    const authorId = this.article.aut_id
    if (this.article.is_followed) {
      await deleteFollow(authorId)
    } else {
      // å¦åˆ™æ·»åŠ å…³æ³¨
      await addFollow(authorId)
    }

    // æ›´æ–°è§†å›¾
    this.article.is_followed = !this.article.is_followed
  } catch (err) {
    console.log(err)
    this.$toast.fail('æ“ä½œå¤±è´¥')
  }

  // å…³é—­æŒ‰é’®çš„ loading çŠ¶æ€
  this.isFollowLoading = false
}
```

æœ€åæµ‹è¯•ã€‚

### loading æ•ˆæœ

ä¸¤ä¸ªä½œç”¨ï¼š

- äº¤äº’åé¦ˆ
- é˜²æ­¢ç½‘ç»œæ…¢ç”¨æˆ·å¤šæ¬¡ç‚¹å‡»æŒ‰é’®å¯¼è‡´é‡å¤è§¦å‘ç‚¹å‡»äº‹ä»¶



### ç»„ä»¶å°è£…

### ç»„ä»¶å°è£…

1ã€å°è£…ç»„ä»¶ >> æŠ½ç¦»ç®€åŒ–é€»è¾‘

> æ³¨æ„ç‚¹ï¼šå…³æ³¨çš„çŠ¶æ€ç»´æŠ¤åœ¨çˆ¶ç»„ä»¶ï¼Œä¿®æ”¹çš„æ—¶å€™éœ€è¦é€šè¿‡è‡ªå®šä¹‰äº‹ä»¶ä¿®æ”¹

```html
<template>
  <van-button
    class="follow-btn"
    type="info"
    color="#3296fa"
    round
    v-if="!is_followed"
    size="small"
    icon="plus"
    :loading="isFollowLoading"
    @click="follow"
  >å…³æ³¨</van-button>
  <van-button
    v-else
    class="follow-btn"
    round
    :loading="isFollowLoading"
    size="small"
    @click="follow"
  >å·²å…³æ³¨</van-button>
</template>

<script>
import { addFollow, deleteFollow } from '@/api/user'
export default {
  name: 'follow-user',
  data () {
    return {
      isFollowLoading: false
    }
  },

  props: {
    is_followed: {
      type: Boolean,
      required: true
    },
    user_id: {
      type: [Number, String, Object],
      required: true
    }
  },

  created () {

  },

  methods: {
    // å…³æ³¨ç”¨æˆ·
    async follow () {
      this.isFollowLoading = true
      try {
        // å¦‚æœå·²å…³æ³¨ï¼Œåˆ™å–æ¶ˆå…³æ³¨
        const authorId = this.user_id
        if (this.is_followed) {
          await deleteFollow(authorId)
        } else {
          // å¦åˆ™æ·»åŠ å…³æ³¨
          await addFollow(authorId)
        }

        // æ›´æ–°è§†å›¾
        this.$emit('update-follow', !this.is_followed)
      } catch (err) {
        console.dir(err)
        if (err.response && err.response.status === 400) {
          return this.$toast.fail('ä¸èƒ½å…³æ³¨è‡ªå·±')
        }
        this.$toast.fail('æ“ä½œå¤±è´¥')
      }

      // å…³é—­æŒ‰é’®çš„ loading çŠ¶æ€
      this.isFollowLoading = false
    }
  }
}
</script>

<style scoped lang='less'>

</style>

```

2ã€å¼•å…¥ç»„ä»¶

```js
import FollowUser from '@/components/follow-user'
```

```js
components: {
    FollowUser
}
```

3ã€ä½¿ç”¨ç»„ä»¶

```html
<follow-user
             :is_followed="article.is_followed"
             :user_id="article.aut_id"
             @update-follow="article.is_followed = $event"
</follow-user>
```



ä½¿ç”¨v-model

æä¾›ç»™å­ç»„ä»¶ å±æ€§ >> value   äº‹ä»¶ >> input >> ä½œç”¨ï¼šä¿®æ”¹value

æ¼”ç¤ºä»£ç 

```vue
<template>
  <div>
    <hr />
    è¿™é‡Œæ˜¯çˆ¶ç»„ä»¶
    <h1>{{ name }}</h1>
    <hr />
    è¿™é‡Œæ˜¯å­ç»„ä»¶
    <Child v-model="name" />
  </div>
</template>
<script>
import Child from "./components/child.vue";
export default {
  components: { Child },
  data() {
    return {
      name: "çˆ¶ç»„ä»¶çš„é»˜è®¤å€¼",
    };
  },
};
</script>


// å­ç»„ä»¶ ./components/child.vue
<template>
  <div>
    <div>{{ value }}</div>
    <van-button @click="$emit('input', 'å­ç»„ä»¶ä¼ é€’çš„å€¼')">ç‚¹å‡»ä¿®æ”¹</van-button>
  </div>
</template>

<script>
import Vue from "vue";

export default Vue.extend({
  name: "Child",
  props: {
    value: String,
  },
  data() {
    return {
      name: "234",
    };
  },
});
</script>


```



```html
<follow-user
          v-model="article.is_followed"
          :user_id="article.aut_id"
          ></follow-user>
```

æƒ³è¦è‡ªå®šä¹‰v-model ä¼ é€’ä¸‹æ¥çš„å±æ€§å’Œäº‹ä»¶ >> ç»„ä»¶å†…éƒ¨æ·»åŠ model

```js
model: {
    prop: 'is_followed', // å®šä¹‰å±æ€§å
    event: 'update-follow' // å®šä¹‰äº‹ä»¶å
}
```

## æ–‡ç« æ”¶è—

> è¯¥åŠŸèƒ½å’Œå…³æ³¨ç”¨æˆ·çš„å¤„ç†æ€è·¯å‡ ä¹ä¸€æ ·ï¼Œå»ºè®®ç”±å­¦å‘˜è‡ªå·±ç¼–å†™ã€‚

### å°è£…ç»„ä»¶

### å¤„ç†è§†å›¾

1ã€å°è£…ç»„ä»¶

```html
<template>
  <van-icon
    color="#777"
    name="star-o"
  />
</template>

<script>
export default {
  name: 'collectArticle',
}
</script>

<style scoped lang='less'>

</style>

```

2ã€ä½¿ç”¨ç»„ä»¶

```html
<van-icon
          name="comment-o"
          info="123"
          color="#777"
          />
<CollectArticle />
<van-icon
          color="#777"
          name="good-job-o"
          />
```

2ã€ä¼ é€’æ•°æ®å¤„ç†è§†å›¾

```html
<collect-article v-model="article.is_collected" />
```

```html
<template>
  <van-icon
    :color="value ? '#ffa500' : ''"
    :name="value?'star':'star-o'"
  />
</template>

<script>
export default {
  name: 'CollectArticle',
  props: {
    value: {
      type: Boolean,
      required: true
    }
  }
}
</script>

```

### æ”¶è—åŠŸèƒ½å¤„ç†

æ€è·¯ï¼š

- ç»™æ”¶è—æŒ‰é’®æ³¨å†Œç‚¹å‡»äº‹ä»¶
- å¦‚æœå·²ç»æ”¶è—äº†ï¼Œåˆ™å–æ¶ˆæ”¶è—
- å¦‚æœæ²¡æœ‰æ”¶è—ï¼Œåˆ™æ·»åŠ æ”¶è—

ä¸‹é¢æ˜¯å…·ä½“å®ç°ã€‚

1ã€åœ¨ `api/article.js` æ·»åŠ å°è£…æ•°æ®æ¥å£

```js
/**
 * æ”¶è—æ–‡ç« 
 */
export const addCollect = target => {
  return request({
    method: 'POST',
    url: '/app/v1_0/article/collections',
    data: {
      target
    }
  })
}

/**
 * å–æ¶ˆæ”¶è—æ–‡ç« 
 */
export const deleteCollect = target => {
  return request({
    method: 'DELETE',
    url: `/app/v1_0/article/collections/${target}`
  })
}
```

2ã€ç»™æ”¶è—æŒ‰é’®æ³¨å†Œç‚¹å‡»äº‹ä»¶

```html
<van-icon
color="#ffa500"
:name="value?'star':'star-o'"
@click="onCollect"
:loading="loading"
/>
```

3ã€å¤„ç†å‡½æ•°

```js
async onCollect () {
    // å¼€å§‹è¯·æ±‚
    this.loading = true
    try {
        // æ˜¯å¦æ”¶è—
        if (this.value) {
            // çˆ¶ç»„ä»¶ ä¼ é€’articleId
            await deleteCollect(this.articleId)
        } else {
            await addCollect(this.articleId)
        }
        // æ›´æ–°è§†å›¾
        this.$emit('input', !this.value)
        this.$toast.success(this.value ? 'å–æ¶ˆæ”¶è—' : 'æ”¶è—æˆåŠŸ')
    } catch (err) {
        this.$toast('æ“ä½œå¤±è´¥ï¼Œè¯·é‡è¯•')
    }
    // è¯·æ±‚ç»“æŸ
    this.loading = false
}
```

4ã€ çˆ¶ç»„ä»¶ä¼ é€’æ–‡ç« id

```html
<collect-article :article-id="article.art_id" v-model="article.is_followed" />
```

5ã€å°†åº•éƒ¨åŒºåŸŸè°ƒæ•´åˆ°æ­£æ–‡ä¸‹é¢

## æ–‡ç« ç‚¹èµ

1ã€å°è£…ç»„ä»¶

```html
<template>
  <van-icon
    :color="value === 1 ? 'red' : ''"
    :name="value === 1?'good-job':'good-job-o'"
  />
</template>

<script>
export default {
  data () {
    return {

    }
  },

  props: {
    value: {
      type: Number,
      required: true
    }
  },

  created () {

  },

  methods: {

  }
}
</script>

<style scoped lang='less'>

</style>

```

2ã€ä½¿ç”¨ç»„ä»¶

```js
import likeArticle from '@/components/like-article'

components: {
    FollowUser,
    CollectArticle,
    likeArticle
}

<likeArticle v-model="article.attitude" />
```



> è¯¥åŠŸèƒ½å’Œå…³æ³¨ç”¨æˆ·çš„å¤„ç†æ€è·¯å‡ ä¹ä¸€æ ·ï¼Œå»ºè®®ç”±å­¦å‘˜è‡ªå·±ç¼–å†™ã€‚

article ä¸­çš„ `attitude` è¡¨ç¤ºç”¨æˆ·å¯¹æ–‡ç« çš„æ€åº¦

- `-1` æ— æ€åº¦
- `0` ä¸å–œæ¬¢
- `1` å·²ç‚¹èµ

æ€è·¯ï¼š

- ç»™ç‚¹èµæŒ‰é’®æ³¨å†Œç‚¹å‡»äº‹ä»¶
- å¦‚æœå·²ç»ç‚¹èµï¼Œåˆ™è¯·æ±‚å–æ¶ˆç‚¹èµ
- å¦‚æœæ²¡æœ‰ç‚¹èµï¼Œåˆ™è¯·æ±‚ç‚¹èµ

1ã€æ·»åŠ å°è£…æ•°æ®æ¥å£

```js
/**
 * ç‚¹èµ
 */
export const addLike = articleId => {
  return request({
    method: 'POST',
    url: '/app/v1_0/article/likings',
    data: {
      target: articleId
    }
  })
}

/**
 * å–æ¶ˆç‚¹èµ
 */
export const deleteLike = articleId => {
  return request({
    method: 'DELETE',
    url: `/app/v1_0/article/likings/${articleId}`
  })
}
```

2ã€ç»™ç‚¹èµæŒ‰é’®æ³¨å†Œç‚¹å‡»äº‹ä»¶

3ã€å¤„ç†å‡½æ•°

```js
async onLike () {
  // ä¸¤ä¸ªä½œç”¨ï¼š1ã€äº¤äº’æç¤º 2ã€é˜²æ­¢ç½‘ç»œæ…¢ç”¨æˆ·è¿ç»­ä¸æ–­çš„ç‚¹å‡»æŒ‰é’®è¯·æ±‚
  this.$toast.loading({
    duration: 0, // æŒç»­å±•ç¤º toast
    message: 'æ“ä½œä¸­...',
    forbidClick: true // æ˜¯å¦ç¦æ­¢èƒŒæ™¯ç‚¹å‡»
  })

  try {
    // å¦‚æœå·²ç»ç‚¹èµï¼Œåˆ™å–æ¶ˆç‚¹èµ
    if (this.article.attitude === 1) {
      await deleteLike(this.articleId)
      this.article.attitude = -1
      this.$toast.success('å–æ¶ˆç‚¹èµ')
    } else {
      // å¦åˆ™æ·»åŠ ç‚¹èµ
      await addLike(this.articleId)
      this.article.attitude = 1
      this.$toast.success('ç‚¹èµæˆåŠŸ')
    }
  } catch (err) {
    console.log(err)
    this.$toast.fail('æ“ä½œå¤±è´¥')
  }
}
```



