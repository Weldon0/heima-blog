---
title: ğŸ“š 08-æ–‡ç« è¯„è®º
---
# å…«ã€æ–‡ç« è¯„è®º

## å±•ç¤ºæ–‡ç« è¯„è®ºåˆ—è¡¨

### å‡†å¤‡ç»„ä»¶

ä¸ºäº†æ›´å¥½çš„å¼€å‘å’Œç»´æŠ¤ï¼Œè¿™é‡Œæˆ‘ä»¬æŠŠæ–‡ç« è¯„è®ºå•ç‹¬å°è£…åˆ°ä¸€ä¸ªç»„ä»¶ä¸­æ¥å¤„ç†ã€‚

> æ ·å¼ç»“æ„ï¼Œå¤§æ¦‚åˆ†æä¹‹åå¯ä»¥ç›´æ¥å¤åˆ¶

1ã€åˆ›å»º `src/views/article/components/comment-list.vue`

```html
<template>
  <div class="article-comments">
    <!-- è¯„è®ºåˆ—è¡¨ -->
    <van-list
      v-model="loading"
      :finished="finished"
      finished-text="æ²¡æœ‰æ›´å¤šäº†"
      @load="onLoad"
    >
     <van-cell :title="item" v-for="item in list" :key="item"/>
    </van-list>
    <!-- è¯„è®ºåˆ—è¡¨ -->
  </div>
</template>

<script>
  export default {
    name: "ArticleComment",
    props: {},
    data() {
      return {
        list: [], // è¯„è®ºåˆ—è¡¨
        loading: false, // ä¸Šæ‹‰åŠ è½½æ›´å¤šçš„ loading
        finished: false // æ˜¯å¦åŠ è½½ç»“æŸ
      };
    },

    methods: {
      onLoad() {
        // å¼‚æ­¥æ›´æ–°æ•°æ®
        setTimeout(() => {
          for (let i = 0; i < 10; i++) {
            this.list.push(this.list.length + 1);
          }
          // åŠ è½½çŠ¶æ€ç»“æŸ
          this.loading = false;

          // æ•°æ®å…¨éƒ¨åŠ è½½å®Œæˆ
          if (this.list.length >= 40) {
            this.finished = true;
          }
        }, 500);
      }
    }
  };
</script>

<style scoped lang="less">
 
  .van-list {
    margin-bottom: 45px;
  }
</style>
```

2ã€åœ¨æ–‡ç« è¯¦æƒ…é¡µé¢ä¸­åŠ è½½æ³¨å†Œæ–‡ç« è¯„è®ºå­ç»„ä»¶

```js
import ArticleComment from './components/article-comment'

export default {
  ...
  components: {
    ArticleComment
  }
}
```

3ã€åœ¨æ–‡ç« è¯¦æƒ…é¡µé¢çš„åŠ è½½å¤±è´¥æç¤ºæ¶ˆæ¯åé¢ä½¿ç”¨æ–‡ç« è¯„è®ºå­ç»„ä»¶

```html
<!-- æ–‡ç« è¯„è®º -->
<article-comment />
<!-- /æ–‡ç« è¯„è®º -->
```

æœ€ç»ˆé¡µé¢æ•ˆæœå¦‚ä¸‹ï¼š

<img src="https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/CleanShot%202022-07-10%20at%2016.11.11@2x.png" alt="CleanShot 2022-07-10 at 16.11.11@2x" style="zoom: 33%;" />

### è·å–æ•°æ®å¹¶å±•ç¤º

æ­¥éª¤ï¼š

- å°è£…æ¥å£
- è¯·æ±‚è·å–æ•°æ®
- å¤„ç†æ¨¡æ¿

å®ç°ï¼š

1ã€åœ¨ `api/comment.js` ä¸­æ·»åŠ å°è£…è¯·æ±‚æ–¹æ³•

```js
/**
 * è¯„è®ºæ¥å£æ¨¡å—
 */
import request from "@/utils/request";

/**
 * è·å–æ–‡ç« åˆ—è¡¨
 */
export function getComments(params) {
  return request({
    method: "GET",
    url: "/app/v1_0/comments",
    params
  });
}
```

2ã€è¯·æ±‚è·å–æ•°æ®

```js
data () {
  return {
      list: [],
      loading: false,
      finished: false,
      offset: null, // è¯·æ±‚ä¸‹ä¸€é¡µæ•°æ®çš„é¡µç 
      totalCount: 0 // æ€»æ•°æ®æ¡æ•°
    }
}
```



```js
// æ¥å—çˆ¶ç»„ä»¶ä¼ é€’è¿‡æ¥çš„artcleId  
props: {
    articleId: {
      type: String,
    },
  }


async onLoad () {
      // 1. è¯·æ±‚è·å–æ•°æ®
      const { data } = await getComments({
        type: 'a', // è¯„è®ºç±»å‹ï¼Œa-å¯¹æ–‡ç« (article)çš„è¯„è®ºï¼Œc-å¯¹è¯„è®º(comment)çš„å›å¤
        source: this.articleId.toString(), // æºidï¼Œæ–‡ç« idæˆ–è¯„è®ºid
        offset: this.offset, // è·å–è¯„è®ºæ•°æ®çš„åç§»é‡ï¼Œå€¼ä¸ºè¯„è®ºidï¼Œè¡¨ç¤ºä»æ­¤idçš„æ•°æ®å‘åå–ï¼Œä¸ä¼ è¡¨ç¤ºä»ç¬¬ä¸€é¡µå¼€å§‹è¯»å–æ•°æ®
        limit: 10 // æ¯é¡µå¤§å°
      })

      console.log(data)

      // 2. å°†æ•°æ®æ·»åŠ åˆ°åˆ—è¡¨ä¸­
      const { results } = data.data
      this.list.push(...results)

      // æ›´æ–°æ€»æ•°æ®æ¡æ•°
      this.totalCount = data.data.total_count

      // 3. å°†åŠ è½½æ›´å¤šçš„ loading è®¾ç½®ä¸º false
      this.loading = false

      // 4. åˆ¤æ–­æ˜¯å¦è¿˜æœ‰æ•°æ®
      if (results.length) {
        this.offset = data.data.last_id // æ›´æ–°è·å–ä¸‹ä¸€é¡µæ•°æ®çš„é¡µç 
      } else {
        this.finished = true // æ²¡æœ‰æ•°æ®äº†ï¼Œå…³é—­åŠ è½½æ›´å¤š
      }
    }
```

3ã€æ¨¡æ¿ç»‘å®š

```html
<template>
  <div class="article-comments">
    <!-- è¯„è®ºåˆ—è¡¨ -->
    <van-list v-model="loading" :finished="finished" finished-text="æ²¡æœ‰æ›´å¤šäº†" @load="onLoad">
      <van-cell v-for="item in list" :key="item.art_id">
        {{ item.content }}
      </van-cell>
    </van-list>
    <!-- è¯„è®ºåˆ—è¡¨ -->
  </div>
</template>
```

### å±•ç¤ºæ–‡ç« è¯„è®ºæ€»æ•°é‡

1ã€åœ¨è¯„è®ºç»„ä»¶è·å–åˆ°æ–‡ç« æ•°æ®é‡åä¼ é€’ç»™çˆ¶ç»„ä»¶

```js
this.$emit('onload-success', data.data.total_count)
```

2ã€çˆ¶ç»„ä»¶å®šä¹‰äº‹ä»¶

```html
<!-- æ–‡ç« è¯„è®º -->
<article-comment @onload-success="totalCount = $event" :article-id="article.art_id" />
<!-- /æ–‡ç« è¯„è®º -->
```

3ã€å®šä¹‰totalCount

4ã€ä½¿ç”¨totalCount



### æ–‡ç« è¯„è®ºé¡¹

1ã€å®šä¹‰åŸºæœ¬ç»„ä»¶

> views/article/components/article-comment-item.vue

```html
<template>
  <van-cell class="comment-item">
    <van-image
      slot="icon"
      class="avatar"
      round
      fit="cover"
      src="https://img.yzcdn.cn/vant/cat.jpeg"
    />
    <div slot="title" class="title-wrap">
      <div class="user-name">ç”¨æˆ·åç§°</div>
      <van-button
        class="like-btn"
        icon="good-job-o"
      >èµ</van-button>
    </div>

    <div slot="label">
      <p class="comment-content">è¿™æ˜¯è¯„è®ºå†…å®¹</p>
      <div class="bottom-info">
        <span class="comment-pubdate">4å¤©å‰</span>
        <van-button
          class="reply-btn"
          round
        >å›å¤ 0</van-button>
      </div>
    </div>
  </van-cell>
</template>

<script>
export default {
  name: 'CommentItem',
  components: {},
  props: {},
  data () {
    return {}
  },
  computed: {},
  watch: {},
  created () {},
  mounted () {},
  methods: {}
}
</script>

<style scoped lang="less">
.comment-item {
  .avatar {
    width: 72px;
    height: 72px;
    margin-right: 25px;
  }
  .title-wrap {
    display: flex;
    justify-content: space-between;
    align-items: center;
    .user-name {
      color: #406599;
      font-size: 26px;
    }
  }
  .comment-content {
    font-size: 32px;
    color: #222222;
    word-break: break-all;
    text-align: justify;
  }
  .comment-pubdate {
    font-size: 19px;
    color: #222;
    margin-right: 25px;
  }
  .bottom-info {
    display: flex;
    align-items: center;
  }
  .reply-btn {
    width: 135px;
    height: 48px;
    line-height: 48px;
    font-size: 21px;
    color: #222;
  }
  .like-btn {
    height: 30px;
    padding: 0;
    border: none;
    font-size: 19px;
    line-height: 30px;
    margin-right: 7px;
    .van-icon {
      font-size: 30px;
    }
  }
}
</style>

```

2ã€ä½¿ç”¨ç»„ä»¶ï¼Œå¹¶ä¼ é€’æ•°æ®

```html
import ArticleCommentItem from './article-comment-item'

components: {
  ArticleCommentItem
}

<ArticleCommentItem v-for="item in list" :comment="item" :key="item.art_id"/>
```

3ã€è¯„è®ºé¡¹ç»„ä»¶æ¥æ”¶æ•°æ®

```js
props: {
    comment: {
      type: Object,
      required: true
    }
  }
```

4ã€ç»‘å®šä¹‹åï¼š

```html
<template>
  <van-cell class="comment-item">
    <van-image
      slot="icon"
      class="avatar"
      round
      fit="cover"
      :src="comment.aut_photo"
    />
    <div slot="title" class="title-wrap">
      <div class="user-name">{{ comment.aut_name }}</div>
      <van-button
        class="like-btn"
        icon="good-job-o"
      >{{ comment.like_count || 'èµ' }}</van-button>
    </div>

    <div slot="label">
      <p class="comment-content">{{ comment.content }}</p>
      <div class="bottom-info">
        <span class="comment-pubdate">{{ comment.pubdate | relativeTime }}</span>
        <van-button
          class="reply-btn"
          round
        >å›å¤ {{ comment.reply_count }}</van-button>
      </div>
    </div>
  </van-cell>
</template>

<script>
export default {
  name: 'CommentItem',
  components: {},
  props: {
    comment: {
      type: Object,
      required: true
    }
  },
  data () {
    return {}
  },
  computed: {},
  watch: {},
  created () {},
  mounted () {},
  methods: {}
}
</script>

<style scoped lang="less">
.comment-item {
  .avatar {
    width: 72px;
    height: 72px;
    margin-right: 25px;
  }
  .title-wrap {
    display: flex;
    justify-content: space-between;
    align-items: center;
    .user-name {
      color: #406599;
      font-size: 26px;
    }
  }
  .comment-content {
    font-size: 32px;
    color: #222222;
    word-break: break-all;
    text-align: justify;
  }
  .comment-pubdate {
    font-size: 19px;
    color: #222;
    margin-right: 25px;
  }
  .bottom-info {
    display: flex;
    align-items: center;
  }
  .reply-btn {
    width: 135px;
    height: 48px;
    line-height: 48px;
    font-size: 21px;
    color: #222;
  }
  .like-btn {
    height: 30px;
    padding: 0;
    border: none;
    font-size: 19px;
    line-height: 30px;
    margin-right: 7px;
    .van-icon {
      font-size: 30px;
    }
  }
}
</style>

```

## è¯„è®ºç‚¹èµ

> article/components/article-comment-item.vue

è§†å›¾å¤„ç†

```html
      <van-button class="like-btn">
        <template #icon>
          <van-icon
            :color="comment.is_liking ? 'red' : ''"
            :name="comment.is_liking ? 'good-job' : 'good-job-o'"
          ></van-icon>
        </template>
        {{ comment.like_count || "èµ" }}
      </van-button>
```



1ã€åœ¨ `api/comment.js` ä¸­æ·»åŠ å°è£…ä¸¤ä¸ªæ•°æ®æ¥å£

```js
/**
 * å¯¹è¯„è®ºæˆ–è¯„è®ºå›å¤ç‚¹èµ
 */
export function addCommentLike(commentId) {
  return request({
    method: "POST",
    url: "/app/v1_0/comment/likings",
    data: {
      target: commentId
    }
  });
}

/**
 * å–æ¶ˆå¯¹è¯„è®ºæˆ–è¯„è®ºå›å¤ç‚¹èµ
 */
export function deleteCommentLike(commentId) {
  return request({
    method: "DELETE",
    url: `/app/v1_0/comment/likings/${commentId}`
  });
}
```

2ã€ç„¶åç»™è¯„è®ºé¡¹ä¸­çš„ `like` å›¾æ ‡æ³¨å†Œç‚¹å‡»äº‹ä»¶

```html

<van-button class="like-btn" @click="onCommentLike(item)">
  <template #icon>
    <van-icon
      :color="comment.is_liking ? 'red' : ''"
      :name="comment.is_liking ? 'good-job' : 'good-job-o'"
    ></van-icon>
  </template>
  {{ comment.like_count || "èµ" }}
</van-button>
```

3ã€åœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­

```js
import {
  getComments,
  addComment,
} from '@/api/comment'
```

```js
async onCommentLike (comment) {
  // å¦‚æœå·²ç»èµäº†åˆ™å–æ¶ˆç‚¹èµ
  if (comment.is_liking) {
    await deleteCommentLike(comment.com_id)
  } else {
    // å¦‚æœæ²¡æœ‰èµï¼Œåˆ™ç‚¹èµ
    await addCommentLike(comment.com_id)
  }

  // æ›´æ–°è§†å›¾çŠ¶æ€
  comment.is_liking = !comment.is_liking
  this.$toast('æ“ä½œæˆåŠŸ')
}
```

## å‘å¸ƒæ–‡ç« è¯„è®º

#### ä¸€ã€ä½¿ç”¨å¼¹å±‚å±•ç¤ºå‘å¸ƒè¯„è®º

1ã€æ·»åŠ å¼¹å±‚ç»„ä»¶

> article/index.vueä¸­

```js
data () {
  return {
    ...
    isPostShow: false
  }
}
```

```html
<!-- å‘å¸ƒæ–‡ç« è¯„è®º -->
<van-popup
  v-model="isPostShow"
  position="bottom"
 >æˆ‘æ˜¯å¼¹å±‚</van-popup>
<!-- /å‘å¸ƒæ–‡ç« è¯„è®º -->
```

> æç¤ºï¼šä¸è®¾ç½®é«˜åº¦çš„æ—¶å€™ï¼Œå†…å®¹ä¼šè‡ªåŠ¨æ’‘å¼€å¼¹å±‚é«˜åº¦

2ã€ç‚¹å‡»å‘è¯„è®ºæŒ‰é’®çš„æ—¶å€™æ˜¾ç¤ºå¼¹å±‚

```html
<van-button
  class="write-btn"
  type="default"
  round
  size="small"
  @click="isPostShow = true"
>å†™è¯„è®º</van-button>
```

#### äºŒã€å°è£…å‘å¸ƒè¯„è®ºç»„ä»¶



1ã€åˆ›å»º `post-comment.vue`

```html
<template>
  <div class="post-comment">
    <van-field
      class="post-field"
      v-model="inputComment"
      rows="2"
      autosize
      type="textarea"
      maxlength="50"
      placeholder="ä¼˜è´¨è¯„è®ºå°†ä¼šè¢«ä¼˜å…ˆå±•ç¤º"
      show-word-limit
    />
    <van-button class="post-btn" size="small">å‘å¸ƒ</van-button>
  </div>
</template>

<script>
export default {
  name: "PostComment",
  components: {},
  props: {},
  data() {
    return {
      inputComment: "",
    };
  },
  computed: {},
  watch: {},
  created() {},
  mounted() {},
  methods: {},
};
</script>

<style scoped lang="less">
.post-comment {
  display: flex;
  align-items: center;
  padding: 32px 0 32px 32px;
  .post-field {
    background-color: #f5f7f9;
  }
  .post-btn {
    width: 150px;
    border: none;
    padding: 0;
    color: #6ba3d8;
    &::before {
      display: none;
    }
  }
}
</style>

```

2ã€åœ¨è¯¦æƒ…é¡µåŠ è½½æ³¨å†Œ

3ã€åœ¨å‘å¸ƒè¯„è®ºçš„å¼¹å±‚ä¸­ä½¿ç”¨

```html
<!-- å‘å¸ƒæ–‡ç« è¯„è®º -->
<van-popup
  v-model="isPostShow"
  position="bottom"
>
  <post-comment />
</van-popup>
<!-- /å‘å¸ƒæ–‡ç« è¯„è®º -->
```

#### ä¸‰ã€å‘å¸ƒè¯„è®º

1ã€åœ¨ `api/comment.js` ä¸­æ·»åŠ å°è£…æ•°æ®æ¥å£

```js
/**
 * æ·»åŠ è¯„è®ºæˆ–è¯„è®ºå›å¤
 */
export function addComment(data) {
  return request({
    method: "POST",
    url: "/app/v1_0/comments",
    data
  });
}
```

2ã€ç»‘å®šè·å–æ·»åŠ è¯„è®ºçš„è¾“å…¥æ¡†æ•°æ®å¹¶ä¸”æ³¨å†Œå‘å¸ƒæŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶

```js
data () {
  return {
    ...
    inputComment: ''
  }
}
```

```html
<!-- å‘å¸ƒè¯„è®º -->
<van-cell-group class="publish-wrap">
  <van-field + v-model="inputComment" clearable placeholder="è¯·è¾“å…¥è¯„è®ºå†…å®¹">
    <van-button slot="button" size="mini" type="info" + @click="onAddComment"
      >å‘å¸ƒ</van-button
    >
  </van-field>
</van-cell-group>
<!-- /å‘å¸ƒè¯„è®º -->
```

3ã€åœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­

```js
import {
	getComments,
+  addComment
} from '@/api/comment'
```

```js
async onAddComment () {
  const inputComment = this.inputComment.trim()

  // éç©ºæ ¡éªŒ
  if (!inputComment.length) {
    return
  }

  // è¯·æ±‚æ·»åŠ 
  const res = await addComment({
    target: this.$route.params.articleId, // è¯„è®ºçš„ç›®æ ‡idï¼ˆè¯„è®ºæ–‡ç« å³ä¸ºæ–‡ç« idï¼Œå¯¹è¯„è®ºè¿›è¡Œå›å¤åˆ™ä¸ºè¯„è®ºidï¼‰
    content: inputComment // è¯„è®ºå†…å®¹
    // art_id // æ–‡ç« idï¼Œå¯¹è¯„è®ºå†…å®¹å‘è¡¨å›å¤æ—¶ï¼Œéœ€è¦ä¼ é€’æ­¤å‚æ•°ï¼Œè¡¨æ˜æ‰€å±æ–‡ç« idã€‚å¯¹æ–‡ç« è¿›è¡Œè¯„è®ºï¼Œä¸è¦ä¼ æ­¤å‚æ•°ã€‚
  })
}
```

### å‘å¸ƒæˆåŠŸå¤„ç†

1ã€å‘å¸ƒæˆåŠŸé€šè¿‡$emitå‘çˆ¶ç»„ä»¶ä¼ é€’æ•°æ®

```js
this.$emit('onpost-success', res)
```

2ã€çˆ¶ç»„ä»¶å®šä¹‰äº‹ä»¶å¹¶æ¥å—æ•°æ®

```html
<CommentPost @onpost-success="onPostSuccess" />
```

```js
onPostSuccess (res) {
    console.log(res)
    this.isPostShow = false
}
```

3ã€å°†æ–‡ç« è¯„è®ºç»„ä»¶ä¸­çš„listæ¢æˆpropsæ¨¡å¼

```js
props: {
    list: {
      type: Array,
      required: true
    }
  }
```

4ã€indexçˆ¶ç»„ä»¶ç»™æ–‡ç« è¯„è®ºç»„ä»¶ä¼ é€’list

```html
<!-- æ–‡ç« è¯„è®º -->
<article-comment :list="commentList" @onload-success="totalCount = $event" :article-id="article.art_id" />
<!-- /æ–‡ç« è¯„è®º -->
```

5ã€å®šä¹‰commentList

```js
commentList: []
```

6ã€ç»™commentListè¿½åŠ æ•°æ®

```js
onPostSuccess (res) {
    this.commentList.push(res.data.data.new_obj)
    this.isPostShow = false
}
```

### å®Œå–„ç©ºå†…å®¹å¤„ç†

```html
<!-- æ·»åŠ trimä¿®é¥° -->
<van-field
      class="post-field"
      v-model.trim="inputComment"
      rows="2"
      autosize
      type="textarea"
      maxlength="50"
      placeholder="è¯·è¾“å…¥ç•™è¨€"
      show-word-limit
    />
<!-- æ·»åŠ disabledæ§åˆ¶ç¦ç”¨ -->
    <van-button
      class="post-btn"
      @click="onAddComment"
      :disabled="!inputComment.length"
    >å‘å¸ƒ</van-button>
```





## è¯„è®ºå›å¤

### å‡†å¤‡å›å¤å¼¹å±‚

> article/comopnents/article-comment-item.vueç»„ä»¶ä¸­

ä¸€ã€åœ¨è¯¦æƒ…é¡µä¸­ä½¿ç”¨å¼¹å±‚ç”¨æ¥å±•ç¤ºæ–‡ç« çš„å›å¤

1ã€åœ¨ data ä¸­æ·»åŠ æ•°æ®ç”¨æ¥æ§åˆ¶å±•ç¤ºå›å¤å¼¹å±‚çš„æ˜¾ç¤ºçŠ¶æ€

```js
data () {
  return {
    ...
    isReplyShow: false
  }
}
```

2ã€åœ¨è¯¦æƒ…é¡µä¸­æ·»åŠ ä½¿ç”¨å¼¹å±‚ç»„ä»¶

```html
<!-- è¯„è®ºå›å¤ -->
<van-popup
  v-model="isReplyShow"
  position="bottom"
  style="height: 95%"
>
  è¯„è®ºå›å¤
</van-popup>
<!-- /è¯„è®ºå›å¤ -->
```

äºŒã€å½“ç‚¹å‡»è¯„è®ºé¡¹ç»„ä»¶ä¸­çš„å›å¤æŒ‰é’®çš„æ—¶å€™å±•ç¤ºå¼¹å±‚

1ã€åœ¨ `article-comment-item.vue` ç»„ä»¶ä¸­ç‚¹å‡»å›å¤æŒ‰é’®çš„æ—¶å€™ï¼Œå¯¹å¤–å‘å¸ƒè‡ªå®šä¹‰äº‹ä»¶

```php+HTML
<van-button
  size="mini"
  type="default"
  @click="$emit('click-reply')"
>å›å¤ {{ comment.reply_count }}</van-button>
```

2ã€åœ¨è¯¦æƒ…é¡µç»„ä»¶ä¸­ä½¿ç”¨çš„ä½ç½®ç›‘å¬å¤„ç†

```html
<article-comment-item
  v-for="(comment, index) in list"
  :key="index"
  :comment="comment"
  @click-reply="isReplyShow = true"
/>
```

### ç‚¹å‡»å›å¤æ˜¾ç¤ºå¼¹å‡ºå±‚

### å°è£…å†…å®¹ç»„ä»¶

article/comopnents/comment-reply.vueç»„ä»¶

> å›å¤å¼¹å±‚å†…éƒ¨çš„å†…å®¹è¿›è¡Œå°è£… >> éœ€è¦æŠŠå½“å‰è¯„è®ºé¡¹ä¼ é€’ç»™å¼¹å±‚ç»„ä»¶



```html
<template>
  <div class="comment-reply">
    <!-- å¯¼èˆªæ  -->
    <van-nav-bar :title="`${comment.reply_count}æ¡å›å¤`">
      <van-icon
        slot="left"
        name="cross"
        @click="$emit('click-close')"
      />
    </van-nav-bar>
    <!-- /å¯¼èˆªæ  -->

    <!-- å½“å‰è¯„è®ºé¡¹ -->
    <!-- /å½“å‰è¯„è®ºé¡¹ -->

    <van-cell title="æ‰€æœ‰å›å¤" />

    <!-- è¯„è®ºçš„å›å¤åˆ—è¡¨ -->
    <!-- /è¯„è®ºçš„å›å¤åˆ—è¡¨ -->

    <!-- åº•éƒ¨ -->
    <!-- /åº•éƒ¨ -->
  </div>
</template>

<script>
export default {
  name: 'CommentReply',
  components: {},
  props: {},
  data () {
    return {}
  },
  computed: {},
  watch: {},
  created () {},
  mounted () {},
  methods: {}
}
</script>

<style scoped></style>

```

### ä¼ é€’å½“å‰ç‚¹å‡»å›å¤çš„è¯„è®ºé¡¹

### å¤„ç†å¤´éƒ¨

### å¤„ç†å½“å‰è¯„è®ºé¡¹

ä¸€ã€è®© `comment-reply.vue` ç»„ä»¶æ‹¿åˆ°ç‚¹å‡»å›å¤çš„è¯„è®ºå¯¹è±¡

1ã€åœ¨ `comment-item.vue` ç»„ä»¶ä¸­ç‚¹å‡»å›å¤æŒ‰é’®çš„æ—¶å€™æŠŠè¯„è®ºå¯¹è±¡ç»™ä¼ å‡ºæ¥

```html
<van-button
  size="mini"
  type="default"
  @click="$emit('click-reply', comment)"
>å›å¤ {{ comment.reply_count }}</van-button>
```

2ã€åœ¨æ–‡ç« è¯¦æƒ…ç»„ä»¶ä¸­æ¥æ”¶å¤„ç†

```js
data () {
  return {
    ...
    currentComment: {} // ç‚¹å‡»å›å¤çš„é‚£ä¸ªè¯„è®ºå¯¹è±¡
  }
}
```

```html
<comment-item
  v-for="(comment, index) in articleComment.list"
  :key="index"
  :comment="comment"
  @click-reply="onReplyShow"
/>
```

```js
async onReplyShow (comment) {
  // å°†å­ç»„ä»¶ä¸­ä¼ ç»™æˆ‘è¯„è®ºå¯¹è±¡å­˜å‚¨åˆ°å½“å‰ç»„ä»¶
  this.currentComment = comment
  
  // å±•ç¤ºè¯„è®ºå›å¤å¼¹å±‚
  this.isReplyShow = true
}
```

3ã€åœ¨è¯¦æƒ…ç»„ä»¶ä¸­å°† `currentComment` ä¼ é€’ç»™ `comment-reply.vue` ç»„ä»¶

```html
<!-- è¯„è®ºå›å¤ -->
<van-popup
  v-model="isReplyShow"
  position="bottom"
  style="height: 95%"
>
  <comment-reply
    @click-close="isReplyShow = false"
    :comment="currentComment"
  />
</van-popup>
<!-- /è¯„è®ºå›å¤ -->
```

4ã€åœ¨ `comment-reply.vue` ç»„ä»¶ä¸­å£°æ˜æ¥æ”¶

```js
props: {
  comment: {
    type: Object,
    required: true
  }
},
```

æœ€åä½¿ç”¨è°ƒè¯•å·¥å…·æŸ¥çœ‹ props æ•°æ®æ˜¯å¦æ¥æ”¶æ­£ç¡®ã€‚

äºŒã€åœ¨ `comment-reply.vue` ç»„ä»¶ä¸­å±•ç¤ºå½“å‰è¯„è®º

1ã€åŠ è½½æ³¨å†Œ `comment-item.vue` ç»„ä»¶

2ã€ä½¿ç”¨å±•ç¤º

```html
<template>
  <div class="comment-reply">
    <!-- å¯¼èˆªæ  -->
    <van-nav-bar :title="`${comment.reply_count}æ¡å›å¤`">
      <van-icon
        slot="left"
        name="cross"
        @click="$emit('click-close')"
      />
    </van-nav-bar>
    <!-- /å¯¼èˆªæ  -->

    <!-- å½“å‰è¯„è®ºé¡¹ -->
    <comment-item :comment="comment" />
    <!-- /å½“å‰è¯„è®ºé¡¹ -->

    <!-- è¯„è®ºçš„å›å¤åˆ—è¡¨ -->
    <!-- /è¯„è®ºçš„å›å¤åˆ—è¡¨ -->

    <!-- åº•éƒ¨ -->
    <!-- /åº•éƒ¨ -->
  </div>
</template>
```





### å±•ç¤ºè¯„è®ºå›å¤åˆ—è¡¨

åŸºæœ¬æ€è·¯ï¼š

- å›å¤åˆ—è¡¨å’Œæ–‡ç« çš„è¯„è®ºåˆ—è¡¨å‡ ä¹æ˜¯ä¸€æ ·çš„
- é‡ç”¨æŠŠä¹‹å‰å°è£…çš„è¯„è®ºåˆ—è¡¨

```html
<template>
  <div class="comment-reply">
    <!-- å¯¼èˆªæ  -->
    <van-nav-bar :title="`${comment.reply_count}æ¡å›å¤`">
      <van-icon
        slot="left"
        name="cross"
        @click="$emit('click-close')"
      />
    </van-nav-bar>
    <!-- /å¯¼èˆªæ  -->

    <!-- å½“å‰è¯„è®ºé¡¹ -->
    <comment-item :comment="comment" />
    <!-- /å½“å‰è¯„è®ºé¡¹ -->

    <van-cell title="æ‰€æœ‰å›å¤" />

    <!-- è¯„è®ºçš„å›å¤åˆ—è¡¨ -->
    <van-list
      v-model="loading"
      :finished="finished"
      finished-text="æ²¡æœ‰æ›´å¤šäº†"
      @load="onLoad"
    >
      <comment-item
        v-for="(comment, index) in list"
        :key="index"
        :comment="comment"
      />
    </van-list>
    <!-- /è¯„è®ºçš„å›å¤åˆ—è¡¨ -->

    <!-- åº•éƒ¨ -->
    <!-- /åº•éƒ¨ -->
  </div>
</template>

<script>
import CommentItem from './comment-item'
import { getComments } from '@/api/comment'

export default {
  name: 'CommentReply',
  components: {
    CommentItem
  },
  props: {
    comment: {
      type: Object,
      required: true
    }
  },
  data () {
    return {
      list: [],
      loading: false,
      finished: false,
      offset: null,
      limit: 20
    }
  },
  computed: {},
  watch: {},
  created () {},
  mounted () {},
  methods: {
    async onLoad () {
      // 1. è¯·æ±‚è·å–æ•°æ®
      const { data } = await getComments({
        type: 'c', // è¯„è®ºç±»å‹ï¼Œa-å¯¹æ–‡ç« (article)çš„è¯„è®ºï¼Œc-å¯¹è¯„è®º(comment)çš„å›å¤
        source: this.comment.com_id.toString(), // æºidï¼Œæ–‡ç« idæˆ–è¯„è®ºid
        offset: this.offset, // è·å–è¯„è®ºæ•°æ®çš„åç§»é‡ï¼Œå€¼ä¸ºè¯„è®ºidï¼Œè¡¨ç¤ºä»æ­¤idçš„æ•°æ®å‘åå–ï¼Œä¸ä¼ è¡¨ç¤ºä»ç¬¬ä¸€é¡µå¼€å§‹è¯»å–æ•°æ®
        limit: this.limit // è·å–çš„è¯„è®ºæ•°æ®ä¸ªæ•°ï¼Œä¸ä¼ è¡¨ç¤ºé‡‡ç”¨åç«¯æœåŠ¡è®¾å®šçš„é»˜è®¤æ¯é¡µæ•°æ®é‡
      })

      // 2. å°†æ•°æ®æ·»åŠ åˆ°åˆ—è¡¨ä¸­
      const { results } = data.data
      this.list.push(...results)

      // 3. å…³é—­ loading
      this.loading = false

      // 4. åˆ¤æ–­æ•°æ®æ˜¯å¦åŠ è½½å®Œæ¯•
      if (results.length) {
        this.offset = data.data.last_id
      } else {
        this.finished = true
      }
    }
  }
}
</script>

<style scoped></style>

```



### è§£å†³å¼¹å±‚ä¸­ç»„ä»¶å†…å®¹ä¸æ›´æ–°é—®é¢˜

å¼¹å±‚ç»„ä»¶ï¼š

- å¦‚æœåˆå§‹çš„æ¡ä»¶æ˜¯ falseï¼Œåˆ™å¼¹å±‚çš„å†…å®¹ä¸ä¼šæ¸²æŸ“
- ç¨‹åºè¿è¡ŒæœŸé—´ï¼Œå½“æ¡ä»¶å˜ä¸º true çš„æ—¶å€™ï¼Œå¼¹å±‚æ‰æ¸²æŸ“äº†å†…å®¹
- ä¹‹ååˆ‡æ¢å¼¹å±‚çš„å±•ç¤ºï¼Œå¼¹å±‚åªæ˜¯é€šè¿‡ CSS æ§åˆ¶éšè—å’Œæ˜¾ç¤º

å¼¹å±‚æ¸²æŸ“å‡ºæ¥ä»¥åå°±åªæ˜¯ç®€å•çš„åˆ‡æ¢æ˜¾ç¤ºå’Œéšè—ï¼Œé‡Œé¢çš„å†…å®¹ä¹Ÿä¸å†é‡æ–°æ¸²æŸ“äº†ï¼Œæ‰€ä»¥ä¼šå¯¼è‡´æˆ‘ä»¬çš„è¯„è®ºçš„å›å¤åˆ—è¡¨ä¸ä¼šåŠ¨æ€æ›´æ–°äº†ã€‚è§£å†³åŠæ³•å°±æ˜¯åœ¨æ¯æ¬¡å¼¹å±‚æ˜¾ç¤ºçš„æ—¶å€™é‡æ–°æ¸²æŸ“ç»„ä»¶ã€‚

```html
<!-- è¯„è®ºå›å¤ -->
<van-popup
  v-model="isReplyShow"
  get-container="body"
  round
  position="bottom"
  :style="{ height: '90%' }"
>
  <!-- å›å¤åˆ—è¡¨ -->
  <comment-reply :comment="currentComment" + v-if="isReplyShow" />
  <!-- /å›å¤åˆ—è¡¨ -->
</van-popup>
<!-- è¯„è®ºå›å¤ -->
```

### å‘å¸ƒå›å¤

ä¼˜åŒ–replyä»£ç 

```vue
<template>
  <div class="reply">
    <van-nav-bar
      left-arrow
      @click-left="$emit('click-close')"
      :title="`æ‰€æœ‰å›å¤${currentComment.reply_count}æ¡`"
    ></van-nav-bar>
    <CommentItem :comment="currentComment" />
    <!--    è¯„è®ºå†…å®¹-->
    <van-divider>æ‰€æœ‰å›å¤</van-divider>
    <!--å›å¤çš„å†…å®¹-->
    <van-list
      finished-text="æ²¡æœ‰æ›´å¤šå›å¤äº†"
      v-model="loading"
      :finished="finished"
      @load="onLoad"
    >
      <!--      <comment-item comment="" v-for="item in list" />-->
      <!--      <van-cell></van-cell>-->
      <comment-item :comment="item" v-for="item in list" :key="item.com_id" />
    </van-list>
    <!--åº•éƒ¨è¯„è®ºé¡¹-->
    <van-cell class="bottom" border>
      <van-button block round size="small" @click="isReplyShow = true"
        >å†™è¯„è®º</van-button
      >
    </van-cell>
    <van-popup position="bottom" v-model="isReplyShow">
      <PostComment
        type="c"
        :com_id="currentComment.com_id"
        @onPostSuccess="onPostSuccess"
      />
    </van-popup>
  </div>
</template>

<script>
import CommentItem from "@/views/article/components/article-item";
import { getComments } from "@/api/commen";
import PostComment from "@/views/article/components/comment-post";
export default {
  name: "CommentReply",
  components: { PostComment, CommentItem },
  props: {
    currentComment: Object,
  },
  data() {
    return {
      loading: false,
      finished: false,
      list: [],
      offset: null,
      limit: 10,
      isReplyShow: false,
    };
  },
  methods: {
    onPostSuccess() {},
    async onLoad() {
      const { data } = await getComments({
        type: "c", // è¯„è®ºç±»å‹ï¼Œa-å¯¹æ–‡ç« (article)çš„è¯„è®ºï¼Œc-å¯¹è¯„è®º(comment)çš„å›å¤
        source: this.currentComment.com_id, // æºidï¼Œæ–‡ç« idæˆ–è¯„è®ºid
        offset: this.offset, // è·å–è¯„è®ºæ•°æ®çš„åç§»é‡ï¼Œå€¼ä¸ºè¯„è®ºidï¼Œè¡¨ç¤ºä»æ­¤idçš„æ•°æ®å‘åå–ï¼Œä¸ä¼ è¡¨ç¤ºä»ç¬¬ä¸€é¡µå¼€å§‹è¯»å–æ•°æ®
        limit: this.limit, // è·å–çš„è¯„è®ºæ•°æ®ä¸ªæ•°ï¼Œä¸ä¼ è¡¨ç¤ºé‡‡ç”¨åç«¯æœåŠ¡è®¾å®šçš„é»˜è®¤æ¯é¡µæ•°æ®é‡
      });
      const { results } = data.data;
      this.list.push(...results);

      // 3. å…³é—­ loading
      this.loading = false;

      // 4. åˆ¤æ–­æ•°æ®æ˜¯å¦åŠ è½½å®Œæ¯•
      if (results.length) {
        this.offset = data.data.last_id;
      } else {
        this.finished = true;
      }
    },
  },
};
</script>

<style scoped lang="less">
.reply {
  .bottom {
    position: fixed;
    bottom: 0;
    right: 0;
    left: 0;
  }
}
</style>

```

### 4.9ã€å‘å¸ƒå›å¤

**1ã€å¤„ç†åº•éƒ¨è§†å›¾ `comment-reply.vue`**

- ç»˜åˆ¶å›å¤æŒ‰é’®å’Œå›å¤å¼¹æ¡†

```js
data () {
    return {
        isPostShow: false  // å¼¹æ¡†æ˜¯å¦æ˜¾ç¤º
    }
}
```



```html
<!-- åº•éƒ¨åŒºåŸŸ -->
<div class="reply-bottom">
    <van-button
        class="write-btn"
        size="small"
        round
        @click="isPostShow = true"        
    >å†™è¯„è®º</van-button>
</div>
<!-- /åº•éƒ¨åŒºåŸŸ -->

<!-- å‘å¸ƒè¯„è®º -->
<van-popup v-model="isPostShow" position="bottom">
   è¯„è®ºå›å¤è¯„è®ºå›å¤
</van-popup>
<!-- /å‘å¸ƒè¯„è®º -->
```

* æ ·å¼

  ```less
  .reply-bottom {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    height: 88px;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: #fff;
    border-top: 1px solid #d8d8d8;
    .write-btn {
      width: 60%;
    }
  }
  ```

**2ã€å‚æ•°å¤„ç†**

- åœ¨`comment-reply.vue`å¯¼å…¥`comment-post.vue` ç»„ä»¶

```js
import CommentPost from './comment-post'
```

```js
components: {
    // å…¶ä»–æ³¨å†Œ...
    CommentPost
}
```



```html
<!-- å‘å¸ƒè¯„è®º -->
<van-popup v-model="isPostShow" position="bottom">
    <comment-post :target="comment.com_id"/>
</van-popup>
<!-- /å‘å¸ƒè¯„è®º -->
```