---
title: ğŸ“š 09-ç¼–è¾‘ç”¨æˆ·èµ„æ–™
---
# ä¹ã€ç”¨æˆ·é¡µé¢

> è¯¥æ¨¡å—ä½œä¸ºå­¦ç”Ÿä½œä¸šï¼Œä¸è®²è§£ï¼Œä»…ä¾›æºç å‚è€ƒã€‚

<img src="https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20200111104547462.png" alt="image-20200111104547462" width="250" />



## åˆ›å»ºç»„ä»¶å¹¶é…ç½®è·¯ç”±

1ã€åˆ›å»º `views/user-profile/index.vue`

```html
<template>
  <div>
    ç”¨æˆ·èµ„æ–™
  </div>
</template>

<script>
export default {
  data () {
    return {

    }
  },

  created () {

  },

  methods: {

  }
}
</script>

<style scoped lang='less'>

</style>

```

2ã€é…ç½®åˆ°æ ¹è·¯ç”±

```js
{
    path: '/user/profile',
        component: () => import('@/views/user-profile/index.vue')
}
```

3ã€ä¿®æ”¹æˆ‘çš„é¡µé¢çš„ç¼–è¾‘èµ„æ–™çš„to

```html
<div class="right">
    <van-button to="/user/profile" type="default" size="mini" round>ç¼–è¾‘èµ„æ–™</van-button>
</div>
```



æœ€åè®¿é—® /user/profile æµ‹è¯•ã€‚

## é¡µé¢å¸ƒå±€

### ç¼–è¾‘ç”¨æˆ·èµ„æ–™åŸºæœ¬å¸ƒå±€

1ã€åŸºæœ¬ç»“æ„

```html
<template>
  <div class="user-profile">
    <!-- å¯¼èˆªæ  -->
    <van-nav-bar
    class="page-nav-bar"
    title="ä¸ªäººä¿¡æ¯"
    left-arrow @click-left="$router.back()" />
    <!-- /å¯¼èˆªæ  -->
    <van-cell title="å¤´åƒ" is-link>
      <van-image
        class="avatar"
        fit="cover"
        round
        src="https://img.yzcdn.cn/vant/cat.jpeg"
      />
    </van-cell>
    <van-cell title="æ˜µç§°" value="å†…å®¹" is-link />
    <van-cell title="æ€§åˆ«" value="å†…å®¹" is-link />
    <van-cell title="ç”Ÿæ—¥" value="å†…å®¹" is-link />
  </div>
</template>
```

2ã€æ ·å¼

```css
<style scoped lang='less'>
.user-profile {
  .avatar {
    width: 60px;
    height: 60px;
  }
}
</style>
```



## å±•ç¤ºç”¨æˆ·ä¿¡æ¯

æ­¥éª¤ï¼š

- å°è£…æ•°æ®æ¥å£
- è¯·æ±‚è·å–æ•°æ®
- æ¨¡æ¿ç»‘å®š

1ã€åœ¨ `api/user.js` ä¸­æ·»åŠ è·å–æŒ‡å®šç”¨æˆ·ä¿¡æ¯çš„æ•°æ®æ¥å£

```js
/**
 * è·å–ç”¨æˆ·ä¸ªäººèµ„æ–™
 */
// è·å–æŒ‡å®šç”¨æˆ·ä¿¡æ¯
export const getUserProfile = () => {
  return request({
    method: 'GET',
    url: '/app/v1_0/user/profile'
  })
}
```

2ã€åœ¨ç”¨æˆ·é¡µé¢ä¸­è¯·æ±‚è·å–æ•°æ®

```js
import { getUserProfile } from '@/api/user.js'
export default {
  name: 'userProfile',
  data () {
    return {
      user: {}
    }
  },

  created () {
    this.loadProfile()
  },

  methods: {
    async loadProfile () {
      try {
        const res = await getUserProfile()
        this.user = res.data.data
      } catch (err) {
        this.$toast('è·å–æ•°æ®å¤±è´¥')
      }
    }
  }
}
```

3ã€æ¨¡æ¿ç»‘å®š

```html
<van-cell title="å¤´åƒ" is-link>
    <van-image
               class="avatar"
               fit="cover"
               round
               :src="user.photo"
               />
</van-cell>
<van-cell title="æ˜µç§°" :value="user.name" is-link />
<van-cell title="æ€§åˆ«" :value="user.gender ? 'å¥³' : 'ç”·'" is-link />
<van-cell title="ç”Ÿæ—¥" :value="user.birthdy || '1977-00-00'" is-link />
```

## ä¿®æ”¹æ˜µç§°

### å¼¹å±‚å¤„ç†

1ã€å¼¹å±‚ç»“æ„

```html
<!-- ç¼–è¾‘æ˜µç§°å¼¹å±‚ -->
    <van-popup
    v-model="isShowUpdateName"
    style="height: 100%"
    position="bottom">
      ç¼–è¾‘æ˜µç§°
    </van-popup>
    <!-- ç¼–è¾‘æ˜µç§°å¼¹å±‚ -->
```

2ã€å®šä¹‰isShowUpdateNameï¼šfalse

3ã€ç‚¹å‡»å¼¹å±‚ä¿®æ”¹isShowUpdateName

```js
<van-cell title="æ˜µç§°" @click="isShowUpdateName = true" :value="user.name" is-link />
```

### å°è£…ç¼–è¾‘æ˜µç§°ç»„ä»¶

1ã€åœ¨å½“å‰é¡µé¢ä¸­å°è£…åŸºæœ¬ç»„ä»¶

2ã€å¼•å…¥ç»„ä»¶ã€æ³¨å†Œã€ä½¿ç”¨

```js
import updateName from './components/update-name.vue'
```

```js
components: {
    updateName
  }
```

```html
<!-- ç¼–è¾‘æ˜µç§°å¼¹å±‚ -->
    <van-popup
    v-model="isShowUpdateName"
    style="height: 100%"
    position="bottom">
      <update-name />
    </van-popup>
    <!-- ç¼–è¾‘æ˜µç§°å¼¹å±‚ -->
```



### ä¿®æ”¹æ˜µç§°ç»„ä»¶

1ã€å¯¼èˆªæ ç»“æ„

```html
<!-- å¯¼èˆªæ  -->
<van-nav-bar
             title="ç¼–è¾‘æ˜µç§°"
             left-text="å–æ¶ˆ"
             right-text="ç¡®å®š"
             @click-left="$emit('close')" />
<!-- /å¯¼èˆªæ  -->
```

2ã€çˆ¶ç»„ä»¶å®šä¹‰closeäº‹ä»¶

```html
<update-name @close="isShowUpdateName = false" />
```

3ã€å®šä¹‰è¾“å…¥æ¡†åŸºæœ¬ç»“æ„

```html
<van-field
      v-model="message"
      rows="2"
      autosize
      type="textarea"
      maxlength="7"
      placeholder="è¯·è¾“å…¥æ–°æ˜µç§°"
      show-word-limit
    />
```

4ã€æ ·å¼å¤„ç†

```html
<div style="padding: 10px;">
      <van-field
        v-model="message"
        rows="2"
        autosize
        type="textarea"
        maxlength="50"
        placeholder="è¯·è¾“å…¥æ–°æ˜µç§°"
        show-word-limit
      />
    </div>
```

```css
.van-popup {
  background: #f5f7f9;
}
```

### æ•°æ®å¤„ç†

1ã€å°†çˆ¶ç»„ä»¶çš„æ˜µç§°ä¼ é€’ç»™å­ç»„ä»¶

```html
<update-name v-model="user.name" @close="isShowUpdateName = false" />
```

2ã€å­ç»„ä»¶update-nameæ¥æ”¶åˆ°æ•°æ®åŒæ­¥ç»™localName

```html
props: {
    value: {
      type: String,
      required: true
    }
  }
```

```js
created () {
    this.localNmae = this.value
  }
```

3ã€é¡µé¢ç»‘å®šlocalNmae

```html
<van-field
        v-model="localNmae"
        rows="2"
        autosize
        type="textarea"
        maxlength="50"
        placeholder="è¯·è¾“å…¥æ–°æ˜µç§°"
        show-word-limit
      />
```

4ã€ç»„ä»¶åˆ©ç”¨v-ifè¿›è¡Œé”€æ¯åˆ›å»º,ä»è€Œæ¸…ç©ºè¾“å…¥æ¡†

```html
<!-- ç¼–è¾‘æ˜µç§°å¼¹å±‚ -->
    <van-popup
    v-model="isShowUpdateName"
    style="height: 100%"
    position="bottom">
      <update-name v-if="isShowUpdateName" v-model="user.name" @close="isShowUpdateName = false" />
    </van-popup>
    <!-- ç¼–è¾‘æ˜µç§°å¼¹å±‚ -->
```

### æ›´æ–°æ˜µç§°å¤„ç†å®Œæˆ

1ã€å°è£…æ›´æ–°æ˜µç§°çš„api

```js
/**
 * æ›´æ–°æ˜µç§°
 */
export const updateUserName = data => {
  return request({
    method: 'PATCH',
    url: '/app/v1_0/user/profile',
    data
  })
}
```

2ã€å¼•å…¥apiæ–¹æ³•å¹¶åœ¨ç‚¹å‡»ç¡®å®šçš„äº‹ä»¶å‡½æ•°ä¸­è°ƒç”¨

```js
import { updateUserName } from '@/api/user.js'
```

3ã€å®šä¹‰ç‚¹å‡»å³ä¾§çš„äº‹ä»¶å’Œäº‹ä»¶å‡½æ•°

```html
<!-- å¯¼èˆªæ  -->
    <van-nav-bar
    title="ç¼–è¾‘æ˜µç§°"
    left-text="å–æ¶ˆ"
    right-text="ç¡®å®š"
    @click-right="onClickRight"
    @click-left="$emit('close')" />
```

```js
async onClickRight () {
      this.$toast.loading({
        message: 'ä¿å­˜ä¸­...',
        forbidClick: true,
        duration: 0
      })
      try {
        if (this.localNmae.trim() === '') return this.$toast('è¯·è¾“å…¥æ˜µç§°')
        await updateUserName({
          name: this.localNmae
        })
        this.$emit('input', this.localNmae)
        this.$emit('close')
        this.$toast('æ›´æ–°æˆåŠŸ')
      } catch (err) {
        this.$toast('æ›´æ–°å¤±è´¥')
      }
    }
```

4ã€ä¼˜åŒ–409

```js
catch (err) {
    console.dir(err)
    if (err.response && err.response.status === 409) {
        return this.$toast('ç”¨æˆ·åå·²å­˜åœ¨')
    }
    this.$toast('æ›´æ–°å¤±è´¥')
}
```

##ç¼–è¾‘æ€§åˆ«

### å¼¹å±‚å’ŒåŸºæœ¬ç»„ä»¶

1ã€å‡†åˆ«å¼¹å±‚

```html
<!-- ç¼–è¾‘æ€§åˆ«å¼¹å±‚ -->
<van-popup
           v-model="isShowUpdateGender"
           position="bottom">
    <update-gender @close="isShowUpdateGender = false" />
</van-popup>
<!-- ç¼–è¾‘æ˜µç§°å¼¹å±‚ -->
```

2ã€å®šä¹‰update-genderç»„ä»¶

```html
<template>
  <van-picker
    title="æ€§åˆ«"
    show-toolbar
    :columns="columns"
    @cancel="$emit('close')"
  />
</template>

<script>
export default {
  data () {
    return {
      columns: ['ç”·', 'å¥³']
    }
  }
}
</script>

<style scoped lang='less'>

</style>

```

3ã€å¼•å…¥ã€æ³¨å†Œ

```js
import updateGender from './components/update-gender.vue'
```

```js
components: {
    updateName,
    updateGender
}
```

### é»˜è®¤å€¼çš„è®¾ç½®

1ã€åˆ©ç”¨v-modelä¼ é€’ç»™å­ç»„ä»¶,å¹¶åˆ©ç”¨v-ifå®ç°ç»„ä»¶é”€æ¯

```html
<update-gender v-if="isShowUpdateGender" v-model="user.gender" @close="isShowUpdateGender = false" />
```

2ã€update-genderç»„ä»¶æ¥æ”¶æ•°æ®å¹¶è®¾ç½®é»˜è®¤å€¼

```js
props: {
    value: {
      type: Number,
      required: true
    }
  }
```

```html
<van-picker
    title="æ€§åˆ«"
    show-toolbar
    :columns="columns"
    :default-index="value"
    @cancel="$emit('close')"
  />
```

### ç‚¹å‡»ç¡®å®š

1ã€åˆ©ç”¨changeè·å–é€‰æ‹©å€¼

```html
<van-picker
    title="æ€§åˆ«"
    show-toolbar
    :columns="columns"
    :default-index="value"
    @cancel="$emit('close')"
    @change="onChange"
    @confirm="onConfirm"
  />
```

```js
onChange (picker, value, index) {
    this.gender = index
}
```

```js
data () {
    return {
      columns: ['ç”·', 'å¥³'],
      gender: this.value
    }
  }
```

2ã€å¼•å…¥æ›´æ–°ä¿¡æ¯æ–¹æ³•

```js
import { updateUser } from '@/api/user.js'
```

3ã€å®šä¹‰configrmäº‹ä»¶å‡½æ•°

```js
async onConfirm () {
      this.$toast.loading({
        message: 'ä¿å­˜ä¸­...',
        forbidClick: true,
        duration: 0
      })
      try {
        await updateUser({
          gender: this.gender
        })
        this.$emit('input', this.gender)
        this.$emit('close')
        this.$toast('æ›´æ–°æˆåŠŸ')
      } catch (err) {
        this.$toast('æ›´æ–°å¤±è´¥')
      }
    }
```

## æ›´æ–°ç”Ÿæ—¥

### å¼¹å±‚å’ŒåŸºæœ¬ç»„ä»¶

1ã€ç¼–è¾‘ç”Ÿæ—¥å¼¹å±‚å¤„ç†

```html
<!-- ç¼–è¾‘ç”Ÿæ—¥å¼¹å±‚ -->
    <van-popup
    v-model="isShowUpdateBirthdy"
    position="bottom">
      æ›´æ–°ç”Ÿæ—¥
    </van-popup>
    <!-- ç¼–è¾‘ç”Ÿæ—¥å¼¹å±‚ -->
```

2ã€ç‚¹å‡»æ˜¾ç¤ºå¼¹å±‚

```html
<van-cell title="ç”Ÿæ—¥" @click="isShowUpdateBirthdy = true" :value="user.birthdy || '1977-00-00'" is-link />
```

3ã€å®šä¹‰ç»„ä»¶ã€å¼•ç”¨ç»„ä»¶ã€æ³¨å†Œã€ä½¿ç”¨

```js
import updateBirthdy from './components/update-birthdy.vue'
```

```js
components: {
    updateName,
    updateGender,
    updateBirthdy
  }
```

```html
<!-- ç¼–è¾‘ç”Ÿæ—¥å¼¹å±‚ -->
    <van-popup
    v-model="isShowUpdateBirthdy"
    position="bottom">
      <update-birthdy />
    </van-popup>
    <!-- ç¼–è¾‘ç”Ÿæ—¥å¼¹å±‚ -->
```

### ç”¨æ—¥æœŸç»„ä»¶å±•ç¤ºç”Ÿæ—¥

1ã€ä½¿ç”¨ç»„ä»¶

```html
<div class="update-birthdy">
    <van-datetime-picker
      v-model="currentDate"
      type="date"
      title="é€‰æ‹©å¹´æœˆæ—¥"
      :min-date="minDate"
      :max-date="maxDate"
    />
  </div>
```

```js
minDate: new Date(1900, 0, 1),
maxDate: new Date(),
currentDate: new Date()
```

2ã€çˆ¶ç»„ä»¶ä¼ é€’currentDate

```html
<update-birthdy v-model="user.birthday" />
```

```js
data () {
    return {
      minDate: new Date(1900, 0, 1),
      maxDate: new Date(),
      currentDate: new Date(this.value)
    }
  },

  props: {
    value: {
      type: String,
      required: true
    }
  }
```

### å–æ¶ˆå’Œç¡®å®š

1ã€ç‚¹å‡»å–æ¶ˆ

```html
<van-datetime-picker
      v-model="currentDate"
      type="date"
      title="é€‰æ‹©å¹´æœˆæ—¥"
      :min-date="minDate"
      :max-date="maxDate"
      @cancel="$emit('close')"
    />
```

```html
<van-popup
    v-model="isShowUpdateBirthdy"
    position="bottom">
      <update-birthdy @close="isShowUpdateBirthdy = false" v-model="user.birthday" />
    </van-popup>
```

2ã€v-ifå¤„ç†ç»„ä»¶é»˜è®¤å€¼é—®é¢˜ v-if="isShowUpdateBirthdy"

3ã€ç‚¹å‡»ç¡®å®šï¼Œæ³¨å†Œäº‹ä»¶å’Œäº‹ä»¶å‡½æ•°

```js
<van-datetime-picker
      v-model="currentDate"
      type="date"
      title="é€‰æ‹©å¹´æœˆæ—¥"
      :min-date="minDate"
      :max-date="maxDate"
      @cancel="$emit('close')"
      @confirm="onConfirm"
    />
```

```js
async onConfirm () {
      this.$toast.loading({
        message: 'ä¿å­˜ä¸­...',
        forbidClick: true,
        duration: 0
      })
      try {
        await updateUser({
          birthday: dayJs(this.currentDate).format('YYYY-MM-DD')
        })
        this.$emit('input', dayJs(this.currentDate).format('YYYY-MM-DD'))
        this.$emit('close')
        this.$toast('æ›´æ–°æˆåŠŸ')
      } catch (err) {
        this.$toast('æ›´æ–°å¤±è´¥')
      }
    }
```

```js
import { updateUser } from '@/api/user.js'
import dayJs from 'dayjs'
```

