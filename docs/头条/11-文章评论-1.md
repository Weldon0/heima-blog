---
title: ğŸŒ¹æ–‡ç« è¯„è®º-1
---
# å…«ã€æ–‡ç« è¯„è®º

## [#](https://hw-xiansheng.github.io/toutiao-notes/guide/08-æ–‡ç« è¯„è®º.html#_1ã€ä¸šåŠ¡åŠŸèƒ½åˆ†æ)1ã€ä¸šåŠ¡åŠŸèƒ½åˆ†æ

## [#](https://hw-xiansheng.github.io/toutiao-notes/guide/08-æ–‡ç« è¯„è®º.html#_2ã€å±•ç¤ºæ–‡ç« è¯„è®ºåˆ—è¡¨)2ã€å±•ç¤ºæ–‡ç« è¯„è®ºåˆ—è¡¨

### [#](https://hw-xiansheng.github.io/toutiao-notes/guide/08-æ–‡ç« è¯„è®º.html#_2-1ã€å‡†å¤‡ç»„ä»¶)2.1ã€å‡†å¤‡ç»„ä»¶

ä¸ºäº†æ›´å¥½çš„å¼€å‘å’Œç»´æŠ¤ï¼Œè¿™é‡Œæˆ‘ä»¬æŠŠæ–‡ç« è¯„è®ºå•ç‹¬å°è£…åˆ°ä¸€ä¸ªç»„ä»¶ä¸­æ¥å¤„ç†ã€‚

**åˆ›å»ºç»„ä»¶** `src/views/article/components/comment-list.vue`

```html
<template>
    <van-list
      v-model="loading"
      :finished="finished"
      finished-text="æ²¡æœ‰æ›´å¤šäº†"
      @load="onLoad"
    >
        <van-cell v-for="item in list" :key="item" :title="item"></van-cell>
    </van-list>
</template>
<script>
  export default {
    name: "CommentList",
    components:{},
    props: {},
    data() {
      return {
        list: [], // è¯„è®ºåˆ—è¡¨
        loading: false, // ä¸Šæ‹‰åŠ è½½æ›´å¤šçš„ loading
        finished: false // æ˜¯å¦åŠ è½½ç»“æŸ
      };
    },

    methods: {
      onLoad() {
        // å¼‚æ­¥æ›´æ–°æ•°æ®
        setTimeout(() => {
          for (let i = 0; i < 10; i++) {
            this.list.push(this.list.length + 1);
          }
          // åŠ è½½çŠ¶æ€ç»“æŸ
          this.loading = false;

          // æ•°æ®å…¨éƒ¨åŠ è½½å®Œæˆ
          if (this.list.length >= 40) {
            this.finished = true;
          }
        }, 500);
      }
    }
  };
</script>
```

**`article/index.vue`å¯¼å…¥ã€æ³¨å†Œã€ä½¿ç”¨ç»„ä»¶**

```js
import CommentList from './components/comment-list'
```

```js
components:{
    // å…¶ä»–æ³¨å†Œ...
    CommentList
}
```

```html
<van-divider>æ­£æ–‡ç»“æŸ</van-divider>
<!------------------------------ æ–‡ç« è¯„è®ºåˆ—è¡¨-------------------------------------->
<comment-list/>
<!------------------------------ /æ–‡ç« è¯„è®ºåˆ—è¡¨ ------------------------------------->
```

### [#](https://hw-xiansheng.github.io/toutiao-notes/guide/08-æ–‡ç« è¯„è®º.html#_2-2ã€è·å–æ•°æ®å¹¶å±•ç¤º)2.2ã€è·å–æ•°æ®å¹¶å±•ç¤º

> æç¤ºï¼šæœ‰è¯„è®ºæ•°æ®çš„æ–‡ç«  id ï¼šçŸ­æ–‡ç« ==>1323981393964826624ï¼Œ é•¿æ–‡ç« ==>138671

æ­¥éª¤ï¼š

- å°è£…æ¥å£
- è¯·æ±‚è·å–æ•°æ®
- å¤„ç†æ¨¡æ¿

------

å®ç°ï¼š

1ã€åœ¨ `api/comment.js` ä¸­æ·»åŠ å°è£…è¯·æ±‚æ–¹æ³•

```js
/**
 * è¯„è®ºè¯·æ±‚æ¨¡å—
 */
import request from '@/utils/request'

/**
 * è·å–æ–‡ç« è¯„è®ºåˆ—è¡¨
 */
export const getComments = params => {
  return request({
    method: 'GET',
    url: '/v1_0/comments',
    params
  })
}
```

2ã€è¯·æ±‚è·å–æ•°æ®

- çˆ¶ç»„ä»¶`article/index.vue` ä¼ å…¥æ–‡ç« id

  ```html
  <comment-list :source="article.art_id"/>
  ```

  1

- å­ç»„ä»¶`commnent-list`å®šä¹‰è‡ªå®šä¹‰å±æ€§æ¥æ”¶

  ```js
  props: {
      source: {
        type: [Number, String, Object],
        required: true
      }
   }   
  ```

- å¯¼å…¥è¯·æ±‚æ–¹æ³•

  ```js
  import { getComments } from '@/api/comment'
  ```

- å®šä¹‰ç›¸å…³å˜é‡

  ```js
  data(){
      return{
          //å…¶ä»–å˜é‡..
          offset: null, // è·å–ä¸‹ä¸€é¡µæ•°æ®çš„æ ‡è®°
          limit: 10,
          error: false
      }
  }
  ```

- ä¹¦å†™å¤„ç†äº‹ä»¶å‡½æ•°

  ```js
    methods: {
      async onLoad () {
        try {
          // 1. è¯·æ±‚è·å–æ•°æ®
          const { data } = await getComments({
            type: 'a', //  è¯„è®ºç±»å‹ï¼Œa-å¯¹æ–‡ç« (article)çš„è¯„è®ºï¼Œc-å¯¹è¯„è®º(comment)çš„å›å¤
            source: this.source.toString(), // æºidï¼Œæ–‡ç« idæˆ–è¯„è®ºid,ã€å¯èƒ½æœ‰å¤§æ•°å­—ï¼Œæ‰€ä»¥æ‰§è¡Œä¸€ä¸‹toString æ–¹æ³•ã€‘
            offset: this.offset, // è¯„è®ºæ•°æ®çš„åç§»é‡ï¼Œå€¼ä¸ºè¯„è®ºidï¼Œè¡¨ç¤ºä»æ­¤idçš„æ•°æ®å‘åå–ï¼Œä¸ä¼ è¡¨ç¤ºä»ç¬¬ä¸€é¡µå¼€å§‹è¯»å–æ•°æ®
            limit: this.limit // è·å–çš„è¯„è®ºæ•°æ®ä¸ªæ•°ï¼Œä¸ä¼ è¡¨ç¤ºé‡‡ç”¨åç«¯æœåŠ¡è®¾å®šçš„é»˜è®¤æ¯é¡µæ•°æ®é‡
          })
  
          // 2. å°†æ•°æ®æ·»åŠ åˆ°åˆ—è¡¨ä¸­(ä¸€å®šè¦æ³¨æ„æ˜¯è¿½åŠ æ•°æ®ï¼Œå¦åˆ™åˆ—è¡¨é«˜åº¦ä¸å¢åŠ ï¼Œå½¢æˆæ­»å¾ªç¯)
          const { results } = data.data
          this.list.push(...results)
  
          // 3. å°† loading è®¾ç½®ä¸º false
          this.loading = false
  
          // 4. åˆ¤æ–­æ˜¯å¦è¿˜æœ‰æ•°æ®
          if (results.length) {
            // æœ‰å°±æ›´æ–°è·å–ä¸‹ä¸€é¡µçš„æ•°æ®é¡µç 
            this.offset = data.data.last_id
          } else {
            // æ²¡æœ‰å°±å°† finished è®¾ç½®ç»“æŸ
            this.finished = true
          }
        } catch (err) {
          this.error = true
          this.loading = false
        }
      }
    }
  ```

  

- æ˜¾ç¤ºè¯„è®ºå†…å®¹

  ```html
   <van-cell v-for="(item,index) in list" :key="index" :title="item.content"></van-cell>
  ```

  

### [#](https://hw-xiansheng.github.io/toutiao-notes/guide/08-æ–‡ç« è¯„è®º.html#_2-3ã€å±•ç¤ºæ–‡ç« è¯„è®ºæ€»æ•°é‡)2.3ã€å±•ç¤ºæ–‡ç« è¯„è®ºæ€»æ•°é‡

**å­ç»„ä»¶`comment-list.vue`è§¦å‘è‡ªå®šä¹‰äº‹ä»¶**

- `onLoad`äº‹ä»¶å‡½æ•°é‡Œé¢ è§¦å‘è‡ªå®šä¹‰

  ```js
   // 2. å°†æ•°æ®æ·»åŠ åˆ°åˆ—è¡¨ä¸­
   const { results } = data.data
   this.list.push(...results)
  
  // æŠŠæ–‡ç« è¯„è®ºçš„æ€»æ•°é‡ä¼ é€’åˆ°å¤–éƒ¨
  this.$emit('onload-success', data.data)  // <========== å¢åŠ è¿™ä¸€å¥
  
  // 3. å°† loading è®¾ç½®ä¸º false
  this.loading = false
  ```

- é»˜è®¤æƒ…å†µä¸‹åªæœ‰æ»šåŠ¨åˆ°äº†è¯„è®ºåˆ—è¡¨åŒºåŸŸæ‰ä¼šè§¦å‘`onLoad`äº‹ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å†`created`é‡Œé¢ä¸»åŠ¨è§¦å‘ä¸€æ¬¡ï¼Œä¿è¯ä¸€å¼€å§‹å°±è§¦å‘

  ```js
    created () {
      this.onLoad()
    }
  ```

**çˆ¶ç»„ä»¶`article/index.vue`ä¸­ç›‘å¬è‡ªå®šäº‹ä»¶**

- å®šä¹‰å˜é‡å­˜æ”¾æ€»æ•°é‡

  ```js
  data(){
      //å…¶ä»–å˜é‡...
      totalCommentCount:0  // æ–‡ç« è¯„è®ºæ€»æ•°é‡
  }
  ```

- ç»‘å®šç»™å±•ç¤ºç»„ä»¶çš„å±æ€§

  ```html
  <van-icon
     class="comment-icon"
     name="comment-o"
     :info="totalCommentCount"
   />
  ```

- ç›‘å¬è‡ªå®šä¹‰äº‹ä»¶ï¼Œèµ‹å€¼ç»™å˜é‡

  ```html
   <!-- æ–‡ç« è¯„è®ºåˆ—è¡¨ -->
  <comment-list
       :source="article.art_id"
       @onload-success="totalCommentCount = $event.total_count"
  />
  <!-- /æ–‡ç« è¯„è®ºåˆ—è¡¨ -->
  ```

### [#](https://hw-xiansheng.github.io/toutiao-notes/guide/08-æ–‡ç« è¯„è®º.html#_2-4ã€æ–‡ç« è¯„è®ºé¡¹)2.4ã€æ–‡ç« è¯„è®ºé¡¹

**åˆ›å»º `article/components/comment-item.vue`**

```html
<template>
  <van-cell class="comment-item">
    <van-image
      slot="icon"
      class="avatar"
      round
      fit="cover"
      src="https://img.yzcdn.cn/vant/cat.jpeg"
    />
    <div slot="title" class="title-wrap">
      <div class="user-name">ç”¨æˆ·åç§°</div>
      <van-button
        class="like-btn"
        icon="good-job-o"
      >èµ</van-button>
    </div>

    <div slot="label">
      <p class="comment-content">è¿™æ˜¯è¯„è®ºå†…å®¹</p>
      <div class="bottom-info">
        <span class="comment-pubdate">4å¤©å‰</span>
        <van-button
          class="reply-btn"
          round
        >å›å¤ 0</van-button>
      </div>
    </div>
  </van-cell>
</template>

<script>
export default {
  name: 'CommentItem',
  props: {
    //æ¯è¡Œçš„è¯„è®ºä¿¡æ¯  
    comment: {
      type: Object,
      required: true
    }
  },
  methods: {}
}
</script>

<style scoped lang="less">
.comment-item {
  .avatar {
    width: 72px;
    height: 72px;
    margin-right: 25px;
  }
  .title-wrap {
    display: flex;
    justify-content: space-between;
    align-items: center;
    .user-name {
      color: #406599;
      font-size: 26px;
    }
  }
  .comment-content {
    font-size: 32px;
    color: #222222;
    word-break: break-all;
    text-align: justify;
  }
  .comment-pubdate {
    font-size: 19px;
    color: #222;
    margin-right: 25px;
  }
  .bottom-info {
    display: flex;
    align-items: center;
  }
  .reply-btn {
    width: 135px;
    height: 48px;
    line-height: 48px;
    font-size: 21px;
    color: #222;
  }
  .like-btn {
    height: 30px;
    padding: 0;
    border: none;
    font-size: 19px;
    line-height: 30px;
    margin-right: 7px;
    .van-icon {
      font-size: 30px;
    }   
  }
  .liked{
   	  background-color:orange;   
   }
}
</style>
```

**åœ¨`comment-list.vue`ä¸­å¯¼å…¥ã€æ³¨å†Œã€ä½¿ç”¨**

```js
import CommentItem from './comment-item'
```

```js
 components: {
    CommentItem  // æ³¨å†Œç»„ä»¶
 }
```

```html
<!--åˆ é™¤ van-cell ç»„ä»¶-->
<!--<van-cell v-for="(item,index) in list" :key="index" :title="item.content"></van-cell>-->

<!--ä½¿ç”¨ comment-itemç»„ä»¶-->
<comment-item
  v-for="(item, index) in list"
  :key="index"
  :comment="item"/>
```

**æ¸²æŸ“å±•ç¤ºæ•°æ®ä¿¡æ¯**

```html
<template>
  <van-cell class="comment-item">
    <van-image
      slot="icon"
      class="avatar"
      round
      fit="cover"
      :src="comment.aut_photo"
    />
    <div slot="title" class="title-wrap">
      <div class="user-name">{{ comment.aut_name }}</div>
      <van-button
        class="like-btn"
        icon="good-job-o"
      >{{ comment.like_count || 'èµ' }}</van-button>
    </div>

    <div slot="label">
      <p class="comment-content">{{ comment.content }}</p>
      <div class="bottom-info">
        <span class="comment-pubdate">{{ comment.pubdate | relativeTime }}</span>
        <van-button
          class="reply-btn"
          round
        >å›å¤ {{ comment.reply_count }}</van-button>
      </div>
    </div>
  </van-cell>
</template>
```



### [#](https://hw-xiansheng.github.io/toutiao-notes/guide/08-æ–‡ç« è¯„è®º.html#_2-5ã€è¯„è®ºç‚¹èµ)2.5ã€è¯„è®ºç‚¹èµ

1ã€åœ¨ `api/comment.js` ä¸­æ·»åŠ å°è£…ä¸¤ä¸ªæ•°æ®æ¥å£

```js
/**
 * å¯¹è¯„è®ºæˆ–è¯„è®ºå›å¤ç‚¹èµ
 */
export function addCommentLike(commentId) {
  return request({
    method: "POST",
    url: "/v1_0/comment/likings",
    data: {
      target: commentId
    }
  });
}

/**
 * å–æ¶ˆå¯¹è¯„è®ºæˆ–è¯„è®ºå›å¤ç‚¹èµ
 */
export function deleteCommentLike(commentId) {
  return request({
    method: "DELETE",
    url: `/v1_0/comment/likings/${commentId}`
  });
}
```



2ã€ç„¶åç»™è¯„è®ºé¡¹ä¸­çš„ `like` å›¾æ ‡æ³¨å†Œç‚¹å‡»äº‹ä»¶

```js
data(){
    return{
        commentLoading:true  // æ˜¯å¦ç‚¹èµä¸­
    }
}
```



```html
<van-button
   class="like-btn"
   :class="{ liked:comment.is_liking  }"    
   :icon="comment.is_liking ? 'good-job' : 'good-job-o'"  
   :loading="commentLoading"                                                            
    @click="onCommentLike"         
>{{ comment.like_count || 'èµ' }}</van-button>
```

3ã€åœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­

```js
import {
   // å…¶ä»–å¯¼å…¥...
    addCommentLike,deleteCommentLik  
} from '@/api/comment'
```

```js
// ç‚¹èµæˆ–å–æ¶ˆç‚¹èµäº‹ä»¶
async onCommentLike () {
  // loading å¼€å¯  
  this.commentLoading = true
  try{
       // å¦‚æœå·²ç»èµäº†åˆ™å–æ¶ˆç‚¹èµ
      if (this.comment.is_liking) {
        await deleteCommentLike(this.comment.com_id)
        this.comment.like_count--  
      } else {
        // å¦‚æœæ²¡æœ‰èµï¼Œåˆ™ç‚¹èµ
        await addCommentLike(this.comment.com_id)
        this.comment.like_count++
      }
      // æ›´æ–°è§†å›¾çŠ¶æ€
      this.comment.is_liking = !this.comment.is_liking
      this.$toast('æ“ä½œæˆåŠŸ')
  }catch(e){
      this.$toast('æ“ä½œå¤±è´¥ï¼Œè¯·é‡è¯•')
  }
  // loading å…³é—­
  this.commentLoading = false  
}
```



## [#](https://hw-xiansheng.github.io/toutiao-notes/guide/08-æ–‡ç« è¯„è®º.html#_3ã€å‘å¸ƒæ–‡ç« è¯„è®º)3ã€å‘å¸ƒæ–‡ç« è¯„è®º

### [#](https://hw-xiansheng.github.io/toutiao-notes/guide/08-æ–‡ç« è¯„è®º.html#_3-1ã€å‡†å¤‡å¼¹å‡ºå±‚)3.1ã€å‡†å¤‡å¼¹å‡ºå±‚

åœ¨`article/index.vue`ä¸­å‡†å¤‡å¼¹å‡ºå±‚ï¼Œä½¿ç”¨å¼¹å‡ºå±‚ç»„ä»¶[Popup(opens new window)](https://vant-contrib.gitee.io/vant/#/zh-CN/popup)

- å®šä¹‰æ§åˆ¶å˜é‡

```js
data(){
    return{
        //å…¶ä»–å˜é‡...
        isPostShow:false // å‘å¸ƒè¯„è®ºå¼¹å±‚æ§åˆ¶
    }
}
```



- ä½¿ç”¨å¼¹å±‚ç»„ä»¶

```html
<!--/åº•éƒ¨åŒºåŸŸ-->

<!--------------------------------  å‘å¸ƒè¯„è®º -------------------------------------->
<van-popup v-model="isPostShow" position="bottom">
	æµ‹è¯•å†…å®¹
</van-popup>
<!-------------------------------- /å‘å¸ƒè¯„è®º -------------------------------------->
```

- ç»‘å®šäº‹ä»¶æ‰“å¼€å¼¹å±‚

```html
<van-button
    class="comment-btn"
    type="default"
    round
    size="small"
    @click="isPostShow=true"   
    >å†™è¯„è®º</van-button>
```

> æç¤ºï¼šä¸è®¾ç½®é«˜åº¦çš„æ—¶å€™ï¼Œå†…å®¹ä¼šè‡ªåŠ¨æ’‘å¼€å¼¹å±‚é«˜åº¦

### [#](https://hw-xiansheng.github.io/toutiao-notes/guide/08-æ–‡ç« è¯„è®º.html#_3-2ã€å°è£…ç»„ä»¶)3.2ã€å°è£…ç»„ä»¶

- åˆ›å»º`views/article/components/comment-post.vue` ç»„ä»¶

```html
<template>
  <div class="comment-post">
    <van-field
      class="post-field"
      v-model="message"
      rows="2"
      autosize
      type="textarea"
      maxlength="50"
      placeholder="è¯·è¾“å…¥ç•™è¨€"
      show-word-limit
    />
    <van-button
      class="post-btn"
    >å‘å¸ƒ</van-button>
  </div>
</template>

<script>
export default {
  name: 'CommentPost',
  data () {
    return {
      message: ''
    }
  },
  computed: {},
  watch: {},
  created () {},
  mounted () {},
  methods: {}
}
</script>

<style scoped lang="less">
.comment-post {
  display: flex;
  align-items: center;
  padding: 32px 0 32px 32px;
  .post-field {
    background-color: #f5f7f9;
  }
  .post-btn {
    width: 150px;
    border: none;
    padding: 0;
    color: #6ba3d8;
    &::before {
      display: none;
    }
  }
}
</style>
```



- åœ¨`article/index.vue` ä¸­å¯¼å…¥ã€æ³¨å†Œã€ä½¿ç”¨

```js
import CommentPost from './components/comment-post'
```

1

```js
  components: {
    // å…¶ä»–æ³¨å†Œ...
    CommentPost
  },
```

1
2
3
4

```html
<!--------------------------------  å‘å¸ƒè¯„è®º -------------------------------------->
<van-popup v-model="isPostShow"  position="bottom">
    <comment-post />
</van-popup>
<!---------------------------------- /å‘å¸ƒè¯„è®º ------------------------------------>
```

1
2
3
4
5

### [#](https://hw-xiansheng.github.io/toutiao-notes/guide/08-æ–‡ç« è¯„è®º.html#_3-3ã€è¯·æ±‚å‘å¸ƒ)3.3ã€è¯·æ±‚å‘å¸ƒ

åŸºæœ¬æ€è·¯ï¼š

- æ‰¾åˆ°æ•°æ®æ¥å£
- å°è£…è¯·æ±‚æ–¹æ³•
- æ³¨å†Œå‘å¸ƒç‚¹å‡»äº‹ä»¶
  - è¯·æ±‚å‘å¸ƒ
  - æˆåŠŸï¼šå°†å‘å¸ƒçš„å†…å®¹å±•ç¤ºåˆ°åˆ—è¡¨ä¸­
  - å¤±è´¥ï¼šæç¤ºå¤±è´¥

------

**å°è£…apiè¯·æ±‚æ–¹æ³•**

åœ¨ `api/comment.js` ä¸­æ·»åŠ å°è£…æ•°æ®æ¥å£

```js
/**
 * å‘å¸ƒæ–‡ç« è¯„è®ºæˆ–è¯„è®ºå›å¤
 */
export const addComment = data=>{
  return request({
    method: "POST",
    url: "/v1_0/comments",
    data
  });
}
```

**çˆ¶å­é€šä¿¡ï¼Œä¼ é€’æ–‡ç« id**

`article/index.vue` ä¼ é€’æ–‡ç« id

```html
<!-- å‘å¸ƒè¯„è®º -->
<van-popup v-model="isPostShow" position="bottom">
    <comment-post :target="article.art_id" />
</van-popup>
<!-- å‘å¸ƒè¯„è®º -->
```

`comment-post.vue` å®šä¹‰æ¥æ”¶

```js
  props: {
    // ç›®æ ‡idï¼Œæ¥æ”¶æ–‡ç« idæˆ–è€…è¯„è®ºid   
    target: {
      type: [Number, String, Object],
      required: true
    }
  }
```

**`comment-post.vue`å¯¼å…¥è¯·æ±‚æ–¹æ³•ã€ç»‘å®šäº‹ä»¶ã€ä¹¦å†™äº‹ä»¶å‡½æ•°ã€å‘é€è¯·æ±‚**

```js
import { addComment } from '@/api/comment'
```

```html
<van-button
      class="post-btn"
      @click="onPost"
    >å‘å¸ƒ</van-button>
```

```js
    async onPost () {
      this.$toast.loading({
        message: 'å‘å¸ƒä¸­...',
        forbidClick: true, // ç¦ç”¨èƒŒæ™¯ç‚¹å‡»
        duration: 0 // æŒç»­æ—¶é—´ï¼Œé»˜è®¤ 2000ï¼Œ0 è¡¨ç¤ºæŒç»­å±•ç¤ºä¸å…³é—­
      })

      try {
        const { data } = await addComment({
          target: this.target.toString(), // è¯„è®ºç›®æ ‡idï¼ˆè¯„è®ºæ–‡ç« å³æ–‡ç« idï¼Œå¯¹è¯„è®ºè¿›è¡Œå›å¤åˆ™ä¸ºè¯„è®ºidï¼‰ é˜²æ­¢æœ‰å¤§æ•°å­—æœ€å¥½ä¹Ÿæ‰§è¡Œä¸€ä¸‹toStringæ–¹æ³•ï¼
          content: this.message, // è¯„è®ºå†…å®¹
          art_id: null // æ–‡ç« idï¼Œå¯¹è¯„è®ºå†…å®¹å‘è¡¨å›å¤æ—¶ï¼Œéœ€è¦ä¼ é€’æ­¤å‚æ•°ï¼Œè¡¨æ˜æ‰€å±æ–‡ç« idã€‚å¯¹æ–‡ç« è¿›è¡Œè¯„è®ºï¼Œä¸è¦ä¼ æ­¤å‚æ•°ã€‚
        })
        
        this.$toast.success('å‘å¸ƒæˆåŠŸ')
		
         // TODO==>
            // å…³é—­å¼¹å‡ºå±‚
            // å°†å‘å¸ƒå†…å®¹æ˜¾ç¤ºåˆ°åˆ—è¡¨é¡¶éƒ¨
            // æ¸…ç©ºæ–‡æœ¬æ¡†
      } catch (err) {
        this.$toast.fail('å‘å¸ƒå¤±è´¥')
      }
    }
```

### [#](https://hw-xiansheng.github.io/toutiao-notes/guide/08-æ–‡ç« è¯„è®º.html#_3-4ã€æˆåŠŸå¤„ç†â˜†â˜†)3.4ã€æˆåŠŸå¤„ç†â˜†â˜†

- æ ¸å¿ƒè¦ç‚¹
  - æ¸…ç©ºæ–‡æœ¬æ¡†
  - å…³é—­å¼¹å‡ºå±‚
  - å°†å‘å¸ƒå†…å®¹æ˜¾ç¤ºåˆ°åˆ—è¡¨é¡¶éƒ¨

------

å­ç»„ä»¶`comment-post.vue`ä¸­æ¸…é™¤`message`å†…å®¹ï¼Œé€šè¿‡è‡ªå®šä¹‰äº‹ä»¶å‘å¤–æŠ›å‡º æ·»åŠ æˆåŠŸçš„æ•°æ®

```js
    async onPost () {
        // å…¶ä»–ä»£ç ...
        
        // å…³é—­å¼¹å‡ºå±‚
        // å°†å‘å¸ƒå†…å®¹æ˜¾ç¤ºåˆ°åˆ—è¡¨é¡¶éƒ¨
        // æ¸…ç©ºæ–‡æœ¬æ¡†
        this.message = ''
        this.$emit('post-success',data.data)
      
        
        // å…¶ä»–ä»£ç ...
    }
```

çˆ¶ç»„ä»¶`article/index.vue` ä¸­ç›‘å¬`post-success`è‡ªå®šä¹‰äº‹ä»¶ï¼Œæ‰§è¡Œå…³é—­å¼¹å±‚å’Œå°†æ•°æ®æ”¾å…¥é¡¶éƒ¨çš„æ“ä½œ

```html
<!-- å‘å¸ƒè¯„è®º -->
<van-popup v-model="isPostShow" position="bottom" >
    <comment-post
       :target="article.art_id"
       @post-success="onPostSuccess"
    />
</van-popup>
<!-- å‘å¸ƒè¯„è®º -->
```



```js
 onPostSuccess (data) {
     // å…³é—­å¼¹å‡ºå±‚
     this.isPostShow = false
     // å°†å‘å¸ƒå†…å®¹æ˜¾ç¤ºåˆ°åˆ—è¡¨é¡¶éƒ¨
     // todo...
     console.log(data) // comment-post.vue ä¼ é€’å‡ºæ¥çš„æ•°æ®
 }
```

è‡³æ­¤ï¼Œå·²ç»å®Œæˆäº†ï¼Œå…³é—­å¼¹å±‚ï¼Œå’Œæ¸…ç©ºè¾“å…¥æ¡†æ“ä½œï¼Œä½†æ˜¯å°†æ•°æ®æ”¾å…¥åˆ°åˆ—è¡¨é¡¶éƒ¨è¿˜æ²¡æœ‰å®ç°ï¼Œè¿™æ˜¯ä¸€ä¸ªéš¾ç‚¹ï¼Œæˆ‘ä»¬å°†å¼€å§‹æ“ä½œ

**æ€è·¯åˆ†æï¼š**

- æˆ‘ä»¬å·²ç»å®ç°äº†å°†`comment-post.vue` é‡Œé¢çš„å‘å¸ƒæˆåŠŸæ•°æ®ä¼ é€’ç»™äº†çˆ¶ç»„ä»¶`article/index.vue`

  

æˆ‘ä»¬å·²ç»æŠŠæ•°æ®ä¼ é€’ç»™çˆ¶ç»„ä»¶äº†ï¼Œç°åœ¨æœ€é‡è¦çš„å°±æ˜¯å¦‚ä½•æ”¾åˆ°åˆ—è¡¨ç»„ä»¶`comment-list`ä¸­å»

**æ€è€ƒï¼š** çˆ¶ç»„ä»¶å¦‚ä½•å°†æ•°æ®ä¼ é€’ç»™å­ç»„ä»¶`comment-list` å‘¢ï¼Ÿ

**å›é¡¾ï¼š** æˆ‘ä»¬ä¹‹å‰åœ¨ é¦–é¡µé¢‘é“åŠŸèƒ½é‡Œé¢`Tab`çš„æ•°æ®ï¼Œå’Œå¼¹å‡ºå±‚é‡Œé¢`æˆ‘çš„é¢‘é“`æ•°æ®æ˜¯ä¸€ä¸ªå†…å®¹ï¼Œæ˜¯é€šè¿‡`props`å°†è¿™ä¸ªæ•°ç»„ä¼ é€’è¿›å…¥ï¼Œç„¶ååœ¨å¼¹å‡ºå±‚é‡Œé¢ç‚¹å‡»æˆ‘çš„é¢‘é“åˆ é™¤çš„æ—¶å€™ç›´æ¥åˆ é™¤è¿™ä¸ª æ•°ç»„é‡Œé¢çš„å¯¹åº”å…ƒç´ ï¼Œå¯ä»¥å®ç°åŒæ­¥æ›´æ–°ã€‚

![image-20210713212348610](data:image/png;base64,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)

![image-20210713212431553](https://hw-xiansheng.github.io/toutiao-notes/assets/img/image-20210713212431553.3cf619ea.png)

**ç»“è®ºï¼š** çˆ¶å­é€šä¿¡çš„`props` å¦‚æœæ˜¯ä¸€ä¸ª æ•°ç»„ï¼Œæˆ‘ä»¬åªè¦ä¸é‡æ–°èµ‹å€¼è¿™ä¸ª`props`é‡Œé¢çš„æ•°ç»„ï¼Œå°±éƒ½ä¸ç®—ä¿®æ”¹`props`ï¼Œè€Œå¯ä»¥å®ç°çˆ¶å­ä¹‹é—´å…±äº«æ•°æ®ï¼Œå®æ—¶å˜åŒ–ã€‚ï¼ˆ**å…¶æœ¬è´¨æ˜¯çˆ¶å­ç”¨äº†ä¸€ä¸ªå¼•ç”¨æ•°æ®ç±»å‹çš„æ•°æ®**ï¼‰

**å®ç°ï¼š** æ—¢ç„¶å¦‚æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä¾ç„¶å¯ä»¥å®ç°`article/index.vue` å’Œ `comment-list.vue` å»å…±äº« è¯„è®ºåˆ—è¡¨æ•°æ®

- å­ç»„ä»¶`comment-list`å°† `data`é‡Œé¢çš„å˜é‡`list`ä¿®æ”¹æˆ `props`é‡Œé¢çš„å±æ€§`list` ç”¨äºå»æ¥æ”¶å¤–é¢çš„ç©ºæ•°ç»„`commentList`

  ```js
  data () {
      return {
        // å…¶ä»–å˜é‡...  
        // list: [],   // <===æ³¨é‡Šæ‰
      }
  }    
  ```

  ```js
  props: {
    // å…¶ä»–å±æ€§...
    // å®šä¹‰è‡ªå®šä¹‰å±æ€§listï¼Œå»æ¥æ”¶å¤–é¢çš„commentList å˜é‡    
    list: {
        type: Array,
        default: () => []
    }
  }
  ```

- çˆ¶ç»„ä»¶`article/index.vue` åœ¨ `data` ä¸­å®šä¹‰æ•°ç»„å˜é‡ï¼Œå»å…±äº«å„¿å­çš„æ•°æ®

  ```js
  data(){
  	return{
  		// å…¶ä»–å˜é‡...
  		 commentList: [] // è¯„è®ºåˆ—è¡¨
  	}
  }
  ```

- ç»‘å®šç»™å­ç»„ä»¶

  ```html
  <!-- æ–‡ç« è¯„è®ºåˆ—è¡¨ -->
  <comment-list
      :source="article.art_id"
      :list="commentList" 
      @onload-success="totalCommentCount = $event.total_count"
  />
  ```

  

**ç–‘é—®ï¼Ÿï¼Ÿï¼Ÿ** å¯èƒ½æœ‰åŒå­¦ä¼šé—®ï¼Œä¸ºä»€ä¹ˆæ¥æ”¶ç©ºæ•°ç»„å‘¢ï¼Œå…¶å®çˆ¶ç»„ä»¶çš„ç©ºæ•°ç»„ä¸æ˜¯ä¸ºäº†ä¼ é€’ç»™å­ç»„ä»¶ï¼Œåè€Œæ˜¯è®©å­ç»„ä»¶æŠŠæ•°æ®åˆ—è¡¨å…±äº«ç»™çˆ¶ç»„ä»¶ï¼Œå› ä¸ºçˆ¶å­é€šä¿¡å…³è”çš„æ˜¯å¼•ç”¨æ•°æ®ç±»å‹ï¼Œä»»ä½•äººä¸€æ–¹æ”¹å˜äº†ï¼Œå¦å¤–ä¸€æ–¹éƒ½ä¼šå˜åŒ–ã€‚

![image-20210713213529540](https://hw-xiansheng.github.io/toutiao-notes/assets/img/image-20210713213529540.b7b9b15e.png)

**æµ‹è¯•ï¼š** é€šè¿‡vueè°ƒè¯•å™¨ï¼Œå»è§‚å¯Ÿå‘ç°çˆ¶ç»„ä»¶`article/index.vue`é‡Œé¢çš„å˜é‡`commentList` ä¹Ÿæœ‰æ•°æ®äº†

![image-20210713213732033](https://hw-xiansheng.github.io/toutiao-notes/assets/img/image-20210713213732033.f67e8569.png)

------

å·²ç»å®ç°äº†ï¼Œçˆ¶ç»„ä»¶å’Œè¯„è®ºåˆ—è¡¨ç»„ä»¶å…±äº«åˆ—è¡¨æ•°æ®ï¼Œæˆ‘ä»¬åªéœ€è¦å°†è¯„è®ºç»„ä»¶ä¼ é€’çš„æ•°æ®æ’å…¥åˆ°çˆ¶ç»„ä»¶çš„è¿™ä¸ªcommentListä¸­å³å¯ï¼

```js
onPostSuccess (data) {
    // å…³é—­å¼¹å‡ºå±‚
    this.isPostShow = false
    // å°†å‘å¸ƒå†…å®¹æ˜¾ç¤ºåˆ°åˆ—è¡¨é¡¶éƒ¨
    this.commentList.unshift(data.new_obj)  // <=== ç²¾åä¹‹å¥ï¼ï¼ï¼
    // è¯„è®ºæ•°é‡+1
    this.totalCommentCount++
    
}
```

**æ€»ç»“ï¼šæ•°æ®æ€è·¯å›¾å¦‚ä¸‹**

![image-20210713225611052](https://hw-xiansheng.github.io/toutiao-notes/assets/img/image-20210713225611052.d985428c.png)

### [#](https://hw-xiansheng.github.io/toutiao-notes/guide/08-æ–‡ç« è¯„è®º.html#_3-5ã€ç©ºå†…å®¹å¤„ç†)3.5ã€ç©ºå†…å®¹å¤„ç†

- å¯¹è¾“å…¥çš„å†…å®¹è¿›è¡Œå»é™¤ç©ºæ ¼å¤„ç†ï¼Œå¢åŠ `trim` ä¿®é¥°ç¬¦

  ```html
  <van-field
        class="post-field"
        v-model.trim="message"
        rows="2"
        autosize
        type="textarea"
        maxlength="50"
        placeholder="è¯·è¾“å…¥ç•™è¨€"
        show-word-limit
      />
  ```

- å†…å®¹æ²¡æœ‰è¾“å…¥çš„æ—¶å€™æˆ‘ä»¬ç¦ç”¨ æŒ‰é’®

  ```html
      <van-button
        class="post-btn"
        @click="onPost"
        :disabled="!message.length"
      >å‘å¸ƒ</van-button>
  ```

  

## [#](https://hw-xiansheng.github.io/toutiao-notes/guide/08-æ–‡ç« è¯„è®º.html#_4ã€è¯„è®ºå›å¤)4ã€è¯„è®ºå›å¤

### [#](https://hw-xiansheng.github.io/toutiao-notes/guide/08-æ–‡ç« è¯„è®º.html#_4-1ã€å‡†å¤‡å›å¤å¼¹å±‚)4.1ã€å‡†å¤‡å›å¤å¼¹å±‚

ä¸€ã€åœ¨è¯¦æƒ…é¡µä¸­ä½¿ç”¨å¼¹å±‚ç”¨æ¥å±•ç¤ºæ–‡ç« çš„å›å¤

1ã€åœ¨`article/index.vue` ä¸­`data`æ·»åŠ æ•°æ®ç”¨æ¥æ§åˆ¶å±•ç¤ºå›å¤å¼¹å±‚çš„æ˜¾ç¤ºçŠ¶æ€

```js
data () {
  return {
    // å…¶ä»–å˜é‡...
    isReplyShow: false
  }
}
```

1
2
3
4
5
6

2ã€åœ¨è¯¦æƒ…é¡µ`article/index.vue`ä¸­æ·»åŠ ä½¿ç”¨å¼¹å±‚ç»„ä»¶

```html
<!------------------------ è¯„è®ºå›å¤ ------------------------------>
<van-popup
  v-model="isReplyShow"
  position="bottom"
  style="height: 100%"
>
  è¯„è®ºå›å¤
</van-popup>
<!------------------------ /è¯„è®ºå›å¤ ------------------------------>
```

### [#](https://hw-xiansheng.github.io/toutiao-notes/guide/08-æ–‡ç« è¯„è®º.html#_4-2ã€ç‚¹å‡»å›å¤æ˜¾ç¤ºå¼¹å‡ºå±‚)4.2ã€ç‚¹å‡»å›å¤æ˜¾ç¤ºå¼¹å‡ºå±‚

- `comment-item.vue`ç»„ä»¶é‡Œé¢ç»™å›å¤æŒ‰é’®ç»‘å®šäº‹ä»¶ï¼Œè§¦å‘å‘å¤–ä¼ é€’ç‚¹å‡»è¡Œæ•°æ®ï¼ˆè‡ªå®šä¹‰äº‹ä»¶ï¼‰

  ```html
  <van-button
            class="reply-btn"
            round
            @click="$emit('reply-click', comment)" 
   >å›å¤ {{ comment.reply_count }}</van-button>
  ```

- çˆ¶ç»„ä»¶`comment-list.vue`ç›‘å¬è‡ªå®šä¹‰äº‹ä»¶ï¼Œç»§ç»­å‘å¤–ä¼ é€’æ”¶åˆ°çš„æ•°æ®ï¼ˆè‡ªå®šä¹‰äº‹ä»¶ï¼‰

  ```html
  <comment-item
        v-for="(item, index) in list"
        :key="index"
        :comment="item"
        @reply-click="$emit('reply-click', $event)" 
      />
  ```

- çˆ·çˆ·ç»„ä»¶`article/index.vue` ç›‘å¬è‡ªå®šäº‹ä»¶ï¼Œæ‰“å¼€å¼¹æ¡†ï¼Œè¾“å‡ºæ”¶åˆ°çš„æ•°æ®

  ```html
  <!-- æ–‡ç« è¯„è®ºåˆ—è¡¨ -->
  <comment-list
     :source="article.art_id"
     :list="commentList"
     @onload-success="totalCommentCount = $event.total_count"
     @reply-click="onReplyClick" 
  />             
  <!-- /æ–‡ç« è¯„è®ºåˆ—è¡¨ -->
  ```

  ```js
  onReplyClick (comment) {
     console.log(comment) // comment-itemç»„ä»¶ä¼ é€’å‡ºæ¥çš„æ•°æ®
     // æ˜¾ç¤ºè¯„è®ºå›å¤å¼¹å‡ºå±‚
     this.isReplyShow = true
  }
  ```

- **æ€è·¯å›¾**

- ![image-20210714213711299](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20210714213711299.932b6060.png)

  

### [#](https://hw-xiansheng.github.io/toutiao-notes/guide/08-æ–‡ç« è¯„è®º.html#_4-3ã€å°è£…å†…å®¹ç»„ä»¶)4.3ã€å°è£…å†…å®¹ç»„ä»¶

- åˆ›å»º`views/article/components/comment-reply.vue`ç»„ä»¶

```html
<template>
  <div class="comment-reply">
     è¯„è®ºå›å¤å†…å®¹
  </div>
</template>

<script>
export default {
  name: 'CommentReply',
  components: {},
  props: {},
  data () {
    return {}
  },
  computed: {},
  watch: {},
  created () {},
  mounted () {},
  methods: {}
}
</script>
<style scoped lang="less"></style>
```

- åœ¨`article/index.vue`ä¸­å¯¼å…¥ï¼Œæ³¨å†Œï¼Œä½¿ç”¨ç»„ä»¶

```js
import CommentReply from './components/comment-reply'
```

```js
components: {
  // å…¶ä»–æ³¨å†Œ...
  CommentReply
}
```

```html
<!-- è¯„è®ºå›å¤ -->
<van-popup v-model="isReplyShow"  position="bottom" style="height: 100%;">
   <comment-reply/>
</van-popup>
<!-- /è¯„è®ºå›å¤ -->
```

### [#](https://hw-xiansheng.github.io/toutiao-notes/guide/08-æ–‡ç« è¯„è®º.html#_4-4ã€ä¼ é€’å½“å‰ç‚¹å‡»å›å¤çš„è¯„è®ºé¡¹)4.4ã€ä¼ é€’å½“å‰ç‚¹å‡»å›å¤çš„è¯„è®ºé¡¹

**æ€è·¯ï¼š** å›é¡¾4.2èŠ‚ï¼Œæˆ‘ä»¬å·²ç»åœ¨`article/index.vue`ä¸­å¾—åˆ°äº†`comment-item.vue`é‡Œé¢å›å¤æŒ‰é’®ä¼ é€’å‡ºæ¥çš„æ•°æ®ï¼Œæˆ‘ä»¬å®šä¹‰å˜é‡æ¥æ”¶ï¼Œç„¶åé€šè¿‡çˆ¶å­é€šä¿¡ä¼ é€’ç»™`comment-reply.vue`ç»„ä»¶

**å®ç°ï¼š**

- `article/index.vue` å®šä¹‰å˜é‡å­˜å‚¨ ä¼ é€’å‡ºæ¥çš„æ•°æ®

  ```js
  data(){
  	return{
           // å…¶ä»–å˜é‡...
  		 currentComment: {} // å½“å‰ç‚¹å‡»å›å¤çš„è¯„è®ºé¡¹
  	}
  }
  ```

- å­˜å‚¨æ•°æ®

  ```js
  onReplyClick (comment) {
      // å­˜å‚¨èµ·æ¥  
      this.currentComment = comment
  
      // æ˜¾ç¤ºè¯„è®ºå›å¤å¼¹å‡ºå±‚
      this.isReplyShow = true
  }
  ```

- å°†æ•°æ®ä¼ é€’ç»™`comment-reply.vue` ç»„ä»¶

  ```html
  <comment-reply :comment="currentComment"/>
  ```

  

- å­ç»„ä»¶`comment-reply.vue` ä¸­å®šä¹‰`props`æ¥æ”¶æ•°æ®

  ```js
  props: {
      // ç‚¹å‡»çš„é‚£è¡Œçš„è¯„è®ºä¿¡æ¯
      comment: {
        type: Object,
        required: true
      }
  }
  ```


> é€šè¿‡`vue-devtools`æ¥è°ƒè¯•æ•°æ®ï¼Œåˆ¤æ–­æ˜¯å¦ä¼ é€’æˆåŠŸ

![image-20210714220605603](https://hw-xiansheng.github.io/toutiao-notes/assets/img/image-20210714220605603.fa5677d3.png)

### [#](https://hw-xiansheng.github.io/toutiao-notes/guide/08-æ–‡ç« è¯„è®º.html#_4-5ã€å¤„ç†å¤´éƒ¨åŠå½“å‰è¯„è®ºé¡¹)4.5ã€å¤„ç†å¤´éƒ¨åŠå½“å‰è¯„è®ºé¡¹

**`comment-reply.vue` å¸ƒå±€å†…å®¹ï¼Œç»‘å®šæ•°æ®**

```vue
<template>
  <div class="comment-reply">
    <van-nav-bar
      :title="comment.reply_count > 0 ? `${comment.reply_count}æ¡å›å¤` : 'æš‚æ— å›å¤'"
    >
      <van-icon
        slot="left"
        name="cross"
        @click="$emit('close')"
      />
    </van-nav-bar>

    <div class="scroll-wrap">
      <!-- å½“å‰è¯„è®ºé¡¹ -->
      <comment-item :comment="comment" />
      <!-- /å½“å‰è¯„è®ºé¡¹ -->

      <!-- è¯„è®ºçš„å›å¤åˆ—è¡¨ -->
      <!-- /è¯„è®ºçš„å›å¤åˆ—è¡¨ -->
    </div>

    <!-- åº•éƒ¨åŒºåŸŸ -->
    <div class="reply-bottom">
      <van-button
        class="write-btn"
        size="small"
        round
      >å†™è¯„è®º</van-button>
    </div>
    <!-- /åº•éƒ¨åŒºåŸŸ -->

    <!-- å‘å¸ƒè¯„è®º -->
    <!-- /å‘å¸ƒè¯„è®º -->
  </div>
</template>

<script>
import CommentItem from './comment-item'

export default {
  name: 'CommentReply',
  components: {
    CommentItem,
  },
  props: {
    // ç‚¹å‡»å›å¤çš„é‚£è¡Œè¯„è®ºä¿¡æ¯  
    comment: {
      type: Object,
      required: true
    }
  },
  data () {
    return {
    }
  }
}
</script>

<style scoped lang="less">
.scroll-wrap {
  position: fixed;
  top: 92px;
  left: 0;
  right: 0;
  bottom: 88px;
  overflow-y: auto;
}

.reply-bottom {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  height: 88px;
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: #fff;
  border-top: 1px solid #d8d8d8;
  .write-btn {
    width: 60%;
  }
}
</style>
```



**çˆ¶ç»„ä»¶`article/index.vue`ä¸­ç›‘å¬å…³é—­äº‹ä»¶**





 





```html
<comment-reply
   :comment="currentComment"
   @close="isReplyShow = false"  
/>
```

1
2
3
4

![image-20210714223218110](https://hw-xiansheng.github.io/toutiao-notes/assets/img/image-20210714223218110.2989cd76.png)

### [#](https://hw-xiansheng.github.io/toutiao-notes/guide/08-æ–‡ç« è¯„è®º.html#_4-6ã€å±•ç¤ºè¯„è®ºå›å¤åˆ—è¡¨)4.6ã€å±•ç¤ºè¯„è®ºå›å¤åˆ—è¡¨

åŸºæœ¬æ€è·¯ï¼š

- å›å¤åˆ—è¡¨å’Œæ–‡ç« çš„è¯„è®ºåˆ—è¡¨å‡ ä¹æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¤ç”¨`comment-list.vue`ç»„ä»¶
- ä¿®æ”¹ `comment-list.vue` ç»„ä»¶ï¼Œå› ä¸ºæ—¢è¦è®©ä»–æ»¡è¶³æ–‡ç« åˆ—è¡¨è¦æ±‚åˆè¦æ»¡è¶³è¯„è®ºåˆ—è¡¨è¦æ±‚

------

ä»£ç å®ç°ï¼š

**1ã€ä¿®æ”¹`comment-list.vue`ç»„ä»¶**

å®šä¹‰è‡ªå®šä¹‰å±æ€§`type`æ¥æ”¶ä¸åŒç±»å‹ï¼Œåˆ¤æ–­æ˜¯æ–‡ç« åˆ—è¡¨ï¼Œè¿˜æ˜¯è¯„è®ºåˆ—è¡¨ï¼Œç”¨äºæä¾›ç»™æ¥å£



```js
props: {
    // æ–‡ç« idæˆ–è€…è¯„è®ºid===> æ­¤åˆ» æ¥æ”¶çš„æ˜¯è¯„è®ºid
    source: {
      type: [Number, String, Object],
      required: true
    },
    // ç”¨äºå’Œçˆ¶ç»„ä»¶å…±äº«æ•°æ®ï¼Œå®ç°æ·»åŠ è¯„è®ºåˆ—è¡¨æ›´æ–°ï¼Œæ’å…¥    
    list: {
      type: Array,
      default: () => []
    },
    // ã€æ–°å¢è¿™ä¸ªtypeã€‘åˆ¤æ–­æ˜¯æ–‡ç« è¿˜æ˜¯è¯„è®º    
    type: {
      type: String,
      // è‡ªå®šä¹‰ Prop æ•°æ®éªŒè¯
      validator (value) {
        return ['a', 'c'].includes(value)
      },
      default: 'a'
    }
}
```

```js
async onLoad(){
    // å¾ˆå¤šä»£ç ...
    
    // è·å–æ–‡ç« çš„è¯„è®ºå’Œè·å–è¯„è®ºçš„å›å¤æ˜¯åŒä¸€ä¸ªæ¥å£
    // å”¯ä¸€çš„åŒºåˆ«æ˜¯æ¥å£å‚æ•°ä¸ä¸€æ ·
    //    type
    //      a æ–‡ç« çš„è¯„è®º
    //      c è¯„è®ºçš„å›å¤
    //    source
    //      æ–‡ç« çš„è¯„è®ºï¼Œåˆ™ä¼ é€’æ–‡ç« çš„ ID
    //      è¯„è®ºçš„å›å¤ï¼Œåˆ™ä¼ é€’è¯„è®ºçš„ ID
    // 1. è¯·æ±‚è·å–æ•°æ®
    const { data } = await getComments({
        type: this.type, //  è¯„è®ºç±»å‹ï¼Œa-å¯¹æ–‡ç« (article)çš„è¯„è®ºï¼Œc-å¯¹è¯„è®º(comment)çš„å›å¤
        source: this.source.toString(), // æºidï¼Œæ–‡ç« idæˆ–è¯„è®ºid  ã€æ–‡ç« idæˆ–è€…è¯„è®ºidéƒ½æœ‰å¯èƒ½å­˜åœ¨å¤§æ•°å­—ã€‘
        offset: this.offset, // è·å–è¯„è®ºæ•°æ®çš„åç§»é‡ï¼Œå€¼ä¸ºè¯„è®ºidï¼Œè¡¨ç¤ºä»æ­¤idçš„æ•°æ®å‘åå–ï¼Œä¸ä¼ è¡¨ç¤ºä»ç¬¬ä¸€é¡µå¼€å§‹è¯»å–æ•°æ®
        limit: this.limit // è·å–çš„è¯„è®ºæ•°æ®ä¸ªæ•°ï¼Œä¸ä¼ è¡¨ç¤ºé‡‡ç”¨åç«¯æœåŠ¡è®¾å®šçš„é»˜è®¤æ¯é¡µæ•°æ®é‡
    })
    
    // å¾ˆå¤šä»£ç ...
}
```

**2ã€åœ¨`comment-reply.vue`ä¸­å¯¼å…¥`comment-list.vue`ï¼Œæ³¨å†Œï¼Œä½¿ç”¨**

```js
import CommentList from './comment-list'
```

```js
components: {
    // å…¶ä»–æ³¨å†Œ...
    CommentList
}
```

```html
<!-- è¯„è®ºçš„å›å¤åˆ—è¡¨ -->
<comment-list
   :source="comment.com_id"
   type="c"
/>
<!-- /è¯„è®ºçš„å›å¤åˆ—è¡¨ -->
```

### [#](https://hw-xiansheng.github.io/toutiao-notes/guide/08-æ–‡ç« è¯„è®º.html#_4-7ã€å›å¤åˆ—è¡¨æ•°æ®é‡å¤æ•°æ®é—®é¢˜)4.7ã€å›å¤åˆ—è¡¨æ•°æ®é‡å¤æ•°æ®é—®é¢˜

**åŸå› ï¼š** `van-list` ç»„ä»¶æœ‰ä¸ªç‰¹ç‚¹ï¼Œå°±æ˜¯åªæœ‰åœ¨å¯è§†èŒƒå›´å†…æ‰ä¼šè‡ªåŠ¨è°ƒç”¨`load`äº‹ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹‹å‰æ–‡ç« å†…å®¹è¿‡é•¿ï¼Œå°±ä¸ä¼šè§¦å‘è¯·æ±‚æ–‡ç« è¯„è®ºåˆ—è¡¨ï¼Œæ•…è€Œ æˆ‘ä»¬æ‰‹åŠ¨åœ¨`created`é‡Œé¢è°ƒç”¨äº†`onLoad`æ–¹æ³•ï¼Œä½†æ˜¯ç°åœ¨æˆ‘ä»¬è¿™é‡Œçš„å›å¤åˆ—è¡¨ä¸€å¼€å§‹å°±åœ¨å¯æ˜¯èŒƒå›´å†…ï¼Œæ•…è€Œä¼šè§¦å‘2æ¬¡è¯·æ±‚ï¼Œ1æ¬¡æ˜¯å¯è§†èŒƒå›´å†…è‡ªåŠ¨è§¦å‘ï¼Œ1æ¬¡æ˜¯æˆ‘ä»¬ä¸»åŠ¨è°ƒç”¨è§¦å‘ã€‚æ‰€ä»¥æˆ‘ä»¬è¦å…³é—­ è‡ªåŠ¨æ£€æµ‹å¯è§†èŒƒå›´è‡ªåŠ¨è°ƒç”¨ã€‚

**å®ç°ï¼š**

- ç»™`van-list`ç»„ä»¶è®¾ç½®`immediate-check` å±æ€§ï¼Œå…³é—­å¯è§†èŒƒå›´è‡ªåŠ¨è°ƒç”¨æ£€æµ‹

```html
  <!--
    åªæœ‰ List åœ¨å¯è§†èŒƒå›´å†…æ‰ä¼šæ£€æŸ¥æ»šåŠ¨ä½ç½®è§¦å‘ onLoad
   -->
  <van-list
    v-model="loading"
    :finished="finished"
    finished-text="å·²æ˜¾ç¤ºå…¨éƒ¨è¯„è®º"
    :error="error"
    error-text="åŠ è½½å¤±è´¥ï¼Œè¯·ç‚¹å‡»é‡è¯•"
    :immediate-check="false" 
    @load="onLoad"
  >
```

- å…³é—­äº†è‡ªåŠ¨æ£€æµ‹ï¼Œéœ€è¦åœ¨`created` é‡Œé¢å¼€å¯åŠ è½½çŠ¶æ€ï¼Œå’Œä¸»åŠ¨è°ƒç”¨åŠ è½½æ•°æ®

```js
  created () {
    // å½“ä½ æ‰‹åŠ¨åˆå§‹ onLoad çš„è¯ï¼Œå®ƒä¸ä¼šè‡ªåŠ¨å¼€å§‹åˆå§‹çš„ loading
    // æ‰€ä»¥æˆ‘ä»¬è¦æ‰‹åŠ¨çš„å¼€å¯åˆå§‹ loading
    this.loading = true
    this.onLoad()
  }
```

### [#](https://hw-xiansheng.github.io/toutiao-notes/guide/08-æ–‡ç« è¯„è®º.html#_4-8ã€å›å¤åˆ—è¡¨å†…å®¹ä¸æ›´æ–°é—®é¢˜)4.8ã€å›å¤åˆ—è¡¨å†…å®¹ä¸æ›´æ–°é—®é¢˜

å¼¹å±‚ç»„ä»¶ï¼š

- å¦‚æœåˆå§‹çš„æ¡ä»¶æ˜¯ falseï¼Œåˆ™å¼¹å±‚çš„å†…å®¹ä¸ä¼šæ¸²æŸ“
- ç¨‹åºè¿è¡ŒæœŸé—´ï¼Œå½“æ¡ä»¶å˜ä¸º true çš„æ—¶å€™ï¼Œå¼¹å±‚æ‰æ¸²æŸ“äº†å†…å®¹
- ä¹‹ååˆ‡æ¢å¼¹å±‚çš„å±•ç¤ºï¼Œå¼¹å±‚åªæ˜¯é€šè¿‡ CSS æ§åˆ¶éšè—å’Œæ˜¾ç¤º

**åŸå› ï¼š** å¼¹å±‚æ¸²æŸ“å‡ºæ¥ä»¥åå°±åªæ˜¯ç®€å•çš„åˆ‡æ¢æ˜¾ç¤ºå’Œéšè—ï¼Œé‡Œé¢çš„å†…å®¹ä¹Ÿä¸å†é‡æ–°æ¸²æŸ“äº†ï¼Œæ‰€ä»¥ä¼šå¯¼è‡´æˆ‘ä»¬çš„è¯„è®ºçš„å›å¤åˆ—è¡¨ä¸ä¼šåŠ¨æ€æ›´æ–°äº†ã€‚è§£å†³åŠæ³•å°±æ˜¯åœ¨æ¯æ¬¡å¼¹å±‚æ˜¾ç¤ºçš„æ—¶å€™é‡æ–°æ¸²æŸ“ç»„ä»¶ã€‚

```html
<!-- è¯„è®ºå›å¤ -->
<!--
å¼¹å‡ºå±‚æ˜¯æ‡’æ¸²æŸ“çš„ï¼šåªæœ‰åœ¨ç¬¬ä¸€æ¬¡å±•ç¤ºçš„æ—¶å€™æ‰ä¼šæ¸²æŸ“é‡Œé¢çš„å†…å®¹ï¼Œä¹‹åå®ƒçš„å…³é—­å’Œæ˜¾ç¤ºéƒ½æ˜¯åœ¨åˆ‡æ¢å†…å®¹çš„æ˜¾ç¤ºå’Œéšè—
-->
<van-popup v-model="isReplyShow"position="bottom"  style="height: 100%;">
    <!--
            v-if æ¡ä»¶æ¸²æŸ“
            trueï¼šæ¸²æŸ“å…ƒç´ èŠ‚ç‚¹
            falseï¼šä¸æ¸²æŸ“
	-->
    <comment-reply
        v-if="isReplyShow"   
        :comment="currentComment"
        @close="isReplyShow = false"
     />
</van-popup>
<!-- /è¯„è®ºå›å¤ -->
```

### [#](https://hw-xiansheng.github.io/toutiao-notes/guide/08-æ–‡ç« è¯„è®º.html#_4-9ã€å‘å¸ƒå›å¤)4.9ã€å‘å¸ƒå›å¤

**1ã€å¤„ç†åº•éƒ¨è§†å›¾ `comment-reply.vue`**

- ç»˜åˆ¶å›å¤æŒ‰é’®å’Œå›å¤å¼¹æ¡†

  ```js
  data () {
      return {
          isPostShow: false  // å¼¹æ¡†æ˜¯å¦æ˜¾ç¤º
      }
  }
  ```

  ```html
  <!-- åº•éƒ¨åŒºåŸŸ -->
  <div class="reply-bottom">
      <van-button
          class="write-btn"
          size="small"
          round
          @click="isPostShow = true"        
      >å†™è¯„è®º</van-button>
  </div>
  <!-- /åº•éƒ¨åŒºåŸŸ -->
  
  <!-- å‘å¸ƒè¯„è®º -->
  <van-popup v-model="isPostShow" position="bottom">
     è¯„è®ºå›å¤è¯„è®ºå›å¤
  </van-popup>
  <!-- /å‘å¸ƒè¯„è®º -->
  ```
  
- æ•´ç†è¯„è®ºé¡¹å’Œå›å¤åˆ—è¡¨ï¼Œç”¨å®¹å™¨åŒ…è£¹

  ```html
  <div class="scroll-wrap">
      <!-- å½“å‰è¯„è®ºé¡¹ -->
      <!-- /å½“å‰è¯„è®ºé¡¹ -->
  
      <!-- è¯„è®ºçš„å›å¤åˆ—è¡¨ -->
      <!-- /è¯„è®ºçš„å›å¤åˆ—è¡¨ -->
  </div>
  ```

- æ ·å¼

  ```less
  <style scoped lang="less">
  .scroll-wrap {
    position: fixed;
    top: 92px;
    left: 0;
    right: 0;
    bottom: 88px;
    overflow-y: auto;
  }
  
  .reply-bottom {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    height: 88px;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: #fff;
    border-top: 1px solid #d8d8d8;
    .write-btn {
      width: 60%;
    }
  }
  </style>
  ```


**2ã€å‚æ•°å¤„ç†**

- åœ¨`comment-reply.vue`å¯¼å…¥`comment-post.vue` ç»„ä»¶

```js
import CommentPost from './comment-post'
```

```js
components: {
    // å…¶ä»–æ³¨å†Œ...
    CommentPost
}
```

```html
<!-- å‘å¸ƒè¯„è®º -->
<van-popup v-model="isPostShow" position="bottom">
    <comment-post 
         :target="comment.com_id"/>
</van-popup>
<!-- /å‘å¸ƒè¯„è®º -->
```

- æ¢³ç† è¯„è®ºå›å¤æ¥å£çš„æ—¶å€™æˆ‘ä»¬å‘ç°`comment-post.vue`ä¸ä»…éœ€è¦è¯„è®ºidï¼Œè¿˜éœ€è¦æ–‡ç« çš„å¯¹åº”idï¼Œè¿™ä¸ªæ—¶å€™ æˆ‘ä»¬çˆ¶ç»„ä»¶`comment-reply.vue`å¹¶æ²¡æœ‰ï¼Œ è€Œ `article/index.vue` ç»„ä»¶æ˜¯æœ‰çš„ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦æœ‰ä¸€ä¸ªç¥–å…ˆåä»£é€šä¿¡è¿‡ç¨‹ï¼ˆä¸é€‰æ‹©å¤šå±‚çˆ¶å­çš„åŸå› æ˜¯å› ä¸ºæ¯”è¾ƒå¤æ‚ï¼‰

  

  **ç¥–å…ˆåä»£é€šä¿¡**

  `article/index.vue` æä¾›æ•°æ®

  ```js
  // ç»™æ‰€æœ‰çš„åä»£ç»„ä»¶æä¾›æ•°æ®
  // æ³¨æ„ï¼šä¸è¦æ»¥ç”¨
  provide: function () {
      return {
          articleId: this.articleId  // æˆ–è€…å†™æˆ this.$route.params.articleId  ä¹Ÿå¯ä»¥
      }
  }
  ```

  `comment-post.vue` æ³¨å…¥æ•°æ®
  
  ```js
  // inject:['articleId']
  inject: {
      articleId: {
          type: [Number, String, Object],
          default: null
      }
  }
  ```
  
  æ”¹é€ å‘é€è¯·æ±‚æ–¹æ³•

~~~js
const { data } = await addComment({
      target: this.target.toString(), // è¯„è®ºçš„ç›®æ ‡idï¼ˆè¯„è®ºæ–‡ç« å³ä¸ºæ–‡ç« idï¼Œå¯¹è¯„è®ºè¿›è¡Œå›å¤åˆ™ä¸ºè¯„è®ºidï¼‰
      content: this.message, // è¯„è®ºå†…å®¹
      // art_id: this.articleId.toString()
      art_id: this.articleId ? this.articleId.toString() : this.articleId // æ–‡ç« idï¼Œå¯¹è¯„è®ºå†…å®¹å‘è¡¨å›å¤æ—¶ï¼Œéœ€è¦ä¼ é€’æ­¤å‚æ•°ï¼Œè¡¨æ˜æ‰€å±æ–‡ç« idã€‚å¯¹æ–‡ç« è¿›è¡Œè¯„è®ºï¼Œä¸è¦ä¼ æ­¤å‚æ•°ã€‚
})
~~~



æ³¨æ„ï¼š å¯¹`target` å’Œ `articleId` éƒ½è¦è¿›è¡Œ`toString` å¤„ç†ã€‚

------

æ­¤åˆ»å‘ç°è¯·æ±‚å¯ä»¥å‘é€äº†ï¼Œå®ç°äº†å¤ç”¨äº†comment-post.vueç»„ä»¶ï¼Œä½†æ˜¯æœ‰åŒå­¦å·²ç»å‘ç°ï¼Œ å…¶å®æœ‰é—®é¢˜ï¼Œå°±æ˜¯comment-post.vue åœ¨ä½œä¸ºæ–‡ç« è¯„è®ºçš„æ—¶å€™æ˜¯å……å½“article/index.vue çš„å­ç»„ä»¶çš„ï¼ŒåŒæ ·ä¹Ÿæ¥æ”¶åˆ°äº† articleId,ä¸”ä¹Ÿå‘é€å‡ºå»äº†ï¼Œä¹Ÿå°±æ˜¯åœ¨å¯¹æ–‡ç« è¿›è¡Œè¯„è®ºçš„æ—¶å€™æˆ‘ä»¬ä¹Ÿæäº¤äº†art_id ï¼Œè¿™æ ·å¦‚æœåå°ä¸¥æ ¼çš„è¯æ˜¯ä¸è¡Œçš„ï¼Œæ‰€ä»¥è¦ä¼˜åŒ–

![image-20210717231805872](https://hw-xiansheng.github.io/toutiao-notes/assets/img/image-20210717231805872.75a44725.png)

æ‰€ä»¥è¦åœ¨`comment-post.vue`é‡Œé¢è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœæ˜¯å……å½“ è¯„è®ºå›å¤çš„æ—¶å€™åˆ™ ä½¿ç”¨ `articleId`ï¼Œå¦åˆ™ä¸ä½¿ç”¨ã€‚

```js
props: {
    // ç›®æ ‡IDï¼ˆæ–‡ç« IDæˆ–è¯„è®ºIDï¼‰
    target: {
        type: [Number, String, Object],
        required: true
    },
    // å¢åŠ ä¸€ä¸ªtypeï¼Œè¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœæ˜¯aåˆ™è¯´æ˜æ˜¯æ–‡ç« å›å¤ï¼Œä¸éœ€è¦ä½¿ç”¨injectæ³¨å…¥çš„æ•°æ®ï¼Œ ä¸æ˜¯aåˆ™ä½¿ç”¨ã€‚   
    type: {
      type: String,
      // è‡ªå®šä¹‰ Prop æ•°æ®éªŒè¯
      validator (value) {
        return ['a', 'c'].includes(value)
      },
      default: 'a'
    }  
}
```

```js
const { data } = await addComment({
    target: this.target.toString(), // è¯„è®ºçš„ç›®æ ‡idï¼ˆè¯„è®ºæ–‡ç« å³ä¸ºæ–‡ç« idï¼Œå¯¹è¯„è®ºè¿›è¡Œå›å¤åˆ™ä¸ºè¯„è®ºidï¼‰
    content: this.message, // è¯„è®ºå†…å®¹
    art_id: this.type === 'a'  ? null : this.articleId.toString() 
})
```

åœ¨`comment-reply.vue`ä¸­ä¼ é€’ä¸€ä¸‹`type`

```html
<!-- å‘å¸ƒè¯„è®º -->
<van-popup v-model="isPostShow" position="bottom">
    <comment-post 
          type="c"        
         :target="comment.com_id"/>
</van-popup>
<!-- /å‘å¸ƒè¯„è®º -->
```

**3ã€å›å¤æˆåŠŸæ“ä½œ**

`comment-post.vue` å›å¤æˆåŠŸä¼šè§¦å‘`post-success`ï¼Œæ‰€ä»¥åªéœ€è¦åœ¨`comment-reply.vue`ä¸­ç›‘å¬å³å¯

```html
<!-- å‘å¸ƒè¯„è®º -->
<van-popup v-model="isPostShow" position="bottom">
    <comment-post
         type="c"    
        :target="comment.com_id"
        @post-success="onPostSuccess"
    />
</van-popup>
<!-- /å‘å¸ƒè¯„è®º -->
```

`data` é‡Œé¢å®šä¹‰å˜é‡`commentList` ï¼Œ å®ç°`comment-list.vue` å’Œ `comment-post.vue` å’Œ `comment-reply.vue` ä¸‰è€…å…±äº«æ•°æ®

```js
data () {
    return {
        isPostShow: false,
        commentList: [] // è¯„è®ºçš„å›å¤åˆ—è¡¨  
    }
}
```

`methods` å®šä¹‰æ–¹æ³•

```js
methods: {
	onPostSuccess (data) {
        // æ›´æ–°å›å¤çš„æ•°é‡
        this.comment.reply_count++

        // å…³é—­å¼¹å±‚
        this.isPostShow = false

        // å°†æœ€æ–°å›å¤çš„å†…å®¹å±•ç¤ºåˆ°åˆ—è¡¨çš„é¡¶éƒ¨
        this.commentList.unshift(data.new_obj)
    }
}
```

```html
<!-- è¯„è®ºçš„å›å¤åˆ—è¡¨ -->
<comment-list
   :source="comment.com_id"
   type="c"
   :list="commentList"
/>
<!-- /è¯„è®ºçš„å›å¤åˆ—è¡¨ -->
```

------

**æ•°æ®æµå›¾**

![image-20210717234635092](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20210717234635092.5d8ba997.png)

### [#](https://hw-xiansheng.github.io/toutiao-notes/guide/08-æ–‡ç« è¯„è®º.html#_4-10ã€è¯„è®ºå›å¤æ€»ç»“)4.10ã€è¯„è®ºå›å¤æ€»ç»“

![image-20210717235958419](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20210717235958419.e157b3ee.png)

