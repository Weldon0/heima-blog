# ğŸ“š 5. Layoutæ¨¡å—

## é¦–é¡µå¸ƒå±€-é…ç½®è·¯ç”±

> ç›®æ ‡ï¼šèƒ½å¤Ÿé…ç½®å°å…”é²œå„¿é¡¹ç›®ä¸­çš„ä¸€çº§è·¯ç”±


**æ ¸å¿ƒä»£ç ï¼š**

ï¼ˆ1ï¼‰å®‰è£…ä¾èµ–åŒ…

```bash
yarn add vue-router
```

ï¼ˆ2ï¼‰åˆ›å»ºç»„ä»¶`views/layout/index.vue`

```vue
<script lang="ts" setup name="Layout"></script>
<template>
  <div>layoutç»„ä»¶</div>
</template>

<style lang="less" scoped></style>
```

ï¼ˆ3ï¼‰åˆ›å»ºç»„ä»¶`views/login/index.vue`

```vue
<script lang="ts" setup name="Login"></script>
<template>
  <div>loginç»„ä»¶</div>
</template>

<style lang="less" scoped></style>
```

ï¼ˆ4ï¼‰åˆ›å»ºæ–‡ä»¶`router/index.ts`

```js
import { createRouter, createWebHashHistory } from 'vue-router'
import Layout from '@/views/layout/index.vue'
const router = createRouter({
  history: createWebHashHistory(),
  routes: [
    {
      path: '/',
      component: Layout
    },
    {
      path: '/login',
      component: () => import('@/views/login/index.vue')
    }
  ]
})
export default router
```

ï¼ˆ5ï¼‰åœ¨`main.ts`ä¸­å¯¼å…¥

```js
import { createApp } from 'vue'
import App from './App.vue'
import 'normalize.css'
import '@/assets/styles/common.less'
import router from './router'

const app = createApp(App)
app.use(router)
app.mount('#app')
```

ï¼ˆ6ï¼‰ä¿®æ”¹`App.vue`

```vue
<template>
  <RouterView></RouterView>
</template>

```

## nameçš„è¯´æ˜

[https://github.com/vbenjs/vite-plugin-vue-setup-extend](https://github.com/vbenjs/vite-plugin-vue-setup-extend)

1. å®‰è£…

```
yarn add vite-plugin-vue-setup-extend -D
```

2. é…ç½® vite.config.jsä¸­

```js
import vueSetupExtend from 'vite-plugin-vue-setup-extend'

export default defineConfig({
  plugins: [vue(), vueSetupExtend()],
})
```

:::tip æ³¨æ„

éœ€è¦scripté‡Œé¢åŒ…å«å†…å®¹ï¼Œæ§åˆ¶å°é‡Œé¢æ‰èƒ½çœ‹åˆ°ç»„ä»¶çš„åç§°

:::

## é¦–é¡µå¸ƒå±€-é¡¶éƒ¨é€šæ 

> ç›®æ ‡ï¼šèƒ½å¤Ÿå®ŒæˆLayoutç»„ä»¶çš„é¡¶éƒ¨é€šæ å¸ƒå±€

![image-20211229175807388](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/2022/05/31/image20211229175807388.png)

**æ ¸å¿ƒä»£ç ï¼š**

ï¼ˆ1ï¼‰åœ¨ `src/index.html` å¼•å…¥å­—ä½“å›¾æ ‡æ–‡ä»¶

```html
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link
  rel="stylesheet"
  href="//at.alicdn.com/t/font_2143783_iq6z4ey5vu.css"
/>
<title>å°å…”é²œå„¿</title>
```

ï¼ˆ2ï¼‰ç„¶åï¼Œæ–°å»ºå¤´éƒ¨å¯¼èˆªç»„ä»¶

`layout/components/app-topnav.vue`

```vue
<script lang="ts" setup name="AppTopnav"></script>

<template>
  <nav class="app-topnav">
    <div class="container">
      <ul>
        <li>
          <a href="javascript:;"><i class="iconfont icon-user"></i>å‘¨æ°ä¼¦</a>
        </li>
        <li><a href="javascript:;">é€€å‡ºç™»å½•</a></li>
        <li><a href="javascript:;">è¯·å…ˆç™»å½•</a></li>
        <li><a href="javascript:;">å…è´¹æ³¨å†Œ</a></li>
        <li><a href="javascript:;">æˆ‘çš„è®¢å•</a></li>
        <li><a href="javascript:;">ä¼šå‘˜ä¸­å¿ƒ</a></li>
        <li><a href="javascript:;">å¸®åŠ©ä¸­å¿ƒ</a></li>
        <li><a href="javascript:;">å…³äºæˆ‘ä»¬</a></li>
        <li>
          <a href="javascript:;"><i class="iconfont icon-phone"></i>æ‰‹æœºç‰ˆ</a>
        </li>
      </ul>
    </div>
  </nav>
</template>

<style scoped lang="less">
.app-topnav {
  background: #333;
  ul {
    display: flex;
    height: 53px;
    justify-content: flex-end;
    align-items: center;
    li {
      a {
        padding: 0 15px;
        color: #cdcdcd;
        line-height: 1;
        display: inline-block;
        i {
          font-size: 14px;
          margin-right: 2px;
        }
        &:hover {
          color: @xtxColor;
        }
      }
      ~ li {
        a {
          border-left: 2px solid #666;
        }
      }
    }
  }
}
</style>
```

ï¼ˆ3ï¼‰åœ¨ `src/views/layout/index.vue` ä¸­å¯¼å…¥ä½¿ç”¨

```html
<script lang="ts" setup>
import AppTopnav from './components/app-topnav.vue'
</script>

<template>
  <AppTopnav></AppTopnav>
</template>

<style lang="less" scoped></style>
```

## é¦–é¡µå¸ƒå±€-å¤´éƒ¨å¸ƒå±€

> ç›®æ ‡ï¼šèƒ½å¤Ÿå®ŒæˆLayoutç»„ä»¶çš„å¤´éƒ¨å¸ƒå±€

![image-20211229180517464](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/2022/05/31/image20211229180517464.png)

**æ ¸å¿ƒä»£ç **

ï¼ˆ1ï¼‰åœ¨  `src/views/layout/components/` ä¸‹æ–°å»º `app-header.vue` ç»„ä»¶ï¼ŒåŸºç¡€å¸ƒå±€å¦‚ä¸‹ï¼š

```vue
<script lang="ts" setup name="AppHeader">
//
</script>

<template>
  <header class="app-header">
    <div class="container">
      <h1 class="logo"><RouterLink to="/">å°å…”é²œ</RouterLink></h1>
      <ul class="app-header-nav">
        <li class="home"><RouterLink to="/">é¦–é¡µ</RouterLink></li>
        <li><a href="#">ç¾é£Ÿ</a></li>
        <li><a href="#">é¤å¨</a></li>
        <li><a href="#">è‰ºæœ¯</a></li>
        <li><a href="#">ç”µå™¨</a></li>
        <li><a href="#">å±…å®¶</a></li>
        <li><a href="#">æ´—æŠ¤</a></li>
        <li><a href="#">å­•å©´</a></li>
        <li><a href="#">æœè£…</a></li>
        <li><a href="#">æ‚è´§</a></li>
      </ul>
      <div class="search">
        <i class="iconfont icon-search"></i>
        <input type="text" placeholder="æœä¸€æœ" />
      </div>
      <div class="cart">
        <a class="curr" href="#">
          <i class="iconfont icon-cart"></i><em>2</em>
        </a>
      </div>
    </div>
  </header>
</template>

<style scoped lang="less">
.app-header {
  background: #fff;
  .container {
    display: flex;
    align-items: center;
  }
  .logo {
    width: 200px;
    a {
      display: block;
      height: 132px;
      width: 100%;
      text-indent: -9999px;
      background: url('@/assets/images/logo.png') no-repeat center 18px /
        contain;
    }
  }
  .app-header-nav {
    width: 820px;
    display: flex;
    padding-left: 40px;
    position: relative;
    z-index: 998;
    li {
      margin-right: 40px;
      width: 38px;
      text-align: center;
      a {
        font-size: 16px;
        line-height: 32px;
        height: 32px;
        display: inline-block;
          &:hover {
            color: @xtxColor;
            border-bottom: 1px solid @xtxColor;
          }
      }
    }
  }
  .search {
    width: 170px;
    height: 32px;
    position: relative;
    border-bottom: 1px solid #e7e7e7;
    line-height: 32px;
    .icon-search {
      font-size: 18px;
      margin-left: 5px;
    }
    input {
      width: 140px;
      padding-left: 5px;
      color: #666;
    }
  }
  .cart {
    width: 50px;
    .curr {
      height: 32px;
      line-height: 32px;
      text-align: center;
      position: relative;
      display: block;
      .icon-cart {
        font-size: 22px;
      }
      em {
        font-style: normal;
        position: absolute;
        right: 0;
        top: 0;
        padding: 1px 6px;
        line-height: 1;
        background: @helpColor;
        color: #fff;
        font-size: 12px;
        border-radius: 10px;
        font-family: Arial;
      }
    }
  }
}
</style>
```

ï¼ˆ2ï¼‰åœ¨ `src/views/layout.vue` ä¸­å¯¼å…¥ä½¿ç”¨ã€‚

```diff
<script lang="ts" setup>
import AppTopnav from './components/app-topnav.vue'
+ import AppHeader from './components/app-header.vue'
</script>

<template>
  <AppTopnav></AppTopnav>
+   <AppHeader></AppHeader>
</template>

<style lang="scss" scoped></style>
```

ï¼ˆ3ï¼‰åœ¨`assets/images/`ä¸­æä¾›å›¾ç‰‡ï¼Œåœ¨ç´ æä¸­å·²ç»æä¾›

:::tip æ³¨æ„

é»˜è®¤æƒ…å†µ

![image-20220530180146481](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20220530180146481.png)



å¸é¡¶ä¹‹å

![image-20220530180235574](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20220530180235574.png)

å› ä¸ºåœ¨åé¢çš„å¸é¡¶äº¤äº’é‡Œï¼Œæˆ‘ä»¬éœ€è¦å¤ç”¨å¯¼èˆªéƒ¨åˆ†ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å…ˆç›´æ¥æŠŠä»–æ‹†åˆ†å‡ºæ¥ï¼Œæ‹†åˆ†æˆä¸€ä¸ªå•ç‹¬çš„ç»„ä»¶

:::

ï¼ˆ4ï¼‰æ–°å»º`layout/compoennts/app-header-nav.vue`ç»„ä»¶

```vue
<script lang="ts" setup name="AppHeaderNav"></script>

<template>
  <ul class="app-header-nav">
    <li class="home"><RouterLink to="/">é¦–é¡µ</RouterLink></li>
    <li><a href="#">ç¾é£Ÿ</a></li>
    <li><a href="#">é¤å¨</a></li>
    <li><a href="#">è‰ºæœ¯</a></li>
    <li><a href="#">ç”µå™¨</a></li>
    <li><a href="#">å±…å®¶</a></li>
    <li><a href="#">æ´—æŠ¤</a></li>
    <li><a href="#">å­•å©´</a></li>
    <li><a href="#">æœè£…</a></li>
    <li><a href="#">æ‚è´§</a></li>
  </ul>
</template>

<style lang="less" scoped>
.app-header-nav {
  width: 820px;
  display: flex;
  padding-left: 40px;
  position: relative;
  z-index: 998;
  li {
    margin-right: 40px;
    width: 38px;
    text-align: center;
    a {
      font-size: 16px;
      line-height: 32px;
      height: 32px;
      display: inline-block;
    }
  }
}
</style>
```

ï¼ˆ5ï¼‰åœ¨`layout/components/app-header.vue`ä¸­

```diff
<script lang="ts" setup>
+ import AppHeaderNavVue from './app-header-nav.vue'
</script>


<template>
  <header class="app-header">
    <div class="container">
      <h1 class="logo"><RouterLink to="/">å°å…”é²œ</RouterLink></h1>
+      <AppHeaderNavVue></AppHeaderNavVue>
      // ...
    </div>
  </header>
</template>
```

## é¦–é¡µå¸ƒå±€-åº•éƒ¨

> ç›®æ ‡ï¼šèƒ½å¤Ÿå®ŒæˆLayoutå¸ƒå±€çš„åº•éƒ¨å¸ƒå±€æ•ˆæœ

![image-20211229182504728](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/2022/05/31/image20211229182504728.png)

**æ ¸å¿ƒä»£ç ï¼š**

ï¼ˆ1ï¼‰åœ¨ `src/views/layout/components/` ä¸‹æ–°å»º `app-footer.vue` ç»„ä»¶ï¼ŒåŸºç¡€å¸ƒå±€å¦‚ä¸‹ï¼š

```vue
<script lang="ts" setup name="AppFooter"></script>

<template>
  <footer class="app_footer">
    <!-- è”ç³»æˆ‘ä»¬ -->
    <div class="contact">
      <div class="container">
        <dl>
          <dt>å®¢æˆ·æœåŠ¡</dt>
          <dd><i class="iconfont icon-kefu"></i> åœ¨çº¿å®¢æœ</dd>
          <dd><i class="iconfont icon-question"></i> é—®é¢˜åé¦ˆ</dd>
        </dl>
        <dl>
          <dt>å…³æ³¨æˆ‘ä»¬</dt>
          <dd><i class="iconfont icon-weixin"></i> å…¬ä¼—å·</dd>
          <dd><i class="iconfont icon-weibo"></i> å¾®åš</dd>
        </dl>
        <dl>
          <dt>ä¸‹è½½APP</dt>
          <dd class="qrcode"><img src="@/assets/images/qrcode.jpg" /></dd>
          <dd class="download">
            <span>æ‰«æäºŒç»´ç </span>
            <span>ç«‹é©¬ä¸‹è½½APP</span>
            <a href="javascript:;">ä¸‹è½½é¡µé¢</a>
          </dd>
        </dl>
        <dl>
          <dt>æœåŠ¡çƒ­çº¿</dt>
          <dd class="hotline">
            400-0000-000 <small>å‘¨ä¸€è‡³å‘¨æ—¥ 8:00-18:00</small>
          </dd>
        </dl>
      </div>
    </div>
    <!-- å…¶å®ƒ -->
    <div class="extra">
      <div class="container">
        <div class="slogan">
          <a href="javascript:;">
            <i class="iconfont icon-footer01"></i>
            <span>ä»·æ ¼äº²æ°‘</span>
          </a>
          <a href="javascript:;">
            <i class="iconfont icon-footer02"></i>
            <span>ç‰©æµå¿«æ·</span>
          </a>
          <a href="javascript:;">
            <i class="iconfont icon-footer03"></i>
            <span>å“è´¨æ–°é²œ</span>
          </a>
        </div>
        <!-- ç‰ˆæƒä¿¡æ¯ -->
        <div class="copyright">
          <p>
            <a href="javascript:;">å…³äºæˆ‘ä»¬</a>
            <a href="javascript:;">å¸®åŠ©ä¸­å¿ƒ</a>
            <a href="javascript:;">å”®åæœåŠ¡</a>
            <a href="javascript:;">é…é€ä¸éªŒæ”¶</a>
            <a href="javascript:;">å•†åŠ¡åˆä½œ</a>
            <a href="javascript:;">æœç´¢æ¨è</a>
            <a href="javascript:;">å‹æƒ…é“¾æ¥</a>
          </p>
          <p>CopyRight Â© å°å…”é²œå„¿</p>
        </div>
      </div>
    </div>
  </footer>
</template>

<style scoped lang="less">
.app_footer {
  overflow: hidden;
  background-color: #f5f5f5;
  padding-top: 20px;
  .contact {
    background: #fff;
    .container {
      padding: 60px 0 40px 25px;
      display: flex;
    }
    dl {
      height: 190px;
      text-align: center;
      padding: 0 72px;
      border-right: 1px solid #f2f2f2;
      color: #999;
      &:first-child {
        padding-left: 0;
      }
      &:last-child {
        border-right: none;
        padding-right: 0;
      }
    }
    dt {
      line-height: 1;
      font-size: 18px;
    }
    dd {
      margin: 36px 12px 0 0;
      float: left;
      width: 92px;
      height: 92px;
      padding-top: 10px;
      border: 1px solid #ededed;
      .iconfont {
        font-size: 36px;
        display: block;
        color: #666;
      }
      &:hover {
        .iconfont {
          color: @xtxColor;
        }
      }
      &:last-child {
        margin-right: 0;
      }
    }
    .qrcode {
      width: 92px;
      height: 92px;
      padding: 7px;
      border: 1px solid #ededed;
    }
    .download {
      padding-top: 5px;
      font-size: 14px;
      width: auto;
      height: auto;
      border: none;
      span {
        display: block;
      }
      a {
        display: block;
        line-height: 1;
        padding: 10px 25px;
        margin-top: 5px;
        color: #fff;
        border-radius: 2px;
        background-color: @xtxColor;
      }
    }
    .hotline {
      padding-top: 20px;
      font-size: 22px;
      color: #666;
      width: auto;
      height: auto;
      border: none;
      small {
        display: block;
        font-size: 15px;
        color: #999;
      }
    }
  }
  .extra {
    background-color: #333;
  }
  .slogan {
    height: 178px;
    line-height: 58px;
    padding: 60px 100px;
    border-bottom: 1px solid #434343;
    display: flex;
    justify-content: space-between;
    a {
      height: 58px;
      line-height: 58px;
      color: #fff;
      font-size: 28px;
      i {
        font-size: 50px;
        vertical-align: middle;
        margin-right: 10px;
        font-weight: 100;
      }
      span {
        vertical-align: middle;
        text-shadow: 0 0 1px #333;
      }
    }
  }
  .copyright {
    height: 170px;
    padding-top: 40px;
    text-align: center;
    color: #999;
    font-size: 15px;
    p {
      line-height: 1;
      margin-bottom: 20px;
    }
    a {
      color: #999;
      line-height: 1;
      padding: 0 10px;
      border-right: 1px solid #999;
      &:last-child {
        border-right: none;
      }
    }
  }
}
</style>
```

ï¼ˆ2ï¼‰åœ¨ `src/views/layout.vue` ä¸­å¯¼å…¥ä½¿ç”¨ã€‚

```vue
<script lang="ts" setup>
import AppTopnav from './components/app-topnav.vue'
import AppHeader from './components/app-header.vue'
import AppFooter from './components/app-footer.vue'
</script>

<template>
  <AppTopnav></AppTopnav>
  <AppHeader></AppHeader>
  <main class="app-body">
    <!-- è·¯ç”±å‡ºå£ -->
  </main>
  <AppFooter></AppFooter>
</template>

<style lang="less" scoped>
.app-body {
  min-height: 600px;
}
</style>
```

## ä½¿ç”¨piniaç®¡ç†æ•°æ®

> ç›®æ ‡ï¼šèƒ½å¤Ÿé›†æˆpiniaç¯å¢ƒï¼Œç»Ÿä¸€ç®¡ç†é¡¹ç›®ä¸­çš„æ•°æ®

> é¡¶éƒ¨çš„åˆ†ç±»æ•°æ®å¾ˆå¤šåœ°æ–¹éƒ½è¦ç”¨ï¼Œæ‰€ä»¥ä»–æ˜¯ç¬¬ä¸€ä¸ªéœ€è¦è¿›è¡Œç®¡ç†çš„

**æ ¸å¿ƒæ­¥éª¤ï¼š**

ï¼ˆ1ï¼‰å®‰è£…pinia

```bash
yarn add pinia
```

ï¼ˆ2ï¼‰åœ¨`main.ts`ä¸­æ³¨å†Œpinia

```js
import { createApp } from 'vue'
import App from '@/App.vue'
// å¼•å…¥é€šç”¨æ ·å¼ï¼Œæµè§ˆå™¨è¡¨ç°æ˜¯ä¸€è‡´çš„
import 'normalize.css'
// å¼•å…¥é¡¹ç›®ä¸­ä¸€äº›é€šç”¨æ ·å¼
import '@/assets/styles/common.less'
import router from '@/router'
import { createPinia } from 'pinia'
const app = createApp(App)
app.use(router)

app.use(createPinia())
app.mount('#app')
```

ï¼ˆ3ï¼‰åˆ›å»ºæ–‡ä»¶`store/modules/category.ts`,ç”¨äºç®¡ç†categoryæ¨¡å—çš„æ•°æ®

```js
import { defineStore } from 'pinia'
export default defineStore('category', {
  state: () => ({
    money: 100,
  }),
})
```

ï¼ˆ4ï¼‰åˆ›å»º`store/index.ts`ç»Ÿä¸€ç®¡ç†æ‰€æœ‰çš„æ¨¡å—

```js
import useCategoryStore from './modules/category'

export default function useStore() {
  return {
    category: useCategoryStore(),
  }
}
```

ï¼ˆ5ï¼‰åœ¨`layout/components/app-header-nav.vue`ä¸­æµ‹è¯•

```js
import useStore from '@/store'
const { category } = useStore()
console.log(category.money)
```

## å¤´éƒ¨åˆ†ç±»å¯¼èˆª-æ¸²æŸ“

> ç›®æ ‡ï¼šèƒ½å¤Ÿå‘é€è¯·æ±‚å®Œæˆåˆ†ç±»å¯¼èˆªçš„æ¸²æŸ“

**æ ¸å¿ƒä»£ç ï¼š**

ï¼ˆ1ï¼‰åœ¨`store/category.ts`ä¸­æä¾›stateå’Œactions

```js
import { defineStore } from 'pinia'
import request from '@/utils/request'
export default defineStore('category', {
  state: () => ({
    list: [],
  }),
  actions: {
    async getAllCategory() {
      const res = await request.get('/home/category/head')
      console.log(res)
    },
  },
})
```

ï¼ˆ2ï¼‰åœ¨`layout/components/app-header-nav.vue`ä¸­å‘é€è¯·æ±‚

```js
<script lang="ts" setup>
import useStore from '@/store'
const { category } = useStore()
category.getAllCategory()
</script>
```

ï¼ˆ3ï¼‰åœ¨`types/data.d.ts`ä¸­å®šä¹‰æ•°æ®ç±»å‹

```js
// æ‰€æœ‰çš„æ¥å£çš„é€šç”¨ç±»å‹
export interface ApiRes<T> {
  code: string
  msg: string
  result: T
}

// å•ä¸ªåˆ†ç±»çš„ç±»å‹
export type CategoryItem = {
  id: string
  name: string
  picture: string
}
```

ï¼ˆ4ï¼‰ä¿®æ”¹`store/category.ts`ï¼Œç»™axiosè¯·æ±‚å¢åŠ æ³›å‹

```typescript
import { defineStore } from 'pinia'
import request from '@/utils/request'
import { ApiRes, CategoryItem } from '@/types/data'
export default defineStore('category', {
  state: () => ({
    list: [] as CategoryItem[],
  }),
  actions: {
    async getAllCategory() {
      const res = await request.get<ApiRes<CategoryItem[]>>(
        '/home/category/head'
      )
      this.list = res.data.result
    },
  },
})
```

ï¼ˆ5ï¼‰æ¸²æŸ“åˆ†ç±»å¯¼èˆª åœ¨`layout/components/app-header-nav.vue`ä¸­

```jsx
<template>
  <ul class="app-header-nav">
    <li class="home"><RouterLink to="/">é¦–é¡µ</RouterLink></li>
    <li v-for="item in category.list" :key="item.id">
      <a href="#">{{ item.name }}</a>
    </li>
  </ul>
</template>
```

## å¤´éƒ¨åˆ†ç±»å¯¼èˆªæ¸²æŸ“-å®Œå–„äºŒçº§åˆ†ç±»

å®Œå–„å­çº§åˆ†ç±»å¸ƒå±€ `src/views/layout/components/app-header-nav.vue`

> æ ·å¼å…¨éƒ¨å¤åˆ¶æ›¿æ¢

```vue
<script lang="ts" setup>
import useStore from '@/store'
const { category } = useStore()
category.getAllCategory()
</script>

<template>
  <ul class="app-header-nav">
    <li class="home"><RouterLink to="/">é¦–é¡µ</RouterLink></li>
    <li v-for="item in home.categoryList" :key="item.id">
      <a href="#">{{ item.name }}</a>

      <!-- æ–°å¢++++++++ -->
      <div class="layer">
        <ul>
          <li v-for="i in 10" :key="i">
            <a href="#">
              <img
                src="https://yanxuan.nosdn.127.net/cc361cf40d4f81c7eccefed1ad18face.png?quality=95&imageView"
                alt=""
              />
              <p>æœå¹²</p>
            </a>
          </li>
        </ul>
      </div>
      <!-- æ–°å¢++++++++ -->
    </li>
  </ul>
</template>


<style scoped lang="less">
.app-header-nav {
  width: 820px;
  display: flex;
  padding-left: 40px;
  position: relative;
  z-index: 998;
  > li {
    margin-right: 40px;
    width: 38px;
    text-align: center;
    > a {
      font-size: 16px;
      line-height: 32px;
      height: 32px;
      display: inline-block;
      &:hover {
        color: @xtxColor;
        border-bottom: 1px solid @xtxColor;
      }
    }
    // æ–°å¢æ ·å¼
    &:hover {
      > a {
        color: @xtxColor;
        border-bottom: 1px solid @xtxColor;
      }
      > .layer {
        height: 132px;
        opacity: 1;
      }
    }
  }
}
// æ–°å¢æ ·å¼
.layer {
  width: 1240px;
  background-color: #fff;
  position: absolute;
  left: -200px;
  top: 56px;
  height: 0;
  overflow: hidden;
  opacity: 0;
  box-shadow: 0 0 5px #ccc;
  transition: all 0.2s 0.1s;
  ul {
    display: flex;
    flex-wrap: wrap;
    padding: 0 70px;
    align-items: center;
    height: 132px;
    li {
      width: 110px;
      text-align: center;
      img {
        width: 60px;
        height: 60px;
      }
      p {
        padding-top: 10px;
      }
      &:hover {
        p {
          color: @xtxColor;
        }
      }
    }
  }
}
</style>
```

## å¤´éƒ¨åˆ†ç±»å¯¼èˆªæ¸²æŸ“-äºŒçº§åˆ†ç±»æ¸²æŸ“

> æ ¹æ®æ•°æ®æ¸²æŸ“äºŒçº§åˆ†ç±»

![image-20220530193953026](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20220530193953026.png)

ä¿®æ”¹types/data.d.tsçš„ç±»å‹ï¼Œæ–°å¢å­èŠ‚ç‚¹çš„ç±»å‹

```js{6}
// å•ä¸ªåˆ†ç±»çš„ç±»å‹
export type CategoryItem = {
  id: string
  name: string
  picture: string
  children: CategoryItem[]
}
```

åŠ¨æ€æ¸²æŸ“

```vue
<template>
  <ul class="app-header-nav">
    <li class="home"><RouterLink to="/">é¦–é¡µ</RouterLink></li>
    <li v-for="item in home.categoryList" :key="item.id">
      <a href="#">{{ item.name }}</a>

      <!-- æ–°å¢++++++++ -->
      <div class="layer">
        <ul>
          <li v-for="sub in item.children" :key="sub.id">
            <a href="#">
              <img :src="sub.picture" alt="" />
              <p>{{ sub.name }}</p>
            </a>
          </li>
        </ul>
      </div>
      <!-- æ–°å¢++++++++ -->
    </li>
  </ul>
</template>
```

## å¤´éƒ¨åˆ†ç±»å¯¼èˆªæ¸²æŸ“-ä¼˜åŒ–

::: danger é—®é¢˜

åˆ·æ–°é¡µé¢ï¼Œä¼šå‘ç°å¯¼èˆªåŠ è½½ä¹‹å‰ï¼Œå°±é—ªä¸€ä¸‹ï¼Œç”¨æˆ·ä½“éªŒä¸å¥½ã€‚

:::

æ€è·¯ï¼šå®šä¹‰ä¸€ä¸ªå¸¸é‡æ•°æ®å’Œåå°ä¿æŒä¸€è‡´ï¼ˆçº¦å®šå¥½9å¤§åˆ†ç±»ï¼‰ï¼Œè¿™æ ·ä¸è¯·æ±‚åå°å°±èƒ½å±•ç¤ºä¸€çº§åˆ†ç±»ï¼Œä¸è‡³äºç™½å±ã€‚

+ å®šä¹‰ä¹ä¸ªåˆ†ç±»å¸¸é‡æ•°æ® `src/store/constants.ts`

```js
// é¡¶çº§åˆ†ç±»
export const topCategory = [
  'å±…å®¶',
  'ç¾é£Ÿ',
  'æœé¥°',
  'æ¯å©´',
  'ä¸ªæŠ¤',
  'ä¸¥é€‰',
  'æ•°ç ',
  'è¿åŠ¨',
  'æ‚é¡¹',
]
```

+ åœ¨piniaä¸­æä¾›åˆå§‹å€¼

```js
import { topCategory } from '../constants'
const defaultCategory = topCategory.map((item) => {
  return {
    name: item,
  }
})

const useHomeStore = defineStore('category', {
  state: () => ({
    categoryList: defaultCategory as CategoryItem[],
  }),
})
```

## é…ç½®äºŒçº§è·¯ç”±

+ åˆ›å»ºé¦–é¡µç»„ä»¶`views/home/index.vue`

```vue
<template>
  <div class="home">é¦–é¡µ</div>
</template>

<script lang="ts" setup name="Home">
</script>

<style></style>
```

+ åˆ›å»ºåˆ†ç±»ç»„ä»¶`views/category/index.vue`

```vue
<template>
  <div class="category">åˆ†ç±»ç»„ä»¶</div>
</template>

<script lang="ts" name="TopCategory" setup>
</script>

<style></style>
```

+ åˆ›å»ºäºŒçº§åˆ†ç±»ç»„ä»¶`views/category/sub.vue`

```vue
<script lang="ts" setup name="SubCategory">

</script>
<template>
  <div class="category">äºŒçº§åˆ†ç±»ç»„ä»¶</div>
</template>

<style></style>

```

+ é…ç½®è·¯ç”±è§„åˆ™

```js
import { createRouter, createWebHashHistory } from 'vue-router'
import Layout from '@/views/layout/index.vue'
import Home from '@/views/home/index.vue'
const router = createRouter({
  history: createWebHashHistory(),
  routes: [
    {
      path: '/',
      component: Layout,
      children: [
        {
          path: '',
          component: Home,
        },
        {
          path: '/category/:id',
          component: () => import('@/views/category/index.vue'),
        },
        {
          path: '/category/sub/:id',
          component: () => import('@/views/category/sub.vue'),
        },
      ],
    },
    {
      path: '/login',
      component: () => import('@/views/login/index.vue'),
    },
  ],
})

export default router
```

+ ç‚¹å‡»åˆ†ç±»-åˆ‡æ¢èœå•`components/app-header-nav.vue`

```diff
<template>
  <ul class="app-header-nav">
    <li class="home"><RouterLink to="/">é¦–é¡µ</RouterLink></li>
    <li v-for="item in list" :key="item.id">
+      <RouterLink :to="`/category/${item.id}`">{{ item.name }}</RouterLink>
      <div class="layer">
        <ul>
          <li v-for="sub in item.children" :key="sub.id">
+            <RouterLink :to="`/category/sub/${sub.id}`">
              <img :src="sub.picture" alt="" />
+              <p>{{ sub.name }}</p>
            </RouterLink>
          </li>
        </ul>
      </div>
    </li>
  </ul>
</template>
```

+ æŒ‡å®šäºŒçº§è·¯ç”±å‡ºå£`src/views/layout/index.vue`

```vue
<template>
  <AppTopnav></AppTopnav>
  <AppHeader></AppHeader>
  <div class="app-body">
    <!-- è·¯ç”±å‡ºå£ -->
    <RouterView></RouterView>
  </div>
  <AppFooter></AppFooter>
</template>
```

## åˆ†ç±»å¯¼èˆªæ˜¾ç¤ºéšè—

> å®ç°ç‚¹å‡»çš„æ—¶å€™è·³è½¬ï¼Œä¸”èƒ½å…³é—­äºŒçº§åˆ†ç±»å¼¹çª—ã€‚

æè¿°ï¼šç”±äºæ˜¯å•é¡µé¢è·¯ç”±è·³è½¬ä¸ä¼šåˆ·æ–°é¡µé¢ï¼Œcssçš„hoverä¸€ç›´è§¦å‘æ— æ³•å…³é—­åˆ†ç±»å¼¹çª—ã€‚

å¤§è‡´é€»è¾‘ï¼š

1. é¼ æ ‡è¿›å…¥ä¸€çº§åˆ†ç±»ï¼Œæ˜¾ç¤ºå½“å‰ä¸€çº§åˆ†ç±»
2. ç‚¹å‡»ä¸€çº§åˆ†ç±»ï¼Œéšè—æ‰€æœ‰äºŒçº§å¼¹å±‚
3. ç‚¹å‡»äºŒçº§åˆ†ç±»ï¼Œéšè—æ‰€æœ‰äºŒçº§å¼¹å±‚

è½åœ°ä»£ç 

1ï¼‰åœ¨piniaç»™ä¸€çº§åˆ†ç±»åŠ openæ§åˆ¶æ˜¾ç¤ºéšè— `src/store/modules/category.ts`

```diff
async getAllCategory() {
  const res = await request.get<ApiRes<CategoryItem[]>>(
    '/home/category/head'
  )
  // 1. ç»™æ¯ä¸€ä¸ªä¸€çº§åˆ†ç±»æ·»åŠ ä¸€ä¸ªopenå±æ€§ï¼Œç”¨äºæ§åˆ¶æ˜¾ç¤ºéšè—
+  res.data.result.forEach((item) => {
+    item.open = false
+  })
  this.list = res.data.result
},
```

éœ€è¦ç»™types/data.d.tsæ–‡ä»¶ä¸­æ–°å¢ä¸€ä¸ªå±æ€§

```diff
// å•ä¸ªåˆ†ç±»çš„ç±»å‹
export type CategoryItem = {
  id: string
  name: string
  picture: string
+  open: boolean
  children: CategoryItem[]
}
```

2ï¼‰piniaä¸­æ·»åŠ äº† show hide æ–¹æ³•æ§åˆ¶æ˜¾ç¤ºå’Œéšè— 

```js
show(id: string) {
  const category = this.list.find((item) => item.id === id)
  category!.open = true
},
hide(id: string) {
  const category = this.list.find((item) => item.id === id)
  category!.open = false
},
```

3ï¼‰å¤´éƒ¨å¯¼èˆªç»„ä»¶ å®ç°æ˜¾ç¤ºå’Œéšè— `src/components/app-header-nav.vue`

```diff{7-8,12,17,21,58-61,66-69}
<template>
  <ul class="app-header-nav">
    <li class="home"><RouterLink to="/">é¦–é¡µ</RouterLink></li>
    <li
      v-for="item in category.categoryList"
      :key="item.id"
+      @mouseenter="category.show(item.id)"
+      @mouseleave="category.hide(item.id)"
    >
      <!-- <a href="#">{{ item.name }}</a> -->
      <RouterLink
+        @click="category.hide(item.id)"
        :to="`/category/${item.id}`"
        >{{ item.name }}</RouterLink
      >
      <!-- æ–°å¢++++++++ -->
+      <div class="layer" :class="{ open: item.open }">
        <ul>
          <li v-for="sub in item.children" :key="sub.id">
            <RouterLink
+              @click="category.hide(item.id)"
              :to="`/category/sub/${sub.id}`"
            >
              <img :src="sub.picture" alt="" />
              <p>{{ sub.name }}</p>
            </RouterLink>
          </li>
        </ul>
      </div>
      <!-- æ–°å¢++++++++ -->
    </li>
  </ul>
</template>


<style scoped lang="less">
.app-header-nav {
  width: 820px;
  display: flex;
  padding-left: 40px;
  position: relative;
  z-index: 998;
  > li {
    margin-right: 40px;
    width: 38px;
    text-align: center;
    > a {
      font-size: 16px;
      line-height: 32px;
      height: 32px;
      display: inline-block;
    }
    &:hover {
      > a {
        color: @xtxColor;
        border-bottom: 1px solid @xtxColor;
      }
-      > .layer {
-          height: 132px;
-          opacity: 1;
-      }
    }
  }
}
.layer {
+  &.open {
+    height: 132px;
+    opacity: 1;
+  }
  width: 1240px;
  background-color: #fff;
  position: absolute;
  left: -200px;
  top: 56px;
  height: 0;
  overflow: hidden;
  opacity: 0;
  box-shadow: 0 0 5px #ccc;
  transition: all 0.2s 0.1s;
  ul {
    display: flex;
    flex-wrap: wrap;
    padding: 0 70px;
    align-items: center;
    height: 132px;
    li {
      width: 110px;
      text-align: center;
      img {
        width: 60px;
        height: 60px;
      }
      p {
        padding-top: 10px;
      }
      &:hover {
        p {
          color: @xtxColor;
        }
      }
    }
  }
}
</style>
```

## å¤´éƒ¨åˆ†ç±»å¯¼èˆª-å¸é¡¶åŠŸèƒ½

> ç”µå•†ç½‘ç«™çš„é¦–é¡µå†…å®¹ä¼šæ¯”è¾ƒå¤šï¼Œé¡µé¢æ¯”è¾ƒé•¿ï¼Œä¸ºäº†èƒ½è®©ç”¨æˆ·åœ¨æ»šåŠ¨æµè§ˆå†…å®¹çš„è¿‡ç¨‹ä¸­éƒ½èƒ½å¤Ÿå¿«é€Ÿçš„åˆ‡æ¢åˆ°å…¶å®ƒåˆ†ç±»ã€‚éœ€è¦åˆ†ç±»å¯¼èˆªä¸€ç›´å¯è§ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªå¸é¡¶å¯¼èˆªçš„æ•ˆæœã€‚
>
> ç›®æ ‡:å®Œæˆå¤´éƒ¨ç»„ä»¶å¸é¡¶æ•ˆæœçš„å®ç°

**äº¤äº’è¦æ±‚**

1. æ»šåŠ¨è·ç¦»å¤§äºç­‰äº78ä¸ªpxçš„æ—¶å€™ï¼Œç»„ä»¶ä¼šåœ¨é¡¶éƒ¨å›ºå®šå®šä½
2. æ»šåŠ¨è·ç¦»å°äº78ä¸ªpxçš„æ—¶å€™ï¼Œç»„ä»¶æ¶ˆå¤±éšè—

**å®ç°æ€è·¯**

1. å‡†å¤‡ä¸€ä¸ªå¸é¡¶ç»„ä»¶ï¼Œå‡†å¤‡ä¸€ä¸ªç±»åï¼Œæ§åˆ¶æ˜¾ç¤ºéšè—
2. ç›‘å¬é¡µé¢æ»šåŠ¨ï¼Œåˆ¤æ–­æ»šåŠ¨è·ç¦»ï¼Œè·ç¦»å¤§äº78pxæ·»åŠ ç±»å

**æ ¸å¿ƒä»£ç ï¼š**

ï¼ˆ1ï¼‰æ–°å»ºå¸é¡¶å¯¼èˆªç»„ä»¶`src/Layout/components/app-header-sticky.vue` 

```jsx
<script lang="ts" setup name="AppHeaderSticky">
import AppHeaderNav from './app-header-nav.vue'
</script>

<template>
  <div class="app-header-sticky">
    <div class="container">
      <RouterLink class="logo" to="/" />
      <AppHeaderNav />
      <div class="right">
        <RouterLink to="/">å“ç‰Œ</RouterLink>
        <RouterLink to="/">ä¸“é¢˜</RouterLink>
      </div>
    </div>
  </div>
</template>

<style scoped lang="less">
.app-header-sticky {
  width: 100%;
  height: 80px;
  position: fixed;
  left: 0;
  top: 0;
  z-index: 999;
  background-color: #fff;
  border-bottom: 1px solid #e4e4e4;
  .container {
    display: flex;
    align-items: center;
  }
  .logo {
    width: 200px;
    height: 80px;
    background: url(@/assets/images/logo.png) no-repeat right 2px;
    background-size: 160px auto;
  }
  .right {
    width: 220px;
    display: flex;
    text-align: center;
    padding-left: 40px;
    border-left: 2px solid @xtxColor;
    a {
      width: 38px;
      margin-right: 40px;
      font-size: 16px;
      line-height: 1;
      &:hover {
        color: @xtxColor;
      }
    }
  }
}
</style>
```

ï¼ˆ2ï¼‰Layouté¦–é¡µå¼•å…¥å¸é¡¶å¯¼èˆªç»„ä»¶

```diff
<script lang="ts" setup>
import AppTopnav from './components/app-topnav.vue'
import AppHeader from './components/app-header.vue'
import AppFooter from './components/app-footer.vue'
+import AppHeaderSticky from './components/app-header-sticky.vue'
</script>
<template>
  <AppTopnav></AppTopnav>
  <AppHeader></AppHeader>
+  <AppHeaderSticky></AppHeaderSticky>
  <div class="app-body">
    <!-- è·¯ç”±å‡ºå£ -->
    <RouterView></RouterView>
  </div>
  <AppFooter></AppFooter>
</template>

<style lang="less" scoped>
.app-body {
  min-height: 600px;
}
</style>

```

ï¼ˆ3ï¼‰æä¾›æ ·å¼ï¼Œæ§åˆ¶stickyçš„æ˜¾ç¤ºå’Œéšè—

```diff
.app-header-sticky {
  width: 100%;
  height: 80px;
  position: fixed;
  left: 0;
  top: 0;
  z-index: 999;
  background-color: #fff;
  border-bottom: 1px solid #e4e4e4;
+  transform: translateY(-100%);
+  &.show {
+    transition: all 0.3s linear;
+    transform: translateY(0%);
+  }
```

ï¼ˆ4ï¼‰ç»™windowæ³¨å†Œscrolläº‹ä»¶ï¼Œè·å–æ»šåŠ¨è·ç¦»

```js
<script lang="ts" setup>
import { onBeforeUnmount, onMounted, ref } from 'vue'
import AppHeaderNav from './app-header-nav.vue'
const y = ref(0)
const onScroll = () => {
  y.value = document.documentElement.scrollTop
}
onMounted(() => {
  window.addEventListener('scroll', onScroll)
})
onBeforeUnmount(() => {
  window.removeEventListener('scroll', onScroll)
})
</script>
```

ï¼ˆ5ï¼‰æ§åˆ¶stickyçš„æ˜¾ç¤ºå’Œéšè—

```vue
 <div class="app-header-sticky" :class="{show:y>=78}">
```

ï¼ˆ6ï¼‰ä¿®å¤bugï¼Œä¸ºäº†å¸é¡¶å¤´éƒ¨çš„å†…å®¹ä¸é®ä½ä¸å¸é¡¶çš„å¤´éƒ¨ã€‚

```vue
<div class="container" v-show="y>=78">
```

> ä¹Ÿå¯ä»¥ä½¿ç”¨185pxï¼Œæ•´å¥½åŸæœ‰çš„headerå…¨éƒ¨æ¶ˆå¤±æ—¶å€™å±•ç¤ºå¸é¡¶çš„header

## å¤´éƒ¨åˆ†ç±»å¯¼èˆª-å¸é¡¶é‡æ„

> [vueuse/core](https://vueuse.org/core/useWindowScroll/) : ç»„åˆå¼APIå¸¸ç”¨å¤ç”¨é€»è¾‘çš„é›†åˆ
>
> ç›®æ ‡ï¼š ä½¿ç”¨  vueuse/core é‡æ„å¸é¡¶åŠŸèƒ½

**æ ¸å¿ƒæ­¥éª¤**

ï¼ˆ1ï¼‰å®‰è£…@vueuse/core åŒ…ï¼Œå®ƒå°è£…äº†å¸¸è§çš„ä¸€äº›äº¤äº’é€»è¾‘

```bash
yarn add @vueuse/core
```

ï¼ˆ2ï¼‰åœ¨å¸é¡¶å¯¼èˆªä¸­ä½¿ç”¨

`src/components/app-header-sticky.vue` 

```vue
<script lang="ts" setup>
import AppHeaderNav from './app-header-nav.vue'
import { useWindowScroll } from '@vueuse/core'
// æ§åˆ¶æ˜¯å¦æ˜¾ç¤ºå¸é¡¶ç»„ä»¶
const { y } = useWindowScroll()
</script>
```

