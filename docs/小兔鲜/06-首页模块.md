# ğŸ“š 6. é¦–é¡µæ¨¡å—

## å·¦ä¾§åˆ†ç±»åŸºæœ¬ç»“æ„

> ç›®æ ‡:  å°†banneréƒ¨åˆ†æ‹†åˆ†æˆå·¦ä¾§åˆ†ç±»ä¸è½®æ’­å›¾ä¸¤ä¸ªåŠŸèƒ½

ï¼ˆ1ï¼‰æ‹†åˆ†å·¦ä¾§åˆ†ç±»ç»„ä»¶

`home/components/home-category.vue`

```html
<script lang="ts" setup name="HomeCategory"></script>
<template>
  <div class="home-category">
    <ul class="menu">
      <li v-for="i in 10" :key="i">
        <RouterLink to="/">å±…å®¶</RouterLink>
        <RouterLink to="/">æ´—æ¼±</RouterLink>
        <RouterLink to="/">æ¸…æ´</RouterLink>
      </li>
    </ul>
  </div>
</template>

<style scoped lang="less">
.home-category {
  width: 250px;
  height: 500px;
  background: rgba(0, 0, 0, 0.8);
  position: relative;
  z-index: 99;
  .menu {
    li {
      padding-left: 40px;
      height: 55px;
      line-height: 55px;
      &:hover {
        background: @xtxColor;
      }
      a {
        margin-right: 4px;
        color: #fff;
        &:first-child {
          font-size: 16px;
        }
      }
    }
  }
}
</style>

```

ï¼ˆ2ï¼‰æ‹†åˆ†bannerç»„ä»¶

`home/components/home-banner.vue`

```html
<script lang="ts" setup></script>
<template>
  <div class="home-banner">
    <!-- è½®æ’­å›¾ -->
  </div>
</template>

<style scoped lang="less">
.home-banner {
  width: 1240px;
  height: 500px;
  position: absolute;
  left: 0;
  top: 0;
  z-index: 98;
  background-color: pink;
}
</style>
```

ï¼ˆ3ï¼‰homeç»„ä»¶ä¸­å¼•å…¥ä½¿ç”¨

```html
<script lang="ts" setup>
import HomeBanner from './components/home-banner.vue'
import HomeCategory from './components/home-category.vue'
</script>

<template>
  <div class="page-home">
    <div class="home-entry">
      <div class="container">
        <!-- å·¦ä¾§åˆ†ç±» -->
        <HomeCategory />
        <!-- bannerè½®æ’­å›¾ -->
        <HomeBanner />
      </div>
    </div>
  </div>
</template>



<style lang="less" scoped></style>
```

## å·¦ä¾§åˆ†ç±»-æ•°æ®æ¸²æŸ“

> ç›®æ ‡ï¼šèƒ½å¤Ÿæ¸²æŸ“å·¦ä¾§åˆ†ç±»æ•°æ®

![image-20210427151621526](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/2022/05/31/left.png)

ï¼ˆ1ï¼‰å¯¼èˆªmenuæ•°æ®æ¸²æŸ“

`src/views/home/components/home-category.vue`

:::tip

åˆ†ç±»æ•°æ®åœ¨piniaä¸­å·²ç»ä¿å­˜äº†ï¼Œç›´æ¥ä½¿ç”¨å³å¯

:::

```html
<script lang="ts" setup name="HomeCategory">
import useStore from '@/store'
const { category } = useStore()
</script>

<template>
  <div class="home-category">
    <ul class="menu">
      <li v-for="item in category.list" :key="item.id">
        <RouterLink :to="`/category/${item.id}`">{{ item.name }}</RouterLink>
        <RouterLink
          :to="`/category/sub/${sub.id}`"
          v-for="sub in item.children?.slice(0, 2)"
        >
          {{ sub.name }}
        </RouterLink>
      </li>
    </ul>
  </div>
</template>
```

## å·¦ä¾§åˆ†ç±»-é¼ æ ‡ç§»å…¥layerå±•ç¤º

> ç›®æ ‡ï¼šèƒ½å¤Ÿå®Œæˆå·¦ä¾§åˆ†ç±»çš„é¼ æ ‡äº¤äº’æ•ˆæœ

**å®ç°æ­¥éª¤**

- å¸ƒå±€äº¤äº’
  - ä¸€ä¸ªå…±ç”¨çš„layerå¼¹å±‚ï¼Œé»˜è®¤éšè—
  - Liæ ‡ç­¾hoverçŠ¶æ€çš„æ—¶å€™è®©layerå¼¹å±‚å±•ç¤ºå‡ºæ¥
- æ•°æ®è·å–
  - æŠŠgoodså­—æ®µä¹Ÿå¯¼å…¥è¿›æ¥

**ä»£ç è½åœ°**

ï¼ˆ1ï¼‰å‡†å¤‡å¸ƒå±€

> æ”¾åˆ°home-category.vue ä¸‹é¢çš„ul.menuä¸‹é¢ï¼Œå…±ç”¨ä¸€ä¸ªå¼¹å±‚

```html
<!-- å¼¹å±‚ -->
<div class="layer">
  <h4>åˆ†ç±»æ¨è <small>æ ¹æ®æ‚¨çš„è´­ä¹°æˆ–æµè§ˆè®°å½•æ¨è</small></h4>
  <ul>
    <li v-for="i in 9" :key="i">
      <RouterLink to="/">
        <img src="https://yanxuan-item.nosdn.127.net/5a115da8f2f6489d8c71925de69fe7b8.png" alt="">
        <div class="info">
          <p class="name ellipsis-2">ã€å®šé‡‘è´­ã€‘ä¸¥é€‰é›¶é£Ÿå¤§ç¤¼åŒ…ï¼ˆ12ä»¶ï¼‰</p>
          <p class="desc ellipsis">è¶…å€¼ç»„åˆè£…ï¼Œæ»¡è¶³é¦‹å˜´æ¬²</p>
          <p class="price"><i>Â¥</i>100.00</p>
        </div>
      </RouterLink>
    </li>
  </ul>
</div>
```

ï¼ˆ2ï¼‰æ–°å¢å¼¹å±‚çš„æ ·å¼

> æ³¨æ„æ ·å¼çš„ä¹¦å†™ä½ç½®

```jsx
<style scoped lang="less">
.home-category {
  // ....
  .layer {
    width: 990px;
    height: 500px;
    background: rgba(255, 255, 255, 0.8);
    position: absolute;
    left: 250px;
    top: 0;
    display: none;
    padding: 0 15px;
    h4 {
      font-size: 20px;
      font-weight: normal;
      line-height: 80px;
      small {
        font-size: 16px;
        color: #666;
      }
    }
    ul {
      display: flex;
      flex-wrap: wrap;
      li {
        width: 310px;
        height: 120px;
        margin-right: 15px;
        margin-bottom: 15px;
        border: 1px solid #eee;
        border-radius: 4px;
        background: #fff;
        &:nth-child(3n) {
          margin-right: 0;
        }
        a {
          display: flex;
          width: 100%;
          height: 100%;
          align-items: center;
          padding: 10px;
          &:hover {
            background: #e3f9f4;
          }
          img {
            width: 95px;
            height: 95px;
          }
          .info {
            padding-left: 10px;
            line-height: 24px;
            width: 190px;
            .name {
              font-size: 16px;
              color: #666;
            }
            .desc {
              color: #999;
            }
            .price {
              font-size: 22px;
              color: @priceColor;
              i {
                font-size: 16px;
              }
            }
          }
        }
      }
    }
  }
  &:hover {
    .layer {
      display: block;
    }
  }
    
    
    
}
</style>
```

ä¿®æ”¹types/data.d.ts

```typescript
export type CategoryGoods = {
  desc: string
  id: string
  name: string
  picture: string
  price: string
}

// å•ä¸ªåˆ†ç±»çš„ç±»å‹
export type CategoryItem = {
  id: string
  name: string
  picture: string
  open: boolean
  children: CategoryItem[]
  goods: CategoryGoods[]
}
```



ï¼ˆ3ï¼‰å®šä¹‰categoryIdï¼Œç”¨äºè®°å½•å½“å‰id

```typescript
// è®°å½•å½“å‰çš„åˆ†ç±»id
const categoryId = ref('')
```

ç»™liæ³¨å†Œmouseenteräº‹ä»¶

```typescript
<li
  v-for="(item, index) in category.list"
  :key="index"
  @mouseenter="categoryId = item.id"
>
```

ï¼ˆ4ï¼‰å®šä¹‰è®¡ç®—å±æ€§ï¼Œè·å–å½“å‰åˆ†ç±»ä¸‹çš„å•†å“æ•°æ®

```typescript
const goods = computed(() => {
  return category.list.find((item) => item.id === categoryId.value)?.goods
})
```

ï¼ˆ5ï¼‰æ¸²æŸ“å•†å“æ•°æ®

```vue
<!-- å¼¹å±‚ -->
<div class="layer" v-if="goods">
  <h4>åˆ†ç±»æ¨è <small>æ ¹æ®æ‚¨çš„è´­ä¹°æˆ–æµè§ˆè®°å½•æ¨è</small></h4>
  <ul>
    <li v-for="item in goods" :key="item.id" >
      <RouterLink :to="`/product/${item.id}`">
        <img :src="item.picture" alt="" />
        <div class="info">
          <p class="name ellipsis-2">{{ item.name }}</p>
          <p class="desc ellipsis">{{ item.desc }}</p>
          <p class="price"><i>Â¥</i>{{ item.price }}</p>
        </div>
      </RouterLink>
    </li>
  </ul>
</div>
```

## å·¦ä¾§åˆ†ç±»-é«˜äº®bugå¤„ç†

> å½“é¼ æ ‡ç§»åŠ¨åˆ°å³ä¾§æ˜¯ï¼Œå·¦ä¾§å¯¹åº”çš„åˆ†ç±»è¦ä¿æŒé«˜äº®

ï¼ˆ1ï¼‰æ·»åŠ æ ·å¼

```diff
  .menu {
    li {
      padding-left: 40px;
      height: 50px;
      line-height: 50px;
+      &:hover,&.active {
        background: @xtxColor;
      }
```

ï¼ˆ2ï¼‰æ§åˆ¶é«˜äº®çš„ç±»å

```diff
   <ul class="menu">
+      <li :class="{active:categoryId===item.id}"
```

ï¼ˆ3ï¼‰é¼ æ ‡ç¦»å¼€ï¼Œç§»é™¤æ ·å¼

```diff
+  <div class="home-category" @mouseleave="categoryId = ''">
    <ul class="menu">
```

## éª¨æ¶ç»„ä»¶-åŸºæœ¬ä½¿ç”¨

> ä¸ºäº†åœ¨åŠ è½½çš„è¿‡ç¨‹ä¸­ç­‰å¾…æ•ˆæœæ›´å¥½ï¼Œå°è£…ä¸€ä¸ªéª¨æ¶å±ç»„ä»¶ã€‚

å¤§è‡´æ­¥éª¤ï¼š

- éœ€è¦ä¸€ä¸ªç»„ä»¶ï¼Œåšå ä½ä½¿ç”¨ã€‚è¿™ä¸ªå ä½ç»„ä»¶æœ‰ä¸ªä¸“ä¸šæœ¯è¯­ï¼šéª¨æ¶å±ç»„ä»¶ã€‚
  - æš´éœ²ä¸€äº›å±æ€§ï¼šé«˜ï¼Œå®½ï¼ŒèƒŒæ™¯ï¼Œæ˜¯å¦æœ‰é—ªåŠ¨ç”»ï¼Œæ˜¯å¦æœ‰æ·¡å…¥æ·¡å‡ºåŠ¨ç”»ã€‚
- è¿™æ˜¯ä¸€ä¸ªå…¬ç”¨ç»„ä»¶ï¼Œéœ€è¦å…¨å±€æ³¨å†Œï¼Œå°†æ¥è¿™æ ·çš„ç»„ä»¶å»ºè®®å†vueæ’ä»¶ä¸­å®šä¹‰ã€‚
- ä½¿ç”¨ç»„ä»¶å®Œæˆå·¦ä¾§åˆ†ç±»éª¨æ¶æ•ˆæœã€‚

ï¼ˆ1ï¼‰å°è£…ç»„ä»¶`src/components/skeleton/index.vue`

```vue
<script lang="ts" setup name="XtxSkeleton">
defineProps({
  bg: {
    type: String,
    default: '#efefef',
  },
  width: {
    type: Number,
    required: true,
  },
  height: {
    type: Number,
    required: true,
  },
  animated: {
    type: Boolean,
    default: false,
  },
  fade: {
    type: Boolean,
    default: false,
  },
})
</script>
<template>
  <div
    class="xtx-skeleton"
    :style="{ width: width + 'px', height: height + 'px' }"
    :class="{ shan: animated, fade: fade }"
  >
    <!-- 1 ç›’å­-->
    <div class="block" :style="{ backgroundColor: bg }"></div>
    <!-- 2 é—ªæ•ˆæœ xtx-skeleton ä¼ªå…ƒç´  --->
  </div>
</template>

<style scoped lang="less">
.xtx-skeleton {
  display: inline-block;
  position: relative;
  overflow: hidden;
  vertical-align: middle;
  .block {
    width: 100%;
    height: 100%;
    border-radius: 2px;
  }
}
.shan {
  &::after {
    content: '';
    position: absolute;
    animation: shan 1.5s ease 0s infinite;
    top: 0;
    width: 50%;
    height: 100%;
    background: linear-gradient(
      to left,
      rgba(255, 255, 255, 0) 0,
      rgba(255, 255, 255, 0.3) 50%,
      rgba(255, 255, 255, 0) 100%
    );
    transform: skewX(-45deg);
  }
}
@keyframes shan {
  0% {
    left: -100%;
  }
  100% {
    left: 120%;
  }
}

.fade {
  animation: fade 1s linear infinite alternate;
}
@keyframes fade {
  from {
    opacity: 0.2;
  }
  to {
    opacity: 1;
  }
}
</style>
```

(2) åœ¨åˆ†ç±»ç»„ä»¶ä¸­ä½¿ç”¨éª¨æ¶å±ç»„ä»¶`src/views/home/components/home-category.vue`

```vue

  <li
    v-for="item in category.categoryList"
    :key="item.id"
    @mouseenter="categoryId = item.id"
    :class="{ active: categoryId === item.id }"
  >
    <RouterLink :to="`/category/${item.id}`">{{ item.name }}</RouterLink>
    <template v-if="item.children">
      <RouterLink
        :to="`/category/sub/${sub.id}`"
        v-for="sub in item.children.slice(0, 2)"
      >
        {{ sub.name }}
      </RouterLink>
    </template>
    <template v-else>
      <XtxSkeleton
        :width="60"
        :height="18"
        style="margin-right: 5px"
        bg="rgba(255,255,255,0.2)"
        animated
      />
      <XtxSkeleton
        :width="50"
        :height="18"
        bg="rgba(255,255,255,0.2)"
        animated
      />
    </template>
  </li>
</ul>
```

## éª¨æ¶ç»„ä»¶-å…¨å±€æ³¨å†Œï¼ˆæ’ä»¶ï¼‰

> ä»»åŠ¡ç›®æ ‡ï¼šä»¥æ’ä»¶çš„å½¢å¼æ³¨å†Œå…¨å±€ç»„ä»¶

**æ ¸å¿ƒæ­¥éª¤**ï¼š

ï¼ˆ1ï¼‰æ–°å»ºæ–‡ä»¶`components/index.ts`

```typescript
// ç»Ÿä¸€çš„æ³¨å†Œæ‰€æœ‰çš„å…¨å±€ç»„ä»¶
import XtxSkeleton from '@/components/skeleton/index.vue'
import { App } from 'vue'
export default {
  install(app: App) {
    app.component('XtxSkeleton', XtxSkeleton)
  },
}
```

ï¼ˆ2ï¼‰åœ¨`main.ts`ä¸­å…¨å±€æ³¨å†Œ

```typescript
import XtxUI from './components'
const app = createApp(App)
app.use(XtxUI)
```

## éª¨æ¶ç»„ä»¶-å…¨å±€ç»„ä»¶ç±»å‹æç¤º

> vue3ä¸­å¦‚æœæ³¨å†Œçš„æ˜¯å±€éƒ¨ç»„ä»¶ï¼Œé‚£ä¹ˆpropsæ˜¯æœ‰ç±»å‹æç¤ºçš„ï¼Œä½†æ˜¯å¦‚æœæ³¨å†Œçš„æ˜¯å…¨å±€ç»„ä»¶ï¼Œpropså°±æ²¡æœ‰ç±»å‹æç¤ºäº†

å‚è€ƒ1ï¼š[How to make VSCode recognize global component in Vue?](https://stackoverflow.com/questions/69010567/how-to-make-vscode-recognize-global-component-in-vue)

å‚è€ƒ2ï¼šhttps://github.com/element-plus/element-plus/blob/dev/global.d.ts

åœ¨srcç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªæ–‡ä»¶ `global.d.ts`

```typescript
import XtxSkeleton from '@/components/skeleton/index.vue'
// å‚è€ƒï¼š
declare module 'vue' {
  export interface GlobalComponents {
    XtxSkeleton: typeof XtxSkeleton
  }
}
export {}
```

## è½®æ’­å›¾åŠŸèƒ½-è·å–æ•°æ®

> ç›®æ ‡:  åŸºäºpiniaè·å–è½®æ’­å›¾æ•°æ®

**æ ¸å¿ƒä»£ç ï¼š**

ï¼ˆ1ï¼‰åœ¨`types/data.d.ts`æ–‡ä»¶ä¸­å®šä¹‰è½®æ’­å›¾æ•°æ®çš„ç±»å‹å£°æ˜

```js
// è½®æ’­å›¾ç±»å‹
export type BannerItem = {
  hrefUrl: string
  id: string
  imgUrl: string
  type: string
}
```

ï¼ˆ2ï¼‰åœ¨`store/home.ts`æ–‡ä»¶ä¸­å°è£…æ¥å£ï¼Œç”¨äºè·å–è½®æ’­å›¾æ•°æ®

```js
import { ApiRes, BannerItem } from '@/types/data'
import request from '@/utils/request'
import { defineStore } from 'pinia'

export default defineStore('home', {
  state: () => ({
    bannerList: [] as BannerItem[],
  }),
  actions: {
    async getBannerList() {
      const res = await request.get<ApiRes<BannerItem[]>>('/home/banner')
      this.bannerList = res.data.result
    },
  },
})
```

(3)åœ¨`store/index.ts`ä¸­å¯¼å…¥

```js
import useCategoryStore from './modules/category'
import useHomeStore from './modules/home'
export default function useStore() {
  return {
    category: useCategoryStore(),
    home: useHomeStore(),
  }
}
```

ï¼ˆ4ï¼‰åœ¨ç»„ä»¶ä¸­å‘é€è¯·æ±‚`views/Home/components/home-banner.vue`

```js
<script lang="ts" setup>
import useStore from '@/store'

const { home } = useStore()
home.getBannerList()
</script>
```

ï¼ˆ4ï¼‰é€šè¿‡å¼€å‘è€…å·¥å…·æŸ¥çœ‹æ•°æ®

## è½®æ’­å›¾-é€šç”¨è½®æ’­å›¾ç»„ä»¶

é¡¹ç›®ä¸­ä¼šå¤šæ¬¡ä½¿ç”¨åˆ°è½®æ’­å›¾ç»„ä»¶ï¼Œä½†æ˜¯è½®æ’­å›¾æ¸²æŸ“çš„æ•°æ®æ˜¯ä¸ä¸€æ ·çš„ã€‚

ä½†æ˜¯è½®æ’­å›¾çš„åŸºæœ¬åŠŸèƒ½éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæ¯”å¦‚å›¾ç‰‡åˆ‡æ¢ï¼Œè‡ªåŠ¨æ’­æ”¾ç­‰ç­‰ã€‚

å› æ­¤éœ€è¦å°è£…ä¸€ä¸ªé€šç”¨çš„è½®æ’­å›¾ç»„ä»¶ã€‚

ï¼ˆ1ï¼‰é€šç”¨è½®æ’­å›¾çš„åŸºæœ¬ç»“æ„`src/components/carousel/index.vue`

fade ç±»ï¼šç”¨äºæ§åˆ¶å›¾ç‰‡çš„æ˜¾ç¤ºå’Œéšè—

active ç±»ï¼šç”¨äºæ§åˆ¶å°åœ†ç‚¹é«˜äº®

```vue
<script lang="ts" setup name="XtxCarousel">
defineProps()
</script>

<template>
  <div class="xtx-carousel">
    <ul class="carousel-body">
      <li class="carousel-item fade">
        <RouterLink to="/">
          <img
            src="http://yjy-xiaotuxian-dev.oss-cn-beijing.aliyuncs.com/picture/2021-04-15/1ba86bcc-ae71-42a3-bc3e-37b662f7f07e.jpg"
            alt=""
          />
        </RouterLink>
      </li>
      <li class="carousel-item">
        <RouterLink to="/">
          <img
            src="http://yjy-xiaotuxian-dev.oss-cn-beijing.aliyuncs.com/picture/2021-04-15/1ba86bcc-ae71-42a3-bc3e-37b662f7f07e.jpg"
            alt=""
          />
        </RouterLink>
      </li>
      <li class="carousel-item">
        <RouterLink to="/">
          <img
            src="http://yjy-xiaotuxian-dev.oss-cn-beijing.aliyuncs.com/picture/2021-04-15/1ba86bcc-ae71-42a3-bc3e-37b662f7f07e.jpg"
            alt=""
          />
        </RouterLink>
      </li>
    </ul>
    <a href="javascript:;" class="carousel-btn prev"
      ><i class="iconfont icon-angle-left"></i
    ></a>
    <a href="javascript:;" class="carousel-btn next"
      ><i class="iconfont icon-angle-right"></i
    ></a>
    <div class="carousel-indicator">
      <span class="active"></span>
      <span></span>
      <span></span>
      <span></span>
      <span></span>
    </div>
  </div>
</template>

<style scoped lang="less">
.xtx-carousel {
  width: 100%;
  height: 100%;
  min-width: 300px;
  min-height: 150px;
  position: relative;
  .carousel {
    &-body {
      width: 100%;
      height: 100%;
    }
    &-item {
      width: 100%;
      height: 100%;
      position: absolute;
      left: 0;
      top: 0;
      opacity: 0;
      transition: opacity 0.5s linear;
      &.fade {
        opacity: 1;
        z-index: 1;
      }
      img {
        width: 100%;
        height: 100%;
      }
    }
    &-indicator {
      position: absolute;
      left: 0;
      bottom: 20px;
      z-index: 2;
      width: 100%;
      text-align: center;
      span {
        display: inline-block;
        width: 12px;
        height: 12px;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 50%;
        cursor: pointer;
        ~ span {
          margin-left: 12px;
        }
        &.active {
          background: #fff;
        }
      }
    }
    &-btn {
      width: 44px;
      height: 44px;
      background: rgba(0, 0, 0, 0.2);
      color: #fff;
      border-radius: 50%;
      position: absolute;
      top: 228px;
      z-index: 2;
      text-align: center;
      line-height: 44px;
      opacity: 0;
      transition: all 0.5s;
      &.prev {
        left: 20px;
      }
      &.next {
        right: 20px;
      }
    }
  }
  &:hover {
    .carousel-btn {
      opacity: 1;
    }
  }
}
</style>
```

ï¼ˆ2ï¼‰å…¨å±€æ³¨å†Œé€šç”¨è½®æ’­å›¾ `src/components/index.ts`

```diff
import type { App } from 'vue'
import skelecton from './skeleton/index.vue'
+import carousel from './carousel/index.vue'
export default {
  install(app: App) {
    app.component(skelecton.name, skelecton)
+    app.component(carousel.name, carousel)
  },
}
```

ï¼ˆ3ï¼‰åœ¨å¹¿å‘Šç»„ä»¶ä¸­ä½¿ç”¨`src/views/home/components/home-banner.vue`

```vue
<template>
  <div class="home-banner">
    <!-- è½®æ’­å›¾ -->
    <XtxCarousel></XtxCarousel>
  </div>
</template>
```

ï¼ˆ4ï¼‰è¦†ç›–æ ·å¼ï¼Œæ§åˆ¶ç®­å¤´å’Œå°åœ†ç‚¹çš„ä½ç½®`src/views/home/components/home-banner.vue`

```less
:deep(.carousel-btn.prev) {
  left: 270px!important;
}
:deep(.carousel-indicator) {
  padding-left: 250px;
}
```

ï¼ˆ5ï¼‰æŸ¥çœ‹æ•ˆæœ

![image-20220218233450038](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/2022/05/31/image20220218233450038.png)

## è½®æ’­å›¾-æ•°æ®æ¸²æŸ“

::: tip ç›®çš„

home-bannerç»„ä»¶æŠŠæ•°æ®ä¼ é€’ç»™xtx-carouselç»„ä»¶è¿›è¡Œæ¸²æŸ“

:::

ï¼ˆ1ï¼‰çˆ¶ä¼ å­çš„æ–¹å¼å°†æ•°æ®ä¼ ç»™é€šç”¨è½®æ’­å›¾ç»„ä»¶`src/views/home/components/home-banner.vue`

```vue
<XtxCarousel :slides="home.bannerList"></XtxCarousel>
```

ï¼ˆ2ï¼‰å­ç»„ä»¶æ¥æ”¶æ•°æ®`src/components/carousel/index.vue`

> äº†è§£å†™æ³•ï¼šå¦‚æœé€šè¿‡jsçš„æ–¹æ³•å®šä¹‰ç±»å‹ï¼Œéœ€è¦å•ç‹¬å¼•å…¥PropTypeè¿›è¡Œç¼–å†™

```js
<script lang="ts" setup name="XtxCarousel">
import { BannerItem } from '@/types/data'
import { PropType } from 'vue'
// import { PropType } from 'vue'

// defineProps({
//   slides: {
//     type: Array as PropType<BannerItem[]>,
//     required: true,
//   },
// })
defineProps<{
  slides: BannerItem[]
}>()
</script>
```

ï¼ˆ3ï¼‰æ¸²æŸ“è½®æ’­å›¾æ•°æ®`src/components/carousel/index.vue`

```vue
<template>
  <div class="xtx-carousel">
    <ul class="carousel-body">
      <li class="carousel-item fade" v-for="item in slides" :key="item.id">
        <RouterLink :to="item.hrefUrl">
          <img :src="item.imgUrl" alt="" />
        </RouterLink>
      </li>
    </ul>
    <a href="javascript:;" class="carousel-btn prev">
      <i class="iconfont icon-angle-left"></i>
    </a>
    <a href="javascript:;" class="carousel-btn next">
      <i class="iconfont icon-angle-right"></i>
    </a>
    <div class="carousel-indicator">
      <span v-for="item in slides" :key="item.id" class="active"></span>
    </div>
  </div>
</template>
```

ï¼ˆ4ï¼‰æ§åˆ¶é«˜äº®çš„ä¸‹æ ‡

```js
<script lang="ts" setup name="XtxCarousel">

const active = ref(0)
</script>
```

ï¼ˆ5ï¼‰é«˜äº®æ¸²æŸ“

> 1. æ·»åŠ çš„fadeçš„å›¾ç‰‡æ‰ä¼šå±•ç¤ºï¼Œæ‰€ä»¥æ ¹æ®å½“å‰ç´¢å¼•å·è¿›è¡Œåˆ¤æ–­ï¼Œç´¢å¼•å·ç­‰äºactiveçš„æ‰è¿›è¡Œå±•ç¤º
> 2. æ·»åŠ äº†activeç±»åçš„å°åœ†ç‚¹æ‰ä¼šé«˜äº®ï¼Œé«˜äº®é€»è¾‘è·Ÿå›¾ç‰‡ä¸€è‡´

```diff
<template>
  <div class="xtx-carousel">
    <ul class="carousel-body">
      <li
        class="carousel-item"
+        :class="{ fade: active === index }"
+        v-for="(item, index) in slides"
        :key="item.id"
      >
        <RouterLink :to="item.hrefUrl">
          <img :src="item.imgUrl" alt="" />
        </RouterLink>
      </li>
    </ul>
    <a href="javascript:;" class="carousel-btn prev">
      <i class="iconfont icon-angle-left"></i>
    </a>
    <a href="javascript:;" class="carousel-btn next">
      <i class="iconfont icon-angle-right"></i>
    </a>
    <div class="carousel-indicator">
      <span
+        v-for="(item, index) in slides"
        :key="item.id"
+        :class="{ active: active === index }"
      ></span>
    </div>
  </div>
</template>
```

## è½®æ’­å›¾-é€»è¾‘å°è£…



> å®ç°éœ€æ±‚ï¼š
>
> 1. è½®æ’­å›¾é‡Œé¢çš„å›¾ç‰‡éœ€è¦ä»çˆ¶ç»„ä»¶ä¼ å…¥(å› ä¸ºè½®æ’­ç»„ä»¶å¯ä»¥å¤ç”¨)
> 2. çˆ¶ç»„ä»¶éœ€è¦æ§åˆ¶è½®æ’­å›¾çš„æ˜¯å¦è‡ªåŠ¨æ’­æ”¾ã€åŠ¨ç”»æ—¶é—´ï¼ˆå¤„ç†é»˜è®¤å€¼é€»è¾‘ï¼‰
>    * æ˜¯å¦è‡ªåŠ¨æ’­æ”¾å’ŒåŠ¨ç”»æ—¶é—´éƒ½æ˜¯éœ€è¦é»˜è®¤å€¼çš„(å¦‚æœä¸ä¼ å°±å¯ä»¥ä½¿ç”¨è½®æ’­ç»„ä»¶è‡ªå·±æä¾›çš„é»˜è®¤å€¼)
> 3. æ’­æ”¾é€»è¾‘
>    1. ç‚¹å‡»å°åœ†ç‚¹å¯ä»¥åˆ‡æ¢å›¾ç‰‡
>    2. ç‚¹å‡»prevå’ŒnextæŒ‰é’®å¯ä»¥æ’­æ”¾æŒ‡å®šå›¾ç‰‡(æ ¹æ®å›¾ç‰‡ä¸ªæ•°åˆ¤æ–­æ’­æ”¾çš„å¾ªç¯)
>    3. å¦‚æœçˆ¶ç»„ä»¶é…ç½®äº†è‡ªåŠ¨æ’­æ”¾ï¼Œåˆ™éœ€è¦å®šæ—¶æ’­æ”¾å›¾ç‰‡
>    4. é¼ æ ‡è¿›å…¥è½®æ’­å›¾ï¼Œæš‚åœè½®æ’­
>    5. é¼ æ ‡ç¦»å¼€è½®æ’­å›¾ï¼Œç»§ç»­è½®æ’­
>    6. æ³¨æ„ç‚¹ï¼šç»„ä»¶å¸è½½çš„æ—¶å€™éœ€è¦æ¸…é™¤å®šæ—¶è½®æ’­æ•ˆæœ(ä¸ç„¶ç»„ä»¶é‡æ–°åŠ è½½çš„æ—¶å€™ä¼šå¯¼è‡´å¤šä¸ªå®šæ—¶å™¨å¼€å¯)



ï¼ˆ1ï¼‰çˆ¶ç»„ä»¶ä¼ å€¼ç»™è½®æ’­å›¾`src/views/home/components/home-banner.vue`

```vue
<template>
  <div class="home-banner">
    <!-- è½®æ’­å›¾ -->
    <XtxCarousel :slides="slides" autoPlay :duration="3000"></XtxCarousel>
  </div>
</template>
```

ï¼ˆ2ï¼‰propsæ¥æ”¶`src/components/library/xtx-carousel.vue`

```js
<script lang="ts" setup name="XtxCarousel">
import { BannerItem } from '@/types/data'
import { ref, PropType } from 'vue'

defineProps({
  slides: {
    type: Array as PropType<BannerItem[]>,
    required: true,
  },
  autoPlay: {
    type: Boolean,
    default: false,
  },
  duration: {
    type: Number,
    default: 3000,
  },
})

const active = ref(0)
</script>

```

ï¼ˆ3ï¼‰è½®æ’­å›¾çš„æ’­æ”¾é€»è¾‘

```js
<script lang="ts" setup name="XtxCarousel">
import { BannerItem } from '@/types/data'
import { onMounted, onUnmounted, PropType, ref } from 'vue'
// import { PropType } from 'vue'

const props = defineProps({
  slides: {
    type: Array as PropType<BannerItem[]>,
    required: true,
  },
  duration: {
    type: Number,
    default: 3000,
  },
  autoPlay: {
    type: Boolean,
    default: false,
  },
})
// const props = defineProps<{
//   slides: BannerItem[]
// }>()

// æ§åˆ¶é«˜äº®
const active = ref(0)

const prev = () => {
  if (active.value <= 0) {
    active.value = props.slides.length - 1
  } else {
    active.value--
  }
}

const next = () => {
  if (active.value >= props.slides.length - 1) {
    active.value = 0
  } else {
    active.value++
  }
}

const play = () => {
  // å¦‚æœæ²¡æœ‰è‡ªåŠ¨æ’­æ”¾
  if (!props.autoPlay) return
  // åœ¨tsä¸­ï¼Œä½¿ç”¨å®šæ—¶å™¨ï¼Œwindow.setInterval
  timer = window.setInterval(() => {
    next()
  }, props.duration)
}
const stop = () => {
  clearInterval(timer)
}

let timer = -1
// è‡ªåŠ¨æ’­æ”¾
onMounted(() => {
  play()
})

onUnmounted(() => {
  stop()
})
</script>
```

ï¼ˆ4ï¼‰é¼ æ ‡è¿›å…¥å’Œç¦»å¼€æ“ä½œ

```js
<div class="xtx-carousel" @mouseenter="stop" @mouseleave="play">
```

ï¼ˆ5ï¼‰é¼ æ ‡ç»è¿‡å°åœ†ç‚¹åˆ‡æ¢

```vue
<span
  v-for="(item, index) in slides"
  :key="item.id"
  :class="{ active: active === index }"
  @mouseenter="active = index"
></span>
```

ï¼ˆ6ï¼‰ç‚¹å‡»å·¦å³ç®­å¤´åˆ‡æ¢

```js

const prev = () => {
  if (active.value === 0) {
    active.value = props.slides.length - 1
  } else {
    active.value--
  }
}
const next = () => {
  if (active.value === props.slides.length - 1) {
    active.value = 0
  } else {
    active.value++
  }
}

// æ³¨å†Œäº‹ä»¶
<a href="javascript:;" class="carousel-btn prev" @click="prev">
  <i class="iconfont icon-angle-left"></i>
</a>
<a href="javascript:;" class="carousel-btn next" @click="next">
  <i class="iconfont icon-angle-right"></i>
</a>
```

é¦–é¡µä¸»ä½“-æ–°é²œå¥½ç‰©å’Œäººæ°”æ¨è

## é¦–é¡µä¸»ä½“-æŸ¥çœ‹æ›´å¤šç»„ä»¶

å°è£…ä¸€ä¸ªé€šç”¨çš„æŸ¥çœ‹æ›´å¤šç»„ä»¶

> åŠŸèƒ½ï¼š
>
> 1. å¯ä»¥é…ç½®è·³è½¬è·¯å¾„
> 2. å¯ä»¥åŠ¨æ€ä¼ å…¥å±•ç¤ºçš„æ–‡å­—

ï¼ˆ1ï¼‰åˆ›å»ºç»„ä»¶`src/components/more/index.vue`

```vue
<script lang="ts" setup name="XtxMore">
import { defineProps } from 'vue'
defineProps({
  path: {
    type: String,
    default: '/',
  },
})
</script>
<template>
  <RouterLink :to="path" class="xtx-more">
    <span><slot>æŸ¥çœ‹å…¨éƒ¨</slot></span>
    <i class="iconfont icon-angle-right"></i>
  </RouterLink>
</template>

<style scoped lang="less">
.xtx-more {
  margin-bottom: 2px;
  span {
    font-size: 16px;
    vertical-align: middle;
    margin-right: 4px;
    color: #999;
  }
  i {
    font-size: 14px;
    vertical-align: middle;
    position: relative;
    top: 2px;
    color: #ccc;
  }
  &:hover {
    span,
    i {
      color: @xtxColor;
    }
  }
}
</style>
```

ï¼ˆ2ï¼‰å…¨å±€æ³¨å†Œ`src/components/index.ts`

```typescript
import type { App } from 'vue'
import XtxSkelecton from './skeleton/index.vue'
import XtxCarousel from './carousel/index.vue'
import XtxMore from './more/index.vue'
export default {
  install(app: App) {
    app.component('XtxSkelecton', XtxSkelecton)
    app.component('XtxCarousel', XtxCarousel)
    app.component('XtxMore', XtxMore)
  },
}
```

ï¼ˆ3ï¼‰å®šä¹‰å…¨å±€ç»„ä»¶ç±»å‹`global.d.ts`

```typescript
import XtxSkeleton from '@/components/skeleton/index.vue'
import XtxCarousel from '@/components/carousel/index.vue'
import XtxMore from '@/components/more/index.vue'
declare module 'vue' {
  export interface GlobalComponents {
    XtxSkeleton: typeof XtxSkeleton
    XtxCarousel: typeof XtxCarousel
    XtxMore: typeof XtxMore
  }
}
export {}
```

ï¼ˆ4ï¼‰æŸ¥çœ‹æ•ˆæœ

```vue
<XtxMore>æŸ¥çœ‹æ›´å¤š</XtxMore>
```

:::tip å°æŠ€å·§

1. å­ç»„ä»¶å¦‚æœåªæœ‰ä¸€ä¸ªæ ¹æ ‡ç­¾ï¼Œçˆ¶ç»„ä»¶ä¼ é€’è¿‡å»çš„æ•°æ®ä¼šèƒ½å¤Ÿç©¿é€
2. å¦‚æœå­ç»„ä»¶é€šè¿‡definePropså®šä¹‰çš„æ•°æ®ä¸ä¼šå‡ºç°åœ¨æ ‡ç­¾çš„èº«ä¸Š

:::

## é¦–é¡µä¸»ä½“-é¢æ¿ç»„ä»¶å°è£… 

> æ–°é²œå¥½ç‰©ã€äººæ°”æ¨èä¿©ä¸ªæ¨¡å—çš„å¸ƒå±€ç»“æ„ä¸Šéå¸¸ç±»ä¼¼ï¼Œæˆ‘ä»¬å¯ä»¥æŠ½ç¦»å‡ºä¸€ä¸ªé€šç”¨çš„é¢æ¿ç»„ä»¶æ¥è¿›è¡Œå¤ç”¨
>
> ç›®æ ‡ï¼šå°è£…ä¸€ä¸ªé€šç”¨çš„é¢æ¿ç»„ä»¶

![](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/2022/05/31/panel.png)

**æ€è·¯åˆ†æ**

1. å›¾ä¸­æ ‡å‡ºçš„å››ä¸ªéƒ¨åˆ†éƒ½æ˜¯å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–çš„ï¼Œéœ€è¦æˆ‘ä»¬å®šä¹‰ä¸ºå¯é…ç½®
2. ä¸»æ ‡é¢˜å’Œå‰¯æ ‡é¢˜ç”±äºæ˜¯çº¯æ–‡æœ¬ï¼Œæˆ‘ä»¬å®šä¹‰æˆpropså³å¯
3. å³ä¾§å†…å®¹å’Œä¸»ä½“å†…å®¹ç”±äºå¯èƒ½ä¼šä¼ å…¥è¾ƒä¸ºå¤æ‚çš„è‡ªå®šä¹‰æ¨¡æ¿ï¼Œæˆ‘ä»¬å®šä¹‰æˆslotåˆ©ç”¨æ’æ§½æ¸²æŸ“

**æ ¸å¿ƒä»£ç **

ï¼ˆ1ï¼‰ç»„ä»¶ç¼–å†™

`Home/components/home-panel.vue`

```html
<script lang="ts" setup name="HomePanel"></script>
<template>
  <div class="home-panel">
    <div class="container">
      <div class="head">
        <h3>æ–°é²œå¥½ç‰©<small>æ–°é²œå‡ºç‚‰ å“è´¨é è°±</small></h3>
        <XtxMore to="/"></XtxMore>
      </div>
      é¢æ¿çš„å†…å®¹
    </div>
  </div>
</template>

<style scoped lang="less">
.home-panel {
  background-color: #fff;
  .head {
    padding: 40px 0;
    display: flex;
    align-items: flex-end;
    h3 {
      flex: 1;
      font-size: 32px;
      font-weight: normal;
      margin-left: 6px;
      height: 35px;
      line-height: 35px;
      small {
        font-size: 16px;
        color: #999;
        margin-left: 20px;
      }
    }
  }
}
</style>
```

ï¼ˆ2ï¼‰propså¤„ç†`src/views/home/components/home-panel.vue`

æ ‡é¢˜å’Œå­æ ‡é¢˜åº”è¯¥æœ‰çˆ¶ç»„ä»¶ä¼ é€’è¿›æ¥ï¼Œä¸èƒ½å†™æ­»

```typescript
<script lang="ts" setup name="HomePanel">
defineProps({
  title: {
    type: String,
    required: true,
  },
  subTitle: {
    type: String,
    required: true,
  },
})
</script>
```

ï¼ˆ3ï¼‰çˆ¶ç»„ä»¶ä¼ å…¥titleå’ŒsubTitle

```vue
<script lang="ts">
import HomePanel from './components/home-panel.vue'
</script>

<!-- æ–°é²œå¥½ç‰© -->
<HomePanel title="æ–°é²œå¥½ç‰©" subTitle="æ–°é²œå‡ºç‚‰ å“è´¨é è°±"></HomePanel>
```

ï¼ˆ4ï¼‰æ’æ§½å¤„ç†ï¼Œå³ä¾§çš„æŸ¥çœ‹å…¨éƒ¨å’Œé¢æ¿å…·ä½“çš„å†…å®¹ä¸åº”è¯¥å†™æ­»`src/views/home/components/home-panel.vue`

```diff
<template>
  <div class="home-panel">
    <div class="container">
      <div class="head">
        <h3>
          {{ title }}<small>{{ subTitle }}</small>
        </h3>
+        <!-- å…·åæ’æ§½ -->
+        <slot name="right"></slot>
      </div>
+      <!-- é»˜è®¤çš„å†…å®¹æ’æ§½ -->
+      <slot></slot>
    </div>
  </div>
</template>
```

ï¼ˆ5ï¼‰çˆ¶ç»„ä»¶ä¿®æ”¹

```vue
<!-- æ–°é²œå¥½ç‰© -->
<HomePanel title="æ–°é²œå¥½ç‰©" subTitle="æ–°é²œå‡ºç‚‰ å“è´¨é è°±">
  <template #right>
    <XtxMore to="/"></XtxMore>
  </template>
  <div>æˆ‘æ˜¯å†…å®¹</div>
</HomePanel>
```

## é¦–é¡µä¸»ä½“-æ–°é²œå¥½ç‰©

> æ–°é²œå¥½ç‰©çš„é€»è¾‘ä¸åœ¨homeç»„ä»¶ä¸­æä¾›ï¼Œå› æ­¤æˆ‘ä»¬å°è£…ä¸€ä¸ªæ–°é²œå¥½ç‰©çš„ç»„ä»¶ï¼Œç”¨äºå¤„ç†æ–°é²œå¥½ç‰©æ¨¡å—
>
> ç›®æ ‡ï¼šå°è£…home-newç»„ä»¶å®Œæˆæ–°é²œå¥½ç‰©çš„åŠŸèƒ½

ï¼ˆ1ï¼‰åˆ›å»ºç»„ä»¶`src/views/home/components/home-new.vue`

```vue
<script lang="ts" setup>
import HomePanel from './home-panel.vue'
</script>
<template>
  <div class="home-new">
    <HomePanel title="æ–°é²œå¥½ç‰©" sub-title="æ–°é²œå‡ºç‚‰ å“è´¨é è°±">
      <template #right><XtxMore path="/" /></template>
      <!-- é¢æ¿å†…å®¹ -->
      <ul class="goods-list">
        <li v-for="item in 4" :key="item">
          <RouterLink to="/">
            <img
              src="https://yanxuan-item.nosdn.127.net/e7337596de7161c57c27e8d8040231aa.jpg"
              alt=""
            />
            <p class="name ellipsis">æƒ…ä¾£æ¬¾æ—¶å°šæˆ·å¤–è½»å‹å¾’æ­¥é‹ç¯ä¿å¤§åº•</p>
            <p class="price">&yen;364.00</p>
          </RouterLink>
        </li>
      </ul>
    </HomePanel>
  </div>
</template>

<style scoped lang="less">
.goods-list {
  display: flex;
  justify-content: space-between;
  height: 406px;
  li {
    width: 306px;
    height: 406px;
    background: #f0f9f4;
    .hoverShadow();
    img {
      width: 306px;
      height: 306px;
    }
    p {
      font-size: 22px;
      padding: 12px 30px 0 30px;
      text-align: center;
    }
    .price {
      color: @priceColor;
    }
  }
}
</style>
```

ï¼ˆ2ï¼‰ä¿®æ”¹homeç»„ä»¶

```vue
<template>
  <div class="page-home">
    <div class="home-entry">
      <div class="container">
        <!-- å·¦ä¾§åˆ†ç±» -->
        <HomeCategory />
        <!-- bannerè½®æ’­å›¾ -->
        <HomeBanner />
      </div>
      <!-- é¢æ¿ç»„ä»¶ -->
      <HomeNew></HomeNew>
    </div>
  </div>
</template>

<script lang="ts" setup>
import HomeNew from './components/home-new.vue'
</script>
```

(3ï¼‰åœ¨`store/home.ts`æ–‡ä»¶ä¸­å°è£…è¯·æ±‚

```typescript
export interface GoodItem {
  desc: string
  id: string
  name: string
  picture: string
  price: string
}
---------------------------------------------------------------------------------------------
import { defineStore } from 'pinia'
import request from '@/utils/request'
import { BannerItem, ApiRes, GoodItem } from '@/types/data'

export default defineStore('home', {
  state() {
    return {
      bannerList: [] as BannerItem[],
      newGoodList: [] as GoodItem[],
    }
  },
  actions: {
    async getBannerList() {
      const res = await request.get<ApiRes<BannerItem[]>>('/home/banner')
      this.bannerList = res.data.result
    },
    async getNewList() {
      const res = await request.get<ApiRes<GoodItem[]>>('/home/new')
      this.newGoodList = res.data.result
    },
  },
})

```

4ï¼‰åœ¨`home-new`ç»„ä»¶ä¸­è·å–æ•°æ®å¹¶ä¸”æ¸²æŸ“

```vue
<script lang="ts" setup>
import useStore from '@/store'
import HomePanel from './home-panel.vue'
const { home } = useStore()
home.getNewList()
</script>
<template>
  <div class="home-new">
    <HomePanel title="æ–°é²œå¥½ç‰©" sub-title="æ–°é²œå‡ºç‚‰ å“è´¨é è°±">
      <template #right><XtxMore path="/" /></template>
      <!-- é¢æ¿å†…å®¹ -->
      <ul class="goods-list">
        <li v-for="item in home.newGoodList" :key="item.id">
          <RouterLink to="/">
            <img :src="item.picture" alt="" />
            <p class="name ellipsis">{{ item.name }}</p>
            <p class="price">&yen;{{ item.price }}</p>
          </RouterLink>
        </li>
      </ul>
    </HomePanel>
  </div>
</template>
```

## é¦–é¡µä¸»ä½“-äººæ°”æ¨è

> äººæ°”æ¨èçš„é€»è¾‘å’Œæ–°é²œå¥½ç‰©çš„é€»è¾‘åŸºæœ¬ä¸€è‡´

ï¼ˆ1ï¼‰å‘é€è¯·æ±‚ï¼Œè·å–æ•°æ®`src/store/home.ts`

```typescript
export interface HotGoods {
  id: string
  picture: string
  title: string
  alt: string
}



import { defineStore } from 'pinia'
import request from '@/utils/request'
import { ApiRes, CategoryList, BannerList, GoodItem, HotGoods } from '@/types/data'
const useHomeStore = defineStore('home', {
  state: () => ({
    hotGoodList: [] as HotGoods[]
  }),
  actions: {
    async getHotList() {
      const res = await request.get<ApiRes<HotGoods[]>>('/home/hot')
      this.hotGoodList = res.data.result
    }
  }
})

export default useHomeStore
```

ï¼ˆ2ï¼‰åˆ›å»ºç»„ä»¶`src/views/home/components/home-hot.vue`

```vue
<script lang="ts" setup>
import useStore from '@/store'
import HomePanel from './home-panel.vue'
const { home } = useStore()
home.getHotList()
</script>
<template>
  <HomePanel title="äººæ°”æ¨è" sub-title="äººæ°”çˆ†æ¬¾ ä¸å®¹é”™è¿‡">
    <ul ref="pannel" class="goods-list">
      <li v-for="item in home.hotGoodList" :key="item.id">
        <RouterLink to="/">
          <img :src="item.picture" alt="" />
          <p class="name">{{ item.title }}</p>
          <p class="desc">{{ item.alt }}</p>
        </RouterLink>
      </li>
    </ul>
  </HomePanel>
</template>

<style scoped lang="less">
.goods-list {
  display: flex;
  justify-content: space-between;
  height: 426px;
  li {
    width: 306px;
    height: 406px;
    .hoverShadow();
    img {
      width: 306px;
      height: 306px;
    }
    p {
      font-size: 22px;
      padding-top: 12px;
      text-align: center;
    }
    .desc {
      color: #999;
      font-size: 18px;
    }
  }
}
</style>
```

ï¼ˆ3ï¼‰é¦–é¡µä¸­æ¸²æŸ“`src/views/home/index.vue`

```vue
<script lang="ts" setup>
import HomeBanner from './components/home-banner.vue'
import HomeCategory from './components/home-category.vue'
import HomeNew from './components/home-new.vue'
import HomeHot from './components/home-hot.vue'
</script>

<template>
  <div class="page-home">
    <div class="home-entry">
      <div class="container">
        <!-- å·¦ä¾§åˆ†ç±» -->
        <HomeCategory />
        <!-- bannerè½®æ’­å›¾ -->
        <HomeBanner />
      </div>
      <!-- æ–°é²œå¥½ç‰© -->
      <HomeNew></HomeNew>
      <!-- äººæ°”æ¨è -->
      <HomeHot></HomeHot>
    </div>
  </div>
</template>

<style lang="less" scoped></style>
```



## å›¾ç‰‡æ‡’åŠ è½½-ä»‹ç»

> ç›®æ ‡ï¼šäº†è§£å¦‚ä½•å®ç°æ•°æ®æ‡’åŠ è½½

ç”µå•†ç±»ç½‘ç«™ï¼Œå›¾ç‰‡ä¼šéå¸¸çš„å¤šï¼Œè€Œå¦‚æœä¸€ä¸Šæ¥å°±åŠ è½½æ‰€æœ‰çš„å›¾ç‰‡ï¼Œä¼šå¯¼è‡´ç½‘é¡µåŠ è½½å¾ˆæ…¢ã€‚

å›¾ç‰‡æ‡’åŠ è½½ï¼šç­‰å›¾ç‰‡æ­£å¼è¿›å…¥åˆ°å¯è§†åŒºä¸­æ—¶ï¼Œæ‰åŠ è½½å¯¹åº”çš„å›¾ç‰‡ï¼Œå¦åˆ™ä¸è¯·æ±‚å›¾ç‰‡

:::danger é—®é¢˜

å¦‚ä½•çŸ¥é“å›¾ç‰‡è¿›å…¥æˆ–è€…ç¦»å¼€äº†å¯è§†åŒºï¼Ÿ

1. é€šè¿‡vueuseå°è£…çš„[useIntersectionObserver](https://vueuse.org/core/useIntersectionObserver/)

:::

**æ ¸å¿ƒä»£ç ï¼š**

ï¼ˆ1ï¼‰[useIntersectionObserver](https://vueuse.org/core/useIntersectionObserver/)çš„åŸºæœ¬ä½¿ç”¨

```vue
<script lang="ts" setup>
import { useIntersectionObserver } from '@vueuse/core'
import { ref } from 'vue'
const target = ref<HTMLImageElement | null>(null)
// stopåœæ­¢ç›‘å¬
const { stop } = useIntersectionObserver(target, ([{ isIntersecting }]) => {
  console.log('æ‰§è¡Œäº†')
  console.log(isIntersecting)

  if (isIntersecting) {
    target.value!.src =
      'https://yanxuan-item.nosdn.127.net/79f289a4e975fd030d5c37b98b9282c5.jpg'
    stop()
  }
})
</script>

<template>
  <div style="height: 3000px"></div>
  <img ref="target" alt="" />
</template>

<style scoed lang="less"></style>
```

## å›¾ç‰‡æ‡’åŠ è½½-å°è£…è‡ªå®šä¹‰æŒ‡ä»¤

> ç›®æ ‡ï¼šè‡ªå·±å°è£…æŒ‡ä»¤ v-lazyï¼Œå®ç°å›¾ç‰‡æ‡’åŠ è½½ 

æ–°å»º `directives/index.ts`

**æ ¸å¿ƒä»£ç **

```typescript
import { App } from 'vue'
import Skeleton from './Skeleton/index.vue'
import Slider from './Slider/index.vue'
import More from './More/index.vue'
import { useIntersectionObserver } from '@vueuse/core'
import defaultImg from '@/assets/images/200.png'
export default {
  install(app: App) {
    // å…¨å±€æ³¨å†Œç»„ä»¶
    app.component('XtxSkeleton', Skeleton)
    app.component('XtxSlider', Slider)
    app.component('XtxMore', More)

    // è‡ªå®šä¹‰æŒ‡ä»¤
    // <img :src="item.src" alt="" />
    // <img v-lazy="item.src" alt="" />
    app.directive('lazy', {
      mounted(el: HTMLImageElement, { value }) {
        // å›¾ç‰‡çš„æ‡’åŠ è½½é€»è¾‘
        // å‚æ•°1ï¼šå›è°ƒå‡½æ•°
        // å‚æ•°2ï¼šå¯é€‰çš„é…ç½®
        const { stop } = useIntersectionObserver(el, ([{ isIntersecting }]) => {
          if (isIntersecting) {
            // åœæ­¢ç›‘å¬
            stop()
            // ç»™elå…ƒç´ è®¾ç½®srcå±æ€§
            // value = '123.jpg'
            el.src = value
            // å¦‚æœå›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œæ˜¾ç¤ºé»˜è®¤çš„å›¾ç‰‡
            el.onerror = function () {
              el.src =  defaultImg
            }
          }
        })
      }
    })
  }
}
```

## ç»„ä»¶æ•°æ®æ‡’åŠ è½½-åŸºæœ¬ä½¿ç”¨

> ç›®æ ‡ï¼šé€šè¿‡useIntersectionObserverä¼˜åŒ–æ–°é²œå¥½ç‰©å’Œäººæ°”æ¨èæ¨¡å—

ç”µå•†ç±»ç½‘ç«™ï¼Œå°¤å…¶æ˜¯é¦–é¡µï¼Œå†…å®¹æœ‰å¥½å‡ å±ï¼Œè€Œå¦‚æœä¸€ä¸Šæ¥å°±åŠ è½½æ‰€æœ‰å±çš„æ•°æ®ï¼Œå¹¶æ¸²æŸ“æ‰€æœ‰å±çš„å†…å®¹ä¼šå¯¼è‡´é¦–é¡µåŠ è½½å¾ˆæ…¢ã€‚

æ•°æ®æ‡’åŠ è½½ï¼šç­‰ç»„ä»¶æ­£å¼è¿›å…¥åˆ°å¯è§†åŒºä¸­æ—¶ï¼Œæ‰æŠŠç»„ä»¶å†…éƒ¨çš„ajaxè¯·æ±‚å‘èµ·ï¼Œå¦åˆ™ä¸è¯·æ±‚æ•°æ®

ï¼ˆ1ï¼‰ä¼˜åŒ–æ–°é²œå¥½ç‰©

```vue
<script lang="ts" setup>
const { home } = useStore()
const target = ref(null)
const { stop } = useIntersectionObserver(target, ([{ isIntersecting }]) => {
  console.log(isIntersecting)
  if (isIntersecting) {
    home.getNewList()
    stop()
  }
})
</script>

<template>
  <div class="home-new">
    <HomePanel ref="target" title="æ–°é²œå¥½ç‰©" sub-title="æ–°é²œå‡ºç‚‰ å“è´¨é è°±">
    </HomePanel>
  </div>
</template>
```

ï¼ˆ2ï¼‰ä¼˜åŒ–äººæ°”æ¨è

```vue
<script lang="ts" setup>

const target = ref(null)
const { stop } = useIntersectionObserver(target, ([{ isIntersecting }]) => {
  console.log(isIntersecting)
  if (isIntersecting) {
    home.getHotList()
    stop()
  }
})
</script>
<template>
  <HomePanel ref="target" title="äººæ°”æ¨è" sub-title="äººæ°”çˆ†æ¬¾ ä¸å®¹é”™è¿‡">

  </HomePanel>
</template>


```

:::tip ç»™refæ·»åŠ ç»„ä»¶ç±»å‹

å‚è€ƒé“¾æ¥:[https://staging-cn.vuejs.org/guide/typescript/composition-api.html#typing-component-template-refs](https://staging-cn.vuejs.org/guide/typescript/composition-api.html#typing-component-template-refs)

```vue
<!-- App.vue -->
<script setup lang="ts">
import MyModal from './MyModal.vue'

const modal = ref<InstanceType<typeof MyModal> | null>(null)

const openModal = () => {
  modal.value?.open()
}
</script>
```



:::

## ç»„ä»¶æ•°æ®æ‡’åŠ è½½-å°è£…

> ç›®æ ‡ï¼šå°è£…ç»„ä»¶æ•°æ®æ‡’åŠ è½½å¯å¤ç”¨çš„é€»è¾‘

:::tip åˆ†æ

é¦–é¡µä¸­ï¼Œå¾ˆå¤šåœ°æ–¹éƒ½åº”è¯¥ä½¿ç”¨ç»„ä»¶æ•°æ®æ‡’åŠ è½½è¿™ä¸ªåŠŸèƒ½ï¼Œä¸ç®¡æ˜¯å“ªä¸ªæ¨¡å—ä½¿ç”¨ï¼Œä¸‹é¢ä»£ç éƒ½ä¼šé‡å¤ä¹¦å†™

äº‹å®ä¸Šï¼Œå”¯ä¸€å¯èƒ½ä¼šéšç€ä¸šåŠ¡ä½¿ç”¨å‘ç”Ÿå˜åŒ–çš„æ˜¯ ajaxæ¥å£çš„è°ƒç”¨

å…¶ä½™çš„éƒ¨åˆ†æˆ‘ä»¬è¿›è¡Œé‡å¤ä½¿ç”¨ï¼ŒæŠ½ç¦»ä¸ºå¯å¤ç”¨é€»è¾‘

:::

**æ ¸å¿ƒä»£ç ï¼š**

ï¼ˆ1ï¼‰å°è£…é€šç”¨çš„æ‡’åŠ è½½æ•°æ®api `src/utils/hooks.ts`

```javascript
// è‡ªå®šä¹‰ä¸€äº›é€šç”¨çš„compositions api
import { useIntersectionObserver } from '@vueuse/core'
import { ref } from 'vue'

// å°è£…é€šç”¨çš„æ•°æ®æ‡’åŠ è½½api
export function useLazyData(apiFn: () => void) {
  // é€šè¿‡ ref è·å¾—ç»„ä»¶å®ä¾‹
  const target = ref(null)
  const { stop } = useIntersectionObserver(
    // target æ˜¯è§‚å¯Ÿçš„ç›®æ ‡domå®¹å™¨ï¼Œå¿…é¡»æ˜¯domå®¹å™¨ï¼Œè€Œä¸”æ˜¯vue3.0æ–¹å¼ç»‘å®šçš„domå¯¹è±¡
    target,
    // isIntersecting æ˜¯å¦è¿›å…¥å¯è§†åŒºåŸŸï¼Œtrueæ˜¯è¿›å…¥ falseæ˜¯ç§»å‡º
    // observerElement è¢«è§‚å¯Ÿçš„dom
    ([{ isIntersecting }]) => {
      // åœ¨æ­¤å¤„å¯æ ¹æ®isIntersectingæ¥åˆ¤æ–­ï¼Œç„¶ååšä¸šåŠ¡
      if (isIntersecting) {
        stop()
        apiFn()
      }
    }
  )
  return target
}
```

ï¼ˆ2ï¼‰ä¼˜åŒ–æ–°é²œå¥½ç‰©

```vue
<script lang="ts" setup>
const target = useLazyData(() => {
  home.getNewList()
})
</script>
<template>
  <div class="home-new">
    <HomePanel ref="target" title="æ–°é²œå¥½ç‰©" sub-title="æ–°é²œå‡ºç‚‰ å“è´¨é è°±">
    </HomePanel>
  </div>
</template>
```

ï¼ˆ3ï¼‰ä¼˜åŒ–äººæ°”æ¨è

```javascript
<script lang="ts" setup>
const target = useLazyData(() => {
  home.getHotList()
})
</script>
<template>
  <HomePanel ref="target" title="äººæ°”æ¨è" sub-title="äººæ°”çˆ†æ¬¾ ä¸å®¹é”™è¿‡">
  </HomePanel>
</template>
```



:::tip æ‹“å±•å°çŸ¥è¯†ï¼šè‡ªå®šä¹‰lazyhookçš„ç±»å‹ä¼˜åŒ–

```ts
export function useLazyApi(apiFn: () => void) {
  const target = ref<MaybeElementRef | null>(null)
  const {stop} = useIntersectionObserver(target, ([{isIntersecting}]) => {
    if (isIntersecting) {
      stop()
      apiFn()
    }
  })
  return target
}
```

æ·»åŠ äº†refç±»å‹æç¤ºï¼šMaybeElementRef -> æš´éœ²å‡ºå»çš„tagetå¦‚æœèµ‹å€¼ç±»å‹ä¸å¯¹ä¼šè¿›è¡Œæç¤º

<img src="https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20220605205543577.png" alt="image-20220605205543577" style="zoom:50%;" />



çœ‹ä¸€ä¸‹MaybeElementRefåˆ°åº•æ˜¯ä»€ä¹ˆç±»å‹ï¼Ÿ

```ts
declare type MaybeElementRef<T extends MaybeElement = MaybeElement> = MaybeRef<T>;
declare type MaybeElement = HTMLElement | SVGElement | VueInstance | undefined | null;
declare type MaybeRef<T> = T | Ref<T>;
```



æ€»ç»“ï¼šMaybeElementRefç±»å‹çš„ç±»å‹ä¸ºï¼š

* MaybeElementçš„Refç±»å‹
* æˆ–è€…ç›´æ¥ä¸ºMayBeElementç±»å‹

:::

## éª¨æ¶å±ä¼˜åŒ–

:::warning

ç»„ä»¶æ•°æ®æ‡’åŠ è½½æ˜¯è¿›å…¥åˆ°å¯è§†åŒºæ‰å¼€å§‹åŠ è½½æ•°æ®ï¼Œå¦‚æœç”¨æˆ·æ»šåŠ¨è¿‡å¿«ï¼Œæ•°æ®è¿˜æ²¡åŠ è½½å›æ¥ï¼Œä¼šæœ‰ç™½å±çš„æ•ˆæœï¼Œå› æ­¤éœ€è¦ä½¿ç”¨éª¨æ¶å±ç»„ä»¶è¿›è¡Œä¼˜åŒ–

:::

ï¼ˆ1ï¼‰æ–°é²œå¥½ç‰©-éª¨æ¶å±çš„ä½¿ç”¨

> ç”¨æ³•ï¼šå¦‚æœå•†å“åˆ—è¡¨çš„lengthä¸º0ï¼Œåˆ™å±•ç¤ºéª¨æ¶å±ï¼Œå¦åˆ™å±•ç¤ºå…·ä½“å•†å“

```vue
<script lang="ts" setup>
import useStore from '@/store'
import HomePanel from './home-panel.vue'
const { home } = useStore()
home.getNewList()
</script>
<template>
  <div class="home-new">
    <HomePanel title="æ–°é²œå¥½ç‰©" sub-title="æ–°é²œå‡ºç‚‰ å“è´¨é è°±">
      <template #right><XtxMore path="/" /></template>
      <!-- é¢æ¿å†…å®¹ -->
      <ul class="goods-list" v-if="home.newGoodList.length > 0">
        // ...
      </ul>
      <div class="home-skeleton" v-else>
        <div
          class="item"
          v-for="i in 4"
          :key="i"
          :style="{ backgroundColor: '#f0f9f4' }"
        >
          <XtxSkeleton bg="#e4e4e4" :width="306" :height="306" />
          <XtxSkeleton bg="#e4e4e4" :width="160" :height="24" />
          <XtxSkeleton bg="#e4e4e4" :width="120" :height="24" />
        </div>
      </div>
    </HomePanel>
  </div>
</template>

<style scoped lang="less">

.home-skeleton {
  width: 1240px;
  height: 406px;
  display: flex;
  justify-content: space-between;
  .item {
    width: 306px;
    .xtx-skeleton ~ .xtx-skeleton {
      display: block;
      margin: 16px auto 0;
    }
  }
}
</style>
```

ï¼ˆ2ï¼‰äººæ°”æ¨è-éª¨æ¶å±çš„ä½¿ç”¨

```vue
<script lang="ts" setup>
import useStore from '@/store'
import HomePanel from './home-panel.vue'
const { home } = useStore()
home.getHotList()
</script>
<template>
  <HomePanel title="äººæ°”æ¨è" sub-title="äººæ°”çˆ†æ¬¾ ä¸å®¹é”™è¿‡">
    <ul ref="pannel" class="goods-list" v-if="home.hotGoodList.length > 0">
      // ...
    </ul>
    <div class="home-skeleton" v-else>
      <div
        class="item"
        v-for="i in 4"
        :key="i"
        :style="{ backgroundColor: '#f0f9f4' }"
      >
        <XtxSkeleton bg="#e4e4e4" :width="306" :height="306" />
        <XtxSkeleton bg="#e4e4e4" :width="160" :height="24" />
        <XtxSkeleton bg="#e4e4e4" :width="120" :height="24" />
      </div>
    </div>
  </HomePanel>
</template>

<style scoped lang="less">

.home-skeleton {
  width: 1240px;
  height: 406px;
  display: flex;
  justify-content: space-between;
  .item {
    width: 306px;
    .xtx-skeleton ~ .xtx-skeleton {
      display: block;
      margin: 16px auto 0;
    }
  }
}
</style>
```

ï¼ˆ3ï¼‰éª¨æ¶å±å°è£…-å¯é€‰æ“ä½œ

å¾ˆæ˜æ˜¾ï¼Œä¸¤ä¸ªç»„ä»¶ä¸­çš„éª¨æ¶å±éƒ¨åˆ†åŠŸèƒ½é‡å¤äº†ï¼Œå› æ­¤å¯ä»¥å°è£…ä¸€ä¸ªhome-skeletonç»„ä»¶, åŒå­¦ä»¬æœ‰å…´è¶£å¯ä»¥å°è£…ä¸€ä¸‹

```javascript
<template>
  <div class="home-skeleton">
    <div
      class="item"
      v-for="i in 4"
      :key="i"
      :style="{ backgroundColor: '#f0f9f4' }"
    >
      <XtxSkeleton bg="#e4e4e4" :width="306" :height="306" />
      <XtxSkeleton bg="#e4e4e4" :width="160" :height="24" />
      <XtxSkeleton bg="#e4e4e4" :width="120" :height="24" />
    </div>
  </div>
</template>
<script lang="ts" setup></script>
<style scoped lang="less">
.home-skeleton {
  width: 1240px;
  height: 406px;
  display: flex;
  justify-content: space-between;
  .item {
    width: 306px;
    .xtx-skeleton ~ .xtx-skeleton {
      display: block;
      margin: 16px auto 0;
    }
  }
}
</style>
```

## vueåŠ¨ç”»-åŸºæœ¬ä»‹ç»

> çŸ¥é“vueä¸­å¦‚ä½•ä½¿ç”¨åŠ¨ç”»ï¼ŒçŸ¥é“Transitionç»„ä»¶ä½¿ç”¨ã€‚

å½“vueä¸­ï¼Œæ˜¾ç¤ºéšè—ï¼Œåˆ›å»ºç§»é™¤ï¼Œä¸€ä¸ªå…ƒç´ æˆ–è€…ä¸€ä¸ªç»„ä»¶çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡transitionå®ç°åŠ¨ç”»ã€‚

vue2çš„åŠ¨ç”»ç±»å

![image-20220220100841157](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/2022/05/31/image20220220100841157.png)

vue3çš„åŠ¨ç”»ç±»å‹

![image-20220220100855095](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/2022/05/31/image20220220100855095.png)

- è¿›å…¥ï¼ˆæ˜¾ç¤ºï¼Œåˆ›å»ºï¼‰
  - v-enter-from è¿›å…¥å‰
  - v-enter-active è¿›å…¥ä¸­
  - v-enter-to è¿›å…¥å
- ç¦»å¼€ï¼ˆéšè—ï¼Œç§»é™¤ï¼‰
  - v-leave-from è¿›å…¥å‰
  - v-leave-active è¿›å…¥ä¸­
  - v-leave-to è¿›å…¥å

å¤šä¸ªtransitionä½¿ç”¨ä¸åŒåŠ¨ç”»ï¼Œå¯ä»¥æ·»åŠ namå±æ€§ï¼Œnameå±æ€§çš„å€¼æ›¿æ¢vå³å¯ã€‚

## vueåŠ¨ç”»-æ·»åŠ åŠ¨ç”»æ•ˆæœ

> å®Œæˆäººæ°”æ¨èå’Œæ–°é²œå¥½ç‰©

ï¼ˆ1ï¼‰å®šä¹‰åŠ¨æ€æ•ˆæœ`src/assets/styles/common.less`

```less
// ç¦»å¼€æ·¡å‡ºåŠ¨ç”»
.fade {
  &-leave-from {
    opacity: 1;
  }
  &-leave-active {
    position: absolute;
    width: 100%;
    transition: opacity 0.5s 0.2s;
    z-index: 1;
  }
  &-leave-to {
    opacity: 0;
  }
}
```

(2)åœ¨ `home-hot` `home-new` ç»„ä»¶åˆ†åˆ«ä½¿ç”¨

```diff
<template>
  <div class="home-new">
    <HomePanel title="æ–°é²œå¥½ç‰©" sub-title="æ–°é²œå‡ºç‚‰ å“è´¨é è°±">
      <template #right><XtxMore path="/"/></template>
+      <Transition name="fade">
        <!-- é¢æ¿å†…å®¹ -->
        <ul class="goods-list" v-if="goods.length > 0">
          <li v-for="item in goods" :key="item.id">
            <RouterLink to="/">
              <img :src="item.picture" alt="" />
              <p class="name ellipsis">{{ item.name }}</p>
              <p class="price">&yen;{{ item.price }}</p>
            </RouterLink>
          </li>
        </ul>
        <HomeSkeleton v-else></HomeSkeleton>
+      </Transition>
    </HomePanel>
  </div>
</template>

<template>
  <HomePanel title="äººæ°”æ¨è" sub-title="äººæ°”çˆ†æ¬¾ ä¸å®¹é”™è¿‡">
+    <Transition name="fade">
      <ul ref="pannel" class="goods-list" v-if="goods.length > 0">
        <li v-for="item in goods" :key="item.id">
          <RouterLink to="/">
            <img :src="item.picture" alt="" />
            <p class="name">{{ item.title }}</p>
            <p class="desc">{{ item.alt }}</p>
          </RouterLink>
        </li>
      </ul>
      <HomeSkeleton v-else></HomeSkeleton>
+    </Transition>
  </HomePanel>
</template>
```

[vueåŠ¨ç”»ä»‹ç»æ–‡æ¡£](https://staging-cn.vuejs.org/guide/built-ins/transition.html)

## çƒ­é—¨å“ç‰Œ

> å®ç°å“ç‰Œçš„å±•ç¤ºï¼Œå’Œåˆ‡æ¢å“ç‰Œæ•ˆæœã€‚

ï¼ˆ1ï¼‰åˆ›å»ºç»„ä»¶`src/views/home/components/home-brand.vue`

```vue
<script lang="ts" setup name="HomeBrand">
import HomePanel from './home-panel.vue'
</script>

<template>
  <HomePanel title="çƒ­é—¨å“ç‰Œ" sub-title="å›½é™…ç»å…¸ å“è´¨ä¿è¯">
    <template v-slot:right>
      <a href="javascript:;" class="iconfont icon-angle-left prev"></a>
      <a href="javascript:;" class="iconfont icon-angle-right next"></a>
    </template>
    <div class="box" ref="box">
      <ul class="list">
        <li v-for="i in 10" :key="i">
          <RouterLink to="/">
            <img
              src="http://yjy-xiaotuxian-dev.oss-cn-beijing.aliyuncs.com/picture/2021-04-22/a25d210a-cf3d-49f5-9006-5c1e7c563bb9.jpg"
              alt=""
            />
          </RouterLink>
        </li>
      </ul>
    </div>
  </HomePanel>
</template>

<style scoped lang="less">
.home-panel {
  background: #f5f5f5;
}
.iconfont {
  width: 20px;
  height: 20px;
  background: #ccc;
  color: #fff;
  display: inline-block;
  text-align: center;
  margin-left: 5px;
  background: @xtxColor;
  &::before {
    font-size: 12px;
    position: relative;
    top: -2px;
  }
  &.disabled {
    background: #ccc;
    cursor: not-allowed;
  }
}
.box {
  display: flex;
  width: 100%;
  height: 345px;
  overflow: hidden;
  padding-bottom: 40px;
  .list {
    width: 200%;
    display: flex;
    transition: all 1s;
    li {
      margin-right: 10px;
      width: 240px;
      &:nth-child(5n) {
        margin-right: 0;
      }
      img {
        width: 240px;
        height: 305px;
      }
    }
  }
}
</style>
```

ï¼ˆ2ï¼‰åœ¨homeç»„ä»¶ä¸­æ³¨å†Œå¹¶ä¸”æ¸²æŸ“ï¼š`src/views/home/index.vue`

```diff
<script lang="ts" setup name="Home">
+import HomeBrand from './components/home-brand.vue'
</script>

<template>
  <div class="page-home">
    <div class="home-entry">
      <!-- äººæ°”æ¨è -->
      <HomeHot></HomeHot>
+      <!-- çƒ­é—¨å“ç‰Œ -->
+      <HomeBrand></HomeBrand>
    </div>
  </div>
</template>

<style scoed lang="less"></style>
```

ï¼ˆ3ï¼‰å¢åŠ å“ç‰Œæ•°æ®ç±»å‹ `types/data.d.ts`

```typescript
export type Brand = {
  id: string
  name: string
  nameEn: string
  logo: string
  picture: string
  type?: any
  desc: string
  place: string
}
```

ï¼ˆ4ï¼‰åœ¨`store/modules/home.ts`ä¸­å‘é€è¯·æ±‚

```typescript
import { ApiRes, BannerList, GoodItem, Brand } from '@/types/data'
import { defineStore } from 'pinia'
import request from '@/utils/request'
const useHomeStore = defineStore('home', {
  state: () => ({
    // å“ç‰Œæ•°æ®
    brandList: [] as Brand[],
  }),
  actions: {
    async getBrandList() {
      const res = await request.get<ApiRes<Brand[]>>('/home/brand')
      console.log(res)
      this.brandList = res.data.result
    },
  },
})

export default useHomeStore
```

ï¼ˆ5ï¼‰è·å–å“ç‰Œæ•°æ®å¹¶ä¸”æ¸²æŸ“

```js
// è·å–å“ç‰Œæ•°æ® ?
// ...

// æ¸²æŸ“
<div class="box" ref="box">
  <ul class="list" >
    <li v-for="item in home.brandList" :key="item.id">
      <RouterLink to="/">
        <img :src="item.picture" alt="">
      </RouterLink>
    </li>
  </ul>
</div>
```

ï¼ˆ6ï¼‰éª¨æ¶å±æ•ˆæœ

```diff

<template>
  <HomePanel title="çƒ­é—¨å“ç‰Œ" sub-title="å›½é™…ç»å…¸ å“è´¨ä¿è¯" ref="target">
    <template v-slot:right>
      <a href="javascript:;" class="iconfont icon-angle-left prev"></a>
      <a href="javascript:;" class="iconfont icon-angle-right next"></a>
    </template>
    <div class="box" ref="box">
+      <Transition name="fade">
        <ul class="list" v-if="home.brandList.length > 0">
          <li v-for="item in home.brandList" :key="item.id">
            <RouterLink to="/">
              <img :src="item.picture" alt="" />
            </RouterLink>
          </li>
        </ul>
+        <div v-else class="skeleton">
          <XtxSkeleton
            class="item"
            v-for="i in 5"
            :key="i"
            animated
            bg="#e4e4e4"
            :width="240"
            :height="305"
          />
        </div>
+      </Transition>
    </div>
  </HomePanel>
</template>
```

æ·»åŠ æ ·å¼

```scss
.skeleton {
  width: 100%;
  display: flex;
  .item {
    margin-right: 10px;
    &:nth-child(5n) {
      margin-right: 0;
    }
  }
}
```

## çƒ­é—¨å“ç‰Œ-å·¦å³åˆ‡æ¢æ•ˆæœ

> ç›®æ ‡ï¼šå®Œæˆå·¦å³åˆ‡æ¢æ•ˆæœ

- æ•°æ®å¤„ç†

```js
<script lang="ts" setup name="HomeBrand">
const index = ref(0)
</script>

```

- æ¸²æŸ“

```diff
    <template v-slot:right>
      <a
        href="javascript:;"
+        :class="{ disabled: index === 0 }"
        class="iconfont icon-angle-left prev"
+        @click="index = 0"
      ></a>
      <a
+       :class="{ disabled: index === 1 }"
        href="javascript:;"
        class="iconfont icon-angle-right next"
+        @click="index = 1"
      ></a>
    </template>
    <div class="box" ref="box">
      <Transition name="fade">
        <ul
          class="list"
          v-if="brands.length > 0"
+          :style="{ transform: `translateX(${-index * 1240}px)` }"
        >
          <li v-for="item in brands" :key="item.id">
            <RouterLink to="/">
              <img :src="item.picture" alt="" />
            </RouterLink>
          </li>
        </ul>
        <div v-else class="skeleton">
          <XtxSkeleton
            class="item"
            v-for="i in 5"
            :key="i"
            animated
            bg="#e4e4e4"
            width="240px"
            height="305px"
          />
        </div>
      </Transition>
    </div>
  </HomePanel>
```

## é¦–é¡µä¸»ä½“-å•†å“åŒºå—

> å®Œæˆå•†å“åŒºåŸŸå±•ç¤ºã€‚

ï¼ˆ1ï¼‰å‡†å¤‡å•†å“ç»„ä»¶ï¼š`src/views/home/components/home-product.vue`

```vue
<script lang="ts" setup name="HomeProduct">
import HomePanel from './home-panel.vue'
</script>
<template>
  <div class="home-product">
    <HomePanel title="ç”Ÿé²œ" sub-title="" v-for="i in 4" :key="i">
      <template v-slot:right>
        <div class="sub">
          <RouterLink to="/">æµ·é²œ</RouterLink>
          <RouterLink to="/">æ°´æœ</RouterLink>
          <RouterLink to="/">è”¬èœ</RouterLink>
          <RouterLink to="/">æ°´äº§</RouterLink>
          <RouterLink to="/">ç¦½è‚‰</RouterLink>
        </div>
        <XtxMore />
      </template>
      <div class="box">
        <RouterLink class="cover" to="/">
          <img
            src="https://yjy-oss-files.oss-cn-zhangjiakou.aliyuncs.com/tuxian/home_goods_cover.jpg"
            alt=""
          />
          <strong class="label">
            <span>ç”Ÿé²œé¦†</span>
            <span>å…¨åœº3ä»¶7æŠ˜</span>
          </strong>
        </RouterLink>
        <ul class="goods-list">
          <li v-for="i in 8" :key="i">
            <div class="goods-item">
              <RouterLink to="/" class="image">
                <img
                  src="https://yjy-oss-files.oss-cn-zhangjiakou.aliyuncs.com/tuxian/home_goods_cover.jpg"
                  alt=""
                />
              </RouterLink>
              <p class="name ellipsis-2">ç¾å¨ æ™ºåˆ©åŸå‘³ä¸‰æ–‡é±¼æ’ 240g/è¢‹ 4ç‰‡è£…</p>
              <p class="desc">æµ·é²œå¹´è´§</p>
              <p class="price">&yen;108.00</p>
              <div class="extra">
                <RouterLink to="/">
                  <span>æ‰¾ç›¸ä¼¼</span>
                  <span>å‘ç°ç°å¤šå®è´ &gt;</span>
                </RouterLink>
              </div>
            </div>
          </li>
        </ul>
      </div>
    </HomePanel>
  </div>
</template>

<style scoped lang="less">
.home-product {
  background: #fff;
  height: 2900px;
  .sub {
    margin-bottom: 2px;
    a {
      padding: 2px 12px;
      font-size: 16px;
      border-radius: 4px;
      &:hover {
        background: @xtxColor;
        color: #fff;
      }
      &:last-child {
        margin-right: 80px;
      }
    }
  }
  .box {
    display: flex;
    .cover {
      width: 240px;
      height: 610px;
      margin-right: 10px;
      position: relative;
      img {
        width: 100%;
        height: 100%;
      }
      .label {
        width: 188px;
        height: 66px;
        display: flex;
        font-size: 18px;
        color: #fff;
        line-height: 66px;
        font-weight: normal;
        position: absolute;
        left: 0;
        top: 50%;
        transform: translate3d(0, -50%, 0);
        span {
          text-align: center;
          &:first-child {
            width: 76px;
            background: rgba(0, 0, 0, 0.9);
          }
          &:last-child {
            flex: 1;
            background: rgba(0, 0, 0, 0.7);
          }
        }
      }
    }
    .goods-list {
      width: 990px;
      display: flex;
      flex-wrap: wrap;
      li {
        width: 240px;
        height: 300px;
        margin-right: 10px;
        margin-bottom: 10px;
        &:nth-last-child(-n + 4) {
          margin-bottom: 0;
        }
        &:nth-child(4n) {
          margin-right: 0;
        }
      }
    }
  }
}
.goods-item {
  width: 240px;
  height: 300px;
  padding: 10px 30px;
  position: relative;
  overflow: hidden;
  border: 1px solid transparent;
  transition: all 0.5s;
  .image {
    display: block;
    width: 160px;
    height: 160px;
    margin: 0 auto;
    img {
      width: 100%;
      height: 100%;
    }
  }
  p {
    margin-top: 6px;
    font-size: 16px;
    &.name {
      height: 44px;
    }
    &.desc {
      color: #666;
      height: 22px;
    }
    &.price {
      margin-top: 10px;
      font-size: 20px;
      color: @priceColor;
    }
  }
  .extra {
    position: absolute;
    left: 0;
    bottom: 0;
    height: 86px;
    width: 100%;
    background: @xtxColor;
    text-align: center;
    transform: translate3d(0, 100%, 0);
    transition: all 0.5s;
    span {
      display: block;
      color: #fff;
      width: 120px;
      margin: 0 auto;
      line-height: 30px;
      &:first-child {
        font-size: 18px;
        border-bottom: 1px solid #fff;
        line-height: 40px;
        margin-top: 5px;
      }
    }
  }
  &:hover {
    border-color: @xtxColor;
    .extra {
      transform: none;
    }
  }
}
</style>
```

ï¼ˆ2ï¼‰åœ¨ä¸»é¡µä¸­å¯¼å…¥å¹¶ä¸”æ¸²æŸ“ï¼š`src/views/home/index.vue`

```vue
<script lang="ts" setup name="Home">
import HomeProduct from './components/home-product.vue'
</script>

<template>
  <div class="page-home">
    <div class="home-entry">
      <!-- ... -->
      <!-- å•†å“åŒºåŸŸ -->
      <HomeProduct />
    </div>
  </div>
</template>

<style scoed lang="less"></style>
```



ï¼ˆ4ï¼‰è·å–æ•°æ®-æ–°å¢æ•°æ®ç±»å‹ `types/data.d.ts`

```js

// é¦–é¡µå•†å“æ¨è
export type HomeProduct = {
  id: string
  name: string
  picture: string
  saleInfo: string
  children: {
    id: string
    name: string
  }[]
  goods: {
    id: string
    name: string
    desc: string
    price: string
    picture: string
    discount?: any
    orderNum: number
  }[]
}


```

ï¼ˆ5ï¼‰storeä¸­å®šä¹‰æ•°æ® `store/modules/home.ts`

```typescript
const useHomeStore = defineStore('home', {
  state: () => ({
    productList: [] as HomeProduct[],
  }),
  actions: {

    async getProductList() {
      const res = await request.get<ApiRes<HomeProduct[]>>('/home/goods')
      this.productList = res.data.result
    },
  },
})
```

ï¼ˆ6ï¼‰ç»„ä»¶ä¸­å‘é€è¯·æ±‚

```typescript
<script lang="ts" setup name="HomeProduct">
import useStore from '@/store'
import { useLazyData } from '@/utils/hooks'
import HomePanel from './home-panel.vue'
const { home } = useStore()
const target = useLazyData(() => {
  console.log('åŠ è½½æ•°æ®')
  home.getProductList()
})
</script>
```

ï¼ˆ7ï¼‰æ¸²æŸ“

```jsx
<template>
  <div class="home-product" ref="target">
    <HomePanel
      :title="item.name"
      sub-title=""
      v-for="item in home.productList"
      :key="item.id"
    >
      <template v-slot:right>
        <div class="sub">
          <RouterLink to="/" v-for="sub in item.children" :key="sub.id">
            {{ sub.name }}
          </RouterLink>
        </div>
        <XtxMore />
      </template>
      <div class="box">
        <RouterLink class="cover" to="/">
          <img v-lazy="item.picture" alt="" />
          <strong class="label">
            <span>{{ item.name }}</span>
            <span>{{ item.saleInfo.slice(0, 4) }}</span>
          </strong>
        </RouterLink>
        <ul class="goods-list">
          <li v-for="goods in item.goods" :key="goods.id">
            <div class="goods-item">
              <RouterLink to="/" class="image">
                <img v-lazy="goods.picture" alt="" />
              </RouterLink>
              <p class="name ellipsis-2">{{ goods.name }}</p>
              <p class="desc ellipsis">{{ goods.desc }}</p>
              <p class="price">&yen;{{ goods.price }}</p>
              <div class="extra">
                <RouterLink to="/">
                  <span>æ‰¾ç›¸ä¼¼</span>
                  <span>å‘ç°ç°å¤šå®è´ &gt;</span>
                </RouterLink>
              </div>
            </div>
          </li>
        </ul>
      </div>
    </HomePanel>
  </div>
</template>
```

## é¦–é¡µä¸»ä½“-æ»šåŠ¨åŠ è½½å•†å“çš„bug

- äº§å“åŒºåŸŸéœ€è¦æ»šåŠ¨æ¯”è¾ƒå¤šæ‰èƒ½å»åŠ è½½æ•°æ®ã€‚
- threshold å®¹å™¨å’Œå¯è§†åŒºäº¤å‰çš„å æ¯”ï¼ˆè¿›å…¥çš„é¢ç§¯/å®¹å™¨å®Œæ•´é¢ç§¯ï¼‰ å–å€¼ï¼Œ0-1 ä¹‹é—´ï¼Œé»˜è®¤æ¯”0å¤§ï¼Œæ‰€ä»¥éœ€è¦æ»šåŠ¨è¾ƒå¤šæ‰èƒ½è§¦å‘è¿›å…¥å¯è§†åŒºåŸŸäº‹ä»¶ã€‚  é˜ˆå€¼   (è¿›å…¥çš„é¢ç§¯/å®¹å™¨å®Œæ•´é¢ç§¯)

```js
const { stop } = useIntersectionObserver(
  target,
  ([{ isIntersecting }], observerElement) => {
    if (isIntersecting) {
      stop()
      // è°ƒç”¨APIè·å–æ•°æ®
      apiFn().then(data => {
        result.value = data.result
      })
    }
  },
  {
    threshold: 0
  }
)
```

## é¦–é¡µä¸»ä½“-æœ€æ–°ä¸“é¢˜

ï¼ˆ1ï¼‰åŸºç¡€å¸ƒå±€ï¼š`src/views/home/components/home-special.vue`

```vue
<script lang="ts" setup name="HomeSpecial">
import HomePanel from './home-panel.vue'
</script>
<template>
  <HomePanel title="æœ€æ–°ä¸“é¢˜" sub-title="">
    <template v-slot:right><XtxMore /></template>
    <div class="special-list" ref="homeSpecial">
      <div class="special-item" v-for="i in 3" :key="i">
        <RouterLink to="/">
          <img
            src="https://yanxuan-item.nosdn.127.net/72e734dd1a4d35ce650afebdaa600b57.png"
            alt=""
          />
          <div class="meta">
            <p class="title">
              <span class="top ellipsis">çœ‹åˆ°æ’’å¨‡çš„æ’’å¨‡çš„å‡¯æ’’å°±</span>
              <span class="sub ellipsis">å€’è¨å€’è¨å€’è¨</span>
            </p>
            <span class="price">&yen;19.99èµ·</span>
          </div>
        </RouterLink>
        <div class="foot">
          <span class="like"><i class="iconfont icon-hart1"></i>100</span>
          <span class="view"><i class="iconfont icon-see"></i>100</span>
          <span class="reply"><i class="iconfont icon-message"></i>100</span>
        </div>
      </div>
    </div>
  </HomePanel>
</template>

<style scoped lang="less">
.home-panel {
  background: #f5f5f5;
}
.special-list {
  height: 380px;
  padding-bottom: 20px;
  display: flex;
  justify-content: space-between;
  .special-item {
    width: 404px;
    background: #fff;
    .hoverShadow();
    a {
      display: block;
      width: 100%;
      height: 288px;
      position: relative;
      img {
        width: 100%;
        height: 100%;
      }
      .meta {
        background-image: linear-gradient(
          to top,
          rgba(0, 0, 0, 0.8),
          transparent 50%
        );
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 288px;
        .title {
          position: absolute;
          bottom: 0px;
          left: 0;
          padding-left: 16px;
          width: 70%;
          height: 70px;
          .top {
            color: #fff;
            font-size: 22px;
            display: block;
          }
          .sub {
            display: block;
            font-size: 19px;
            color: #999;
          }
        }
        .price {
          position: absolute;
          bottom: 25px;
          right: 16px;
          line-height: 1;
          padding: 4px 8px 4px 7px;
          color: @priceColor;
          font-size: 17px;
          background-color: #fff;
          border-radius: 2px;
        }
      }
    }
    .foot {
      height: 72px;
      line-height: 72px;
      padding: 0 20px;
      font-size: 16px;

      i {
        display: inline-block;
        width: 15px;
        height: 14px;
        margin-right: 5px;
        color: #999;
      }
      .like,
      .view {
        float: left;
        margin-right: 25px;
        vertical-align: middle;
      }
      .reply {
        float: right;
        vertical-align: middle;
      }
    }
  }
}
</style>

```

ï¼ˆ2ï¼‰ä¸»é¡µæ¸²æŸ“ï¼Œä½¿ç”¨ç»„ä»¶ï¼š`src/views/home/index.vue`

```vue
<script lang="ts" setup name="Home">
import HomeSpecial from './components/home-special.vue'
</script>

<template>
  <div class="page-home">
    <div class="home-entry">
      <!-- æœ€æ–°ä¸“é¢˜ -->
      <HomeSpecial />
    </div>
  </div>
</template>

<style scoed lang="less"></style>

```

ï¼ˆ3ï¼‰æŒ‡å®šä¸“é¢˜ç±»å‹

```js

export type Special = {
  creator: string
  isDelete: number
  createTime: string
  updateTime: string
  id: string
  classificationId: string
  title: string
  summary: string
  lowestPrice: number
  cover: string
  detailsUrl: string
  collectNum: number
  viewNum: number
  replyNum: number
}
```

ï¼ˆ4ï¼‰æŒ‡å®šä¸“é¢˜æ•°æ®stateå’Œaction

```typescript
import { ApiRes, BannerList, GoodItem, Brand, HomeProduct } from '@/types/data'
import { defineStore } from 'pinia'
import request from '@/utils/request'
const useHomeStore = defineStore('home', {
  state: () => ({
    specialList: [] as Special[],
  }),
  actions: {
    async getSpecialList() {
      const res = await request.get<ApiRes<Special[]>>('/home/special')
      this.specialList = res.data.result
    },
  },
})

export default useHomeStore
```

ï¼ˆ5ï¼‰å‘é€è¯·æ±‚è·å–æ•°æ®

```js
<script lang="ts" setup name="HomeSpecial">
import useStore from '@/store'
import { useLazyData } from '@/utils/hooks'
import HomePanel from './home-panel.vue'
const { home } = useStore()
const target = useLazyData(() => {
  home.getSpecialList()
})
</script>
```

ï¼ˆ6ï¼‰åŠ¨æ€æ¸²æŸ“

```vue
<template>
  <HomePanel title="æœ€æ–°ä¸“é¢˜" sub-title="" ref="target">
    <template v-slot:right><XtxMore /></template>
    <div class="special-list" ref="homeSpecial">
      <div class="special-item" v-for="item in home.specialList" :key="item.id">
        <RouterLink to="/">
          <img :src="item.cover" alt="" />
          <div class="meta">
            <p class="title">
              <span class="top ellipsis">{{ item.title }}</span>
              <span class="sub ellipsis">{{ item.summary }}</span>
            </p>
            <span class="price">&yen;{{ item.lowestPrice }}èµ·</span>
          </div>
        </RouterLink>
        <div class="foot">
          <span class="like">
            <i class="iconfont icon-hart1"></i>{{ item.collectNum }}
          </span>
          <span class="view">
            <i class="iconfont icon-see"></i>{{ item.viewNum }}
          </span>
          <span class="reply">
            <i class="iconfont icon-message"></i>{{ item.replyNum }}
          </span>
        </div>
      </div>
    </div>
  </HomePanel>
</template>
```
