# ğŸ“š 8. å•†å“è¯¦æƒ…

## è·¯ç”±é…ç½®

> ç›®æ ‡ï¼šå®Œæˆå•†å“è¯¦æƒ…çš„åŸºç¡€å¸ƒå±€å’Œè·¯ç”±é…ç½®

<img src="https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/2022/05/31/01.png" style="zoom:48%;" />

(1)æ–°å»ºé¡µé¢ç»„ä»¶

`src/views/goods/index.vue`

```vue
<script lang="ts" setup></script>
<template>
  <div class="xtx-goods-page">
    <div class="container">
      <!-- é¢åŒ…å±‘ -->
      <XtxBread>
        <XtxBreadItem to="/">é¦–é¡µ</XtxBreadItem>
        <XtxBreadItem to="/">æ‰‹æœº</XtxBreadItem>
        <XtxBreadItem to="/">åä¸º</XtxBreadItem>
        <XtxBreadItem to="/">p30</XtxBreadItem>
      </XtxBread>
      <!-- å•†å“ä¿¡æ¯ -->
      <div class="goods-info"></div>
      <!-- å•†å“è¯¦æƒ… -->
      <div class="goods-footer">
        <div class="goods-article">
          <!-- å•†å“+è¯„ä»· -->
          <div class="goods-tabs"></div>
        </div>
        <!-- 24çƒ­æ¦œ+ä¸“é¢˜æ¨è -->
        <div class="goods-aside"></div>
      </div>
    </div>
  </div>
</template>

<style scoped lang="less">
.goods-info {
  min-height: 600px;
  background: #fff;
}
.goods-footer {
  display: flex;
  margin-top: 20px;
  .goods-article {
    width: 940px;
    margin-right: 20px;
  }
  .goods-aside {
    width: 280px;
    min-height: 1000px;
  }
}
.goods-tabs {
  min-height: 600px;
  background: #fff;
}
.goods-warn {
  min-height: 600px;
  background: #fff;
  margin-top: 20px;
}
</style>
```

ï¼ˆ2ï¼‰è·¯ç”±é…ç½®

`src/router/index.js`

```js
routes: [
  {
    path: '/',
    component: Layout,
    children: [
      {
        path: '',
        component: () => import('@/views/home/index.vue'),
      },
      {
        path: '/category/:id',
        component: () => import('@/views/category/index.vue'),
      },
      {
        path: '/category/sub/:id',
        component: () => import('@/views/category/sub.vue'),
      },
      {
        path: '/goods/:id',
        component: () => import('@/views/goods/index.vue'),
      },
    ],
  },
  {
    path: '/login',
    component: () => import('@/views/Login/index.vue'),
  },
],
```

ï¼ˆ3ï¼‰ä¿®æ”¹è·³è½¬è·¯å¾„ `category/components/goods-item.vue`

```vue
<template>
  <RouterLink :to="`/goods/${goods.id}`" class="goods-item">
    <img v-lazy="goods.picture" alt="" />
    <p class="name ellipsis">{{ goods.name }}</p>
    <p class="desc ellipsis">{{ goods.desc }}</p>
    <p class="price">&yen;{{ goods.price }}</p>
  </RouterLink>
</template>
```

## æ¸²æŸ“é¢åŒ…å±‘

> ç›®æ ‡ï¼šä½¿ç”¨çœŸå®æ•°æ®æ¸²æŸ“é¢åŒ…å±‘å¯¼èˆª

![](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/2022/05/31/03.png)

**å®ç°æ­¥éª¤**

1. è·å–å•†å“è¯¦æƒ…æ•°æ®
2. æ ¹æ®å•†å“è¯¦æƒ…æ•°æ®æ¸²æŸ“

**ä»£ç è½åœ°**

ï¼ˆ1ï¼‰åœ¨`types/data.d.ts`ä¸­å®šä¹‰å•†å“çš„æ•°æ®ç±»å‹

```js
// å•†å“æ¨¡å—çš„ç±»å‹å£°æ˜
export type GoodsInfo = {
  id: string
  name: string
  spuCode: string
  desc: string
  price: string
  oldPrice: string
  discount: number
  inventory: number
  salesCount: number
  commentCount: number
  collectCount: number
  mainVideos: any[]
  videoScale: number
  mainPictures: string[]
  isPreSale: boolean
  isCollect?: any
  recommends?: any
  userAddresses?: any
  evaluationInfo?: any
  categories: {
    id: string
    name: string
  }[]
}
```

ï¼ˆ2ï¼‰æ–°å»ºæ–‡ä»¶`store/good.ts`  

```js
import { ApiRes } from '@/types/data'
import { GoodsInfo } from '@/types/data'
import request from '@/utils/request'
import { defineStore } from 'pinia'

export default defineStore('goods', {
  state: () => ({
    // å•†å“è¯¦ç»†ä¿¡æ¯
    info: {} as GoodsInfo,
  }),
  actions: {
    async getGoodsInfo(id: string) {
      const res = await request.get<ApiRes<GoodsInfo>>('/goods', {
        params: {
          id,
        },
      })
      this.info = res.data.result
    },
  },
})
```

ï¼ˆ3ï¼‰åœ¨`store/index.ts`æ–‡ä»¶ä¸­å¼•å…¥goodæ¨¡å—

```typescript
import useCategoryStore from './modules/category'
import useHomeStore from './modules/home'
import useGoodStore from './modules/goods'
const useStore = () => {
  return {
    category: useCategoryStore(),
    home: useHomeStore(),
    goods: useGoodStore()
  }
}

export default useStore
```

ï¼ˆ4ï¼‰åœ¨ç»„ä»¶ä¸­è·å–æ•°æ®å¹¶ä¸”æ¸²æŸ“

```vue
<script lang="ts" setup name="Goods">
import useStore from '@/store'
import { storeToRefs } from 'pinia'
import { watchEffect } from 'vue'
import { useRoute } from 'vue-router'
const { goods } = useStore()
const route = useRoute()
watchEffect(() => {
  const id = route.params.id as string
  goods.getGoodsInfo(id)
})

const { info } = storeToRefs(goods)
</script>


<template>
  <div class="xtx-goods-page">
    <div class="container">
      <!-- æ¸²æŸ“ -->
      <div v-if="info.categories">
        <!-- é¢åŒ…å±‘ -->
        <XtxBread>
          <XtxBreadItem to="/">é¦–é¡µ</XtxBreadItem>
          <XtxBreadItem :to="`/category/${info.categories[1].id}`">
            {{ info.categories[1].name }}
          </XtxBreadItem>
          <XtxBreadItem :to="`/category/sub/${info.categories[0].id}`">
            {{ info.categories[0].name }}
          </XtxBreadItem>
          <XtxBreadItem>{{ info.name }}</XtxBreadItem>
        </XtxBread>
        <!-- å•†å“ä¿¡æ¯ -->
        <div class="goods-info"></div>
        <!-- å•†å“è¯¦æƒ… -->
        <div class="goods-footer">
          <div class="goods-article">
            <!-- å•†å“+è¯„ä»· -->
            <div class="goods-tabs"></div>
          </div>
          <!-- 24çƒ­æ¦œ+ä¸“é¢˜æ¨è -->
          <div class="goods-aside"></div>
        </div>
      </div>

      <!-- å ä½çš„ -->
      <div v-else>
        <!-- é¢åŒ…å±‘ -->
        <XtxBread>
          <XtxBreadItem to="/">é¦–é¡µ</XtxBreadItem>
        </XtxBread>
        <!-- å•†å“ä¿¡æ¯ -->
        <div class="goods-info"></div>
        <!-- å•†å“è¯¦æƒ… -->
        <div class="goods-footer">
          <div class="goods-article">
            <!-- å•†å“+è¯„ä»· -->
            <div class="goods-tabs"></div>
          </div>
          <!-- 24çƒ­æ¦œ+ä¸“é¢˜æ¨è -->
          <div class="goods-aside"></div>
        </div>
      </div>
    </div>
  </div>
</template>
```

:::danger æ³¨æ„

1. ç”±äºå‘é€è¯·æ±‚éœ€è¦æ—¶é—´ï¼Œåœ¨åˆ·æ–°é¡µé¢çš„æ—¶å€™ï¼Œä¼šå‘ç°æ¸²æŸ“æŠ¥é”™ï¼Œå› ä¸ºæ•°æ®è¿˜æ²¡æœ‰è·å–åˆ°ï¼Œæ‰€ä»¥éœ€è¦åŠ v-ifè¿›è¡Œåˆ¤æ–­ï¼Œä¿è¯æ•°æ®åŠ è½½å®Œæˆåæ‰æ¸²æŸ“ã€‚
2. å½“å•†å“è¯¦æƒ…é¡µè·³è½¬åˆ°åˆ†ç±»é¡µï¼Œæˆ–è€…åˆ†ç±»é¡µè·³è½¬åˆ°å•†å“è¯¦æƒ…é¡µæ—¶ä¼šæŠ¥é”™ï¼Œæ­¤æ—¶éœ€è¦åœ¨`watchEffect`ä¸­è¿›è¡Œé¢å¤–çš„åˆ¤æ–­ã€‚

:::

## å•†å“è¯¦æƒ…-å•†å“å›¾ç‰‡-åŸºæœ¬åŠŸèƒ½

ï¼ˆ1ï¼‰æ–°å»ºç»„ä»¶`src/views/goods/components/goods-image.vue`

```vue
<script lang="ts" setup name="GoodsImage"></script>
<template>
  <div class="goods-image">
    <div class="middle">
      <img
        src="https://yanxuan-item.nosdn.127.net/4356c9fc150753775fe56b465314f1eb.png"
        alt=""
      />
    </div>
    <ul class="small">
      <li v-for="item in 5" :key="item" :class="{ active: item === 1 }">
        <img
          src="https://yanxuan-item.nosdn.127.net/4356c9fc150753775fe56b465314f1eb.png"
          alt=""
        />
      </li>
    </ul>
  </div>
</template>

<style scoped lang="less">
.goods-image {
  width: 480px;
  height: 400px;
  position: relative;
  display: flex;
  .middle {
    width: 400px;
    height: 400px;
    background: #f5f5f5;
  }
  .small {
    width: 80px;
    li {
      width: 68px;
      height: 68px;
      margin-left: 12px;
      margin-bottom: 15px;
      cursor: pointer;
      &:hover,
      &.active {
        border: 2px solid @xtxColor;
      }
    }
  }
}
</style>
```

ï¼ˆ2ï¼‰æ¸²æŸ“ç»„ä»¶å•†å“å›¾ç‰‡ç»„ä»¶`src/views/goods/index.vue`

```vue
<!-- å•†å“ä¿¡æ¯ -->
<div class="goods-info">
  <div class="media">
    <GoodsImage></GoodsImage>
  </div>
  <div class="spec"></div>
</div>


<style scoped lang="less">
.goods-info {
  min-height: 600px;
  background: #fff;
  display: flex;
  .media {
    width: 580px;
    height: 600px;
    padding: 30px 50px;
  }
  .spec {
    flex: 1;
    padding: 30px 30px 30px 0;
  }
}
</style>
```

ï¼ˆ3ï¼‰åŠŸèƒ½å®ç°`src/views/goods/index.vue`

çˆ¶ä¼ å­

```vue
<GoodsImage :images="info.mainPictures"></GoodsImage>
```

å­ç»„ä»¶æ¸²æŸ“

```vue
<script lang="ts" setup name="GoodsImage">
import { ref } from 'vue'

defineProps<{
  images: string[]
}>()
// é»˜è®¤é«˜äº®çš„ä¸‹æ ‡
const active = ref(0)
</script>
<template>
  <div class="goods-image">
    <div class="middle">
      <img :src="images[active]" alt="" />
    </div>
    <ul class="small">
      <li
        v-for="(item, index) in images"
        :key="item"
        :class="{ active: index === active }"
        @mouseenter="active = index"
      >
        <img :src="item" alt="" />
      </li>
    </ul>
  </div>
</template>
```



:::details ä¼˜åŒ–ï¼ˆå¯é€‰ï¼‰

1. é¦–é¡µæ•°æ®æ¸²æŸ“çš„æ—¶å€™ï¼Œé¢åŒ…å±‘é«˜åº¦åœ¨è¯·æ±‚æ•°æ®æœŸé—´ä¼šæ¶ˆå¤±ï¼Œå¯¼è‡´ç•Œé¢é—ªåŠ¨ä¸€ä¸‹

   è§£å†³æ–¹æ³•ï¼šå¯ä»¥å‡†å¤‡ä¸€ä¸ªå ä½ç©ºç›’å­ï¼šæ•°æ®æ²¡æ‹¿åˆ°çš„æ—¶å€™å…ˆæŠŠä½å­å ä½

   å ä½ç›’å­åˆ‡æ¢æ—¶å€™å¯ä»¥æ·»åŠ transitionåŠ¨ç”»ï¼Œè®©çœŸå®ç›’å­å‡ºç°æ›´æµç•…

:::

## æ”¾å¤§é•œæ•ˆæœ-åŸºæœ¬ç»“æ„

ï¼ˆ1ï¼‰å‡†å¤‡å¤§å›¾ç‰‡å®¹å™¨ï¼š`src/views/goods/components/goods-image.vue`

```diff
  <div class='goods-image'>
+   <div class="large" :style="[{backgroundImage:`url(${images[current]})`}]"></div>
    <div class="middle">
```

ï¼ˆ2ï¼‰æä¾›å¤§å›¾ç‰‡å®¹å™¨çš„æ ·å¼

```css{6-17}
.goods-image {
  width: 480px;
  height: 400px;
  position: relative;
  display: flex;
  z-index: 500;
  .large {
    position: absolute;
    top: 0;
    left: 412px;
    width: 400px;
    height: 400px;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
    background-repeat: no-repeat;
    background-size: 800px 800px;
    background-color: #f8f8f8;
 }
```

ï¼ˆ3ï¼‰å‡†å¤‡ç§»åŠ¨çš„é®ç½©å±‚,å·¦ä¾§ç›’å­é¼ æ ‡ç§»åŠ¨æ—¶å€™æ–¹å½¢é®ç½©

<img src="https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/image-20220612144623557.png" alt="image-20220612144623557" style="zoom:50%;" />

```diff
    <div class="middle" ref="target">
      <img :src="images[current]" alt="">
+      <div class="layer"></div>
    </div>
```

ï¼ˆ4ï¼‰ç»™é®ç½©å±‚æ·»åŠ æ ·å¼

```css{4-13}
  .middle {
    width: 400px;
    height: 400px;
    position: relative;
    cursor: move;
    .layer {
      width: 200px;
      height: 200px;
      background: rgba(0,0,0,.2);
      left: 0;
      top: 0;
      position: absolute;
    }
  }
```

## æ”¾å¤§é•œæ•ˆæœ-æ§åˆ¶æ˜¾ç¤ºéšè—

:::æç¤º

é€šè¿‡[useMouseInElement](https://vueuse.org/core/usemouseinelement/)å¯ä»¥è·å–åˆ°é¼ æ ‡ç›¸å…³çš„ä¿¡æ¯

:::

ï¼ˆ1ï¼‰ä½¿ç”¨`useMouseInElement`æˆ–è®¸é¼ æ ‡åœ¨å…ƒç´ ä¸­çš„ä¿¡æ¯

```js
<script lang="ts" setup name="GoodsImage">
import { useMouseInElement } from '@vueuse/core'
import { ref } from 'vue'

defineProps<{
  images: string[]
}>()

const current = ref(0)

const target = ref(null)
const { isOutside, elementX, elementY } = useMouseInElement(target)
</script>
```

ï¼ˆ2ï¼‰é€šè¿‡`v-show`æ¸²æŸ“

> isOutSideè¡¨ç¤ºé¼ æ ‡æ˜¯å¦å†ç›’å­å¤–é¢
>
> trueï¼šåœ¨ç›’å­å¤–é¢
>
> false: åœ¨ç›’å­é‡Œé¢

```diff
<template>
  <div class="goods-image">
    <!-- å¤§å›¾ç‰‡å®¹å™¨ -->
    <div
      class="large"
      :style="[{ backgroundImage: `url(${images[current]})` }]"
+      v-show="!isOutside"
    ></div>
    <div class="middle" ref="target">
      <img :src="images[current]" alt="" />
      <!-- é®ç½©å±‚ -->
+      <div class="layer" v-show="!isOutside"></div>
    </div>
    <ul class="small">
      <li
        v-for="(item, index) in images"
        :key="index"
        :class="{ active: index === current }"
      >
        <img :src="images[index]" @mouseenter="current = index" alt="" />
      </li>
    </ul>
  </div>
</template>
```

## æ”¾å¤§é•œæ•ˆæœ-æ§åˆ¶ç§»åŠ¨

ï¼ˆ1ï¼‰æä¾›é®ç½©å’Œå¤§å›¾ç‰‡çš„åæ ‡

> 1. positionå†…éƒ¨ä¸­è®¡ç®—çš„xæ˜¯ç›’å­çš„leftå’Œtopå€¼
> 2. elementXæ˜¯é¼ æ ‡çš„åæ ‡ï¼Œå¦‚æœè¦å¾—åˆ°ç›’å­çš„leftå’Œtop(é¼ æ ‡æ˜¯åœ¨ç›’å­ä¸­é—´çš„)ï¼Œéœ€è¦ä½¿ç”¨é¼ æ ‡åæ ‡-ç›’å­å®½åº¦çš„ä¸€åŠ



```js
<script lang="ts" setup name="GoodsImage">
import { computed, ref } from 'vue'
import { useMouseInElement } from '@vueuse/core'
defineProps<{
  images: string[]
}>()
// é»˜è®¤é«˜äº®çš„ä¸‹æ ‡
const active = ref(0)
const target = ref(null)
const { isOutside, elementX, elementY } = useMouseInElement(target)

const position = computed(() => {
  let x = elementX.value - 100
  let y = elementY.value - 100
  if (x <= 0) x = 0
  if (x >= 200) x = 200
  if (y <= 0) y = 0
  if (y >= 200) y = 200
  return {
    x,
    y,
  }
})
</script>
```

ï¼ˆ2ï¼‰æ¸²æŸ“

```diff

<template>
  <div class="goods-image">
    <div
      class="large"
      :style="[
        {
          backgroundImage: `url(${images[current]})`,
+          backgroundPosition: `${-position.x * 2}px ${-position.y * 2}px`,
        },
      ]"
+      v-show="!isOutside"
    ></div>
    <div class="middle" ref="target">
      <img :src="images[current]" alt="" />
      <div
        class="layer"
+        v-show="!isOutside"
+        :style="{ left: position.x + 'px', top: position.y + 'px' }"
      ></div>
    </div>
    <ul class="small">
      <li
        v-for="(item, index) in images"
        :key="index"
        :class="{ active: index === current }"
      >
        <img :src="images[index]" @mouseenter="current = index" alt="" />
      </li>
    </ul>
  </div>
</template>
```



## å•†å“è¯¦æƒ…-å•†å“åŸºæœ¬ä¿¡æ¯

å±•ç¤ºå•†å“åŸºæœ¬ä¿¡æ¯

![image-20220224094104000](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/2022/05/31/image20220224094104000.png)

ï¼ˆ1ï¼‰åº•éƒ¨é”€é‡ä¿¡æ¯å°è£… `src/views/goods/components/goods-sales.vue`

```vue
<script lang="ts" setup name="GoodsSales"></script>

<template>
  <ul class="goods-sales">
    <li>
      <p>é”€é‡äººæ°”</p>
      <p>200+</p>
      <p><i class="iconfont icon-task-filling"></i>é”€é‡äººæ°”</p>
    </li>
    <li>
      <p>å•†å“è¯„ä»·</p>
      <p>400+</p>
      <p><i class="iconfont icon-comment-filling"></i>æŸ¥çœ‹è¯„ä»·</p>
    </li>
    <li>
      <p>æ”¶è—äººæ°”</p>
      <p>600+</p>
      <p><i class="iconfont icon-favorite-filling"></i>æ”¶è—å•†å“</p>
    </li>
    <li>
      <p>å“ç‰Œä¿¡æ¯</p>
      <p>è‹å®ç”µå™¨</p>
      <p><i class="iconfont icon-dynamic-filling"></i>å“ç‰Œä¸»é¡µ</p>
    </li>
  </ul>
</template>

<style scoped lang="less">
.goods-sales {
  display: flex;
  width: 400px;
  align-items: center;
  text-align: center;
  height: 140px;
  li {
    flex: 1;
    position: relative;
    ~ li::after {
      position: absolute;
      top: 10px;
      left: 0;
      height: 60px;
      border-left: 1px solid #e4e4e4;
      content: '';
    }
    p {
      &:first-child {
        color: #999;
      }
      &:nth-child(2) {
        color: @priceColor;
        margin-top: 10px;
      }
      &:last-child {
        color: #666;
        margin-top: 10px;
        i {
          color: @xtxColor;
          font-size: 14px;
          margin-right: 2px;
        }
        &:hover {
          color: @xtxColor;
          cursor: pointer;
        }
      }
    }
  }
}
</style>
```

ï¼ˆ2ï¼‰å•†å“åå­—ç»„ä»¶å°è£…2 `src/views/goods/components/goods-name.vue`

```vue
<script lang="ts" setup name="GoodName"></script>
<template>
  <p class="g-name">2ä»¶è£… ç²‰é‡‰èŠ±ç“£å¿ƒæ„ç‚¹ç¼€ ç‚¹å¿ƒç›˜*2 ç¢Ÿå­ç›˜å­</p>
  <p class="g-desc">èŠ±ç“£é€ å‹å¹²å‡€ç®€çº¦ å¤šåŠŸèƒ½ä½¿ç”¨å †å æ–¹ä¾¿</p>
  <p class="g-price">
    <span>108.00</span>
    <span>199.00</span>
  </p>
  <div class="g-service">
    <dl>
      <dt>ä¿ƒé”€</dt>
      <dd>12æœˆå¥½ç‰©æ”¾é€ï¼ŒAppé¢†åˆ¸è´­ä¹°ç›´é™120å…ƒ</dd>
    </dl>
    <dl>
      <dt>é…é€</dt>
      <dd>è‡³</dd>
    </dl>
    <dl>
      <dt>æœåŠ¡</dt>
      <dd>
        <span>æ— å¿§é€€è´§</span>
        <span>å¿«é€Ÿé€€æ¬¾</span>
        <span>å…è´¹åŒ…é‚®</span>
        <a href="javascript:;">äº†è§£è¯¦æƒ…</a>
      </dd>
    </dl>
  </div>
</template>

<style lang="less" scoped>
.g-name {
  font-size: 22px;
}
.g-desc {
  color: #999;
  margin-top: 10px;
}
.g-price {
  margin-top: 10px;
  span {
    &::before {
      content: 'Â¥';
      font-size: 14px;
    }
    &:first-child {
      color: @priceColor;
      margin-right: 10px;
      font-size: 22px;
    }
    &:last-child {
      color: #999;
      text-decoration: line-through;
      font-size: 16px;
    }
  }
}
.g-service {
  background: #f5f5f5;
  width: 500px;
  padding: 20px 10px 0 10px;
  margin-top: 10px;
  dl {
    padding-bottom: 20px;
    display: flex;
    align-items: center;
    dt {
      width: 50px;
      color: #999;
    }
    dd {
      color: #666;
      &:last-child {
        span {
          margin-right: 10px;
          &::before {
            content: 'â€¢';
            color: @xtxColor;
            margin-right: 2px;
          }
        }
        a {
          color: @xtxColor;
        }
      }
    }
  }
}
</style>
```

ï¼ˆ3ï¼‰å¼•å…¥ç»„ä»¶å¹¶ä¸”æ¸²æŸ“ `src/views/goods/index.vue`

```js
import GoodsSales from './components/goods-sales.vue'
import GoodsName from './components/goods-name.vue'


<!-- å•†å“ä¿¡æ¯ -->
<div class="goods-info">
  <div class="media">
    <GoodsImage :images="info.mainPictures"></GoodsImage>
    <GoodsSales />
  </div>
  <div class="spec">
    <GoodsName :goods="info" />
  </div>
</div>
```

ï¼ˆ4ï¼‰æ¸²æŸ“æ•°æ® `src/views/goods/components/goods-name.vue`

```vue
<script lang="ts" setup name="GoodName">
import { GoodsInfo } from '@/types/goods'

defineProps<{
  goods: GoodsInfo
}>()
</script>
<template>
  <p class="g-name">{{ goods.name }}</p>
  <p class="g-desc">{{ goods.desc }}</p>
  <p class="g-price">
    <span>{{ goods.price }}</span>
    <span>{{ goods.oldPrice }}</span>
  </p>
  <div class="g-service">
    <dl>
      <dt>ä¿ƒé”€</dt>
      <dd>12æœˆå¥½ç‰©æ”¾é€ï¼ŒAppé¢†åˆ¸è´­ä¹°ç›´é™120å…ƒ</dd>
    </dl>
    <dl>
      <dt>é…é€</dt>
      <dd>è‡³</dd>
    </dl>
    <dl>
      <dt>æœåŠ¡</dt>
      <dd>
        <span>æ— å¿§é€€è´§</span>
        <span>å¿«é€Ÿé€€æ¬¾</span>
        <span>å…è´¹åŒ…é‚®</span>
        <a href="javascript:;">äº†è§£è¯¦æƒ…</a>
      </dd>
    </dl>
  </div>
</template>

<style lang="less" scoped>
.g-name {
  font-size: 22px;
}
.g-desc {
  color: #999;
  margin-top: 10px;
}
.g-price {
  margin-top: 10px;
  span {
    &::before {
      content: 'Â¥';
      font-size: 14px;
    }
    &:first-child {
      color: @priceColor;
      margin-right: 10px;
      font-size: 22px;
    }
    &:last-child {
      color: #999;
      text-decoration: line-through;
      font-size: 16px;
    }
  }
}
.g-service {
  background: #f5f5f5;
  width: 500px;
  padding: 20px 10px 0 10px;
  margin-top: 10px;
  dl {
    padding-bottom: 20px;
    display: flex;
    align-items: center;
    dt {
      width: 50px;
      color: #999;
    }
    dd {
      color: #666;
      &:last-child {
        span {
          margin-right: 10px;
          &::before {
            content: 'â€¢';
            color: @xtxColor;
            margin-right: 2px;
          }
        }
        a {
          color: @xtxColor;
        }
      }
    }
  }
}
</style>
```

## åŸå¸‚é€‰æ‹©-åŸºæœ¬åŠŸèƒ½

> èƒ½å¤Ÿå°è£…åŸå¸‚é€‰æ‹©ç»„ä»¶ï¼Œå¹¶ä¸”å®ŒæˆåŸºç¡€çš„æ˜¾ç¤ºéšè—çš„äº¤äº’åŠŸèƒ½

ï¼ˆ1ï¼‰å°è£…é€šç”¨ç»„ä»¶`src/components/city/index.vue`

```vue
<script lang="ts" setup name="XtxCity"></script>
<template>
  <div class="xtx-city">
    <div class="select">
      <span class="placeholder">è¯·é€‰æ‹©é…é€åœ°å€</span>
      <span class="value"></span>
      <i class="iconfont icon-angle-down"></i>
    </div>
    <div class="option">
      <span class="ellipsis" v-for="i in 24" :key="i">åŒ—äº¬å¸‚</span>
    </div>
  </div>
</template>

<style scoped lang="less">
.xtx-city {
  display: inline-block;
  position: relative;
  z-index: 400;
  .select {
    border: 1px solid #e4e4e4;
    height: 30px;
    padding: 0 5px;
    line-height: 28px;
    cursor: pointer;
    &.active {
      background: #fff;
    }
    .placeholder {
      color: #999;
    }
    .value {
      color: #666;
      font-size: 12px;
    }
    i {
      font-size: 12px;
      margin-left: 5px;
    }
  }
  .option {
    width: 542px;
    border: 1px solid #e4e4e4;
    position: absolute;
    left: 0;
    top: 29px;
    background: #fff;
    min-height: 30px;
    line-height: 30px;
    display: flex;
    flex-wrap: wrap;
    padding: 10px;
    > span {
      width: 130px;
      text-align: center;
      cursor: pointer;
      border-radius: 4px;
      padding: 0 3px;
      &:hover {
        background: #f5f5f5;
      }
    }
  }
}
</style>
```

å…¨å±€æ³¨å†Œ

```typescript
import XtxCity from '@/components/city/index.vue'
export default {
  install(app: App) {
    app.component('XtxCity', XtxCity)
  },
}
```

æä¾›ç±»å‹ `src/global.d.ts`

```typescript
import XtxCity from '@/components/city/index.vue'
declare module 'vue' {
    XtxCity: typeof XtxCity
  }
}
```

ï¼ˆ2ï¼‰åœ¨å•†å“è¯¦æƒ…ç»„ä»¶ä¸­æ¸²æŸ“cityç»„ä»¶ `src/views/goods/components/goods-name.vue`

```vue
<dl>
  <dt>é…é€</dt>
  <dd>è‡³ <XtxCity></XtxCity></dd>
</dl>
```

ï¼ˆ3ï¼‰æ§åˆ¶åŸå¸‚çš„æ˜¾ç¤ºå’Œéšè—

> 1. ç‚¹å‡»çš„æ—¶å€™åˆ‡æ¢çœå¸‚åŒºçš„æ ·å¼
> 2. åˆ‡æ¢åŸå¸‚å¼¹å±‚çš„æ˜¾ç¤ºæˆ–éšè—

```diff
<script lang="ts" setup name="XtxCity">
+ import { ref } from 'vue'
+const active = ref(false)
+const toggle = () => {
+  active.value = !active.value
+}
</script>


<template>
  <div class="xtx-city">
+    <div class="select" @click="toggle" :class="{ active: active }">
      <span class="placeholder">è¯·é€‰æ‹©é…é€åœ°å€</span>
      <span class="value"></span>
      <i class="iconfont icon-angle-down"></i>
    </div>
+    <div class="option" v-show="active">
      <span class="ellipsis" v-for="i in 24" :key="i">åŒ—äº¬å¸‚</span>
    </div>
  </div>
</template>
```

ï¼ˆ4ï¼‰ç‚¹å‡»å¼¹å±‚å¤–éƒ¨ï¼Œå…³é—­å¼¹å±‚



```vue{8-14}
<script lang="ts" setup>
import { ref } from 'vue'
+import { onClickOutside } from '@vueuse/core'
const active = ref(false)
const toggle = () => {
  active.value = !active.value
}
// ç‚¹å‡»å¤–é¢ï¼Œå…³é—­å¼¹çª—
const target = ref(null)
onClickOutside(target, () => {
// å‚æ•°1ï¼šç›‘å¬å“ªä¸ªå…ƒç´ ,targetæ˜¯é€šè¿‡refç»‘å®šç»™æˆ‘ä»¬ç›‘å¬ç›’å­çš„
// å‚æ•°2ï¼šç‚¹å‡»äº†è¯¥å…ƒç´ å¤–å…¶ä»–åœ°æ–¹è§¦å‘çš„å‡½æ•°
  active.value = false
})
</script>
<template>
  <div class="xtx-city" ref="target">
    <div class="select" @click="toggle" :class="{ active: active }">
      <span class="placeholder">è¯·é€‰æ‹©é…é€åœ°å€</span>
      <span class="value"></span>
      <i class="iconfont icon-angle-down"></i>
    </div>
    <div class="option" v-if="active">
      <span class="ellipsis" v-for="i in 24" :key="i">åŒ—äº¬å¸‚</span>
    </div>
  </div>
</template>
```

## åŸå¸‚é€‰æ‹©-åŠ¨æ€æ¸²æŸ“

**éœ€æ±‚ï¼šå®ŒæˆåŸå¸‚æ•°æ®çš„è·å–ä»¥åŠæ¸²æŸ“**

:::tip æ³¨æ„

åŸå¸‚æ•°æ®å¹¶ä¸æ˜¯ç›´æ¥ä»æ¥å£æœåŠ¡å™¨ä¸­è·å–çš„ï¼Œè€Œæ˜¯ä»é˜¿é‡Œäº‘æœåŠ¡å™¨ä¸Šè·å–çš„æ•°æ®ï¼Œæ‰€ä»¥ä¸èƒ½ä½¿ç”¨å°è£…å¥½çš„requestå‘é€è¯·æ±‚ï¼Œç›´æ¥ä½¿ç”¨ **åŸç”Ÿçš„axios** å‘é€è¯·æ±‚å³å¯ã€‚https://yjy-oss-files.oss-cn-zhangjiakou.aliyuncs.com/tuxian/area.json

:::



ï¼ˆ1ï¼‰å®šä¹‰æ•°æ®ç±»å‹

```ts
// åŸå¸‚åˆ—è¡¨ç±»å‹
export type AreaList = {
  code: string
  level: number
  name: string
  areaList: AreaList[]
}
```

ï¼ˆ2ï¼‰è·å–æ•°æ®`src/components/city/index.vue`

> éœ€æ±‚: ä»æ¥å£è·å–åŸå¸‚æ•°æ®ï¼Œèµ‹å€¼ç»™æœ¬åœ°æ•°æ®
>
> 1. å®šä¹‰åˆ—è¡¨æ•°æ®å˜é‡ `const cityList = ref<AreaList[]>([])`
> 2. å°è£…è°ƒæ¥å£çš„æ–¹æ³•
> 3. æ–¹æ³•å†…éƒ¨è°ƒç”¨æ¥å£ï¼ŒæŠŠè·å–åˆ°çš„ç»“æœèµ‹å€¼ç»™cityList
> 4. è°ƒç”¨æ–¹æ³•

```js{18-25}
<script lang="ts" setup name="XtxCity">
import { ref } from 'vue'
import { onClickOutside } from '@vueuse/core'
import type { AreaList } from '@/types/goods'
import axios from 'axios'
// æ§åˆ¶å¼¹å±‚çš„æ˜¾ç¤ºéšè—
const active = ref(false)
const toggle = () => {
  active.value = !active.value
}
const target = ref(null)
onClickOutside(target, (e) => {
  // console.log(e)
  // å½“ç‚¹å‡»targetå…ƒç´ çš„å¤–é¢çš„æ—¶å€™ï¼Œå°±ä¼šè§¦å‘
  active.value = false
})

const cityList = ref<AreaList[]>([])
const getCityList = async () => {
  const res = await axios.get<AreaList[]>(
    'https://yjy-oss-files.oss-cn-zhangjiakou.aliyuncs.com/tuxian/area.json'
  )
  cityList.value = res.data
}
getCityList()
</script>
```

ï¼ˆ3ï¼‰æ¸²æŸ“æ•°æ®`src/components/City/index.vue`

```html
<template>
  <div class="xtx-city" ref="target">
    <div class="select" :class="{ active: active }" @click="toggle">
      <span class="placeholder">è¯·é€‰æ‹©é…é€åœ°å€</span>
      <span class="value"></span>
      <i class="iconfont icon-angle-down"></i>
    </div>
    <div class="option" v-show="active">
      <span class="ellipsis" v-for="item in cityList" :key="item.code">
        {{ item.name }}
      </span>
    </div>
  </div>
</template>
```

## åŸå¸‚é€‰æ‹©-äº¤äº’é€»è¾‘

<img src="https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/CleanShot%202022-06-13%20at%2011.54.12.gif" alt="CleanShot 2022-06-13 at 11.54.12" style="zoom:50%;" />

:::tip éœ€æ±‚ï¼š

1. ç‚¹å‡»é€‰æ‹©çœå¸‚åŒºçš„æ—¶å€™èƒ½å¤ŸæŠŠçœå¸‚åŒºæ•°æ®å­˜å‚¨èµ·æ¥
   1. æ ¹æ®ç‚¹å‡»çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹çš„levelå†³å®šä»–åº”è¯¥å­˜å‚¨åˆ°çœ/åŸ/åŒºçš„å“ªä¸ªä¸‹é¢
   2. ç‚¹å‡»çš„æ—¶å€™ï¼Œéœ€è¦æŠŠå½“å‰å¼¹å±‚åŸå¸‚ä¿¡æ¯æ›¿æ¢ä¸ºå½“å‰ç‚¹å‡»èŠ‚ç‚¹çš„å­èŠ‚ç‚¹çš„åŸå¸‚ä¿¡æ¯ï¼ˆç‚¹å‡»çœæ˜¾ç¤ºå¸‚ï¼Œç‚¹å‡»å¸‚æ˜¾ç¤ºå¿ï¼‰
   3. å¦‚æœç‚¹å‡»çš„æ˜¯åŒºçš„èŠ‚ç‚¹ï¼Œåˆ™éœ€è¦å…³å¼¹å±‚
   4. å¦‚æœä¸­é€”ç‚¹å‡»äº†å…³é—­å¼¹å±‚ï¼Œåˆ™éœ€è¦é‡ç½®åŸå¸‚æ•°æ®

:::

> ç‚¹å‡»æŸä¸ªçœï¼Œæ˜¾ç¤ºçœä¸‹é¢çš„å¸‚ã€‚ç‚¹å‡»å¸‚ï¼Œæ˜¾ç¤ºå¸‚ä¸‹é¢çš„å¿ã€‚
>
> æ ¹æ®levelåˆ¤æ–­çº§åˆ«ã€‚

 ï¼ˆ1ï¼‰ç»™åŸå¸‚æ³¨å†Œç‚¹å‡»äº‹ä»¶

```diff
<div class="option" v-if="active">
  <span
    class="ellipsis"
    v-for="item in cityList"
    :key="item.code"
+    @click="selectCity(item)"
  >
    {{ item.name }}
  </span>
</div>
```

ï¼ˆ2ï¼‰åŸå¸‚åˆ‡æ¢é€»è¾‘

```js
// é€‰æ‹©åŸå¸‚
const changeResult = ref({
  provinceCode: '',
  provinceName: '',
  cityCode: '',
  cityName: '',
  countyCode: '',
  countyName: ''
})

const selectCity = (city: AreaList) => {
  if (city.level === 0) {
    // çœ
    changeResult.value.provinceName = city.name
    changeResult.value.provinceCode = city.code
    cityList.value = city.areaList
  }
  if (city.level === 1) {
    // å¸‚
    changeResult.value.cityName = city.name
    changeResult.value.cityCode = city.code
    cityList.value = city.areaList
  }
  if (city.level === 2) {
    // å¿ï¼ˆåŒºï¼‰
    changeResult.value.countyName = city.name
    changeResult.value.countyCode = city.code
    // å…³é—­å¼¹çª—
    active.value = false
  }
}
```

ï¼ˆ3ï¼‰å…³é—­æ—¶æ¢å¤åŸå¸‚æ•°æ®

```jsx
const cityList = ref<AreaList[]>([])
const cacheList = ref<AreaList[]>([])

function getCityData() {
  axios
    .get<AreaList[]>(
      'https://yjy-oss-files.oss-cn-zhangjiakou.aliyuncs.com/tuxian/area.json'
    )
    .then((res) => {
      cityList.value = res.data
      cacheList.value = res.data
    })
}

// ç›‘å¬å…³é—­å¼¹çª—çš„å¤„ç†ï¼Œæ¢å¤æ•°æ®
watch(active, (value) => {
  // å½“å…³é—­activeçš„æ—¶å€™ï¼Œéœ€è¦å›å¤æ•°æ®
  if (!value) {
    cityList.value = cacheList.value
  }
})
```

## åŸå¸‚é€‰æ‹©-å®Œæ•´åœ°å€å¤„ç†

:::tip éœ€æ±‚æè¿°

1. é»˜è®¤å±•ç¤ºçš„é…é€åœ°å€éœ€è¦ä»çˆ¶ç»„ä»¶ä¼ é€’è¿‡æ¥(ç™»å½•çš„ç”¨æˆ·å¯ä»¥æ‹¿åˆ°å½“å‰ç”¨æˆ·çš„é»˜è®¤é…é€åœ°å€)
2. å­ç»„ä»¶é€‰æ‹©å®Œçœå¸‚åŒºéœ€è¦ä¼ é€’ç»™çˆ¶ç»„ä»¶ï¼Œç”±çˆ¶ç»„ä»¶ç»„ç»‡æ•°æ®ä¼ ç»™å­ç»„ä»¶è¿›è¡Œå±•ç¤ºï¼ˆé»˜è®¤å±•ç¤ºé…é€åœ°å€çš„æ•°æ®æºåœ¨çˆ¶ç»„ä»¶ï¼‰

:::

> æ³¨æ„ï¼šå®Œæ•´åœ°å€éœ€è¦çˆ¶ç»„ä»¶ä¼ é€’ç»™å­ç»„ä»¶ï¼Œå°†æ¥å¦‚æœç™»å½•çš„ç”¨æˆ·ï¼Œçˆ¶ç»„ä»¶å¯ä»¥è·å–åˆ°å®Œæ•´çš„åœ°å€ã€‚

ï¼ˆ1ï¼‰çˆ¶ç»„ä»¶è®²åŸå¸‚æ•°æ®ä¼ é€’ç»™å­ç»„ä»¶

```jsx
<script lang="ts" setup>
const userAddress = ref('æ±Ÿè¥¿çœ ä¹æ±Ÿå¸‚ ä¸çŸ¥é“å¿')
</script>

 <XtxCity :userAddress="userAddress"></XtxCity></dd>
```

ï¼ˆ2ï¼‰å­ç»„ä»¶æ¥æ”¶ï¼Œå¹¶ä¸”è¿›è¡Œå±•ç¤º

> æ³¨æ„ç‚¹:å…·ä½“çš„åœ°å€å’Œè¯·é€‰æ‹©é…é€åŒæ—¶åªå±•ç¤ºä¸€ä¸ª

```jsx
defineProps<{
  userAddress?: string
}>()

<div class="select" @click="toggle" :class="{ active }">
  <span class="value" v-if="userAddress">{{ userAddress }}</span>
  <span class="placeholder" v-else>è¯·é€‰æ‹©é…é€åœ°å€</span>
  <i class="iconfont icon-angle-down"></i>
</div>
```

ï¼ˆ3ï¼‰å­ç»„ä»¶é€‰æ‹©å®ŒåŸå¸‚ï¼Œéœ€è¦å°†æ•°æ®ä¼ é€’ç»™çˆ¶ç»„ä»¶

```ts
// é€‰æ‹©çš„åŸå¸‚ç»“æœç±»å‹
export type CityResult = {
  provinceCode: string
  provinceName: string
  cityCode: string
  cityName: string
  countyCode: string
  countyName: string
}

const changeResult = ref<Partial<CityResult>>({})


const emit = defineEmits<{
  (e: 'changeCity', value: CityResult): void
}>()


const selectCity = (city: AreaList) => {
  if (city.level === 0) {
    // çœ
    changeResult.value.provinceName = city.name
    changeResult.value.provinceCode = city.code
    cityList.value = city.areaList
  }
  if (city.level === 1) {
    // å¸‚
    changeResult.value.cityName = city.name
    changeResult.value.cityCode = city.code
    cityList.value = city.areaList
  }
  if (city.level === 2) {
    // å¿ï¼ˆåŒºï¼‰
    changeResult.value.countyName = city.name
    changeResult.value.countyCode = city.code
    // å…³é—­å¼¹çª—
    active.value = false
    // å­ä¼ çˆ¶
    emit('changeCity', changeResult.value)
  }
}
```

:::details ä¼˜åŒ–ä»£ç ï¼ˆå¯é€‰ï¼‰

```js
const changeResult = ref<Partial<CityResult>>({})
// recordæ¥å—ä¸¤ä¸ªæ³›å‹å‚æ•°ï¼Œç¬¬ä¸€ä¸ªä¸ºå¯¹è±¡keyçš„ç±»å‹ï¼Œç¬¬äºŒä¸ªä¸ºå¯¹è±¡å€¼çš„ç±»å‹
const cityMap: Record<number, 'province' | 'city' | 'county'> = {
  0: 'province',
  1: 'city',
  2: 'county'
}
const selectedCity = (city: AreaList) => {
  changeResult.value[`${cityMap[city["level"]]}Name`] = city.name
  changeResult.value[`${cityMap[city["level"]]}Code`] = city.code
  if (city.level === 2) {
    setIsShowCity(false)
    emits('changeCity', changeResult.value)
  } else {
    cityList.value = city.areaList
  }
}
```



:::

ï¼ˆ4ï¼‰çˆ¶ç»„ä»¶æ¥å—æ•°æ®å¹¶ä¸”å¤„ç†

```jsx
<dl>
  <dt>é…é€</dt>
  <dd>
    è‡³
    <XtxCity
      @changeCity="changeCity"
      :fullPath="fullPath"
    ></XtxCity>
  </dd>
</dl>

const userAddress = ref('æ±Ÿè¥¿çœ ä¹æ±Ÿå¸‚ ä¸çŸ¥é“å¿')
const changeCity = (changeResult: CityResult) => {
  userAddress.value =
    changeResult.provinceName +
    ' ' +
    changeResult.cityName +
    ' ' +
    changeResult.countyName
}
```

## å•†å“è§„æ ¼-spuä¸skuçš„æ¦‚å¿µ

> äº†è§£ç”µå•†æ ¸å¿ƒæ¦‚å¿µSPUä¸SKU

å®˜æ–¹è¯æœ¯ï¼š

- SPUï¼ˆStandard Product Unitï¼‰ï¼šæ ‡å‡†åŒ–äº§å“å•å…ƒã€‚æ˜¯å•†å“ä¿¡æ¯èšåˆçš„æœ€å°å•ä½ï¼Œæ˜¯ä¸€ç»„å¯å¤ç”¨ã€æ˜“æ£€ç´¢çš„æ ‡å‡†åŒ–ä¿¡æ¯çš„é›†åˆï¼Œè¯¥é›†åˆæè¿°äº†ä¸€ä¸ªäº§å“çš„ç‰¹æ€§ã€‚é€šä¿—ç‚¹è®²ï¼Œå±æ€§å€¼ã€ç‰¹æ€§ç›¸åŒçš„å•†å“å°±å¯ä»¥ç§°ä¸ºä¸€ä¸ªSPUã€‚
- SKUï¼ˆStock Keeping Unitï¼‰åº“å­˜é‡å•ä½ï¼Œå³åº“å­˜è¿›å‡ºè®¡é‡çš„å•ä½ï¼Œ å¯ä»¥æ˜¯ä»¥ä»¶ã€ç›’ã€æ‰˜ç›˜ç­‰ä¸ºå•ä½ã€‚SKUæ˜¯ç‰©ç†ä¸Šä¸å¯åˆ†å‰²çš„æœ€å°å­˜è´§å•å…ƒã€‚åœ¨ä½¿ç”¨æ—¶è¦æ ¹æ®ä¸åŒä¸šæ€ï¼Œä¸åŒç®¡ç†æ¨¡å¼æ¥å¤„ç†ã€‚



**ä¸¾ä¸ªğŸŒ°ï¼š**


iphoneX     SPU     ä¸€ç±»å•†å“, æ ‡å‡†åŒ–äº§å“å•å…ƒé›†åˆ  

iphoneX  çº¢è‰²  64G   SKU    åº“å­˜é‡å•ä½(æœ€å°å­˜è´§å•å…ƒ)       200ä¸ª

iphoneX  è“è‰²  128G   SKU   åº“å­˜é‡å•ä½(æœ€å°å­˜è´§å•å…ƒ)      205ä¸ª

iphoneX  é»‘è‰²128G   SKU   åº“å­˜é‡å•ä½(æœ€å°å­˜è´§å•å…ƒ)        æ–­è´§




ç”»å›¾ç†è§£ï¼š

![image-20210726205210768](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/2022/05/31/image20210726205210768.png)

æ€»ç»“ä¸€ä¸‹ï¼š

- spuä»£è¡¨ä¸€ä¸ªå•†å“ï¼Œæ‹¥æœ‰å¾ˆå¤šç›¸åŒçš„å±æ€§ã€‚
- skuä»£è¡¨è¯¥å•†å“å¯é€‰è§„æ ¼çš„ä»»æ„ç»„åˆï¼Œä»–æ˜¯åº“å­˜å•ä½çš„å”¯ä¸€æ ‡è¯†ã€‚

## å•†å“è§„æ ¼-åŸºç¡€ç»“æ„å’Œæ ·å¼

> ç›®æ ‡ï¼Œå®Œæˆè§„æ ¼ç»„ä»¶çš„åŸºç¡€å¸ƒå±€ã€‚

![image-20210726205245468](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/2022/05/31/image20210726205245468.png)

ï¼ˆ1ï¼‰åˆ›å»ºç»„ä»¶ç»“æ„ `src/views/goods/components/goods-sku.vue`

```vue
<script setup lang="ts" name="GoodsSku"></script>
<template>
  <div class="goods-sku">
    <dl>
      <dt>é¢œè‰²</dt>
      <dd>
        <img
          class="selected"
          src="https://yanxuan-item.nosdn.127.net/d77c1f9347d06565a05e606bd4f949e0.png"
          alt=""
        />
        <img
          class="disabled"
          src="https://yanxuan-item.nosdn.127.net/d77c1f9347d06565a05e606bd4f949e0.png"
          alt=""
        />
      </dd>
    </dl>
    <dl>
      <dt>å°ºå¯¸</dt>
      <dd>
        <span class="disabled">10è‹±å¯¸</span>
        <span class="selected">20è‹±å¯¸</span>
        <span>30è‹±å¯¸</span>
      </dd>
    </dl>
    <dl>
      <dt>ç‰ˆæœ¬</dt>
      <dd>
        <span>ç¾ç‰ˆ</span>
        <span>æ¸¯ç‰ˆ</span>
      </dd>
    </dl>
  </div>
</template>

<style scoped lang="less">
.sku-state-mixin () {
  border: 1px solid #e4e4e4;
  margin-right: 10px;
  cursor: pointer;
  &.selected {
    border-color: @xtxColor;
  }
  &.disabled {
    opacity: 0.6;
    border-style: dashed;
    cursor: not-allowed;
  }
}
.goods-sku {
  padding-left: 10px;
  padding-top: 20px;
  dl {
    display: flex;
    padding-bottom: 20px;
    align-items: center;
    dt {
      width: 50px;
      color: #999;
    }
    dd {
      flex: 1;
      color: #666;
      > img {
        width: 50px;
        height: 50px;
        margin-top: 5px;
        .sku-state-mixin ();
      }
      > span {
        display: inline-block;
        height: 30px;
        line-height: 30px;
        padding: 0 20px;
        margin-top: 5px;
        .sku-state-mixin ();
      }
    }
  }
}
</style>

```

ï¼ˆ2ï¼‰ä½¿ç”¨ç»„ä»¶ `src/views/goods/index.vue`

```vue
import GoodsSku from './components/goods-sku.vue'

<div class="spec">
  <GoodsName :goods="info" />
  <!-- è§„æ ¼ç»„ä»¶ -->
  <GoodsSku />
</div>
```

## å•†å“è§„æ ¼-è§„æ ¼ç»„ä»¶æ¸²æŸ“

> 1369155859933827074

ï¼ˆ1ï¼‰çˆ¶ä¼ å­ `src/views/goods/index.vue`

```vue
<!-- å•†å“è§„æ ¼ -->
<GoodsSku :goods="info" />
```

ï¼ˆ2ï¼‰åŸºæœ¬æ¸²æŸ“

å¢åŠ è§„æ ¼ç±»å‹

```ts
// å•†å“çš„è§„æ ¼ç±»å‹
export type Spec = {
  name: string
  values: {
    desc: string
    name: string
    picture: string
  }[]
}
// å•†å“æ¨¡å—çš„ç±»å‹å£°æ˜
export type GoodsInfo = {
  id: string
  name: string
  spuCode: string
  desc: string
  price: string
  oldPrice: string
  discount: number
  inventory: number
  salesCount: number
  commentCount: number
  collectCount: number
  mainVideos: any[]
  videoScale: number
  mainPictures: string[]
  isPreSale: boolean
  isCollect?: any
  recommends?: any
  userAddresses?: any
  evaluationInfo?: any
  categories: {
    id: string
    name: string
  }[]
  specs: Spec[]
}
```



```vue
<script setup lang="ts" name="GoodsSku">
import { GoodsInfo } from '@/types/goods'

defineProps<{
  goods: GoodsInfo
}>()
</script>
<template>
  <div class="goods-sku">
    <dl v-for="item in goods.specs" :key="item.name">
      <dt>{{ item.name }}</dt>
      <dd>
        <template v-for="sub in item.values" :key="sub.name">
          <img v-if="sub.picture" :src="sub.picture" alt="" :title="sub.name" />
          <span v-else>{{ sub.name }}</span>
        </template>
      </dd>
    </dl>
  </div>
</template>
```

## å•†å“è§„æ ¼-é€‰ä¸­åŠŸèƒ½

ä¿®æ”¹types/goods.d.tsçš„ç±»å‹

> 1. å¢åŠ selectedå­—æ®µç”¨æ¥åˆ¤æ–­æ˜¯å¦é€‰ä¸­
> 2. ç‚¹å‡»çš„æ—¶å€™å¦‚æœå½“å‰å…ƒç´ å·²ç»è¢«é€‰ä¸­ï¼Œç›´æ¥å–æ¶ˆé€‰ä¸­å°±å¯ä»¥
> 3. å¦‚æœå½“å‰å…ƒç´ æ²¡æœ‰è¢«é€‰ä¸­ï¼Œåˆ™å…ˆæŠŠåŒçº§å…¶ä»–å…ƒç´ å–æ¶ˆé€‰ä¸­ï¼Œå†æŠŠå½“å‰å…ƒç´ é€‰ä¸­
> 4. --> é€‰ä¸­çš„æ—¶å€™éœ€è¦æŠŠitemå’ŒsubItemå…¨éƒ¨ä¼ é€’è¿‡æ¥ï¼Œè¿›è¡Œé€»è¾‘åˆ¤æ–­

```ts
// å•†å“çš„è§„æ ¼çš„å€¼çš„ç±»å‹
export type SpecValue = {
  desc: string
  name: string
  picture: string
  selected: boolean
}
// å•†å“çš„è§„æ ¼ç±»å‹
export type Spec = {
  name: string
  values: SpecValue[]
}
// å•†å“æ¨¡å—çš„ç±»å‹å£°æ˜
export type GoodsInfo = {
  id: string
  name: string
  spuCode: string
  desc: string
  price: string
  oldPrice: string
  discount: number
  inventory: number
  salesCount: number
  commentCount: number
  collectCount: number
  mainVideos: any[]
  videoScale: number
  mainPictures: string[]
  isPreSale: boolean
  isCollect?: any
  recommends?: any
  userAddresses?: any
  evaluationInfo?: any
  categories: {
    id: string
    name: string
  }[]
  specs: Spec[]
}
```

ï¼ˆ1ï¼‰æ³¨å†Œç‚¹å‡»äº‹ä»¶

```jsx
<dd>
  <template v-for="sub in item.values" :key="sub.name">
    <img
      v-if="sub.picture"
      :src="sub.picture"
      alt=""
      :title="sub.name"
      @click="changeSelected(item, sub)"
    />
    <span v-else @click="changeSelected(item, sub)">{{ sub.name }}</span>
  </template>
</dd>
```

ï¼ˆ2ï¼‰é€»è¾‘å¤„ç†

```vue
<script setup lang="ts" name="GoodsSku">
import { GoodsInfo, Spec, SpecValue } from '@/types/goods'
defineProps<{
  goods: GoodsInfo
}>()

/**
 * é€‰ä¸­è§„æ ¼
 * @param item
 * @param sub
 */
const changeSelected = (item: Spec, sub: SpecValue) => {
  if (sub.selected) {
    // å¦‚æœå·²ç»æ˜¯é€‰ä¸­äº†ï¼Œå–æ¶ˆé€‰ä¸­
    sub.selected = false
  } else {
    // æŠŠåŒçº§æ‰€æœ‰(åŒ…æ‹¬sub)çš„å…¨éƒ¨å–æ¶ˆé€‰ä¸­
    item.values.forEach((v) => (v.selected = false))
    // è®©subé€‰ä¸­
    sub.selected = true
  }
}
</script>
```

ï¼ˆ3ï¼‰æ§åˆ¶é€‰ä¸­çš„ç±»å

```vue
<template v-for="sub in item.values" :key="sub.name">
  <img
    v-if="sub.picture"
    :src="sub.picture"
    alt=""
    :title="sub.name"
    :class="{ selected: sub.selected }"
    @click="changeSelected(item, sub)"
  />
  <span
    v-else
    @click="changeSelected(item, sub)"
    :class="{ selected: sub.selected }"
    >{{ sub.name }}</span
  >
</template>
```



## å•†å“Skuç±»å‹ - åˆ†æ

æ•°æ®ä¸­çš„ Sku ä¹Ÿéœ€è¦æœ‰ ç±»å‹

```typescript
export type Sku = {
  id: string
  inventory: number
  oldPrice: string
  price: string
  skuCode: string
  specs: {
    name: string
    valueName: string
  }[]
}

// å•†å“æ¨¡å—çš„ç±»å‹å£°æ˜
export type GoodsInfo = {
  ...
  specs: Spec[]
  skus: Sku[]
}
```



## å•†å“è§„æ ¼-ç¦ç”¨æ€è·¯åˆ†æ

> æ¨èæ¼”ç¤ºå•†å“ï¼šhttp://localhost:3000/#/goods/1369155859933827074
>
> ç›®æ ‡ï¼šå¤§è‡´äº†è§£ç¦ç”¨æ•ˆæœçš„æ•´ä½“æ€è·¯ï¼Œæ³¨æ„åªæ˜¯äº†è§£ã€‚

![image-20210726221134503](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/2022/05/31/image20210726221134503.png)

å¤§è‡´æ­¥éª¤ï¼š

1. æ ¹æ®åå°è¿”å›çš„skusæ•°æ®å¾—åˆ°æœ‰æ•ˆskuç»„åˆï¼ˆè¿‡æ»¤æ‰åº“å­˜ä¸º0çš„ï¼‰
2. æ ¹æ®æœ‰æ•ˆçš„skuç»„åˆå¾—åˆ°æ‰€æœ‰çš„å­é›†é›†åˆï¼ˆå¦‚ä½•å¾—åˆ°å¹‚é›†ï¼‰
3. æ ¹æ®å­é›†é›†åˆç»„åˆæˆä¸€ä¸ªè·¯å¾„å­—å…¸ï¼Œä¹Ÿå°±æ˜¯å¯¹è±¡ã€‚
4. åœ¨ç»„ä»¶åˆå§‹åŒ–çš„æ—¶å€™å»åˆ¤æ–­æ¯ä¸ªè§„æ ¼æ˜¯å¦ç‚¹å‡»
5. åœ¨ç‚¹å‡»è§„æ ¼çš„æ—¶å€™å»åˆ¤æ–­å…¶ä»–è§„æ ¼æ˜¯å¦å¯ç‚¹å‡»
6. åˆ¤æ–­çš„ä¾æ®æ˜¯ï¼Œæ‹¿ç€è¯´æœ‰è§„æ ¼å’Œç°åœ¨å·²ç»é€‰ä¸­çš„è§„åˆ™å–æ­é…ï¼Œå¾—åˆ°å¯èµ°è·¯å¾„ã€‚
   1. å¦‚æœå¯èµ°è·¯å¾„åœ¨å­—å…¸ä¸­ï¼Œå¯ç‚¹å‡»
   2. å¦‚æœå¯èµ°è·¯å¾„ä¸åœ¨å­—å…¸ä¸­ï¼Œç¦ç”¨

## å•†å“è§„æ ¼-è·¯å¾„å­—å…¸

> ç›®çš„ï¼šæ ¹æ®åå°skusæ•°æ®å¾—åˆ°å¯èµ°è·¯å¾„å­—å…¸å¯¹è±¡

<img src="https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/CleanShot%202022-06-14%20at%2017.21.30@2x.png" alt="CleanShot 2022-06-14 at 17.21.30@2x" style="zoom:50%;" />

<img src="https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/uPic/CleanShot%202022-06-14%20at%2017.15.33@2x.png" alt="CleanShot 2022-06-14 at 17.15.33@2x" style="zoom:50%;" />

- jsç®—æ³•åº“ https://gitee.com/mirrors/javascript-algorithms?_from=gitee_search
- å¹‚é›†ç®—æ³• https://raw.githubusercontent.com/trekhleb/javascript-algorithms/master/src/algorithms/sets/power-set/bwPowerSet.js

ï¼ˆ1ï¼‰`src/utils/power-set.ts`

```js
/**
 * Find power-set of a set using BITWISE approach.
 *
 * @param {*[]} originalSet
 * @return {*[][]}
 */
export default function bwPowerSet(originalSet: any[]) {
  const subSets = []

  // We will have 2^n possible combinations (where n is a length of original set).
  // It is because for every element of original set we will decide whether to include
  // it or not (2 options for each set element).
  const numberOfCombinations = 2 ** originalSet.length

  // Each number in binary representation in a range from 0 to 2^n does exactly what we need:
  // it shows by its bits (0 or 1) whether to include related element from the set or not.
  // For example, for the set {1, 2, 3} the binary number of 0b010 would mean that we need to
  // include only "2" to the current set.
  for (
    let combinationIndex = 0;
    combinationIndex < numberOfCombinations;
    combinationIndex += 1
  ) {
    const subSet = []

    for (
      let setElementIndex = 0;
      setElementIndex < originalSet.length;
      setElementIndex += 1
    ) {
      // Decide whether we need to include current element into the subset or not.
      if (combinationIndex & (1 << setElementIndex)) {
        subSet.push(originalSet[setElementIndex])
      }
    }

    // Add current subset to the list of all subsets.
    subSets.push(subSet)
  }

  return subSets
}
```

ï¼ˆ2ï¼‰æ–°å¢skuçš„ç±»å‹

```ts
// å•†å“è§„æ ¼çš„å€¼
export type SpecValue = {
  desc: string
  name: string
  picture: string
  selected: boolean
}
// å•†å“è§„æ ¼
export type Spec = {
  name: string
  values: SpecValue[]
}

// skuçš„ç±»å‹
export type Sku = {
  id: string
  inventory: number // åº“å­˜çš„ç±»å‹
  oldPrice: string
  price: string
  skuCode: string
  specs: {
    name: string
    valueName: string
  }[]
}
// å•†å“æ¨¡å—çš„ç±»å‹å£°æ˜
export type GoodsInfo = {
  id: string
  name: string
  spuCode: string
  desc: string
  price: string
  oldPrice: string
  discount: number
  inventory: number
  salesCount: number
  commentCount: number
  collectCount: number
  mainVideos: any[]
  videoScale: number
  mainPictures: string[]
  isPreSale: boolean
  isCollect?: any
  recommends?: any
  userAddresses?: any
  evaluationInfo?: any
  categories: {
    id: string
    name: string
  }[]
  specs: Spec[]
  skus: Sku[]
}
```

ï¼ˆ3ï¼‰å¤„ç†è·¯å¾„å­—å…¸

```js

/**
 * è·å–è·¯å¾„å­—å…¸
 */
const getPathMap = () => {
  const pathMap: any = {}
  // 1. è¿‡æ»¤æ‰åº“å­˜ä¸º0çš„sku
  const skus = props.goods.skus.filter((item) => item.inventory > 0)
  // console.log(skus)
  // 2. éå†æœ‰æ•ˆçš„sku,è·å–skuçš„å¹‚é›†
  skus.forEach((item) => {
    const arr = item.specs.map((sub) => sub.valueName)
    // console.log(arr)
    // 3. è°ƒç”¨powerSetè·å–å¹‚é›†
    const powerSet = bwPowerSet(arr)
    // 4. æŠŠè¿™äº›powerSetåˆå¹¶åˆ°ä¸€ä¸ªè·¯å¾„å­—å…¸ä¸­
    powerSet.forEach((sub) => {
      const key = sub.join('â˜…')
      // 5. åˆ¤æ–­pathMapä¸­æœ‰æ²¡æœ‰key
      if (key in pathMap) {
        // 6. å­˜åœ¨
        pathMap[key].push(item.id)
      } else {
        // 7. ä¸å­˜åœ¨
        pathMap[key] = [item.id]
      }
    })
  })

  return pathMap
}

console.log(getPathMap())
```

ç»“æœç¤ºä¾‹

![image-20220222232439732](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/2022/05/31/image20220222232439732.png)

## å•†å“è§„æ ¼-é»˜è®¤ç¦ç”¨æŒ‰é’®

> æµ‹è¯•å•†å“idï¼š 1379052170040578049 å’Œ 1369155859933827074

ç›®æ ‡ï¼šåœ¨ç»„ä»¶åˆå§‹åŒ–çš„æ—¶å€™ï¼Œç‚¹å‡»è§„æ ¼çš„æ—¶å€™ï¼Œå»æ›´æ–°å…¶ä»–æŒ‰é’®çš„ç¦ç”¨çŠ¶æ€ã€‚

æ ¸å¿ƒæ€è·¯ï¼š

   éå†æ‰€æœ‰çš„è§„æ ¼æŒ‰é’®ï¼Œåˆ¤æ–­è§„æ ¼æŒ‰é’®åœ¨ `pathMap` ä¸­æ˜¯å¦å­˜åœ¨ï¼Œ å¦‚æœä¸å­˜åœ¨ï¼Œå°±è¦ç¦ç”¨

![image-20220222232708245](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/2022/05/31/image20220222232708245.png)

ï¼ˆ1ï¼‰ä¿®æ”¹typesï¼Œå¢åŠ disabledå±æ€§

```ts
// å•†å“è§„æ ¼çš„å€¼
export type SpecValue = {
  desc: string
  name: string
  picture: string
  selected: boolean
  disabled: boolean
}
```

ï¼ˆ2ï¼‰æ ¹æ®disabledå±æ€§æ§åˆ¶æŒ‰é’®æ˜¯å¦ç¦ç”¨

```vue
<img
  @click="changeSelected(sub, item)"
  v-if="sub.picture"
  :src="sub.picture"
  alt=""
  :title="sub.name"
  :class="{ selected: sub.selected, disabled: sub.disabled }"
/>
<span
  @click="changeSelected(sub, item)"
  v-else
  :class="{ selected: sub.selected, disabled: sub.disabled }"
  >{{ sub.name }}</span
>
```

ï¼ˆ3ï¼‰å°è£…æ›´æ–°æŒ‰é’®ç¦ç”¨çŠ¶æ€çš„å‡½æ•°

```ts
// æ›´æ–°æŒ‰é’®çš„ç¦ç”¨çŠ¶æ€
const updateDisabledStatus = () => {
  props.goods.specs.forEach((item) => {
    item.values.forEach((sub) => {
      if (sub.name in pathMap) {
        // å½“å‰è§„æ ¼çš„åå­—åœ¨pathMapå­˜åœ¨ï¼Œä¸ç¦ç”¨
        sub.disabled = false
      } else {
        // å½“å‰è§„æ ¼åœ¨pathMapæ‰¾ä¸åˆ°ï¼Œç¦ç”¨
        sub.disabled = true
      }
    })
  })
}
updateDisabledStatus()
```

![image-20220222233636856](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/2022/05/31/image20220222233636856.png)

ï¼ˆ4ï¼‰ç¦ç”¨çš„æ—¶å€™ä¸å…è®¸é€‰ä¸­

```diff

// ç‚¹å‡»é€‰ä¸­è§„æ ¼
// spec: è§„æ ¼
// val: è§„æ ¼çš„å€¼
const changeSelected = (spec: Spec, sub: SpecValue) => {
+  if (sub.disabled) return
  // å¢åŠ ä¸€ä¸ªselected
  if (sub.selected) {
    sub.selected = false
  } else {
    // è®©æ‰€æœ‰çš„éƒ½ä¸é€‰ä¸­
    spec.values.forEach((item) => {
      item.selected = false
    })
    // è®©è‡ªå·±é€‰ä¸­
    sub.selected = true
  }
}
```

## å•†å“è§„æ ¼-è·å–é€‰ä¸­çš„å€¼  

> é»˜è®¤è¿›æ¥çš„ç¦ç”¨å·²ç»å®Œæˆï¼Œ ä½†æ˜¯ä¸€æ—¦æˆ‘ä»¬é€‰ä¸­æŸä¸ªæŒ‰é’®äº†ï¼Œä¼šéœ€è¦é¢å¤–å†³å®šå…¶ä»–æŒ‰é’®æ˜¯å¦ç¦ç”¨ ï¼ˆä¸­å›½ï¼Œæ—¥æœ¬æ˜¯å¦ç¦ç”¨ï¼‰

![image-20220223153748059](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/2022/05/31/image20220223153748059.png)

ï¼ˆ1ï¼‰åœ¨é€‰æ‹©è§„æ ¼çš„æ—¶å€™ï¼Œéœ€è¦é‡æ–°æ›´æ–°ç¦ç”¨çŠ¶æ€

```diff
// ç‚¹å‡»é€‰ä¸­è§„æ ¼
// spec: è§„æ ¼
// val: è§„æ ¼çš„å€¼
const changeSelected = (spec: Spec, sub: SpecValue) => {
  if (sub.disabled) return
  // å¢åŠ ä¸€ä¸ªselected
  if (sub.selected) {
    sub.selected = false
  } else {
    // è®©æ‰€æœ‰çš„éƒ½ä¸é€‰ä¸­
    spec.values.forEach((item) => {
      item.selected = false
    })
    // è®©è‡ªå·±é€‰ä¸­
    sub.selected = true
  }
+  // åœ¨ç‚¹å‡»è§„æ ¼çš„æ—¶å€™ï¼Œéœ€è¦æ›´æ–°ç¦ç”¨çŠ¶æ€
+  // æ›´æ–°ç¦ç”¨çŠ¶æ€
+  updateDisabledStatus(props.goods.specs, pathMap)
}
```

 ï¼ˆ2ï¼‰**éœ€è¦å°è£…ä¸€ä¸ªæ–¹æ³•ï¼Œè·å–é€‰ä¸­çš„å€¼ï¼š**

 ä»€ä¹ˆéƒ½æ²¡é€‰ï¼š `["", "", ""]`

 é€‰ä¸­é»‘è‰²: `["é»‘è‰²", "", ""]`

 é€‰ä¸­10cm: `["", "", "10cm"]`

```typescript
// è·å–é€‰ä¸­çš„è§„æ ¼
const getSelectedSpec = () => {
  const arr: string[] = []
  props.goods.specs.forEach((item) => {
    const temp = item.values.find((sub) => sub.selected)
    arr.push(temp ? temp.name : '')
  })
  return arr
}
```

ï¼ˆ3ï¼‰ç¦ç”¨æ–¹æ³•ä¸­è°ƒç”¨è·å–é€‰ä¸­çš„å€¼

```typescript
// ç¦ç”¨æŒ‰é’®çš„æ–¹æ³•
// æŒ‰é’®æ—¶æ ¹æ®specséå†ç”Ÿæˆçš„ï¼Œå› æ­¤éœ€è¦ç»™spcesæ·»åŠ disabledå±æ€§ç”¨äºæ§åˆ¶æŒ‰é’®
const updateDisabledStatus = (specs: Spec[], pathMap: PathMap) => {
  getSelectedSpec(props.goods.specs)
  specs.forEach((spec) => {
    spec.values.forEach((v) => {
      if (v.name in pathMap) {
        // èƒ½æ‰¾åˆ°
        v.disabled = false
      } else {
        // æ‰¾ä¸åˆ°
        v.disabled = true
      }
    })
  })
}
```



## å•†å“è§„æ ¼-ç¦ç”¨åŠŸèƒ½å®Œæˆ

ï¼ˆ1ï¼‰ä¿®æ”¹ç¦ç”¨æ—¶çš„é€»è¾‘

```typescript
// æ›´æ–°å¯ç”¨ç¦ç”¨çŠ¶æ€
const updateDisabledStatus = () => {
  const selectArr = getSelectedSpec() // ['', '', 'æ—¥æœ¬']

  // æ ¹æ®è·¯å¾„å­—å…¸ => æ›´æ–°æ‰€æœ‰çš„æŒ‰é’®specValueçš„çŠ¶æ€
  props.goods.specs.forEach((spec, index) => {
    spec.values.forEach((specValue) => {
      // è®©å½“å‰è¿™ä¸ªæŒ‰é’®, specValue.name(é»‘è‰²) å’Œ selectArr è¿›è¡Œç»„åˆ
      // æ³¨æ„ï¼šè¿™è¾¹å°è¯•ç»„åˆ, åˆ¤æ–­æ˜¯å¦ç¦ç”¨æ—¶, éœ€è¦æ‹·è´ä¸€ä»½åŸæ•°ç»„
      const tempArr = [...selectArr]
      tempArr[index] = specValue.name // ['é»‘è‰²', '', 'æ—¥æœ¬']

      // å¾—åˆ°ç»„åˆåè½¬æˆå­—ç¬¦ä¸²çš„key  'é»‘è‰²+æ—¥æœ¬'
      const key = tempArr.filter((item) => item).join(SPLIT_STR)
      if (key in pathMap) {
        // å­˜åœ¨, è¯´æ˜æœ‰åº“å­˜, ä¸ç¦ç”¨
        specValue.disabled = false
      } else {
        // ä¸å­˜åœ¨, è¯´æ˜æ²¡æœ‰åº“å­˜, ç¦ç”¨
        specValue.disabled = true
      }
    })
  })
}
```

## å•†å“è§„æ ¼-ç»„ä»¶é€šè®¯-é»˜è®¤é€‰ä¸­

> ç›®çš„ï¼š1. ç»„ä»¶æ ¹æ®ä¼ å…¥çš„skuIdè¿›è¡Œæ”¯æŒé»˜è®¤é€‰ä¸­ï¼Œ
>
> â€‹     2. é€‰æ‹©è§„æ ¼åè§¦å‘changeäº‹ä»¶ä¼ å‡ºé€‰æ‹©çš„skuæ•°æ®ã€‚

å¤§è‡´æ­¥éª¤ï¼š

- æ ¹æ®ä¼ å…¥çš„SKUIDé€‰ä¸­å¯¹åº”è§„æ ¼æŒ‰é’®

è½çš„ä»£ç ï¼š

ï¼ˆ1ï¼‰çˆ¶ç»„ä»¶ä¼ å…¥skuId

```js
<GoodsSku :goods="info" skuId="1369155864430120962"  />
```

ï¼ˆ2ï¼‰æ¥æ”¶skuId `src/views/goods/components/goods-sku.vue`

```js
const props = defineProps<{
  goods: GoodsInfo
  skuId?: String
}>()
```

ï¼ˆ3ï¼‰åˆå§‹åŒ–é»˜è®¤é€‰ä¸­çŠ¶æ€

```js
// åˆå§‹åŒ–æ—¶ï¼Œè®¾ç½®é»˜è®¤é€‰ä¸­æ•ˆæœ
const initSelectedSpec = () => {
  const sku = props.goods.skus.find((item) => item.id === props.skuId)
  // console.log(sku)
  if (sku) {
    // å¦‚æœæ ¹æ®çˆ¶ç»„ä»¶ä¼ é€’çš„skuIdæ‰¾åˆ°äº†å¯¹åº”çš„sku,è®¾ç½®é»˜è®¤é€‰ä¸­
    props.goods.specs.forEach((item, index) => {
      // è·å–åˆ°skuä¸­é€‰ä¸­çš„è§„æ ¼
      const value = sku.specs[index].valueName
      console.log(value)
      // è®©valueå¯¹åº”çš„è§„æ ¼é€‰ä¸­
      const spec = item.values.find((item) => item.name === value)
      spec!.selected = true
    })
  }
}
initSelectedSpec()
```

ï¼ˆ4ï¼‰æ³¨æ„ï¼Œè®¾ç½®é»˜è®¤é€‰ä¸­å¿…é¡»åœ¨é»˜è®¤ç¦ç”¨ä¹‹å‰è®¾ç½®

```ts
// å…ˆè®¾ç½®é»˜è®¤é€‰ä¸­
initSelectedSpec()
// åˆå§‹åŒ–æ—¶ï¼Œæ§åˆ¶æ‰€æœ‰æŒ‰é’®çš„çŠ¶æ€
updateDisabledStatus()
```

## å•†å“è§„æ ¼-ç»„ä»¶é€šè®¯-å­ä¼ çˆ¶

> goods-skuç»„ä»¶é€‰æ‹©äº†æ‰€æœ‰çš„è§„æ ¼ä¹‹åï¼Œè¿˜éœ€è¦å°†skuçš„ä¿¡æ¯ä¼ é€’ç»™çˆ¶ç»„ä»¶ï¼Œçˆ¶ç»„ä»¶å¯ä»¥ç”¨äºæ¸²æŸ“å•†å“çš„æ•°æ®ï¼Œä¸”åŠ å…¥è´­ç‰©è½¦æ—¶ä¹Ÿä¼šç”¨åˆ°ã€‚

ï¼ˆ1ï¼‰æ ¹æ®é€‰æ‹©çš„å®Œæ•´skuè§„æ ¼ä¼ å‡ºskuä¿¡æ¯ `src/views/goods/components/goods-sku.vue`

```typescript
const emit = defineEmits<{
  (e: 'changeSku', skuId: string): void
}>()



// ç‚¹å‡»é€‰ä¸­è§„æ ¼
// spec: è§„æ ¼
// val: è§„æ ¼çš„å€¼
const changeSelected = (spec: Spec, sub: SpecValue) => {
  if (sub.disabled) return
  // å¢åŠ ä¸€ä¸ªselected
  if (sub.selected) {
    sub.selected = falsef
  } else {
    // è®©æ‰€æœ‰çš„éƒ½ä¸é€‰ä¸­
    spec.values.forEach((item) => {
      item.selected = false
    })
    // è®©è‡ªå·±é€‰ä¸­
    sub.selected = true
  }
  // è·å–é€‰ä¸­çš„å€¼
  // getSelectedSpec(props.goods.specs)
  // åœ¨ç‚¹å‡»è§„æ ¼çš„æ—¶å€™ï¼Œéœ€è¦æ›´æ–°ç¦ç”¨çŠ¶æ€
  // æ›´æ–°ç¦ç”¨çŠ¶æ€
  updateDisabledStatus(props.goods.specs, pathMap)

    // 1. åˆ¤æ–­è§„æ ¼æ˜¯å¦å…¨éƒ¨é€‰ä¸­
    const selected = getSelectedSpec().filter((v) => v)
    if (selected.length === props.goods.specs.length) {
      // è¯´æ˜å…¨éƒ¨é€‰ä¸­
      // 2. å»pathMapæ‰¾åˆ°å¯¹åº”çš„skuid
      const key = selected.join('â˜…')
      const [skuId] = pathMap[key]
      // 3. å­ä¼ çˆ¶ï¼Œç»™çˆ¶ç»„ä»¶
      emit('changeSku', skuId)
    }
}
```

ï¼ˆ2ï¼‰çˆ¶ç»„ä»¶æ³¨å†Œäº‹ä»¶

```typescript
<div class="spec">
  <GoodsName :goods="info" />
  <!-- è§„æ ¼ç»„ä»¶ -->
  <GoodsSku
    :goods="info"
    @changeSku="changeSku"
    skuId="1369155864430120962"
  />
</div>
```

ï¼ˆ3ï¼‰çˆ¶ç»„ä»¶æ ¹æ®skuIdæ¸²æŸ“å•†å“çš„ä¿¡æ¯

```typescript
const changeSku = (skuId: string) => {
  // console.log(skuId)
  const sku = info.value.skus.find((item) => item.id === skuId)
  if (sku) {
    info.value.inventory = sku.inventory
    info.value.price = sku.price
    info.value.oldPrice = sku.oldPrice
  }
}
```

## æ•°é‡é€‰æ‹©ç»„ä»¶-åŸºæœ¬ç»“æ„

ï¼ˆ1ï¼‰å‡†å¤‡åŸºæœ¬ç»“æ„

```vue
<script lang="ts" setup name="XtxNumbox">
//
</script>
<template>
  <div class="xtx-numbox">
    <div class="label">æ•°é‡</div>
    <div class="numbox">
      <a href="javascript:;">-</a>
      <input type="text" readonly value="1" />
      <a href="javascript:;">+</a>
    </div>
  </div>
</template>

<style scoped lang="less">
.xtx-numbox {
  display: flex;
  align-items: center;
  .label {
    width: 60px;
    color: #999;
    padding-left: 10px;
  }
  .numbox {
    width: 120px;
    height: 30px;
    border: 1px solid #e4e4e4;
    display: flex;
    > a {
      width: 29px;
      line-height: 28px;
      text-align: center;
      background: #f8f8f8;
      font-size: 16px;
      color: #666;
      &:first-of-type {
        border-right: 1px solid #e4e4e4;
      }
      &:last-of-type {
        border-left: 1px solid #e4e4e4;
      }
    }
    > input {
      width: 60px;
      padding: 0 5px;
      text-align: center;
      color: #666;
    }
  }
}
</style>
```

ï¼ˆ2ï¼‰å…¨å±€æ³¨å†Œ

```typescript
import XtxNumbox from '@/components/numbox/index.vue'
export default {
  install(app: App) {
    app.component('XtxNumbox', XtxNumbox)
  },
}
```

ï¼ˆ3ï¼‰æä¾›ç±»å‹å£°æ˜

```typescript
import XtxNumbox from '@/components/numbox/index.vue'
declare module 'vue' {
  export interface GlobalComponents {
    XtxNumbox: typeof XtxNumbox
  }
}

export {}
```

ï¼ˆ4ï¼‰æ¸²æŸ“

```typescript
<div class="spec">
  <GoodsName :goods="info" />
  <!-- è§„æ ¼ç»„ä»¶ -->
  <GoodsSku
    :goods="info"
    @changeSku="changeSku"
    skuId="1369155864430120962"
  />
  <!-- æ•°å­—é€‰æ‹©æ¡† -->
  <XtxNumbox></XtxNumbox>
</div>
```

## æ•°é‡é€‰æ‹©ç»„ä»¶-v-modelè¯­æ³•ç³–

> ç›®æ ‡ï¼šæŒæ¡vue3.0çš„v-modelè¯­æ³•ç³–åŸç† 

åœ¨vue2.0ä¸­v-modeè¯­æ³•ç³–ç®€å†™çš„ä»£ç  `<Son :value="msg" @input="msg=$event" />`

åœ¨vue3.0ä¸­v-modelè¯­æ³•ç³–æœ‰æ‰€è°ƒæ•´ï¼š`<Son :modelValue="msg" @update:modelValue="msg=$event" />`

æ¼”ç¤ºä»£ç ï¼š

```vue
<script lang="ts" setup>
defineProps({
  money: {
    type: Number,
    default: 0,
  },
})

const emit = defineEmits(['update:money'])
</script>

<template>
  <h3>å­ç»„ä»¶-{{ money }}</h3>
  <button @click="emit('update:money', money + 1)">+1</button>
</template>

<style scoped lang="less"></style>
```

**æ€»ç»“ï¼š** vue3.0å°è£…ç»„ä»¶æ”¯æŒv-modelçš„æ—¶å€™ï¼Œçˆ¶ä¼ å­`:modelValue` å­ä¼ çˆ¶ `@update:modelValue`

**è¡¥å……ï¼š** vue2.0çš„ `xxx.sync` è¯­æ³•ç³–è§£æ çˆ¶ä¼ å­ `:xxx` å­ä¼ çˆ¶ `@update:xxx` åœ¨vue3.0 ä½¿ç”¨ `v-model:xxx` ä»£æ›¿ã€‚

## æ•°é‡é€‰æ‹©ç»„ä»¶-åŠŸèƒ½å®ç°

å¤§è‡´åŠŸèƒ½åˆ†æï¼š

- é»˜è®¤å€¼ä¸º1
- å¯é™åˆ¶æœ€å¤§æœ€å°å€¼
- ç‚¹å‡»-å°±æ˜¯å‡1 ç‚¹å‡»+å°±æ˜¯åŠ 1
- éœ€è¦å®Œæˆv-modelå¾—å®ç°
- å­˜åœ¨æ— labelæƒ…å†µ

```vue
<script lang="ts" setup name="XtxNumbox">
const props = defineProps({
  modelValue: {
    type: Number,
    default: 1,
  },
  min: {
    type: Number,
    default: 1,
  },
  max: {
    type: Number,
    default: 20,
  },
  showLabel: {
    type: Boolean,
    default: false,
  },
})

const emit = defineEmits<{
  (e: 'update:modelValue', value: number): void
}>()

const add = () => {
  if (props.modelValue >= props.max) return
  emit('update:modelValue', props.modelValue + 1)
}

const sub = () => {
  if (props.modelValue <= props.min) return
  emit('update:modelValue', props.modelValue - 1)
}
</script>
<template>
  <div class="xtx-numbox">
    <div class="label" v-if="showLabel"><slot>æ•°é‡</slot></div>
    <div class="numbox">
      <a href="javascript:;" @click="sub">-</a>
      <input type="text" readonly :value="modelValue" />
      <a href="javascript:;" @click="add">+</a>
    </div>
  </div>
</template>

<style scoped lang="less">
.xtx-numbox {
  display: flex;
  align-items: center;
  .label {
    width: 60px;
    color: #999;
    padding-left: 10px;
  }
  .numbox {
    width: 120px;
    height: 30px;
    border: 1px solid #e4e4e4;
    display: flex;
    > a {
      width: 29px;
      line-height: 28px;
      text-align: center;
      background: #f8f8f8;
      font-size: 16px;
      color: #666;
      &:first-of-type {
        border-right: 1px solid #e4e4e4;
      }
      &:last-of-type {
        border-left: 1px solid #e4e4e4;
      }
    }
    > input {
      width: 60px;
      padding: 0 5px;
      text-align: center;
      color: #666;
    }
  }
}
</style>
```



## å•†å“è¯¦æƒ…-æŒ‰é’®ç»„ä»¶

> ç›®çš„ï¼šå°è£…ä¸€ä¸ªé€šç”¨æŒ‰é’®ç»„ä»¶ï¼Œæœ‰å¤§ã€ä¸­ã€å°ã€è¶…å°å››ç§å°ºå¯¸ï¼Œæœ‰é»˜è®¤ã€ä¸»è¦ã€æ¬¡è¦ã€ç°è‰²å››ç§ç±»å‹ã€‚

å°è£…ç»„ä»¶ï¼š`src/components/button/index.vue`

```vue
<script lang="ts" setup name="XtxButton">
import { PropType } from 'vue'

defineProps({
  size: {
    type: String as PropType<'large' | 'middle' | 'small' | 'mini'>,
    default: 'middle',
  },
  type: {
    type: String as PropType<'default' | 'primary' | 'plain' | 'gray'>,
    default: 'default',
  },
})
</script>
<template>
  <button class="xtx-button ellipsis" :class="[size, type]">
    <slot />
  </button>
</template>

<style scoped lang="less">
.xtx-button {
  appearance: none;
  border: none;
  outline: none;
  background: #fff;
  text-align: center;
  border: 1px solid transparent;
  border-radius: 4px;
  cursor: pointer;
}
.large {
  width: 240px;
  height: 50px;
  font-size: 16px;
}
.middle {
  width: 180px;
  height: 50px;
  font-size: 16px;
}
.small {
  width: 100px;
  height: 32px;
}
.mini {
  width: 60px;
  height: 32px;
}
.default {
  border-color: #e4e4e4;
  color: #666;
}
.primary {
  border-color: @xtxColor;
  background: @xtxColor;
  color: #fff;
}
.plain {
  border-color: @xtxColor;
  color: @xtxColor;
  background: lighten(@xtxColor, 50%);
}
.gray {
  border-color: #ccc;
  background: #ccc;
  color: #fff;
}
</style>
```

å…¨å±€æ³¨å†Œç»„ä»¶

```ts
import XtxButton from '@/components/button/index.vue'
export default {
  install(app: App) {
    app.component('XtxButton', XtxButton)
}

```

å®šä¹‰ç»„ä»¶ç±»å‹

```ts
import XtxButton from '@/components/button/index.vue'
declare module 'vue' {
  export interface GlobalComponents {
    XtxButton: typeof XtxButton
  }
}

export {}

```

ä½¿ç”¨ç»„ä»¶ï¼š`src/views/goods/index.vue`

```vue
<!-- å•†å“ä¿¡æ¯ -->
<div class="goods-info">
  <div class="media">
    <GoodsImage :images="info.mainPictures"></GoodsImage>
    <GoodsSales />
  </div>
  <div class="spec">
    <GoodsName :goods="info" />
    <!-- è§„æ ¼ç»„ä»¶ -->
    <GoodsSku
      :goods="info"
      @changeSku="changeSku"
      skuId="1369155864430120962"
    />
    <!-- æ•°å­—é€‰æ‹©æ¡† -->
    <XtxNumbox :max="info.inventory" isLabel v-model="count"></XtxNumbox>
    <XtxButton type="primary" style="margin-top: 20px">
      åŠ å…¥è´­ç‰©è½¦
    </XtxButton>
  </div>
```

## å•†å“è¯¦æƒ…-è¯¦æƒ…æ¸²æŸ“

ï¼ˆ1ï¼‰æ–°å¢ç»„ä»¶ `src/goods/components/goods-detail.vue`

```vue
<script setup lang="ts">
import type { GoodsInfo } from '@/types/goods'

interface Props {
  goods: GoodsInfo
}
defineProps<Props>()
</script>

<template>
  <div class="goods-tabs">
    <nav>
      <a>å•†å“è¯¦æƒ…</a>
    </nav>
    <div class="goods-detail">
      <!-- å±æ€§ -->
      <ul class="attrs">
        <li v-for="item in goods.details.properties" :key="item.value">
          <span class="dt">{{ item.name }}</span>
          <span class="dd">{{ item.value }}</span>
        </li>
      </ul>
      <!-- å›¾ç‰‡ -->
      <img
        v-for="item in goods.details.pictures"
        :key="item"
        :src="item"
        alt=""
      />
    </div>
  </div>
</template>

<style scoped lang="less">
.goods-tabs {
  min-height: 600px;
  background: #fff;
  nav {
    height: 70px;
    line-height: 70px;
    display: flex;
    border-bottom: 1px solid #f5f5f5;
    a {
      padding: 0 40px; 
      font-size: 18px;
      position: relative;
      > span {
        color: @priceColor;
        font-size: 16px;
        margin-left: 10px;
      }
    }
  }
}
.goods-detail {
  padding: 40px;
  .attrs {
    display: flex;
    flex-wrap: wrap;
    margin-bottom: 30px;
    li {
      display: flex;
      margin-bottom: 10px;
      width: 50%;
      .dt {
        width: 100px;
        color: #999;
      }
      .dd {
        flex: 1;
        color: #666;
      }
    }
  }
  > img {
    width: 100%;
  }
}
</style>
```

ï¼ˆ2ï¼‰æä¾›æ•°æ®ç±»å‹

```ts

type GoodsDetail = {
  pictures: string[]
  properties: {
    name: string
    value: string
  }[]
}
// å•†å“æ¨¡å—çš„ç±»å‹å£°æ˜
export type GoodsInfo = {
  ...
  details: GoodsDetail
}
```

ï¼ˆ3ï¼‰å•†å“ç»„ä»¶ä¸­æ¸²æŸ“

```vue
<div class="goods-footer">
  <div class="goods-article">
    <!-- å•†å“+è¯„ä»· -->
    <div class="goods-tabs">
      <!-- å•†å“è¯¦æƒ… -->
      <GoodsDetail :goods="info" />
    </div>
  </div>
  <!-- 24çƒ­æ¦œ+ä¸“é¢˜æ¨è -->
  <div class="goods-aside"></div>
</div>



<style scoped lang="less">
.goods-info {
  min-height: 600px;
  background: #fff;
  display: flex;
  .media {
    width: 580px;
    height: 600px;
    padding: 30px 50px;
  }
  .spec {
    flex: 1;
    padding: 30px 30px 30px 0;
  }
}
.goods-footer {
  display: flex;
  margin-top: 20px;
  .goods-article {
    width: 940px;
    margin-right: 20px;
  }
  .goods-aside {
    width: 280px;
    min-height: 1000px;
  }
}
</style>
```

## å•†å“è¯¦æƒ…-çƒ­æ¦œç»„ä»¶

ï¼ˆ1ï¼‰åŸºæœ¬ç»“æ„   goods-hot.vue

```vue
<script setup lang="ts">
import GoodsItem from '@/views/category/components/goods-item.vue'
import type { PropType } from 'vue'
const props = defineProps({
  type: {
    type: Number as PropType<1 | 2 | 3>,
    default: 1,
  },
})

// æ ‡é¢˜å¯¹è±¡
const titleObj = {
  1: '24å°æ—¶çƒ­é”€æ¦œ',
  2: 'å‘¨çƒ­é”€æ¦œ',
  3: 'æ€»çƒ­é”€æ¦œ',
}
</script>

<template>
  <div class="goods-hot">
    <h3>{{ titleObj[props.type] }}</h3>
    <div class="goods-list">
      <!-- å•†å“åŒºå— -->
      <GoodsItem v-for="(item, index) in 4" :key="index" />
    </div>
  </div>
</template>

<style scoped lang="less">
.goods-hot {
  background-color: #fff;
  margin-bottom: 20px;
  h3 {
    height: 70px;
    background: @helpColor;
    color: #fff;
    font-size: 18px;
    line-height: 70px;
    padding-left: 25px;
    margin-bottom: 10px;
    font-weight: normal;
  }
  .goods-list {
    display: flex;
    flex-direction: column;
    align-items: center;
  }
}
</style>
```

(2)çˆ¶ç»„ä»¶ä¸­æ¸²æŸ“

```vue
<!-- 24çƒ­æ¦œ+ä¸“é¢˜æ¨è -->
<div class="goods-aside">
  <!-- 24çƒ­æ¦œ+ä¸“é¢˜æ¨è -->
  <div class="goods-aside">
    <GoodsHot :type="1" />
    <GoodsHot :type="2" />
    <GoodsHot :type="3" />
  </div>
</div>
```

(3)å‘é€è¯·æ±‚å¹¶ä¸”æ¸²æŸ“

```vue
<script setup lang="ts">
import { ApiRes, GoodItem } from '@/types/data'
import request from '@/utils/request'
import GoodsItem from '@/views/category/components/goods-item.vue'
import { onMounted, PropType, ref } from 'vue'
import { useRoute } from 'vue-router'
const props = defineProps({
  type: {
    type: Number as PropType<1 | 2 | 3>,
    default: 1,
  },
})

// æ ‡é¢˜å¯¹è±¡
const titleObj = {
  1: '24å°æ—¶çƒ­é”€æ¦œ',
  2: 'å‘¨çƒ­é”€æ¦œ',
  3: 'æ€»çƒ­é”€æ¦œ',
}

// å‘é€è¯·æ±‚è·å–æ•°æ®
const route = useRoute()
const id = route.params.id as string
const list = ref<GoodItem[]>([])
onMounted(async () => {
  const res = await request.get<ApiRes<GoodItem[]>>('/goods/hot', {
    params: {
      id: id,
      type: props.type,
    },
  })
  list.value = res.data.result
})
</script>

<template>
  <div class="goods-hot">
    <h3>{{ titleObj[props.type] }}</h3>
    <div class="goods-list">
      <!-- å•†å“åŒºå— -->
      <GoodsItem v-for="(item, index) in list" :key="index" :goods="item" />
    </div>
  </div>
</template>

<style scoped lang="less">
.goods-hot {
  background-color: #fff;
  margin-bottom: 20px;
  h3 {
    height: 70px;
    background: @helpColor;
    color: #fff;
    font-size: 18px;
    line-height: 70px;
    padding-left: 25px;
    margin-bottom: 10px;
    font-weight: normal;
  }
  .goods-list {
    display: flex;
    flex-direction: column;
    align-items: center;
  }
}
</style>

```

