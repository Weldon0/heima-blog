# ğŸ“š 9. ç™»å½•åŠŸèƒ½

## åŸºç¡€å¸ƒå±€

é¦–é¡µè·³è½¬åˆ°ç™»å½•é¡µ

```vue
<li><RouterLink to="/login">è¯·å…ˆç™»å½•</RouterLink></li>
```

ï¼ˆ1ï¼‰å°è£…å¤´éƒ¨ç»„ä»¶ `src/views/login/components/login-header.vue`

:::tip æ³¨æ„

å¤´éƒ¨ç»„ä»¶ä¸­çš„æ¬¢è¿ç™»å½•æ²¡æœ‰å†™æ­»ï¼Œä½¿ç”¨æ’æ§½ï¼Œå› ä¸ºå°†æ¥qqç™»å½•ä»¥åŠä¿®æ”¹èµ„æ–™çš„æ—¶å€™éœ€è¦å¤ç”¨è¯¥ç»„ä»¶ã€‚

:::

```vue
<script setup lang="ts" name="LoginHeader"></script>
<template>
  <header class="login-header">
    <div class="container">
      <h1 class="logo"><RouterLink to="/">å°å…”é²œ</RouterLink></h1>
      <h3 class="sub"><slot></slot></h3>
      <RouterLink class="entry" to="/">
        è¿›å…¥ç½‘ç«™é¦–é¡µ
        <i class="iconfont icon-angle-right"></i>
        <i class="iconfont icon-angle-right"></i>
      </RouterLink>
    </div>
  </header>
</template>

<style scoped lang="less">
.login-header {
  background: #fff;
  border-bottom: 1px solid #e4e4e4;
  .container {
    display: flex;
    align-items: flex-end;
    justify-content: space-between;
  }
  .logo {
    width: 200px;
    a {
      display: block;
      height: 132px;
      width: 100%;
      text-indent: -9999px;
      background: url(@/assets/images/logo.png) no-repeat center 18px / contain;
    }
  }
  .sub {
    flex: 1;
    font-size: 24px;
    font-weight: normal;
    margin-bottom: 38px;
    margin-left: 20px;
    color: #666;
  }
  .entry {
    width: 120px;
    margin-bottom: 38px;
    font-size: 16px;
    i {
      font-size: 14px;
      color: @xtxColor;
      letter-spacing: -5px;
    }
  }
}
</style>

```

ï¼ˆ2ï¼‰åº•éƒ¨ç»„ä»¶ `src/views/login/components/login-footer.vue`

```vue
<script lang="ts" setup name="LoginFooter"></script>
<template>
  <footer class="login-footer">
    <div class="container">
      <p>
        <a href="javascript:;">å…³äºæˆ‘ä»¬</a>
        <a href="javascript:;">å¸®åŠ©ä¸­å¿ƒ</a>
        <a href="javascript:;">å”®åæœåŠ¡</a>
        <a href="javascript:;">é…é€ä¸éªŒæ”¶</a>
        <a href="javascript:;">å•†åŠ¡åˆä½œ</a>
        <a href="javascript:;">æœç´¢æ¨è</a>
        <a href="javascript:;">å‹æƒ…é“¾æ¥</a>
      </p>
      <p>CopyRight &copy; å°å…”é²œå„¿</p>
    </div>
  </footer>
</template>

<style scoped lang="less">
.login-footer {
  padding: 30px 0 50px;
  background: #fff;
  p {
    text-align: center;
    color: #999;
    padding-top: 20px;
    a {
      line-height: 1;
      padding: 0 10px;
      color: #999;
      display: inline-block;
      ~ a {
        border-left: 1px solid #ccc;
      }
    }
  }
}
</style>

```

ï¼ˆ3ï¼‰ç™»å½•ç»„ä»¶æ¸²æŸ“ `src/views/login/index.vue`

```vue
<script lang="ts" setup name="Login">
import LoginHeader from './components/login-header.vue'
import LoginFooter from './components/login-footer.vue'
</script>
<template>
  <LoginHeader>æ¬¢è¿ç™»å½•</LoginHeader>
  <section class="login-section">
    <div class="wrapper">
      <nav>
        <a href="javascript:;">è´¦æˆ·ç™»å½•</a>
        <a href="javascript:;">æ‰«ç ç™»å½•</a>
      </nav>
    </div>
  </section>
  <LoginFooter />
</template>

<style scoped lang="less">
.login-section {
  background: url(@/assets/images/login-bg.png) no-repeat center / cover;
  height: 488px;
  position: relative;
  .wrapper {
    width: 380px;
    background: #fff;
    min-height: 400px;
    position: absolute;
    left: 50%;
    top: 54px;
    transform: translate3d(100px, 0, 0);
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.15);
    nav {
      height: 55px;
      border-bottom: 1px solid #f5f5f5;
      display: flex;
      padding: 0 40px;
      text-align: right;
      align-items: center;
      a {
        flex: 1;
        line-height: 1;
        display: inline-block;
        font-size: 18px;
        position: relative;
        &:first-child {
          border-right: 1px solid #f5f5f5;
          text-align: left;
        }
        &.active {
          color: @xtxColor;
          font-weight: bold;
        }
      }
    }
  }
}
</style>

```

## åˆ‡æ¢æ•ˆæœ

ï¼ˆ1ï¼‰å‡†å¤‡åˆ‡æ¢ä¸»ä½“å†…å®¹ç»“æ„ï¼ˆè¡¨å•ç›’å­å’ŒäºŒç»´ç ç›’å­ï¼‰

```html
<section class="login-section">
  <div class="wrapper">
    <nav>
      <a class="active" href="javascript:;">è´¦æˆ·ç™»å½•</a>
      <a href="javascript:;">æ‰«ç ç™»å½•</a>
    </nav>

    <!-- è¡¨å• -->
    <div v-if="false" class="account-box">è¡¨å•</div>
    <!-- äºŒç»´ç  -->
    <div v-else class="qrcode-box">
      <img src="@/assets/images/qrcode.jpg" alt="" />
      <p>æ‰“å¼€ <a href="javascript:;">å°å…”é²œApp</a> æ‰«ç ç™»å½•</p>
    </div>
  </div>
</section>
```

ï¼ˆ2ï¼‰æ ·å¼

```less
// äºŒç»´ç å®¹å™¨
.qrcode-box {
  text-align: center;
  padding-top: 40px;
  p {
    margin-top: 20px;
    a {
      color: @xtxColor;
      font-size: 16px;
    }
  }
}
```

ï¼ˆ3ï¼‰æ§åˆ¶åˆ‡æ¢é€»è¾‘

```vue
<script lang="ts" setup name="Login">
import LoginHeader from './components/login-header.vue'
import LoginFooter from './components/login-footer.vue'
import { ref } from 'vue'
const activeName = ref<'account' | 'qrcode'>('account')
</script>
<template>
  <LoginHeader>æ¬¢è¿ç™»å½•</LoginHeader>
  <section class="login-section">
    <div class="wrapper">
      <nav>
        <a
          href="javascript:;"
          :class="{ active: activeName === 'account' }"
          @click="activeName = 'account'"
          >è´¦æˆ·ç™»å½•</a
        >
        <a
          href="javascript:;"
          :class="{ active: activeName === 'qrcode' }"
          @click="activeName = 'qrcode'"
          >æ‰«ç ç™»å½•</a
        >
      </nav>

      <!-- è¡¨å• -->
      <div v-if="activeName === 'account'" class="account-box">è¡¨å•</div>
      <!-- äºŒç»´ç  -->
      <div v-else class="qrcode-box">
        <img src="@/assets/images/qrcode.jpg" alt="" />
        <p>æ‰“å¼€ <a href="javascript:;">å°å…”é²œApp</a> æ‰«ç ç™»å½•</p>
      </div>
    </div>
  </section>
  <LoginFooter />
</template>
```

## è¡¨å•ç»„ä»¶

ï¼ˆ1ï¼‰å‡†å¤‡åŸºæœ¬ç»“æ„ `src/views/login/component/login-form.vue`

```vue
<script lang="ts" setup name="LoginForm"></script>
<template>
  <div class="account-box">
    <div class="toggle">
      <a href="javascript:;" v-if="true">
        <i class="iconfont icon-user"></i> ä½¿ç”¨è´¦å·ç™»å½•
      </a>
      <a href="javascript:;" v-else>
        <i class="iconfont icon-msg"></i> ä½¿ç”¨çŸ­ä¿¡ç™»å½•
      </a>
    </div>
    <div class="form">
      <template v-if="true">
        <div class="form-item">
          <div class="input">
            <i class="iconfont icon-user"></i>
            <input type="text" placeholder="è¯·è¾“å…¥ç”¨æˆ·åæˆ–æ‰‹æœºå·" />
          </div>
          <!-- <div class="error"><i class="iconfont icon-warning" />è¯·è¾“å…¥æ‰‹æœºå·</div> -->
        </div>
        <div class="form-item">
          <div class="input">
            <i class="iconfont icon-lock"></i>
            <input type="password" placeholder="è¯·è¾“å…¥å¯†ç " />
          </div>
        </div>
      </template>
      <template v-else>
        <div class="form-item">
          <div class="input">
            <i class="iconfont icon-user"></i>
            <input type="text" placeholder="è¯·è¾“å…¥æ‰‹æœºå·" />
          </div>
        </div>
        <div class="form-item">
          <div class="input">
            <i class="iconfont icon-code"></i>
            <input type="password" placeholder="è¯·è¾“å…¥éªŒè¯ç " />
            <span class="code">å‘é€éªŒè¯ç </span>
          </div>
        </div>
      </template>
      <div class="form-item">
        <div class="agree">
         
          <span>æˆ‘å·²åŒæ„</span>
          <a href="javascript:;">ã€Šéšç§æ¡æ¬¾ã€‹</a>
          <span>å’Œ</span>
          <a href="javascript:;">ã€ŠæœåŠ¡æ¡æ¬¾ã€‹</a>
        </div>
      </div>
      <a href="javascript:;" class="btn">ç™»å½•</a>
    </div>
    <div class="action">
      <img
        src="https://qzonestyle.gtimg.cn/qzone/vas/opensns/res/img/Connect_logo_7.png"
        alt=""
      />
      <div class="url">
        <a href="javascript:;">å¿˜è®°å¯†ç </a>
        <a href="javascript:;">å…è´¹æ³¨å†Œ</a>
      </div>
    </div>
  </div>
</template>

<style scoped lang="less">
// è´¦å·å®¹å™¨
.account-box {
  .toggle {
    padding: 15px 40px;
    text-align: right;
    a {
      color: @xtxColor;
      i {
        font-size: 14px;
      }
    }
  }
  .form {
    padding: 0 40px;
    &-item {
      margin-bottom: 28px;
      .input {
        position: relative;
        height: 36px;
        > i {
          width: 34px;
          height: 34px;
          background: #cfcdcd;
          color: #fff;
          position: absolute;
          left: 1px;
          top: 1px;
          text-align: center;
          line-height: 34px;
          font-size: 18px;
        }
        input {
          padding-left: 44px;
          border: 1px solid #cfcdcd;
          height: 36px;
          line-height: 36px;
          width: 100%;
          &.error {
            border-color: @priceColor;
          }
          &.active,
          &:focus {
            border-color: @xtxColor;
          }
        }
        .code {
          position: absolute;
          right: 1px;
          top: 1px;
          text-align: center;
          line-height: 34px;
          font-size: 14px;
          background: #f5f5f5;
          color: #666;
          width: 90px;
          height: 34px;
          cursor: pointer;
        }
      }
      > .error {
        position: absolute;
        font-size: 12px;
        line-height: 28px;
        color: @priceColor;
        i {
          font-size: 14px;
          margin-right: 2px;
        }
      }
    }
    .agree {
      a {
        color: #069;
      }
    }
    .btn {
      display: block;
      width: 100%;
      height: 40px;
      color: #fff;
      text-align: center;
      line-height: 40px;
      background: @xtxColor;
      &.disabled {
        background: #cfcdcd;
      }
    }
  }
  .action {
    padding: 20px 40px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    img {
      cursor: pointer;
    }
    .url {
      a {
        color: #999;
        margin-left: 10px;
      }
    }
  }
}
</style>

```

ï¼ˆ2ï¼‰æ¸²æŸ“

```vue
<script lang="ts" setup name="Login">
import LoginHeader from './components/login-header.vue'
import LoginFooter from './components/login-footer.vue'
import LoginForm from './components/login-form.vue'
import { ref } from 'vue'
const activeName = ref<'account' | 'qrcode'>('account')
</script>



<!-- è¡¨å• -->
<div v-if="activeName === 'account'" class="account-box">
  <LoginForm></LoginForm>
</div>


```

ï¼ˆ3ï¼‰æ§åˆ¶åˆ‡æ¢æ•ˆæœ `/components/login-form.vue`

```typescript
<script lang="ts" setup name="LoginForm">
import { ref } from 'vue'

const type = ref<'account' | 'mobile'>('account')
</script>
```

ï¼ˆ3ï¼‰æ¸²æŸ“

```diff
<template>
  <div class="account-box">
    <div class="toggle">
+       <a href="javascript:;" @click="type = 'account'" v-if="type === 'mobile'">
        <i class="iconfont icon-user"></i> ä½¿ç”¨è´¦å·ç™»å½•
      </a>
+      <a href="javascript:;" @click="type = 'mobile'" v-else>
        <i class="iconfont icon-msg"></i> ä½¿ç”¨çŸ­ä¿¡ç™»å½•
      </a>
    </div>
    <div class="form">
+      <template v-if="type === 'account'">
        <div class="form-item">
          <div class="input">
            <i class="iconfont icon-user"></i>
            <input
              v-model="form.account"
              type="text"
              placeholder="è¯·è¾“å…¥ç”¨æˆ·åæˆ–æ‰‹æœºå·"
            />
```

## å¤é€‰æ¡†ç»„ä»¶-åŠŸèƒ½å®ç°

ï¼ˆ1ï¼‰å‡†å¤‡ç»„ä»¶`src/components/checkbox/index.vue`

```vue
<script lang="ts" setup name="XtxCheckbox"></script>

<template>
  <div class="xtx-checkbox">
    <i class="iconfont icon-checked"></i>
    <i class="iconfont icon-unchecked"></i>
    <span>æç¤ºæ–‡æœ¬</span>
  </div>
</template>

<style scoped lang="less">
.xtx-checkbox {
  display: inline-block;
  margin-right: 2px;
  .icon-checked {
    color: @xtxColor;
    ~ span {
      color: @xtxColor;
    }
  }
  i {
    position: relative;
    top: 1px;
  }
  span {
    margin-left: 2px;
  }
}
</style>

```

å…¨å±€æ³¨å†Œ

```typescript

import XtxCheckbox from '@/components/checkbox/index.vue'
export default {
  install(app: App) {
    app.component('XtxCheckbox', XtxCheckbox)
  }
}
```

å¢åŠ å…¨å±€ç±»å‹

```typescript
import XtxCheckbox from '@/components/checkbox/index.vue'
declare module 'vue' {
  export interface GlobalComponents {
    XtxCheckbox: typeof XtxCheckbox
  }
}

```

ï¼ˆ2ï¼‰åœ¨`src/views/login/index.vue`ä¸­æ¸²æŸ“

```vue
<!-- å¤é€‰æ¡† -->
<XtxCheckbox v-model="isAgree" />
```

ï¼ˆ3ï¼‰æ§åˆ¶æ¸²æŸ“çŠ¶æ€`src/components/xtx-checkbox.vue`

> changeäº‹ä»¶çš„ç›®çš„ï¼šæ–¹ä¾¿æˆ‘ä»¬åœ¨ä½¿ç”¨ç»„ä»¶çš„æ—¶å€™ï¼Œå¦‚æœåˆ‡æ¢äº†é€‰é¡¹çš„æ—¶å€™æƒ³è¦åšä¸€äº›äº‹æƒ…ï¼Œå°±å°±å¯ä»¥è°ƒç”¨ä¸€ä¸‹changeäº‹ä»¶

```vue
<script lang="ts" setup name="XtxCheckbox">
const props = defineProps({
  modelValue: {
    type: Boolean,
    default: false,
  },
})

const emit = defineEmits<{
  (e: 'update:modelValue', vlaue: boolean): void
  (e: 'change', vlaue: boolean): void
}>()

const change = () => {
  emit('update:modelValue', !props.modelValue)
  emit('change', !props.modelValue)
}
</script>

<template>
  <div class="xtx-checkbox" @click="change">
    <i v-if="modelValue" class="iconfont icon-checked"></i>
    <i v-else class="iconfont icon-unchecked"></i>
    <span><slot></slot></span>
  </div>
</template>

<style scoped lang="less">
.xtx-checkbox {
  display: inline-block;
  margin-right: 2px;
  .icon-checked {
    color: @xtxColor;
    ~ span {
      color: @xtxColor;
    }
  }
  i {
    position: relative;
    top: 1px;
  }
  span {
    margin-left: 2px;
  }
}
</style>

```

## æ¶ˆæ¯æç¤ºç»„ä»¶-åŸºç¡€å°è£…

ç»„ä»¶åŠŸèƒ½åˆ†æï¼š

- å›ºå®šé¡¶éƒ¨æ˜¾ç¤ºï¼Œæœ‰ä¸‰ç§ç±»å‹ï¼šæˆåŠŸsuccessï¼Œé”™è¯¯errorï¼Œè­¦å‘Šwarningã€‚
- æ˜¾ç¤ºæ¶ˆæ¯æç¤ºæ—¶éœ€è¦åŠ¨ç”»ä»ä¸Šæ»‘å…¥ä¸”æ·¡å‡ºã€‚
- ç»„ä»¶ä½¿ç”¨çš„æ–¹å¼ä¸å¤Ÿä¾¿åˆ©ï¼Œå°è£…æˆå·¥å…·å‡½æ•°æ–¹å¼ã€‚



ï¼ˆ1ï¼‰åŸºæœ¬ç»“æ„`src/components/message/index.vue`

```vue
<script lang="ts" setup name="XtxMessage">
import { PropType } from 'vue'

defineProps({
  type: {
    type: String as PropType<'success' | 'error' | 'warning'>,
    default: 'success',
  },
})

// å®šä¹‰ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«ä¸‰ç§æƒ…å†µçš„æ ·å¼ï¼Œå¯¹è±¡keyå°±æ˜¯ç±»å‹å­—ç¬¦ä¸²
const style = {
  warning: {
    icon: 'icon-warning',
    color: '#E6A23C',
    backgroundColor: 'rgb(253, 246, 236)',
    borderColor: 'rgb(250, 236, 216)',
  },
  error: {
    icon: 'icon-shanchu',
    color: '#F56C6C',
    backgroundColor: 'rgb(254, 240, 240)',
    borderColor: 'rgb(253, 226, 226)',
  },
  success: {
    icon: 'icon-queren2',
    color: '#67C23A',
    backgroundColor: 'rgb(240, 249, 235)',
    borderColor: 'rgb(225, 243, 216)',
  },
}
</script>

<template>
  <div class="xtx-message" :style="style[type]">
    <i class="iconfont" :class="style[type].icon"></i>
    <span class="text"><slot></slot></span>
  </div>
</template>

<style scoped lang="less">
.xtx-message {
  width: 300px;
  height: 50px;
  position: fixed;
  z-index: 9999;
  left: 50%;
  margin-left: -150px;
  top: 25px;
  line-height: 50px;
  padding: 0 25px;
  border: 1px solid #e4e4e4;
  background: #f5f5f5;
  color: #999;
  border-radius: 4px;
  i {
    margin-right: 4px;
    vertical-align: middle;
  }
  .text {
    vertical-align: middle;
  }
}
</style>
```

å…¨å±€æ³¨å†Œ

```typescript
import XtxMessage from '@/components/message/index.vue'

app.component('XtxMessage', XtxMessage)





declare module 'vue' {
  export interface GlobalComponents {
    XtxMessage: typeof XtxMessage
  }
}
```

ï¼ˆ2ï¼‰åœ¨`App.vue`ä¸­æ¸²æŸ“

```vue
<template>
  <router-view />
  <XtxMessage type="error">æˆ‘æ˜¯æç¤ºæ¶ˆæ¯</XtxMessage>
</template>
```

## æ¶ˆæ¯æç¤ºç»„ä»¶-hå‡½æ•°ä¸renderå‡½æ•°

> createVNodeçš„åŸºæœ¬ä½¿ç”¨ï¼šhttps://staging-cn.vuejs.org/guide/extras/render-function.html#creating-vnodes

```typescript
<script lang="ts" setup name="PlayGround">
// h ç­‰ä»·äº createVNode
// createVNode: ä½œç”¨ï¼šåˆ›å»ºè™šæ‹ŸDOM  (ä¸€ä¸ªjså¯¹è±¡, å¯ä»¥æ¨¡æ‹ŸçœŸå®domç»“æ„)
import { h, onMounted, render } from 'vue'
// å‚æ•°1ï¼šåˆ›å»ºçš„è™šæ‹ŸDOMçš„èŠ‚ç‚¹ç±»å‹  æ¯”å¦‚  div h1  a  img
// å‚æ•°2ï¼šè™šæ‹ŸDOMæ‹¥æœ‰çš„å±æ€§ï¼Œæ˜¯ä¸€ä¸ªå¯¹è±¡
// å‚æ•°3ï¼šè™šæ‹ŸDOMèŠ‚ç‚¹çš„å†…å®¹

// <h1 title="æ ‡é¢˜" id="box" class="aa">æˆ‘æ˜¯æ ‡é¢˜</h1>
const vNode = h('h1', { title: 'æ ‡é¢˜', id: 'box', className: 'aa' }, 'æˆ‘æ˜¯æ ‡é¢˜')

onMounted(() => {
  // å‚æ•°1ï¼šè™šæ‹ŸDOM
  // å‚æ•°2ï¼šçœŸå®çš„DOMï¼Œï¼Œï¼Œè™šæ‹ŸDOMçš„æŒ‚è½½ç‚¹
  render(vNode, document.querySelector('.box')!)
})
</script>

<template>
  <div class="box">
    <h1 title="æ ‡é¢˜">æˆ‘æ˜¯ä¸€ä¸ªæ ‡é¢˜</h1>
  </div>
</template>

<style scoped lang="less"></style>
```



## æ¶ˆæ¯æç¤ºç»„ä»¶-å‡½æ•°å°è£…

ç›®å‰ï¼Œmessageç»„ä»¶è¿˜ä¸å¤Ÿå¥½ç”¨ï¼Œä¸»è¦é—®é¢˜æœ‰2ä¸ª

1. ä½¿ç”¨éº»çƒ¦
2. æ ·å¼ä¼šå—åˆ°çˆ¶å…ƒç´ çš„å½±å“

ï¼ˆ1ï¼‰æ–°å»ºæ–‡ä»¶`src/components/message/index.ts`

```js
import { h, render } from 'vue'
import XtxMessage from './message.vue'
type Props = {
  type: 'success' | 'error' | 'warning'
  text: string
}

const div = document.createElement('div')
div.setAttribute('class', 'xtx-message-container')
document.body.appendChild(div)
export default function Message({ type, text }: Props) {
  const vNode = h(XtxMessage, { type, text })
  render(vNode, div)
}

```

ï¼ˆ2ï¼‰ç™»å½•æ—¶è°ƒç”¨

```js
const login = () => {
  Message({ type: 'error', text: 'ç™»å½•å¤±è´¥' })
}
```

ï¼ˆ3ï¼‰å»¶è¿Ÿ1ç§’åè‡ªåŠ¨å…³é—­

```js
export function Message({ type, text, duration = 2000 }) {
  // æ¸²æŸ“XtxMessageç»„ä»¶
  // <XtxMessage :type="type" :text="text"></XtxMessage>
  const vNode = h(XtxMessage, { type, text })
  render(vNode, div)

  // å¼€å¯å»¶æ—¶å™¨
  clearTimeout(timer)
  timer = setTimeout(() => {
    // åˆ é™¤è™šæ‹ŸDOM
    render(null, div)
  }, duration)
}
```



## æ¶ˆæ¯æç¤ºç»„ä»¶-åŠ¨ç”»æ•ˆæœä¼˜åŒ–

ï¼ˆ1ï¼‰æ·»åŠ åŠ¨æ€æ•ˆæœ-æ ·å¼

```vue
<template>
  <Transition name="down">
    <div class="xtx-message" :style="style[type]" v-show="isShow">
      <i class="iconfont" :class="style[type].icon"></i>
      <span class="text">{{ text }}</span>
    </div>
  </Transition>
</template>


<style>
.down {
  &-enter {
    &-from {
      transform: translate3d(0, -75px, 0);
      opacity: 0;
    }
    &-active {
      transition: all 0.5s;
    }
    &-to {
      transform: none;
      opacity: 1;
    }
  }
}
</style>
```

ï¼ˆ2ï¼‰æ§åˆ¶ç›’å­çš„æ˜¾ç¤ºå’Œéšè—

```js
const isShow = ref(false)
onMounted(() => {
  isShow.value = true
})
```

## æ¶ˆæ¯æç¤ºç»„ä»¶-é€šç”¨æ–¹æ³•å°è£…

```typescript
import { h, render } from 'vue'
import XtxMessage from './message.vue'
type Props = {
  type: 'success' | 'error' | 'warning'
  text: string
  duration?: number
}

const div = document.createElement('div')
div.setAttribute('class', 'xtx-message-container')
document.body.appendChild(div)
export default function Message({ type, text, duration = 2000 }: Props) {
  const vNode = h(XtxMessage, { type, text })
  render(vNode, div)
  setTimeout(() => {
    render(null, div)
  }, duration)
}

Message.error = function (text: string, duration = 2000) {
  Message({
    type: 'error',
    text,
    duration,
  })
}
Message.success = function (text: string, duration = 2000) {
  Message({
    type: 'success',
    text,
    duration,
  })
}
Message.warning = function (text: string, duration = 2000) {
  Message({
    type: 'warning',
    text,
    duration,
  })
}
```

## ç™»å½•åŠŸèƒ½-æ”¶é›†è¡¨å•æ•°æ®

ï¼ˆ1ï¼‰æä¾›æ•°æ®ï¼Œç”¨äºæ”¶é›†è¡¨å•æ•°æ®

```typescript
<script lang="ts" setup name="LoginForm">
import { ref } from 'vue'
const isMsgLogin = ref(false)

const form = ref({
  account: '',
  password: '',
  isAgree: false,
})
</script>
```

ï¼ˆ2ï¼‰åŒå‘ç»‘å®š

```diff

<template>
  <div class="account-box">
    <div class="toggle">
      <a href="javascript:;" v-if="isMsgLogin" @click="isMsgLogin = false">
        <i class="iconfont icon-user"></i> ä½¿ç”¨è´¦å·ç™»å½•
      </a>
      <a href="javascript:;" v-else @click="isMsgLogin = true">
        <i class="iconfont icon-msg"></i> ä½¿ç”¨çŸ­ä¿¡ç™»å½•
      </a>
    </div>
    <div class="form">
      <template v-if="!isMsgLogin">
        <div class="form-item">
          <div class="input">
            <i class="iconfont icon-user"></i>
            <input
+              v-model="form.account"
              type="text"
              placeholder="è¯·è¾“å…¥ç”¨æˆ·åæˆ–æ‰‹æœºå·"
            />
          </div>
          <!-- <div class="error"><i class="iconfont icon-warning" />è¯·è¾“å…¥æ‰‹æœºå·</div> -->
        </div>
        <div class="form-item">
          <div class="input">
            <i class="iconfont icon-lock"></i>
            <input
+              v-model="form.password"
              type="password"
              placeholder="è¯·è¾“å…¥å¯†ç "
            />
          </div>
        </div>
      </template>
      <template v-else>
        <div class="form-item">
          <div class="input">
            <i class="iconfont icon-user"></i>
            <input type="text" placeholder="è¯·è¾“å…¥æ‰‹æœºå·" />
          </div>
        </div>
        <div class="form-item">
          <div class="input">
            <i class="iconfont icon-code"></i>
            <input type="password" placeholder="è¯·è¾“å…¥éªŒè¯ç " />
            <span class="code">å‘é€éªŒè¯ç </span>
          </div>
        </div>
      </template>
      <div class="form-item">
        <div class="agree">
+          <XtxCheckbox v-model="form.isAgree" />
          <span>æˆ‘å·²åŒæ„</span>
          <a href="javascript:;">ã€Šéšç§æ¡æ¬¾ã€‹</a>
          <span>å’Œ</span>
          <a href="javascript:;">ã€ŠæœåŠ¡æ¡æ¬¾ã€‹</a>
        </div>
      </div>
      <a href="javascript:;" class="btn">ç™»å½•</a>
    </div>
    <div class="action">
      <img
        src="https://qzonestyle.gtimg.cn/qzone/vas/opensns/res/img/Connect_logo_7.png"
        alt=""
      />
      <div class="url">
        <a href="javascript:;">å¿˜è®°å¯†ç </a>
        <a href="javascript:;">å…è´¹æ³¨å†Œ</a>
      </div>
    </div>
  </div>
</template>
```

## ç™»å½•å‰è¡¨å•æ ¡éªŒ

> ç›®æ ‡ï¼šæ ¡éªŒä¹‹å‰æˆ‘ä»¬å·²ç»å®ç°äº†å¾ˆå¤šæ¬¡ï¼Œè¿™é‡Œå¼±åŒ–éªŒè¯å†™æ³•ï¼Œç®€å•åšä¸€ä¸ªéç©ºæ£€éªŒå³å¯ã€‚

```vue
<script lang="ts" setup name="LoginForm">
import { ref } from 'vue'
import Message from '@/components/message'
const isMsgLogin = ref(false)

const form = ref({
  account: '',
  password: '',
  isAgree: false,
})

const login = () => {
  if (form.value.account === '') {
    Message({ type: 'error', text: 'ç”¨æˆ·åæˆ–æ‰‹æœºå·ä¸èƒ½ä¸ºç©º' })
    return
  }
  if (form.value.password === '') {
    Message({ type: 'error', text: 'å¯†ç ä¸èƒ½ä¸ºç©º' })
    return
  }
  if (!form.value.isAgree) {
    Message({ type: 'error', text: 'è¯·åŒæ„è®¸å¯' })
    return
  }
  console.log('é€šè¿‡æ ¡éªŒï¼Œå¯ä»¥å‘é€è¯·æ±‚')
}
</script>


// ğŸ“Œ ç»‘å®š form å“åº”å¼æ•°æ®åˆ°è¡¨å•å…ƒç´ ä¸­
<input v-model="form.account" type="text" placeholder="è¯·è¾“å…¥ç”¨æˆ·åæˆ–æ‰‹æœºå·" />
<input v-model="form.password" type="password" placeholder="è¯·è¾“å…¥å¯†ç " />
<XtxCheckBox v-model="form.isAgree">æˆ‘å·²åŒæ„</XtxCheckBox>

// ğŸ“Œ ç™»å½•æŒ‰é’®
<a href="javascript:;" class="btn" @click="login">ç™»å½•</a>
```

## Pinia çŠ¶æ€ç®¡ç†

ï¼ˆ1ï¼‰æ–°å»ºæ–‡ä»¶ï¼š `src\store\modules\user.ts`

```typescript
import { defineStore } from 'pinia'

export default defineStore({
  id: 'user',
  // çŠ¶æ€
  state: () => ({}),
})

```



ï¼ˆ2ï¼‰ä¿®æ”¹æ–‡ä»¶ï¼š`src\store\index.ts`

```typescript
import useCategoryStore from './modules/category'
import useHomeStore from './modules/home'
import useGoodsStore from './modules/goods'
import useUserStore from './modules/user'
export default function useStore() {
  return {
    category: useCategoryStore(),
    home: useHomeStore(),
    goods: useGoodsStore(),
    user: useUserStore(),
  }
}

```

- è°ƒè¯•å·¥å…·æ£€æŸ¥ Piniaã€‚

## ç™»å½•åŠŸèƒ½-å‘é€è¯·æ±‚

ï¼ˆ1ï¼‰å®šä¹‰ç±»å‹

```typescript
export interface Profile {
  id: string
  account: string
  mobile: string
  token: string
  avatar: string
  nickname: string
  gender: string
  birthday?: string
  cityCode: string
  provinceCode: string
  profession: string
}
```

ï¼ˆ2ï¼‰å‘é€è¯·æ±‚ï¼Œè·å–ç”¨æˆ·æ•°æ®

```typescript
import { ApiRes } from '@/types/data'
import { Profile } from '@/types/user'
import request from '@/utils/request'
import { defineStore } from 'pinia'

export default defineStore({
  id: 'user',
  // çŠ¶æ€
  state: () => ({
    // ç”¨æˆ·ä¿¡æ¯
    profile: {} as Profile,
  }),
  // æ–¹æ³•
  actions: {
    // ç”¨æˆ·åå’Œå¯†ç ç™»å½•
    async login(account: string, password: string) {
      const res = await request.post<ApiRes<Profile>>('/login', {
        account,
        password,
      })
      // 1. ä¿å­˜ç”¨æˆ·ä¿¡æ¯åˆ° state ä¸­
      this.profile = res.data.result
    },
  },
})

```

ï¼ˆ3ï¼‰ç»„ä»¶ä¸­å‘é€è¯·æ±‚è¿›è¡Œç™»å½•

```typescript
const login = async () => {
  if (form.value.account === '') {
    Message({ type: 'error', text: 'ç”¨æˆ·åæˆ–æ‰‹æœºå·ä¸èƒ½ä¸ºç©º' })
    return
  }
  if (form.value.password === '') {
    Message({ type: 'error', text: 'å¯†ç ä¸èƒ½ä¸ºç©º' })
    return
  }
  if (!form.value.isAgree) {
    Message({ type: 'error', text: 'è¯·åŒæ„è®¸å¯' })
    return
  }
  try {
    await user.login(form.value.account, form.value.password)
    Message({ type: 'success', text: 'ç™»å½•æˆåŠŸ' })
    // è·³è½¬åˆ°é¦–é¡µ
    router.push('/')
  } catch {
    Message.error('ç”¨æˆ·åæˆ–è€…å¯†ç é”™è¯¯')
  }
}
```

## é¦–é¡µä¸ªäººä¿¡æ¯æ¸²æŸ“

ï¼ˆ1ï¼‰ä»piniaä¸­è·å–ä¸ªäººä¿¡æ¯`src/components/app-topnav.vue`

```vue
<script lang="ts" setup name="AppTopnav">
import useStore from '@/store'

const { user } = useStore()
</script>
```

ï¼ˆ2ï¼‰æ¸²æŸ“ä¸ªäººä¿¡æ¯

```html
<template v-if="user.profile.token">
  <li>
    <a href="javascript:;">
      <i class="iconfont icon-user"></i>
      {{ user.profile.nickname }}
    </a>
  </li>
  <li><a href="javascript:;">é€€å‡ºç™»å½•</a></li>
</template>
<template v-else>
  <li><RouterLink to="/login">è¯·å…ˆç™»å½•</RouterLink></li>
  <li><a href="javascript:;">å…è´¹æ³¨å†Œ</a></li>
</template>
```

## è¡¨å•æ ¡éªŒ-åŸºæœ¬ä½¿ç”¨ 

> ç”±äºæ²¡æœ‰ä½¿ç”¨ç»„ä»¶åº“ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä½¿ç”¨[vee-validate](https://vee-validate.logaretm.com/v4/)å®ç°ä¸€ç§é€šç”¨çš„è¡¨å•æ ¡éªŒ
>
> vee-validateå·²ç»  **å…¨é¢æ”¯æŒvue3æœ€æ–°è¯­æ³•** ï¼Œvee-validateåœ¨ä½¿ç”¨ä¸Šä¹Ÿæœ‰å¾ˆå¤§çš„å˜åŒ–    
>
> å¦‚æœç»„ä»¶åº“å¯¹vue3ç”šè‡³æ”¯æŒçš„ä¸å¥½,   æˆ–è€…ç»„ä»¶åº“åœ¨æ ¡éªŒæ–¹ä¾¿æ”¯æŒçš„ä¸å¥½,  æˆ–è€…ä½ å‹æ ¹ä¸å‡†å¤‡ç”¨ä»»ä½•ç»„ä»¶åº“, 
>
> éƒ½å¯ä»¥ç”¨ vee-validate

ï¼ˆ1ï¼‰å®‰è£…

```
yarn add vee-validate
```

ï¼ˆ2ï¼‰å¯¼å…¥å‡½æ•°

```typescript
import { useField, useForm } from 'vee-validate'
```

ï¼ˆ3ï¼‰é€šè¿‡useFormæä¾›æ ¡éªŒè§„åˆ™

```typescript
useForm({
  validationSchema: {
    account(value: string) {
      // valueæ˜¯å°†æ¥ä½¿ç”¨è¯¥è§„åˆ™çš„è¡¨å•å…ƒç´ çš„å€¼
      // 1. å¿…å¡«
      // 2. 6-20ä¸ªå­—ç¬¦ï¼Œéœ€è¦ä»¥å­—æ¯å¼€å¤´
      // å¦‚ä½•åé¦ˆæ ¡éªŒæˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œè¿”å›trueæ‰æ˜¯æˆåŠŸï¼Œå…¶ä»–æƒ…å†µå¤±è´¥ï¼Œè¿”å›å¤±è´¥åŸå› ã€‚
      if (!value) return 'è¯·è¾“å…¥ç”¨æˆ·å'
      if (!/^[a-zA-Z]\w{5,19}$/.test(value)) return 'å­—æ¯å¼€å¤´ä¸”6-20ä¸ªå­—ç¬¦'
      return true
    }
  }
})
```

ï¼ˆ4ï¼‰é€šè¿‡useFieldæä¾›valueå€¼å’Œé”™è¯¯ä¿¡æ¯

```typescript
const { value, errorMessage } = useField('account')
```

ï¼ˆ5ï¼‰ä¸inputæ¡†åŒå‘ç»‘å®š

```typescript
<div class="input">
  <i class="iconfont icon-user"></i>
  <input
    type="text"
    v-model="value"
    placeholder="è¯·è¾“å…¥ç”¨æˆ·åæˆ–æ‰‹æœºå·"
  />
</div>
```

ï¼ˆ6ï¼‰æ˜¾ç¤ºé”™è¯¯

```typescript
<div class="error" v-if="errorMessage">
  <i class="iconfont icon-warning" />{{ errorMessage }}
</div>
```

## è¡¨å•æ ¡éªŒ-å®Œæ•´è¡¨å•æ ¡éªŒ

ï¼ˆ1ï¼‰æä¾›å®Œæ•´çš„è¡¨å•æ ¡éªŒè§„åˆ™

```typescript
// è¡¨å•æ ¡éªŒ
useForm({
  // æä¾›æ ¡éªŒè§„åˆ™
  validationSchema: {
    account: (value: string) => {
      // æ ¡éªŒçš„valueå€¼
      // valueæ˜¯å°†æ¥ä½¿ç”¨è¯¥è§„åˆ™çš„è¡¨å•å…ƒç´ çš„å€¼
      // 1. å¿…å¡«
      // 2. 6-20ä¸ªå­—ç¬¦ï¼Œéœ€è¦ä»¥å­—æ¯å¼€å¤´
      // å¦‚ä½•åé¦ˆæ ¡éªŒæˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œè¿”å›trueæ‰æ˜¯æˆåŠŸï¼Œå…¶ä»–æƒ…å†µå¤±è´¥ï¼Œè¿”å›å¤±è´¥åŸå› ã€‚
      if (!value) return 'è¯·è¾“å…¥ç”¨æˆ·å'
      if (!/^[a-zA-Z]\w{5,19}$/.test(value)) return 'å­—æ¯å¼€å¤´ä¸”6-20ä¸ªå­—ç¬¦'
      return true
    },
    password: (value: string) => {
      if (!value) return 'è¯·è¾“å…¥å¯†ç '
      if (!/^\w{6,12}$/.test(value)) return 'å¯†ç å¿…é¡»æ˜¯6-24ä½å­—ç¬¦'
      return true
    },
    isAgree: (value: boolean) => {
      if (!value) return 'è¯·åŒæ„éšç§æ¡æ¬¾'
      return true
    },
  },
})
```

ï¼ˆ2ï¼‰ç»™æ¯ä¸€ä¸ªå­—æ®µæä¾›æ ¡éªŒ

```typescript
const { value: account, errorMessage: accountError } =
  useField<string>('account')
const { value: password, errorMessage: passwordError } =
  useField<string>('password')
const { value: isAgree, errorMessage: isAgreeError } =
  useField<boolean>('isAgree')
```

ï¼ˆ3ï¼‰ç»‘å®šè¡¨å•å…ƒç´ 

```typescript
<template>
  <div class="account-box">
    <div class="toggle">
      <a href="javascript:;" @click="type = 'account'" v-if="type === 'mobile'">
        <i class="iconfont icon-user"></i> ä½¿ç”¨è´¦å·ç™»å½•
      </a>
      <a href="javascript:;" @click="type = 'mobile'" v-else>
        <i class="iconfont icon-msg"></i> ä½¿ç”¨çŸ­ä¿¡ç™»å½•
      </a>
    </div>
    <div class="form">
      <template v-if="type === 'account'">
        <div class="form-item">
          <div class="input">
            <i class="iconfont icon-user"></i>
            <input
              type="text"
              v-model="account"
              placeholder="è¯·è¾“å…¥ç”¨æˆ·åæˆ–æ‰‹æœºå·"
            />
          </div>
          <div class="error" v-if="accountError">
            <i class="iconfont icon-warning" />{{ accountError }}
          </div>
        </div>
        <div class="form-item">
          <div class="input">
            <i class="iconfont icon-lock"></i>
            <input
              type="password"
              v-model="password"
              placeholder="è¯·è¾“å…¥å¯†ç "
            />
          </div>
          <div class="error" v-if="passwordError">
            <i class="iconfont icon-warning" />{{ passwordError }}
          </div>
        </div>
      </template>
      <div class="form-item">
        <div class="agree">
          <XtxCheckbox v-model="isAgree"></XtxCheckbox>
          <span>æˆ‘å·²åŒæ„</span>
          <a href="javascript:;">ã€Šéšç§æ¡æ¬¾ã€‹</a>
          <span>å’Œ</span>
          <a href="javascript:;">ã€ŠæœåŠ¡æ¡æ¬¾ã€‹</a>
        </div>
        <div class="error" v-if="isAgreeError">
          <i class="iconfont icon-warning" />{{ isAgreeError }}
        </div>
      </div>
      <a href="javascript:;" class="btn" @click="login">ç™»å½•</a>
    </div>
    <div class="action">
      <img
        src="https://qzonestyle.gtimg.cn/qzone/vas/opensns/res/img/Connect_logo_7.png"
        alt=""
      />
      <div class="url">
        <a href="javascript:;">å¿˜è®°å¯†ç </a>
        <a href="javascript:;">å…è´¹æ³¨å†Œ</a>
      </div>
    </div>
  </div>
</template>
```

## è¡¨å•æ ¡éªŒ-ç™»å½•æ—¶æ ¡éªŒ

ï¼ˆ1ï¼‰å¯¼å…¥å‡½æ•°

```typescript
import { useField, useForm } from 'vee-validate'
```

ï¼ˆ2ï¼‰ç™»å½•æ—¶ï¼Œå¯¹æ•´ä¸ªè¡¨å•è¿›è¡Œæ ¡éªŒ

```typescript
// è¡¨å•æ ¡éªŒ
const { validate } = useForm({
  // æä¾›æ ¡éªŒè§„åˆ™
  validationSchema: {
    account: (value: string) => {
      // æ ¡éªŒçš„valueå€¼
      // valueæ˜¯å°†æ¥ä½¿ç”¨è¯¥è§„åˆ™çš„è¡¨å•å…ƒç´ çš„å€¼
      // 1. å¿…å¡«
      // 2. 6-20ä¸ªå­—ç¬¦ï¼Œéœ€è¦ä»¥å­—æ¯å¼€å¤´
      // å¦‚ä½•åé¦ˆæ ¡éªŒæˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œè¿”å›trueæ‰æ˜¯æˆåŠŸï¼Œå…¶ä»–æƒ…å†µå¤±è´¥ï¼Œè¿”å›å¤±è´¥åŸå› ã€‚
      if (!value) return 'è¯·è¾“å…¥ç”¨æˆ·å'
      if (!/^[a-zA-Z]\w{5,19}$/.test(value)) return 'å­—æ¯å¼€å¤´ä¸”6-20ä¸ªå­—ç¬¦'
      return true
    },
    password: (value: string) => {
      if (!value) return 'è¯·è¾“å…¥å¯†ç '
      if (!/^\w{6,12}$/.test(value)) return 'å¯†ç å¿…é¡»æ˜¯6-24ä½å­—ç¬¦'
      return true
    },
    isAgree: (value: boolean) => {
      if (!value) return 'è¯·åŒæ„éšç§æ¡æ¬¾'
      return true
    },
  },
})


const login = async () => {
  const res = await validate()
  if (!res.valid) return
  try {
    await user.login(account.value, password.value)
    Message.success('ç™»å½•æˆåŠŸ')
    router.push('/')
  } catch {
    Message.error('è´¦å·æˆ–è€…å¯†ç é”™è¯¯')
  }
}

```

:::tip æäº¤å†™æ³•æ‹“å±•

```vue
// åˆ›å»ºæ ¡éªŒè§„åˆ™
const {handleSubmit} = useForm({
  validationSchema: {
    account(value: string) {
      const reg = /^[a-zA-Z]\w{5,19}$/;
      if (!value) return 'è¯·å¡«å†™ç”¨æˆ·å'
      if (!reg.test(value)) return 'å­—æ¯å¼€å¤´åŒæ—¶6-20ä¸ªå­—ç¬¦'
      return true
    },
    password: (value: string) => {
      if (!value) return 'è¯·è¾“å…¥å¯†ç '
      if (!/^\w{6,12}$/.test(value)) return 'å¯†ç å¿…é¡»æ˜¯6-24ä½å­—ç¬¦'
      return true
    },
    isAgree: (value: boolean) => {
      if (!value) return 'è¯·åŒæ„éšç§æ¡æ¬¾'
      return true
    },
  }
})

const login = handleSubmit(async values => {
  try {
    await user.login(values.account, values.password)
    Message.success('ç™»å½•æˆåŠŸ')
    await push('/')
  } catch (e) {
    Message.error('ç™»å½•å¤±è´¥')
  }
})
```



:::

## çŸ­ä¿¡ç™»å½•-è¡¨å•æ ¡éªŒ

ï¼ˆ1ï¼‰useFormå¢åŠ äº†ä¸¤ä¸ªæ ¡éªŒ

```typescript
// è¡¨å•æ ¡éªŒ
const { validate } = useForm({
  // æä¾›æ ¡éªŒè§„åˆ™
  validationSchema: {
    account: (value: string) => {
      // æ ¡éªŒçš„valueå€¼
      // valueæ˜¯å°†æ¥ä½¿ç”¨è¯¥è§„åˆ™çš„è¡¨å•å…ƒç´ çš„å€¼
      // 1. å¿…å¡«
      // 2. 6-20ä¸ªå­—ç¬¦ï¼Œéœ€è¦ä»¥å­—æ¯å¼€å¤´
      // å¦‚ä½•åé¦ˆæ ¡éªŒæˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œè¿”å›trueæ‰æ˜¯æˆåŠŸï¼Œå…¶ä»–æƒ…å†µå¤±è´¥ï¼Œè¿”å›å¤±è´¥åŸå› ã€‚
      if (!value) return 'è¯·è¾“å…¥ç”¨æˆ·å'
      if (!/^[a-zA-Z]\w{5,19}$/.test(value)) return 'å­—æ¯å¼€å¤´ä¸”6-20ä¸ªå­—ç¬¦'
      return true
    },
    password: (value: string) => {
      if (!value) return 'è¯·è¾“å…¥å¯†ç '
      if (!/^\w{6,12}$/.test(value)) return 'å¯†ç å¿…é¡»æ˜¯6-24ä½å­—ç¬¦'
      return true
    },
    isAgree: (value: boolean) => {
      if (!value) return 'è¯·åŒæ„éšç§æ¡æ¬¾'
      return true
    },
    mobile: (value: string) => {
      if (!value) return 'è¯·è¾“å…¥æ‰‹æœºå·'
      if (!/^1[3-9]\d{9}$/.test(value)) return 'æ‰‹æœºå·æ ¼å¼é”™è¯¯'
      return true
    },
    code: (value: string) => {
      if (!value) return 'è¯·è¾“å…¥éªŒè¯ç '
      if (!/^\d{6}$/.test(value)) return 'éªŒè¯ç æ ¼å¼é”™è¯¯'
      return true
    },
  },
})
```

ï¼ˆ2ï¼‰å¢åŠ ä¸¤ä¸ªuseField

```typescript
const { value: mobile, errorMessage: mobileError } = useField<string>('mobile')
const { value: code, errorMessage: codeError } = useField<string>('code')
```

ï¼ˆ3ï¼‰ç»‘å®švalueå€¼

```vue
<template v-else>
  <div class="form-item">
    <div class="input">
      <i class="iconfont icon-user"></i>
      <input type="text" v-model="mobile" placeholder="è¯·è¾“å…¥æ‰‹æœºå·" />
    </div>
    <div class="error" v-if="mobileError">
      <i class="iconfont icon-warning" />{{ mobileError }}
    </div>
  </div>
  <div class="form-item">
    <div class="input">
      <i class="iconfont icon-code"></i>
      <input type="text" v-model="code" placeholder="è¯·è¾“å…¥éªŒè¯ç " />
      <span class="code">å‘é€éªŒè¯ç </span>
    </div>
    <div class="error" v-if="codeError">
      <i class="iconfont icon-warning" />{{ codeError }}
    </div>
  </div>
</template>
```

## çŸ­ä¿¡ç™»å½•-åˆ‡æ¢æ—¶é‡ç½®è¡¨å•æ ¡éªŒ

ï¼ˆ1ï¼‰é€šè¿‡useFormè§£æ„resetFormæ–¹æ³•

```typescript

// è¡¨å•æ ¡éªŒ
const { validate, resetForm } = useForm({
  // æä¾›æ ¡éªŒè§„åˆ™
  validationSchema: {
    //....
  },
})
```

ï¼ˆ2ï¼‰ç›‘å¬typeçš„å˜åŒ–ï¼Œé‡ç½®

```typescript
// ç›‘å¬typeçš„å˜åŒ–
watch(type, () => {
  // é‡ç½®è¡¨å•
  resetForm()
})
```



## çŸ­ä¿¡ç™»å½•-è·å–éªŒè¯ç -è¡¨å•æ ¡éªŒ

> éœ€æ±‚ï¼šç‚¹å‡»è·å–éªŒè¯ç æ—¶å€™ï¼Œèƒ½å¤Ÿå¯¹æ‰‹æœºå·è¿›è¡Œæ ¼å¼æ ¡éªŒï¼Œå¦‚æœæ ¡éªŒä¸é€šè¿‡ï¼Œè‡ªåŠ¨è·å–ç„¦ç‚¹

ï¼ˆ1ï¼‰æ³¨å†Œäº‹ä»¶

```typescript
<span class="code" @click="send">å‘é€éªŒè¯ç </span>
```

ï¼ˆ2ï¼‰å¯¼å…¥å‡½æ•°

```typescript
const {
  value: mobile,
  errorMessage: mobileError,
  validate: validateMobile,
} = useField<string>('mobile')
```

ï¼ˆ3ï¼‰éªŒè¯è¡¨å•

```typescript

const mobileRef = ref<HTMLInputElement | null>(null)
const send = async () => {
  const res = await validateMobile()
  if (!res.valid) {
    // æ ¡éªŒæ²¡é€šè¿‡
    mobileRef.value?.focus()
    return
  }
  console.log('å‘é€éªŒè¯ç ')
}
```

ï¼ˆ4ï¼‰ç»‘å®šref

```typescript
<div class="input">
  <i class="iconfont icon-user"></i>
  <input
    ref="mobileRef"
    v-model="mobile"
    type="text"
    placeholder="è¯·è¾“å…¥æ‰‹æœºå·"
  />
</div>
```

## çŸ­ä¿¡ç™»å½•-è·å–éªŒè¯ç -å‘é€è¯·æ±‚

ï¼ˆ1ï¼‰åœ¨actionsä¸­æä¾›æ–¹æ³•

```typescript
// è·å–æ‰‹æœºéªŒè¯ç 
async sendMobileMsg(mobile: string) {
  await request.get('/login/code', {
    params: {
      mobile
    }
  })
}
```

ï¼ˆ2ï¼‰è¡¨å•æ ¡éªŒé€šè¿‡æ—¶ï¼Œå‘é€è¯·æ±‚ï¼Œè·å–éªŒè¯ç 

```typescript
const send = async () => {
  // console.log('è·å–éªŒè¯ç ')
  // å•ç‹¬æ ¡éªŒæ‰‹æœºå·
  const res = await validMobile()
  if (!res.valid) {
    // å¦‚æœæ²¡é€šè¿‡ï¼Œè‡ªåŠ¨è·å–æ‰‹æœºå·çš„ç„¦ç‚¹
    mobileRef.value!.focus()
    return
  }
  try {
    await user.sendMobileMsg(mobile.value)
    Message.success('è·å–éªŒè¯ç æˆåŠŸ')
  } catch {
    Message.error('è·å–éªŒè¯ç å¤±è´¥')
  }
}
```

## é…ç½®axioså“åº”æ‹¦æˆªå™¨-ç»Ÿä¸€å¤„ç†é”™è¯¯

ï¼ˆ1ï¼‰ç»™axiosç»Ÿä¸€å¤„ç†é”™è¯¯æç¤º

```typescript

// æ·»åŠ å“åº”æ‹¦æˆªå™¨
request.interceptors.response.use(
  function (response) {
    return response
  },
  function (error: AxiosError) {
    // Message.error(error.response.data.message)
    // å¯¹å“åº”é”™è¯¯åšç‚¹ä»€ä¹ˆ
    if (!error.response) {
      Message.error('ç½‘ç»œå¼‚å¸¸ï¼Œè¯·ç¨åé‡ç½®')
    } else {
      Message.error(error.response.data.message)
    }
    return Promise.reject(error)
  }
)

```



## çŸ­ä¿¡ç™»å½•-è·å–éªŒè¯ç -å€’è®¡æ—¶

ï¼ˆ1ï¼‰æä¾›å€’è®¡æ—¶é€»è¾‘

```typescript
const time = ref(0)
let timer = -1
const send = async () => {
  if (time.value > 0) return
  // console.log('è·å–éªŒè¯ç ')
  // å•ç‹¬æ ¡éªŒæ‰‹æœºå·
  const res = await validMobile()
  if (!res.valid) {
    // å¦‚æœæ²¡é€šè¿‡ï¼Œè‡ªåŠ¨è·å–æ‰‹æœºå·çš„ç„¦ç‚¹
    mobileRef.value!.focus()
    return
  }
  await user.sendMobileMsg(mobile.value)
  Message.success('è·å–éªŒè¯ç æˆåŠŸ')

  // å¼€å¯å€’è®¡æ—¶
  time.value = 60
  timer = window.setInterval(() => {
    time.value--
    if (time.value === 0) {
      clearInterval(timer)
    }
  }, 1000)
}
```

ï¼ˆ2ï¼‰æ¸²æŸ“å€’è®¡æ—¶å†…å®¹

```typescript
<div class="form-item">
  <div class="input">
    <i class="iconfont icon-code"></i>
    <input v-model="code" type="password" placeholder="è¯·è¾“å…¥éªŒè¯ç " />
    <span class="code" @click="send">
      {{ time === 0 ? 'å‘é€éªŒè¯ç ' : `${time}såå‘é€` }}
    </span>
  </div>
```

## çŸ­ä¿¡ç™»å½•-è·å–éªŒè¯ç -å€’è®¡æ—¶ä¼˜åŒ–

> å‚è€ƒæ–‡æ¡£ï¼šhttps://vueuse.org/shared/useintervalfn/

ä¿®æ”¹ç™»å½•å€’è®¡æ—¶ä»£ç 

```typescript
const time = ref(0)
const { pause, resume } = useIntervalFn(
  () => {
    time.value--
    if (time.value <= 0) {
      pause()
    }
  },
  1000,
  {
    immediate: false
  }
)

const send = async () => {
  if (time.value > 0) return
  // console.log('è·å–éªŒè¯ç ')
  // å•ç‹¬æ ¡éªŒæ‰‹æœºå·
  const res = await validMobile()
  if (!res.valid) {
    // å¦‚æœæ²¡é€šè¿‡ï¼Œè‡ªåŠ¨è·å–æ‰‹æœºå·çš„ç„¦ç‚¹
    mobileRef.value!.focus()
    return
  }
  await user.sendMobileMsg(mobile.value)
  Message.success('è·å–éªŒè¯ç æˆåŠŸ')

  // å¼€å¯å€’è®¡æ—¶
  time.value = 60
  resume()
}
```

## çŸ­ä¿¡ç™»å½•-è·å–éªŒè¯ç -å°è£…

åœ¨hooks/index.tsä¸­å°è£…å‡½æ•°

```typescript
import { useIntersectionObserver, useIntervalFn } from '@vueuse/core'
import { onUnmounted, ref } from 'vue'

/**
 * å°è£…ä¸€ä¸ªå€’è®¡æ—¶åŠŸèƒ½
 */
export function useCountDown(count: number = 60) {
  const time = ref(0)
  const { pause, resume } = useIntervalFn(
    () => {
      time.value--
      if (time.value === 0) {
        pause()
      }
    },
    1000,
    { immediate: false }
  )

  // ç»„ä»¶é”€æ¯æ—¶æ¸…é™¤å®šæ—¶å™¨
  onUnmounted(() => {
    pause()
  })

  const start = () => {
    time.value = count
    resume()
  }

  return {
    time,
    start
  }
}
```

ä½¿ç”¨

```typescript
const { time, start } = useCountDown(60)
const send = async () => {
  if (time.value > 0) return
  // console.log('è·å–éªŒè¯ç ')
  // å•ç‹¬æ ¡éªŒæ‰‹æœºå·
  const res = await validMobile()
  if (!res.valid) {
    // å¦‚æœæ²¡é€šè¿‡ï¼Œè‡ªåŠ¨è·å–æ‰‹æœºå·çš„ç„¦ç‚¹
    mobileRef.value!.focus()
    return
  }
  await user.sendMobileMsg(mobile.value)
  Message.success('è·å–éªŒè¯ç æˆåŠŸ')

  start()
}
```

## çŸ­ä¿¡ç™»å½•-åŠŸèƒ½å®Œæˆ

ï¼ˆ1ï¼‰å°è£…çŸ­ä¿¡ç™»å½•æ¥å£

```typescript
// ç”¨æˆ·åå’Œå¯†ç ç™»å½•
async login(account: string, password: string) {
  const res = await request.post<ApiRes<Profile>>('/login', {
    account,
    password
  })
  // 1. ä¿å­˜ç”¨æˆ·ä¿¡æ¯åˆ° state ä¸­
  this.profile = res.data.result
  setProfile(res.data.result)
},
async mobileLogin(mobile: string, code: string) {
  const res = await request.post<ApiRes<Profile>>('/login/code', {
    mobile,
    code
  })
  // 1. ä¿å­˜ç”¨æˆ·ä¿¡æ¯åˆ° state ä¸­
  this.profile = res.data.result
  setProfile(res.data.result)
},
```

ï¼ˆ2ï¼‰ä¿®æ”¹ç™»å½•é€»è¾‘

```typescript
const login = async () => {
  const res = await validForm()
  if (type.value === 'account') {
    // å¦‚æœè¡¨å•æ ¡éªŒé€šè¿‡
    if (res.errors.account || res.errors.password || res.errors.isAgree) return
    await user.login(account.value, password.value)
  } else {
    if (res.errors.mobile || res.errors.code || res.errors.isAgree) return
    await user.mobileLogin(mobile.value, code.value)
  }
  Message.success('ç™»å½•æˆåŠŸ')
  router.push('/')
}

```

ï¼ˆ3ï¼‰ä¿®æ”¹æ˜¾ç¤ºæ•ˆæœ

```typescript
<li>
  <a href="javascript:;">
    <i class="iconfont icon-user"></i>
    {{ user.profile.nickname || user.profile.account }}
  </a>
</li>
```

## è¡¨å•æ ¡éªŒ-æä¾›åˆå§‹å€¼

> ä¸ºäº†æ–¹ä¾¿æµ‹è¯•ï¼Œæä¾›åˆå§‹å€¼

```typescript
useForm({
  validationSchema: {
    account(value: string) {
      // valueæ˜¯å°†æ¥ä½¿ç”¨è¯¥è§„åˆ™çš„è¡¨å•å…ƒç´ çš„å€¼
      // 1. å¿…å¡«
      // 2. 6-20ä¸ªå­—ç¬¦ï¼Œéœ€è¦ä»¥å­—æ¯å¼€å¤´
      // å¦‚ä½•åé¦ˆæ ¡éªŒæˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œè¿”å›trueæ‰æ˜¯æˆåŠŸï¼Œå…¶ä»–æƒ…å†µå¤±è´¥ï¼Œè¿”å›å¤±è´¥åŸå› ã€‚
      if (!value) return 'è¯·è¾“å…¥ç”¨æˆ·å'
      if (!/^[a-zA-Z]\w{5,19}$/.test(value)) return 'å­—æ¯å¼€å¤´ä¸”6-20ä¸ªå­—ç¬¦'
      return true
    },
    password(value: string) {
      if (!value) return 'è¯·è¾“å…¥å¯†ç '
      if (!/^\w{6,24}$/.test(value)) return 'å¯†ç æ˜¯6-24ä¸ªå­—ç¬¦'
      return true
    },
    mobile(value: string) {
      if (!value) return 'è¯·è¾“å…¥æ‰‹æœºå·'
      if (!/^1[3-9]\d{9}$/.test(value)) return 'æ‰‹æœºå·æ ¼å¼é”™è¯¯'
      return true
    },
    code(value: string) {
      if (!value) return 'è¯·è¾“å…¥éªŒè¯ç '
      if (!/^\d{6}$/.test(value)) return 'éªŒè¯ç æ˜¯6ä¸ªæ•°å­—'
      return true
    },
    isAgree(value: string) {
      if (!value) return 'è¯·å‹¾é€‰åŒæ„ç”¨æˆ·åè®®'
      return true
    }
  },
  initialValues: {
    mobile: '13666666666',
    code: '123456',
    account: 'xiaotuxian001',
    password: '123456',
    isAgree: true
  }
})

```



## æ•°æ®æŒä¹…åŒ–

åœ¨piniaä¸­å­˜å‚¨çš„æ•°æ®æ˜¯ä¿å­˜åœ¨å†…å­˜ä¸­çš„ï¼Œå› æ­¤ä¸€åˆ·æ–°é¡µé¢ï¼Œpiniaä¸­çš„æ•°æ®å°±ä¸¢å¤±äº†ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æŠŠæ•°æ®ä¿å­˜åˆ°localStorageä¸­ã€‚

ï¼ˆ1ï¼‰å°è£…storageçš„æ“ä½œ

```typescript
import { Profile } from '@/types/user'
const PROFILE_KEY = 'rabbit-profile-92'
// å°è£…å’Œlocalstorageç›¸å…³çš„api

/**
 * è®¾ç½®ä¸ªäººä¿¡æ¯
 * @param profile
 */
export function setProfile(profile: Profile): void {
  localStorage.setItem(PROFILE_KEY, JSON.stringify(profile))
}

/**
 * è·å–ä¸ªäººä¿¡æ¯
 * @returns
 */
export function getProfile(): Profile {
  return JSON.parse(localStorage.getItem(PROFILE_KEY) || '{}')
}

/**
 * ç§»é™¤ä¸ªäººä¿¡æ¯
 */
export function removeProfile(): void {
  localStorage.removeItem(PROFILE_KEY)
}

```

ï¼ˆ2ï¼‰ä¿å­˜ä¿¡æ¯æ—¶æŒä¹…åŒ–

```diff
actions: {
  // ç”¨æˆ·åå’Œå¯†ç ç™»å½•
  async login(account: string, password: string) {
    const res = await request.post<ApiRes<Profile>>('/login', {
      account,
      password
    })
    // 1. ä¿å­˜ç”¨æˆ·ä¿¡æ¯åˆ° state ä¸­
    this.profile = res.data.result
+    setProfile(res.data.result)
  }
}
```

ï¼ˆ3ï¼‰è·å–æ˜¯ä»localstorageä¸­è·å–

```typescript
state: () => ({
  profile: getProfile()
}),
```

## é€€å‡ºç™»å½•åŠŸèƒ½

ï¼ˆ1ï¼‰actionsä¸­æä¾›é€€å‡ºæ–¹æ³•

```typescript
logout() {
  this.profile = {} as Profile
  removeProfile()
}
```

ï¼ˆ2ï¼‰åœ¨app-topnavä¸­å®Œæˆé€€å‡ºåŠŸèƒ½

```typescript
<script lang="ts" setup name="AppTopnav">
import Message from '@/components/message'
import router from '@/router'
import useStore from '@/store'

const { user } = useStore()
const logout = () => {
  user.logout()
  router.push('/login')
  Message.success('é€€å‡ºæˆåŠŸ')
}
</script>

<li><a href="javascript:;" @click="logout">é€€å‡ºç™»å½•</a></li>
```
