# ğŸ“š  12.ç»“ç®—æ¨¡å—

## ç»“ç®—é¡µé¢å¸ƒå±€å’Œè·¯ç”±

è½åœ°ä»£ç ï¼š

1. å®šä¹‰ç»„ä»¶åŸºç¡€è§£æ„å’Œé…ç½®è·¯ç”±

`src/views/member/pay/checkout.vue` å®šä¹‰ç»„ä»¶

```vue
<script lang="ts" setup name="XtxPayCheckoutPage"></script>

<template>
  <div class="xtx-pay-checkout-page">
    <div class="container">
      <XtxBread>
        <XtxBreadItem to="/">é¦–é¡µ</XtxBreadItem>
        <XtxBreadItem to="/cart">è´­ç‰©è½¦</XtxBreadItem>
        <XtxBreadItem>å¡«å†™è®¢å•</XtxBreadItem>
      </XtxBread>
      <div class="wrapper">
        <!-- æ”¶è´§åœ°å€ -->
        <h3 class="box-title">æ”¶è´§åœ°å€</h3>
        <div class="box-body">
          <div class="address">
            <div class="text">
              <ul>
                <li><span>æ”¶&ensp;è´§&ensp;äººï¼š</span>æœ±è¶…</li>
                <li><span>è”ç³»æ–¹å¼ï¼š</span>132****2222</li>
                <li>
                  <span>æ”¶è´§åœ°å€ï¼š</span>æµ·å—çœä¸‰äºšå¸‚è§£æ”¾è·¯108å·ç‰©è´¨å¤§å¦1003å®¤
                </li>
              </ul>
              <!-- <div class="none">æ‚¨éœ€è¦å…ˆæ·»åŠ æ”¶è´§åœ°å€æ‰å¯æäº¤è®¢å•ã€‚</div> -->
            </div>
            <div class="action">
              <XtxButton class="btn">åˆ‡æ¢åœ°å€</XtxButton>
              <XtxButton class="btn">æ·»åŠ åœ°å€</XtxButton>
            </div>
          </div>
        </div>
        <!-- å•†å“ä¿¡æ¯ -->
        <h3 class="box-title">å•†å“ä¿¡æ¯</h3>
        <div class="box-body">
          <table class="goods">
            <thead>
              <tr>
                <th width="520">å•†å“ä¿¡æ¯</th>
                <th width="170">å•ä»·</th>
                <th width="170">æ•°é‡</th>
                <th width="170">å°è®¡</th>
                <th width="170">å®ä»˜</th>
              </tr>
            </thead>
            <tbody>
              <tr v-for="item in 4" :key="item">
                <td>
                  <a href="javascript:;" class="info">
                    <img
                      src="https://yanxuan-item.nosdn.127.net/cd9b2550cde8bdf98c9d083d807474ce.png"
                      alt=""
                    />
                    <div class="right">
                      <p>è½»å·§å¤šç”¨é”…é›ªå¹³é”… éº¦é¥­çŸ³ä¸ç²˜å°å¥¶é”…ç…®é”…</p>
                      <p>é¢œè‰²ï¼šç™½è‰² å°ºå¯¸ï¼š10cm äº§åœ°ï¼šæ—¥æœ¬</p>
                    </div>
                  </a>
                </td>
                <td>&yen;100.00</td>
                <td>2</td>
                <td>&yen;200.00</td>
                <td>&yen;200.00</td>
              </tr>
            </tbody>
          </table>
        </div>
        <!-- é…é€æ—¶é—´ -->
        <h3 class="box-title">é…é€æ—¶é—´</h3>
        <div class="box-body">
          <a class="my-btn active" href="javascript:;"
            >ä¸é™é€è´§æ—¶é—´ï¼šå‘¨ä¸€è‡³å‘¨æ—¥</a
          >
          <a class="my-btn" href="javascript:;">å·¥ä½œæ—¥é€è´§ï¼šå‘¨ä¸€è‡³å‘¨äº”</a>
          <a class="my-btn" href="javascript:;">åŒä¼‘æ—¥ã€å‡æ—¥é€è´§ï¼šå‘¨å…­è‡³å‘¨æ—¥</a>
        </div>
        <!-- æ”¯ä»˜æ–¹å¼ -->
        <h3 class="box-title">æ”¯ä»˜æ–¹å¼</h3>
        <div class="box-body">
          <a class="my-btn active" href="javascript:;">åœ¨çº¿æ”¯ä»˜</a>
          <a class="my-btn" href="javascript:;">è´§åˆ°ä»˜æ¬¾</a>
          <span style="color: #999">è´§åˆ°ä»˜æ¬¾éœ€ä»˜5å…ƒæ‰‹ç»­è´¹</span>
        </div>
        <!-- é‡‘é¢æ˜ç»† -->
        <h3 class="box-title">é‡‘é¢æ˜ç»†</h3>
        <div class="box-body">
          <div class="total">
            <dl>
              <dt>å•†å“ä»¶æ•°ï¼š</dt>
              <dd>5ä»¶</dd>
            </dl>
            <dl>
              <dt>å•†å“æ€»ä»·ï¼š</dt>
              <dd>Â¥5697.00</dd>
            </dl>
            <dl>
              <dt>è¿<i></i>è´¹ï¼š</dt>
              <dd>Â¥0.00</dd>
            </dl>
            <dl>
              <dt>åº”ä»˜æ€»é¢ï¼š</dt>
              <dd class="price">Â¥5697.00</dd>
            </dl>
          </div>
        </div>
        <!-- æäº¤è®¢å• -->
        <div class="submit">
          <XtxButton type="primary">æäº¤è®¢å•</XtxButton>
        </div>
      </div>
    </div>
  </div>
</template>

<style scoped lang="less">
.wrapper {
  background: #fff;
  padding: 0 20px;
  .box-title {
    font-size: 16px;
    font-weight: normal;
    padding-left: 10px;
    line-height: 70px;
    border-bottom: 1px solid #f5f5f5;
  }
  .box-body {
    padding: 20px 0;
  }
}
.address {
  border: 1px solid #f5f5f5;
  display: flex;
  align-items: center;
  .text {
    flex: 1;
    min-height: 90px;
    display: flex;
    align-items: center;
    .none {
      line-height: 90px;
      color: #999;
      text-align: center;
      width: 100%;
    }
    > ul {
      flex: 1;
      padding: 20px;
      li {
        line-height: 30px;
        span {
          color: #999;
          margin-right: 5px;
          > i {
            width: 0.5em;
            display: inline-block;
          }
        }
      }
    }
    > a {
      color: @xtxColor;
      width: 160px;
      text-align: center;
      height: 90px;
      line-height: 90px;
      border-right: 1px solid #f5f5f5;
    }
  }
  .action {
    width: 420px;
    text-align: center;
    .btn {
      width: 140px;
      height: 46px;
      line-height: 44px;
      font-size: 14px;
      &:first-child {
        margin-right: 10px;
      }
    }
  }
}
.goods {
  width: 100%;
  border-collapse: collapse;
  border-spacing: 0;
  .info {
    display: flex;
    text-align: left;
    img {
      width: 70px;
      height: 70px;
      margin-right: 20px;
    }
    .right {
      line-height: 24px;
      p {
        &:last-child {
          color: #999;
        }
      }
    }
  }
  tr {
    th {
      background: #f5f5f5;
      font-weight: normal;
    }
    td,
    th {
      text-align: center;
      padding: 20px;
      border-bottom: 1px solid #f5f5f5;
      &:first-child {
        border-left: 1px solid #f5f5f5;
      }
      &:last-child {
        border-right: 1px solid #f5f5f5;
      }
    }
  }
}
.my-btn {
  width: 228px;
  height: 50px;
  border: 1px solid #e4e4e4;
  text-align: center;
  line-height: 48px;
  margin-right: 25px;
  color: #666666;
  display: inline-block;
  &.active,
  &:hover {
    border-color: @xtxColor;
  }
}
.total {
  dl {
    display: flex;
    justify-content: flex-end;
    line-height: 50px;
    dt {
      i {
        display: inline-block;
        width: 2em;
      }
    }
    dd {
      width: 240px;
      text-align: right;
      padding-right: 70px;
      &.price {
        font-size: 20px;
        color: @priceColor;
      }
    }
  }
}
.submit {
  text-align: right;
  padding: 60px;
  border-top: 1px solid #f5f5f5;
}
// å¯¹è¯æ¡†åœ°å€åˆ—è¡¨
.xtx-dialog {
  .addressWrapper {
    max-height: 500px;
    overflow-y: auto;
  }
  .text {
    flex: 1;
    min-height: 90px;
    display: flex;
    align-items: center;
    &.item {
      border: 1px solid #f5f5f5;
      margin-bottom: 10px;
      cursor: pointer;
      &.active,
      &:hover {
        border-color: @xtxColor;
        background: lighten(@xtxColor, 50%);
      }
      > ul {
        padding: 10px;
        font-size: 14px;
        line-height: 30px;
      }
    }
  }
}
</style>
```

`src/router/index.ts` é…ç½®è·¯ç”±

```ts
{
  path: '/member/checkout',
  component: () => import('@/views/member/pay/checkout.vue')
}
```

ç»™ç»“ç®—æŒ‰é’®æ³¨å†Œç‚¹å‡»äº‹ä»¶

```jsx
<XtxButton type="primary" @click="goCheckout">ä¸‹å•ç»“ç®—</XtxButton>
```

æä¾›è·³è½¬å‡½æ•°

```jsx
// è·³è½¬åˆ°ç»“ç®—é¡µ
const router = useRouter()
const goCheckout = () => {
  if (cart.selectedList.length === 0) {
    return Message.warning('è¯·è‡³å°‘é€‰æ‹©ä¸€ä»¶å•†å“')
  }
  router.push('/member/checkout')
}
```

## æ‹¦æˆªæœªç™»å½•çš„ç”¨æˆ·

> å¯¹äºç»“ç®—é¡µé¢ï¼Œæ²¡æœ‰ç™»å½•çš„ç”¨æˆ·æ˜¯æ— æ³•è®¿é—®çš„

ï¼ˆ1ï¼‰æ‹¦æˆªæœªç™»å½•çš„ç”¨æˆ·`src/router/index.ts`

```js
// é…ç½®è·¯ç”±å¯¼èˆªå®ˆå«ï¼Œæ‹¦æˆª /memberå¼€å¤´çš„æ‰€æœ‰çš„åœ°å€
router.beforeEach((to, from, next) => {
  // åˆ¤æ–­ç”¨æˆ·ç™»æ²¡ç™»å½•
  const { cart } = useStore()
  if (cart.isLogin) {
    next()
  } else {
    if (to.path.includes('/member')) {
      next({
        path: '/login',
      })
    } else {
      next()
    }
  }
})
```

ï¼ˆ2ï¼‰å¢åŠ å›è·³çš„urlåœ°å€

```diff
// é…ç½®è·¯ç”±å¯¼èˆªå®ˆå«ï¼Œæ‹¦æˆª /memberå¼€å¤´çš„æ‰€æœ‰çš„åœ°å€
router.beforeEach((to, from, next) => {
  // åˆ¤æ–­ç”¨æˆ·ç™»æ²¡ç™»å½•
  const { cart } = useStore()
  if (cart.isLogin) {
    next()
  } else {
    if (to.path.includes('/member')) {
      next({
        path: '/login',
+        query: {
+          redirectUrl: to.fullPath
+        }
      })
    } else {
      next()
    }
  }
})
```

ï¼ˆ3ï¼‰ä¿®æ”¹ç™»å½•æˆåŠŸçš„é€»è¾‘

```jsx
// é€šè¿‡ç¬¬ä¸‰æ–¹ç™»å½•ï¼Œè·³è½¬åˆ°é¦–é¡µ
Message.success('ç™»å½•æˆåŠŸ')
const redirectUrl = (route.query.redirectUrl as string) || '/'
router.push(redirectUrl)
```



## å¯¹è¯æ¡†ç»„ä»¶å°è£…

> ç›®çš„ï¼šå®ç°ä¸€ä¸ªå¯¹è¯æ¡†ç»„ä»¶å¯è®¾ç½®æ ‡é¢˜ï¼ŒåŠ¨æ€æ’å…¥å†…å®¹ï¼ŒåŠ¨æ€æ’å…¥åº•éƒ¨æ“ä½œæŒ‰é’®ï¼Œæ‰“å¼€å…³é—­åŠŸèƒ½ã€‚

![image-20210804181049576](https://wuxiaohui-1254415986.cos.ap-nanjing.myqcloud.com/2022/05/31/image20210804181049576.png)

### åŸºæœ¬ç»“æ„

è½çš„ä»£ç ï¼š

1. å®šä¹‰ä¸€ä¸ªåŸºç¡€å¸ƒå±€

`src/components/dialog/index.vue` å®šä¹‰ç»„ä»¶

```vue
<script lang="ts" setup name="XtxDialog"></script>
<template>
  <div class="xtx-dialog">
    <div class="wrapper">
      <div class="header">
        <h3>åˆ‡æ¢æ”¶è´§åœ°å€</h3>
        <a href="JavaScript:;" class="iconfont icon-close-new"></a>
      </div>
      <div class="body">å¯¹è¯æ¡†å†…å®¹</div>
      <div class="footer">
        <XtxButton type="gray" style="margin-right: 20px">å–æ¶ˆ</XtxButton>
        <XtxButton type="primary">ç¡®è®¤</XtxButton>
      </div>
    </div>
  </div>
</template>

<style scoped lang="less">
.xtx-dialog {
  position: fixed;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  z-index: 8887;
  background: rgba(0, 0, 0, 0.5);
  // background: rgba(0, 0, 0, 0);
  // &.fade {
  //   transition: all 0.4s;
  //   background: rgba(0, 0, 0, 0.5);
  // }
  .wrapper {
    width: 600px;
    background: #fff;
    border-radius: 4px;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    // transform: translate(-50%, -60%);
    // opacity: 0;
    // &.fade {
    //   transition: all 0.4s;
    //   transform: translate(-50%, -50%);
    //   opacity: 1;
    // }
    .body {
      padding: 20px 40px;
      font-size: 16px;
      .icon-warning {
        color: @priceColor;
        margin-right: 3px;
        font-size: 16px;
      }
    }
    .footer {
      text-align: center;
      padding: 10px 0 30px 0;
    }
    .header {
      position: relative;
      height: 70px;
      line-height: 70px;
      padding: 0 20px;
      border-bottom: 1px solid #f5f5f5;
      h3 {
        font-weight: normal;
        font-size: 18px;
      }
      a {
        position: absolute;
        right: 25px;
        top: 25px;
        font-size: 24px;
        width: 20px;
        height: 20px;
        line-height: 20px;
        text-align: center;
        color: #999;
        &:hover {
          color: #666;
        }
      }
    }
  }
}
</style>
```

éœ€è¦å…¨å±€æ³¨å†Œ

```ts
import XtxDialog from '@/components/dialog/index.vue'

app.component('XtxDialog', XtxDialog)

XtxDialog: typeof XtxDialog
```

`src/views/playground` ä½¿ç”¨ç»„ä»¶

```vue
<XtxDialog />
```

### æ ‡é¢˜æ§åˆ¶

å®ç°è®¾ç½®æ ‡é¢˜

`src/components/library/xtx-dialog.vue` å®šä¹‰ç»„ä»¶

```ts
defineProps({
  title: {
    type: String,
    default: ''
  }
})


<div class="header">
  <h3>{{ title }}</h3>
  <a href="JavaScript:;" class="iconfont icon-close-new"></a>
</div>
```

`src/views/playground/index.vue` ä½¿ç”¨ç»„ä»¶

```vue
<XtxDialog title="åˆ‡æ¢æ”¶è´§åœ°å€" />
```

### æ’æ§½çš„ä½¿ç”¨

å®ç°æ’å…¥å†…å®¹

`src/components/dialog/index.vue` å®šä¹‰ç»„ä»¶

```diff
      <div class="body">
+        <slot />
      </div>
```

`src/views/playground/index.vue`ä½¿ç”¨ç»„ä»¶

```vue
<XtxDialog title="åˆ‡æ¢æ”¶è´§åœ°å€" >
  å¯¹è¯æ¡†å†…å®¹
</XtxDialog>
```

å®ç°æ’å…¥åº•éƒ¨æ“ä½œæŒ‰é’®

`src/components/dialog/index.vue` å®šä¹‰ç»„ä»¶

```diff
      <div class="footer">
+        <slot name="footer" />
      </div>
```

`src/views/playground/index.vue`ä½¿ç”¨ç»„ä»¶

```vue
    <XtxDialog title="åˆ‡æ¢æ”¶è´§åœ°å€">
      å¯¹è¯æ¡†å†…å®¹ 
      <template #footer>
        <XtxButton type="gray" style="margin-right:20px">å–æ¶ˆ</XtxButton>
        <XtxButton type="primary">ç¡®è®¤</XtxButton>
      </template>
    </XtxDialog>
```

### å®ç°æ‰“å¼€å…³é—­åŠŸèƒ½

1. æ‰“å¼€å…³é—­é€šè¿‡v-modelæ¥å®ç°
2. åŠ¨ç”»æ ¹æ®æ‰“å¼€å…³é—­çŠ¶æ€æ¥æ§åˆ¶

`src/components/dialog/index.vue` å®šä¹‰ç»„ä»¶

```typescript
<script lang="ts" setup name="XtxDialog">
import { onClickOutside } from '@vueuse/core'
import { ref, watch } from 'vue'

const props = defineProps({
  title: {
    type: String,
    default: '',
  },
  visible: {
    type: Boolean,
    default: false,
  },
})
const emit = defineEmits<{
  (e: 'update:visible', visible: boolean): void
}>()

// æ§åˆ¶åŠ¨ç”»
const show = ref(false)
watch(
  () => props.visible,
  (value) => {
    setTimeout(() => {
      show.value = value
    }, 20)
  },
  {
    immediate: true,
  }
)
const close = () => {
  emit('update:visible', false)
}

const target = ref(null)
onClickOutside(target, () => {
  close()
})
</script>
<template>
  <div class="xtx-dialog" v-if="visible" :class="{ fade: show }">
    <div class="wrapper" ref="target" :class="{ fade: show }">
      <div class="header">
        <h3>{{ title }}</h3>
        <a
          href="JavaScript:;"
          class="iconfont icon-close-new"
          @click="close"
        ></a>
      </div>
      <div class="body">
        <!-- é»˜è®¤æ’æ§½ -->
        <slot></slot>
      </div>
      <div class="footer">
        <!-- åº•éƒ¨æ’æ§½ -->
        <slot name="footer"></slot>
      </div>
    </div>
  </div>
</template>

<style scoped lang="less">
.xtx-dialog {
  position: fixed;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  z-index: 8887;
  // background: rgba(0, 0, 0, 0.5);
  background: rgba(0, 0, 0, 0);
  &.fade {
    transition: all 0.4s;
    background: rgba(0, 0, 0, 0.5);
  }
  .wrapper {
    width: 600px;
    background: #fff;
    border-radius: 4px;
    position: absolute;
    top: 50%;
    left: 50%;
    // transform: translate(-50%, -50%);
    transform: translate(-50%, -60%);
    opacity: 0;
    &.fade {
      transition: all 0.4s;
      transform: translate(-50%, -50%);
      opacity: 1;
    }
    .body {
      padding: 20px 40px;
      font-size: 16px;
      .icon-warning {
        color: @priceColor;
        margin-right: 3px;
        font-size: 16px;
      }
    }
    .footer {
      text-align: center;
      padding: 10px 0 30px 0;
    }
    .header {
      position: relative;
      height: 70px;
      line-height: 70px;
      padding: 0 20px;
      border-bottom: 1px solid #f5f5f5;
      h3 {
        font-weight: normal;
        font-size: 18px;
      }
      a {
        position: absolute;
        right: 25px;
        top: 25px;
        font-size: 24px;
        width: 20px;
        height: 20px;
        line-height: 20px;
        text-align: center;
        color: #999;
        &:hover {
          color: #666;
        }
      }
    }
  }
}
</style> 
```

`src/views/playground/index` ä½¿ç”¨ç»„ä»¶

```vue
<template>
  <button @click="visible = true">æ˜¾ç¤º</button>
  <XtxDialog title="æ·»åŠ åœ°å€" v-model:visible="visible">
    <div>æˆ‘æ˜¯ä¸€ä¸ªè¡¨å•</div>
    <template #footer>
      <XtxButton type="gray" style="margin-right: 20px" @click="visible = false"
        >å–æ¶ˆ</XtxButton
      >
      <XtxButton type="primary" @click="visible = false">ç¡®è®¤</XtxButton>
    </template>
  </XtxDialog>
</template>
```

### Teleportç»„ä»¶çš„ä½¿ç”¨

> https://staging-cn.vuejs.org/guide/built-ins/teleport.html#teleport

```vue
<Teleport to="body">
  <XtxDialog title="æ·»åŠ åœ°å€" v-model:visible="visible">
    <div class="form">æˆ‘æ˜¯ä¸€ä¸ªè¡¨å•</div>
    <template #footer>
      <XtxButton
        type="gray"
        style="margin-right: 20px"
        @click="visible = false"
      >
        å–æ¶ˆ
      </XtxButton>
      <XtxButton type="primary" @click="visible = false">ç¡®è®¤</XtxButton>
    </template>
  </XtxDialog>
</Teleport>
```



## ç»“ç®—æ¨¡å—å¿«é€Ÿå®ç°

ç»“ç®—æ¨¡å—çš„æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼Œå°±æ˜¯å¯¹è¯æ¡†ç»„ä»¶å°è£…ï¼Œ å…¶ä»–éƒ¨åˆ†ä¸šåŠ¡ï¼Œ æˆ‘ä»¬å¯ä»¥å¿«é€Ÿå®ç°

æ‹·è´ç»“ç®—æ¨¡å—ä»£ç åˆ°é¡¹ç›®ä¸­

1. components/switch ç»„ä»¶   =ã€‹ éœ€è¦å…¨å±€æ³¨å†Œ
2. checkout.vue å’Œ components  =ã€‹ ç›´æ¥è¦†ç›–
3. store/checkoutæ¨¡å—              =ã€‹ éœ€è¦æŒ‚è½½



## æäº¤è®¢å•åŠŸèƒ½

ï¼ˆ1ï¼‰æ³¨å†Œäº‹ä»¶

```typescript
<!-- æäº¤è®¢å• -->
<div class="submit">
  <XtxButton type="primary" @click="submitCheckout">æäº¤è®¢å•</XtxButton>
</div>
```

ï¼ˆ2ï¼‰æ ¸å¿ƒé€»è¾‘

```typescript

const submitCheckout = async () => {
  // å¦‚æœåœ°å€ä¸ºç©ºï¼Œä¸èƒ½æäº¤è®¢å•
  if (!checkout.showAddress) {
    return Message.warning('è¯·é€‰æ‹©æ”¶è´§åœ°å€')
  }
  
  // å‘é€è¯·æ±‚, ä¸‹å•
  const res = await request.post('/member/order', {
    goods: checkout.checkoutInfo.goods.map((item) => {
      return {
        skuId: item.skuId,
        count: item.count,
      }
    }),
    addressId: checkout.showAddress.id,
  })
  
  // æˆåŠŸæé†’ç”¨æˆ·
  Message({ type: 'success', text: 'ä¸‹å•æˆåŠŸ~' })
  // ğŸ””é‡æ–°è·å–è´­ç‰©è½¦åˆ—è¡¨
  cart.getCartList()
  // è·³è½¬åˆ°æ”¯ä»˜é¡µé¢
  router.push('/member/pay')
}
```



