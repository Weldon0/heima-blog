<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.48" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://vuepress-theme-hope-v2-demo.mrhope.site/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html"><meta property="og:site_name" content="课程笔记"><meta property="og:title" content="📚极客园M-4【个人中心】"><meta property="og:type" content="article"><meta property="og:updated_time" content="2022-05-22T10:16:09.000Z"><meta property="og:locale" content="zh-CN"><meta property="article:modified_time" content="2022-05-22T10:16:09.000Z"><link rel="manifest" href="/manifest.webmanifest"><meta name="theme-color" content="#3eaf7c"><title>📚极客园M-4【个人中心】 | 课程笔记</title><meta name="description" content="课程笔记博客系统">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background-color: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="stylesheet" href="/assets/style.3bd5937b.css">
    <link rel="modulepreload" href="/assets/app.88f692a7.js"><link rel="modulepreload" href="/assets/📚极客园M-4【个人中心】.html.a5f98f1e.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper.21dcd24c.js"><link rel="modulepreload" href="/assets/📚极客园M-4【个人中心】.html.0f622c5c.js"><link rel="prefetch" href="/assets/index.html.ca01698f.js"><link rel="prefetch" href="/assets/home.html.81aa3df7.js"><link rel="prefetch" href="/assets/1. 创建项目.html.f66b314f.js"><link rel="prefetch" href="/assets/1.认识antd-pro.html.7d38f9c3.js"><link rel="prefetch" href="/assets/1.自定义请求hook.html.db1df6e6.js"><link rel="prefetch" href="/assets/2.面试题.html.f9564bfe.js"><link rel="prefetch" href="/assets/index.html.f8c12963.js"><link rel="prefetch" href="/assets/JavaScript高级第01天笔记.html.a6aeb32d.js"><link rel="prefetch" href="/assets/JavaScript高级第02天笔记.html.30839f58.js"><link rel="prefetch" href="/assets/JavaScript高级第03天笔记.html.c2171967.js"><link rel="prefetch" href="/assets/JavaScript高级第04天笔记.html.66d28a86.js"><link rel="prefetch" href="/assets/es6-ES6概念_新增语法_内置对象拓展.html.f88ecef3.js"><link rel="prefetch" href="/assets/index.html.70ae272b.js"><link rel="prefetch" href="/assets/1.基础篇-认识jsx.html.702b4234.js"><link rel="prefetch" href="/assets/10.优化篇-渲染控制.html.fad7f2e0.js"><link rel="prefetch" href="/assets/11.优化篇-渲染调优.html.e63cb2d1.js"><link rel="prefetch" href="/assets/12.优化篇-处理海量数据.html.a0c2b2ce.js"><link rel="prefetch" href="/assets/13.优化篇-细节处理（持续）.html.c65b8cd7.js"><link rel="prefetch" href="/assets/14.原理篇-事件原理.html.8afee511.js"><link rel="prefetch" href="/assets/15.原理篇-调度与时间片.html.0d3898e4.js"><link rel="prefetch" href="/assets/16.原理篇-调和fiber.html.8481d2d4.js"><link rel="prefetch" href="/assets/17.原理篇-Hooks原理.html.e75dad9e.js"><link rel="prefetch" href="/assets/18.生态篇-React-router.html.3b0f2542.js"><link rel="prefetch" href="/assets/19.生态篇-React-redux.html.aa1a53ba.js"><link rel="prefetch" href="/assets/2.基础篇-起源Component.html.834f4363.js"><link rel="prefetch" href="/assets/20.生态篇-React-mobx.html.6c2a8061.js"><link rel="prefetch" href="/assets/21.实践篇-实现mini-Router.html.7357ef97.js"><link rel="prefetch" href="/assets/22.实践篇-表单验证上.html.4a1d6215.js"><link rel="prefetch" href="/assets/23.实践篇-表单验证下.html.64801825.js"><link rel="prefetch" href="/assets/24.实践篇-自定义弹窗.html.936ebede.js"><link rel="prefetch" href="/assets/25.实践篇-自定义Hooks设计（持续）.html.947041c3.js"><link rel="prefetch" href="/assets/26.实践篇-自定义Hooks实践（持续）.html.667bef52.js"><link rel="prefetch" href="/assets/27.原理篇-Context原理.html.b49fb708.js"><link rel="prefetch" href="/assets/28.原理篇-beginWork和render全流程.html.576b5069.js"><link rel="prefetch" href="/assets/29.V18特性篇-useMutableSource外部数据源.html.d7d2313a.js"><link rel="prefetch" href="/assets/3.基础篇-玄学state.html.5b73b9a5.js"><link rel="prefetch" href="/assets/30.V18特性篇-transition.html.1a3ddbd5.js"><link rel="prefetch" href="/assets/31.原理篇-更新流程：进入调度任务.html.1dcac68c.js"><link rel="prefetch" href="/assets/4.基础篇-深入props.html.d1c7bbc7.js"><link rel="prefetch" href="/assets/5.基础篇-理解lifeCycle.html.fa97fc71.js"><link rel="prefetch" href="/assets/6.基础篇-多功能Ref.html.26c74189.js"><link rel="prefetch" href="/assets/7.基础篇-提供者context.html.ab90909d.js"><link rel="prefetch" href="/assets/8.基础篇-模块化css.html.31c44402.js"><link rel="prefetch" href="/assets/9.基础篇-高阶组件.html.b33857ef.js"><link rel="prefetch" href="/assets/index.html.8ca698b1.js"><link rel="prefetch" href="/assets/Suspense.html.2bb1bc55.js"><link rel="prefetch" href="/assets/index.html.1f84ce60.js"><link rel="prefetch" href="/assets/index.html.c0eeff31.js"><link rel="prefetch" href="/assets/1.如何搭建一个antd-pro项目.html.bdcc4c21.js"><link rel="prefetch" href="/assets/1.配置式路由.html.07918737.js"><link rel="prefetch" href="/assets/index.html.1c49b44f.js"><link rel="prefetch" href="/assets/lesson.html.c9f58489.js"><link rel="prefetch" href="/assets/test1.html.ace72297.js"><link rel="prefetch" href="/assets/wechat-1.html.43a33bde.js"><link rel="prefetch" href="/assets/wechat-2.html.abebbbc2.js"><link rel="prefetch" href="/assets/wechat-3.html.e0b7c4dd.js"><link rel="prefetch" href="/assets/wechat-4.html.e03b42c8.js"><link rel="prefetch" href="/assets/wechat-5.html.62d7ae87.js"><link rel="prefetch" href="/assets/01-vuex基础.html.cae06ec5.js"><link rel="prefetch" href="/assets/02-基础环境搭建.html.d36c5826.js"><link rel="prefetch" href="/assets/03-登录模块.html.d7c8321d.js"><link rel="prefetch" href="/assets/04-主页模块.html.e7b0021a.js"><link rel="prefetch" href="/assets/05-路由和页面.html.ee2c822c.js"><link rel="prefetch" href="/assets/06-组织架构.html.e6b2d740.js"><link rel="prefetch" href="/assets/07-公司和角色.html.8a35836a.js"><link rel="prefetch" href="/assets/08-员工管理.html.b2d487fd.js"><link rel="prefetch" href="/assets/09-权限设计和管理.html.85d044a3.js"><link rel="prefetch" href="/assets/10-其他模块集成.html.71fe0b65.js"><link rel="prefetch" href="/assets/11-主页审批-图表.html.859486fb.js"><link rel="prefetch" href="/assets/12-多语言tab页全屏主题.html.79cb962a.js"><link rel="prefetch" href="/assets/13-打包上线.html.de5db446.js"><link rel="prefetch" href="/assets/index.html.891e93c8.js"><link rel="prefetch" href="/assets/人资第二天-Element表单校验补充.html.bf8ac87c.js"><link rel="prefetch" href="/assets/人资项目问题.html.db8d8c00.js"><link rel="prefetch" href="/assets/01-项目初始化.html.037fc481.js"><link rel="prefetch" href="/assets/02-登录注册.html.f3fc8d82.js"><link rel="prefetch" href="/assets/03-个人中心.html.d9c0fe0c.js"><link rel="prefetch" href="/assets/04-首页-文章列表.html.70b76265.js"><link rel="prefetch" href="/assets/05-首页-频道编辑.html.a5f45a92.js"><link rel="prefetch" href="/assets/06-文章搜索.html.ca7783cc.js"><link rel="prefetch" href="/assets/07-文章详情.html.990635f9.js"><link rel="prefetch" href="/assets/08-文章评论.html.06cee9d1.js"><link rel="prefetch" href="/assets/09-编辑用户资料.html.5c63a74a.js"><link rel="prefetch" href="/assets/10-编辑用户头像.html.1f302467.js"><link rel="prefetch" href="/assets/11-文章评论-1.html.da2b2358.js"><link rel="prefetch" href="/assets/index.html.46aeb955.js"><link rel="prefetch" href="/assets/01-vue3笔记.html.1c702be5.js"><link rel="prefetch" href="/assets/02-pinia笔记.html.65f02adf.js"><link rel="prefetch" href="/assets/03-Typescript.html.7a218258.js"><link rel="prefetch" href="/assets/04-项目搭建.html.fb341036.js"><link rel="prefetch" href="/assets/05-布局模块.html.b7839d73.js"><link rel="prefetch" href="/assets/06-首页模块.html.e496d65d.js"><link rel="prefetch" href="/assets/07-分类模块.html.082ccb90.js"><link rel="prefetch" href="/assets/08-商品详情.html.81049dab.js"><link rel="prefetch" href="/assets/09-登录模块.html.41abc95f.js"><link rel="prefetch" href="/assets/10-登录模块-第三方登录.html.c5c9a23d.js"><link rel="prefetch" href="/assets/11-购物车模块.html.6a09632e.js"><link rel="prefetch" href="/assets/12-结算模块.html.be015a82.js"><link rel="prefetch" href="/assets/13-支付模块.html.5622a856.js"><link rel="prefetch" href="/assets/14-订单模块.html.853507b4.js"><link rel="prefetch" href="/assets/jsBridge.html.66128ad1.js"><link rel="prefetch" href="/assets/移动端问题.html.6e322578.js"><link rel="prefetch" href="/assets/1.HTTP 缓存1：开门见山——请求响应头中关于缓存的奥秘.html.c045d22b.js"><link rel="prefetch" href="/assets/2.HTTP 缓存2：卧虎藏龙——网页由慢到快背后的强缓存.html.fffa483a.js"><link rel="prefetch" href="/assets/3.HTTP 缓存3：刨根问底——缓存新鲜度与使用期算法.html.65fe806a.js"><link rel="prefetch" href="/assets/4. HTTP 缓存4：相辅相成——从协商缓存到启发式缓存.html.ff96e829.js"><link rel="prefetch" href="/assets/5.应用篇：从理论到实际——HTTP 缓存方案解析.html.f68ade06.js"><link rel="prefetch" href="/assets/6.福利篇：换一种角度——用户操作与 HTTP 缓存.html.fd17717d.js"><link rel="prefetch" href="/assets/index.html.1d88bfb6.js"><link rel="prefetch" href="/assets/拓展-https.html.a7de494a.js"><link rel="prefetch" href="/assets/1.html基础.html.b1493ac6.js"><link rel="prefetch" href="/assets/10.react.html.d69cd119.js"><link rel="prefetch" href="/assets/2.css基础.html.a1f66c29.js"><link rel="prefetch" href="/assets/3.js.html.3a1175b2.js"><link rel="prefetch" href="/assets/4.http协议.html.95605a65.js"><link rel="prefetch" href="/assets/5.tcp.html.c3c4d92c.js"><link rel="prefetch" href="/assets/6.dom.html.c5866e65.js"><link rel="prefetch" href="/assets/7.浏览器与新技术.html.3ed24cc9.js"><link rel="prefetch" href="/assets/8.前端工程化.html.e067139e.js"><link rel="prefetch" href="/assets/9.vue.html.02668e79.js"><link rel="prefetch" href="/assets/一、Vue生命周期.html.37bf19f8.js"><link rel="prefetch" href="/assets/七、组件传值.html.2b8e1e98.js"><link rel="prefetch" href="/assets/三、v-if_v-show.html.3237c4b0.js"><link rel="prefetch" href="/assets/二、对keep-alive的理解.html.1e622e23.js"><link rel="prefetch" href="/assets/五、scoped原理是什么.html.730de7fd.js"><link rel="prefetch" href="/assets/六、如何做样式穿透.html.7c5cba1e.js"><link rel="prefetch" href="/assets/四、ref是什么.html.05a56e5c.js"><link rel="prefetch" href="/assets/文件上传.html.c82f818b.js"><link rel="prefetch" href="/assets/阿里外包笔试题目.html.563e32b0.js"><link rel="prefetch" href="/assets/index.html.3a96919a.js"><link rel="prefetch" href="/assets/1.node-sass问题.html.840f87d6.js"><link rel="prefetch" href="/assets/index.html.6a71294a.js"><link rel="prefetch" href="/assets/index.html.9bbe26a7.js"><link rel="prefetch" href="/assets/01-React基础.html.ff963e44.js"><link rel="prefetch" href="/assets/02-组件基础.html.f51ff404.js"><link rel="prefetch" href="/assets/03-组件通讯.html.f1f4e209.js"><link rel="prefetch" href="/assets/04-组件生命周期.html.ab1dfa3f.js"><link rel="prefetch" href="/assets/05-react原理揭秘.html.847ccd1a.js"><link rel="prefetch" href="/assets/06-react路由.html.3a0d93a3.js"><link rel="prefetch" href="/assets/fiber.html.2ced87ff.js"><link rel="prefetch" href="/assets/index.html.ca39004e.js"><link rel="prefetch" href="/assets/01-项目搭建.html.85bbaa7f.js"><link rel="prefetch" href="/assets/02-登录功能.html.26f492fa.js"><link rel="prefetch" href="/assets/03-首页.html.d689bce9.js"><link rel="prefetch" href="/assets/04-文章列表.html.4fcbaa93.js"><link rel="prefetch" href="/assets/index.html.6d118562.js"><link rel="prefetch" href="/assets/01-react-组件复用.html.675f519c.js"><link rel="prefetch" href="/assets/02-hooks基本使用.html.7fcc93b2.js"><link rel="prefetch" href="/assets/03-hooks进阶_redux学习.html.1df17b13.js"><link rel="prefetch" href="/assets/index.html.fb3cdcce.js"><link rel="prefetch" href="/assets/扩展-useCallback和useMemo.html.dce6103f.js"><link rel="prefetch" href="/assets/扩展-useImperativeHandle的使用.html.9c184f3b.js"><link rel="prefetch" href="/assets/拓展-redux-createStore实现.html.ed14cbab.js"><link rel="prefetch" href="/assets/拓展-useEffect和useLayoutEffect.html.e76e1090.js"><link rel="prefetch" href="/assets/applymiddleWare原理.html.b0f5bf0f.js"><link rel="prefetch" href="/assets/index.html.6c9dbbfb.js"><link rel="prefetch" href="/assets/redux-acions用法.html.ef100d02.js"><link rel="prefetch" href="/assets/redux中间件.html.32f898f8.js"><link rel="prefetch" href="/assets/redux课程.html.941c1cc4.js"><link rel="prefetch" href="/assets/todolist.html.ddba1ac5.js"><link rel="prefetch" href="/assets/react面试题.html.8a177f91.js"><link rel="prefetch" href="/assets/index.html.6fbbd3b8.js"><link rel="prefetch" href="/assets/webpack面试题.html.6faf54bd.js"><link rel="prefetch" href="/assets/极客园移动端1.html.8a9842c1.js"><link rel="prefetch" href="/assets/极客园移动端2.html.da6d9bb1.js"><link rel="prefetch" href="/assets/面试题.html.6b25199c.js"><link rel="prefetch" href="/assets/🌹【拓展】-ahooks之useCountDown用法.html.d5eb51b8.js"><link rel="prefetch" href="/assets/📚极客园M-1【项目搭建】.html.eb794133.js"><link rel="prefetch" href="/assets/📚极客园M-2【登录模块】.html.b06eda54.js"><link rel="prefetch" href="/assets/📚极客园M-3【布局页面】.html.0529e18f.js"><link rel="prefetch" href="/assets/📚极客园M-5【首页】.html.420e3b8f.js"><link rel="prefetch" href="/assets/📚极客园M-6【搜索】.html.e25f11e8.js"><link rel="prefetch" href="/assets/📚极客园M-7【文章详情】.html.3568b2d7.js"><link rel="prefetch" href="/assets/📚极客园M-8【小智同学】.html.149a18bc.js"><link rel="prefetch" href="/assets/01-TypeScript 介绍.html.f281375e.js"><link rel="prefetch" href="/assets/02-TypeScript 常用类型.html.3107d700.js"><link rel="prefetch" href="/assets/03-TypeScript 高级类型.html.d90d452a.js"><link rel="prefetch" href="/assets/04-在 React 项目中使用 TS.html.74454474.js"><link rel="prefetch" href="/assets/05-使用Typescript改造项目.html.3f68380e.js"><link rel="prefetch" href="/assets/index.html.c27573b7.js"><link rel="prefetch" href="/assets/1.响应式原理.html.7c78f125.js"><link rel="prefetch" href="/assets/404.html.60f752fd.js"><link rel="prefetch" href="/assets/index.html.8b72e0f0.js"><link rel="prefetch" href="/assets/index.html.a9728e99.js"><link rel="prefetch" href="/assets/index.html.05cb2bb2.js"><link rel="prefetch" href="/assets/index.html.2d2968d1.js"><link rel="prefetch" href="/assets/index.html.c4db3dcf.js"><link rel="prefetch" href="/assets/index.html.08d256c4.js"><link rel="prefetch" href="/assets/index.html.46a383bf.js"><link rel="prefetch" href="/assets/index.html.54dbd027.js"><link rel="prefetch" href="/assets/index.html.6d08f253.js"><link rel="prefetch" href="/assets/home.html.d2383193.js"><link rel="prefetch" href="/assets/1. 创建项目.html.8af12bb0.js"><link rel="prefetch" href="/assets/1.认识antd-pro.html.5db98694.js"><link rel="prefetch" href="/assets/1.自定义请求hook.html.85e82c26.js"><link rel="prefetch" href="/assets/2.面试题.html.b2323f31.js"><link rel="prefetch" href="/assets/index.html.924e9cbd.js"><link rel="prefetch" href="/assets/JavaScript高级第01天笔记.html.fe0056be.js"><link rel="prefetch" href="/assets/JavaScript高级第02天笔记.html.b749b6a4.js"><link rel="prefetch" href="/assets/JavaScript高级第03天笔记.html.95c3ab2c.js"><link rel="prefetch" href="/assets/JavaScript高级第04天笔记.html.1ffeaebe.js"><link rel="prefetch" href="/assets/es6-ES6概念_新增语法_内置对象拓展.html.1c4a2ef1.js"><link rel="prefetch" href="/assets/index.html.7e21076f.js"><link rel="prefetch" href="/assets/1.基础篇-认识jsx.html.78c189e0.js"><link rel="prefetch" href="/assets/10.优化篇-渲染控制.html.8c16ec7f.js"><link rel="prefetch" href="/assets/11.优化篇-渲染调优.html.fb0ae698.js"><link rel="prefetch" href="/assets/12.优化篇-处理海量数据.html.57ed8514.js"><link rel="prefetch" href="/assets/13.优化篇-细节处理（持续）.html.bcab3511.js"><link rel="prefetch" href="/assets/14.原理篇-事件原理.html.3464aeca.js"><link rel="prefetch" href="/assets/15.原理篇-调度与时间片.html.e4aea8e7.js"><link rel="prefetch" href="/assets/16.原理篇-调和fiber.html.8d508658.js"><link rel="prefetch" href="/assets/17.原理篇-Hooks原理.html.3e908510.js"><link rel="prefetch" href="/assets/18.生态篇-React-router.html.dfafa26e.js"><link rel="prefetch" href="/assets/19.生态篇-React-redux.html.5149eb08.js"><link rel="prefetch" href="/assets/2.基础篇-起源Component.html.398e96d6.js"><link rel="prefetch" href="/assets/20.生态篇-React-mobx.html.ebf1f6c0.js"><link rel="prefetch" href="/assets/21.实践篇-实现mini-Router.html.78ae301d.js"><link rel="prefetch" href="/assets/22.实践篇-表单验证上.html.bc339e0a.js"><link rel="prefetch" href="/assets/23.实践篇-表单验证下.html.02589685.js"><link rel="prefetch" href="/assets/24.实践篇-自定义弹窗.html.64258227.js"><link rel="prefetch" href="/assets/25.实践篇-自定义Hooks设计（持续）.html.e888784b.js"><link rel="prefetch" href="/assets/26.实践篇-自定义Hooks实践（持续）.html.7d16444e.js"><link rel="prefetch" href="/assets/27.原理篇-Context原理.html.f0edfc59.js"><link rel="prefetch" href="/assets/28.原理篇-beginWork和render全流程.html.ee0507fd.js"><link rel="prefetch" href="/assets/29.V18特性篇-useMutableSource外部数据源.html.7c16e776.js"><link rel="prefetch" href="/assets/3.基础篇-玄学state.html.8f7cc377.js"><link rel="prefetch" href="/assets/30.V18特性篇-transition.html.a9495a4f.js"><link rel="prefetch" href="/assets/31.原理篇-更新流程：进入调度任务.html.350c8172.js"><link rel="prefetch" href="/assets/4.基础篇-深入props.html.744ef28e.js"><link rel="prefetch" href="/assets/5.基础篇-理解lifeCycle.html.1abc25a5.js"><link rel="prefetch" href="/assets/6.基础篇-多功能Ref.html.c9a61df7.js"><link rel="prefetch" href="/assets/7.基础篇-提供者context.html.fd112f4f.js"><link rel="prefetch" href="/assets/8.基础篇-模块化css.html.d674e2f9.js"><link rel="prefetch" href="/assets/9.基础篇-高阶组件.html.2f3b039b.js"><link rel="prefetch" href="/assets/index.html.a498e451.js"><link rel="prefetch" href="/assets/Suspense.html.29f91fa6.js"><link rel="prefetch" href="/assets/index.html.f1f75e1e.js"><link rel="prefetch" href="/assets/index.html.f5b11e44.js"><link rel="prefetch" href="/assets/1.如何搭建一个antd-pro项目.html.36ac4a80.js"><link rel="prefetch" href="/assets/1.配置式路由.html.029397b9.js"><link rel="prefetch" href="/assets/index.html.7c5a3e5d.js"><link rel="prefetch" href="/assets/lesson.html.4aa3ca6a.js"><link rel="prefetch" href="/assets/test1.html.66e62c07.js"><link rel="prefetch" href="/assets/wechat-1.html.ffec603a.js"><link rel="prefetch" href="/assets/wechat-2.html.9bf17f3f.js"><link rel="prefetch" href="/assets/wechat-3.html.d2be8ac3.js"><link rel="prefetch" href="/assets/wechat-4.html.4086b0d7.js"><link rel="prefetch" href="/assets/wechat-5.html.b7cbcca7.js"><link rel="prefetch" href="/assets/01-vuex基础.html.1d8e42fd.js"><link rel="prefetch" href="/assets/02-基础环境搭建.html.e785bb47.js"><link rel="prefetch" href="/assets/03-登录模块.html.b670d97a.js"><link rel="prefetch" href="/assets/04-主页模块.html.7e3385a1.js"><link rel="prefetch" href="/assets/05-路由和页面.html.86fe128a.js"><link rel="prefetch" href="/assets/06-组织架构.html.d968fae9.js"><link rel="prefetch" href="/assets/07-公司和角色.html.d15f3a4f.js"><link rel="prefetch" href="/assets/08-员工管理.html.5e37d789.js"><link rel="prefetch" href="/assets/09-权限设计和管理.html.c6e3349a.js"><link rel="prefetch" href="/assets/10-其他模块集成.html.244e03c9.js"><link rel="prefetch" href="/assets/11-主页审批-图表.html.513b43c6.js"><link rel="prefetch" href="/assets/12-多语言tab页全屏主题.html.6c4ff7ee.js"><link rel="prefetch" href="/assets/13-打包上线.html.b7b0d637.js"><link rel="prefetch" href="/assets/index.html.d81081df.js"><link rel="prefetch" href="/assets/人资第二天-Element表单校验补充.html.aa56da0e.js"><link rel="prefetch" href="/assets/人资项目问题.html.a26af7b2.js"><link rel="prefetch" href="/assets/01-项目初始化.html.ce33e576.js"><link rel="prefetch" href="/assets/02-登录注册.html.e606b2f0.js"><link rel="prefetch" href="/assets/03-个人中心.html.e6fb7ce4.js"><link rel="prefetch" href="/assets/04-首页-文章列表.html.a1daf701.js"><link rel="prefetch" href="/assets/05-首页-频道编辑.html.8bcd70aa.js"><link rel="prefetch" href="/assets/06-文章搜索.html.fb6a3359.js"><link rel="prefetch" href="/assets/07-文章详情.html.d8ded61a.js"><link rel="prefetch" href="/assets/08-文章评论.html.a866bbd7.js"><link rel="prefetch" href="/assets/09-编辑用户资料.html.8d718a32.js"><link rel="prefetch" href="/assets/10-编辑用户头像.html.f02e0858.js"><link rel="prefetch" href="/assets/11-文章评论-1.html.4cce99d8.js"><link rel="prefetch" href="/assets/index.html.16893cbc.js"><link rel="prefetch" href="/assets/01-vue3笔记.html.3935ddc4.js"><link rel="prefetch" href="/assets/02-pinia笔记.html.c1acd935.js"><link rel="prefetch" href="/assets/03-Typescript.html.26f87e54.js"><link rel="prefetch" href="/assets/04-项目搭建.html.1bc311b7.js"><link rel="prefetch" href="/assets/05-布局模块.html.aca987c0.js"><link rel="prefetch" href="/assets/06-首页模块.html.b841acc5.js"><link rel="prefetch" href="/assets/07-分类模块.html.d3647bdb.js"><link rel="prefetch" href="/assets/08-商品详情.html.8988cd03.js"><link rel="prefetch" href="/assets/09-登录模块.html.2743e145.js"><link rel="prefetch" href="/assets/10-登录模块-第三方登录.html.5f4c9e04.js"><link rel="prefetch" href="/assets/11-购物车模块.html.aebe4a58.js"><link rel="prefetch" href="/assets/12-结算模块.html.6b4cb7c2.js"><link rel="prefetch" href="/assets/13-支付模块.html.b198ea92.js"><link rel="prefetch" href="/assets/14-订单模块.html.264874d5.js"><link rel="prefetch" href="/assets/jsBridge.html.c26435e6.js"><link rel="prefetch" href="/assets/移动端问题.html.9cd56874.js"><link rel="prefetch" href="/assets/1.HTTP 缓存1：开门见山——请求响应头中关于缓存的奥秘.html.d4c08f33.js"><link rel="prefetch" href="/assets/2.HTTP 缓存2：卧虎藏龙——网页由慢到快背后的强缓存.html.c25c3b4a.js"><link rel="prefetch" href="/assets/3.HTTP 缓存3：刨根问底——缓存新鲜度与使用期算法.html.87b19d8f.js"><link rel="prefetch" href="/assets/4. HTTP 缓存4：相辅相成——从协商缓存到启发式缓存.html.cefaa22e.js"><link rel="prefetch" href="/assets/5.应用篇：从理论到实际——HTTP 缓存方案解析.html.6a2a87e7.js"><link rel="prefetch" href="/assets/6.福利篇：换一种角度——用户操作与 HTTP 缓存.html.faff51c1.js"><link rel="prefetch" href="/assets/index.html.a390cf83.js"><link rel="prefetch" href="/assets/拓展-https.html.78426ea8.js"><link rel="prefetch" href="/assets/1.html基础.html.451ec60e.js"><link rel="prefetch" href="/assets/10.react.html.6f029ccb.js"><link rel="prefetch" href="/assets/2.css基础.html.9fac3537.js"><link rel="prefetch" href="/assets/3.js.html.44c0869b.js"><link rel="prefetch" href="/assets/4.http协议.html.4c10b0fe.js"><link rel="prefetch" href="/assets/5.tcp.html.d682895d.js"><link rel="prefetch" href="/assets/6.dom.html.db1e6858.js"><link rel="prefetch" href="/assets/7.浏览器与新技术.html.59b8f1d0.js"><link rel="prefetch" href="/assets/8.前端工程化.html.1f0ae2e3.js"><link rel="prefetch" href="/assets/9.vue.html.b9de9baf.js"><link rel="prefetch" href="/assets/一、Vue生命周期.html.67a4f9c2.js"><link rel="prefetch" href="/assets/七、组件传值.html.77b45d25.js"><link rel="prefetch" href="/assets/三、v-if_v-show.html.101c15f2.js"><link rel="prefetch" href="/assets/二、对keep-alive的理解.html.64ab34c8.js"><link rel="prefetch" href="/assets/五、scoped原理是什么.html.6987d95c.js"><link rel="prefetch" href="/assets/六、如何做样式穿透.html.86df9b5d.js"><link rel="prefetch" href="/assets/四、ref是什么.html.57d93fca.js"><link rel="prefetch" href="/assets/文件上传.html.7972d2fd.js"><link rel="prefetch" href="/assets/阿里外包笔试题目.html.a9ddac06.js"><link rel="prefetch" href="/assets/index.html.95cf1ad9.js"><link rel="prefetch" href="/assets/1.node-sass问题.html.c9ffcac0.js"><link rel="prefetch" href="/assets/index.html.dad4447d.js"><link rel="prefetch" href="/assets/index.html.9f761659.js"><link rel="prefetch" href="/assets/01-React基础.html.fe6cc461.js"><link rel="prefetch" href="/assets/02-组件基础.html.26261800.js"><link rel="prefetch" href="/assets/03-组件通讯.html.fce6101b.js"><link rel="prefetch" href="/assets/04-组件生命周期.html.5916e65c.js"><link rel="prefetch" href="/assets/05-react原理揭秘.html.401ac2b5.js"><link rel="prefetch" href="/assets/06-react路由.html.f5751a7a.js"><link rel="prefetch" href="/assets/fiber.html.e1761934.js"><link rel="prefetch" href="/assets/index.html.2602e09e.js"><link rel="prefetch" href="/assets/01-项目搭建.html.b33fe151.js"><link rel="prefetch" href="/assets/02-登录功能.html.313d1d63.js"><link rel="prefetch" href="/assets/03-首页.html.1937e5d0.js"><link rel="prefetch" href="/assets/04-文章列表.html.5e25b9af.js"><link rel="prefetch" href="/assets/index.html.12375ec9.js"><link rel="prefetch" href="/assets/01-react-组件复用.html.38de85eb.js"><link rel="prefetch" href="/assets/02-hooks基本使用.html.242e6b6b.js"><link rel="prefetch" href="/assets/03-hooks进阶_redux学习.html.a8044d95.js"><link rel="prefetch" href="/assets/index.html.133f2559.js"><link rel="prefetch" href="/assets/扩展-useCallback和useMemo.html.93eb7960.js"><link rel="prefetch" href="/assets/扩展-useImperativeHandle的使用.html.98a85665.js"><link rel="prefetch" href="/assets/拓展-redux-createStore实现.html.b48da31b.js"><link rel="prefetch" href="/assets/拓展-useEffect和useLayoutEffect.html.79df999b.js"><link rel="prefetch" href="/assets/applymiddleWare原理.html.94948d05.js"><link rel="prefetch" href="/assets/index.html.c118bf5a.js"><link rel="prefetch" href="/assets/redux-acions用法.html.94402108.js"><link rel="prefetch" href="/assets/redux中间件.html.b07eacd1.js"><link rel="prefetch" href="/assets/redux课程.html.615fa86c.js"><link rel="prefetch" href="/assets/todolist.html.3f259b2f.js"><link rel="prefetch" href="/assets/react面试题.html.a6dcd425.js"><link rel="prefetch" href="/assets/index.html.de81af2d.js"><link rel="prefetch" href="/assets/webpack面试题.html.b41d1d2c.js"><link rel="prefetch" href="/assets/极客园移动端1.html.a66b7710.js"><link rel="prefetch" href="/assets/极客园移动端2.html.8afa138f.js"><link rel="prefetch" href="/assets/面试题.html.5b071689.js"><link rel="prefetch" href="/assets/🌹【拓展】-ahooks之useCountDown用法.html.f5ab7492.js"><link rel="prefetch" href="/assets/📚极客园M-1【项目搭建】.html.81b03a0c.js"><link rel="prefetch" href="/assets/📚极客园M-2【登录模块】.html.5b691baf.js"><link rel="prefetch" href="/assets/📚极客园M-3【布局页面】.html.47a1846f.js"><link rel="prefetch" href="/assets/📚极客园M-5【首页】.html.d0f7ca61.js"><link rel="prefetch" href="/assets/📚极客园M-6【搜索】.html.826a27f8.js"><link rel="prefetch" href="/assets/📚极客园M-7【文章详情】.html.ef090b8c.js"><link rel="prefetch" href="/assets/📚极客园M-8【小智同学】.html.e5180c67.js"><link rel="prefetch" href="/assets/01-TypeScript 介绍.html.fc6d630f.js"><link rel="prefetch" href="/assets/02-TypeScript 常用类型.html.f15a5a9c.js"><link rel="prefetch" href="/assets/03-TypeScript 高级类型.html.ec671993.js"><link rel="prefetch" href="/assets/04-在 React 项目中使用 TS.html.3077e5da.js"><link rel="prefetch" href="/assets/05-使用Typescript改造项目.html.5e2d0b5a.js"><link rel="prefetch" href="/assets/index.html.bc16088d.js"><link rel="prefetch" href="/assets/1.响应式原理.html.1895587b.js"><link rel="prefetch" href="/assets/404.html.c9cb4d2d.js"><link rel="prefetch" href="/assets/index.html.4da2f53c.js"><link rel="prefetch" href="/assets/index.html.74b284bb.js"><link rel="prefetch" href="/assets/index.html.79511d8a.js"><link rel="prefetch" href="/assets/index.html.94dd083b.js"><link rel="prefetch" href="/assets/index.html.cd7f9896.js"><link rel="prefetch" href="/assets/index.html.cac6b252.js"><link rel="prefetch" href="/assets/index.html.fa9188ec.js"><link rel="prefetch" href="/assets/index.html.8075d560.js"><link rel="prefetch" href="/assets/404.17b7571b.js"><link rel="prefetch" href="/assets/Layout.706c9e43.js"><link rel="prefetch" href="/assets/Slide.9e82aa3a.js"><link rel="prefetch" href="/assets/Blog.1d3992d7.js"><link rel="prefetch" href="/assets/auto.esm.36809f22.js"><link rel="prefetch" href="/assets/index.daae04bf.js"><link rel="prefetch" href="/assets/index.1842ee54.js"><link rel="prefetch" href="/assets/mermaid.esm.min.ee1e0284.js"><link rel="prefetch" href="/assets/highlight.esm.d982e650.js"><link rel="prefetch" href="/assets/markdown.esm.832a189d.js"><link rel="prefetch" href="/assets/math.esm.a3f84b6f.js"><link rel="prefetch" href="/assets/notes.esm.3c361cb7.js"><link rel="prefetch" href="/assets/reveal.esm.b96f05d8.js"><link rel="prefetch" href="/assets/search.esm.80da4a02.js"><link rel="prefetch" href="/assets/zoom.esm.8514a202.js"><link rel="prefetch" href="/assets/photoswipe.esm.092fbc15.js"><link rel="prefetch" href="/assets/index.0e8935cb.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to content</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><a href="/" class="brand"><img class="logo" src="/logo.svg" alt="课程笔记"><!----><span class="site-name hide-in-pad">课程笔记</span></a><!----></div><div class="navbar-center"><!----><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/" class="nav-link" aria-label="博客主页"><span class="icon iconfont icon-home" style=""></span>博客主页<!----></a></div><div class="nav-item hide-in-mobile"><a href="/%E9%A1%B9%E7%9B%AE%E8%B5%84%E6%BA%90" class="nav-link" aria-label="项目资源"><!---->项目资源<!----></a></div><div class="nav-item hide-in-mobile"><a href="/react%E8%AF%BE%E7%A8%8B/" class="nav-link active" aria-label="课程笔记"><span class="icon iconfont icon-book-font" style=""></span>课程笔记<!----></a></div><div class="nav-item hide-in-mobile"><a href="/%E9%A1%B9%E7%9B%AE%E9%97%AE%E9%A2%98" class="nav-link" aria-label="项目问题"><span class="icon iconfont icon-book-font" style=""></span>项目问题<!----></a></div></nav><!----></div><div class="navbar-right"><!----><!----><div class="nav-item"><a class="repo-link" href="https://github.com/vuepress-theme-hope/vuepress-theme-hope" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!----><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-javascript" style=""></span><span class="title">js高级笔记</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><a href="/%E9%A1%B9%E7%9B%AE%E8%B5%84%E6%BA%90" class="nav-link sidebar-link sidebar-page" aria-label="项目资源"><span class="icon iconfont icon-repo" style=""></span>项目资源<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><section class="sidebar-group"><p class="sidebar-heading clickable"><span class="icon iconfont icon-repo" style=""></span><a href="/%E9%A1%B9%E7%9B%AE%E9%97%AE%E9%A2%98" class="title">项目问题</a><!----></p><ul class="sidebar-links"><li><!--[--><a href="/%E9%A1%B9%E7%9B%AE%E9%97%AE%E9%A2%98/1.node-sass%E9%97%AE%E9%A2%98.html" class="nav-link sidebar-link sidebar-page" aria-label="1.node-sass问题"><!---->1.node-sass问题<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable active"><span class="icon iconfont icon-react" style=""></span><span class="title">react课程</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">一、react基础</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">二、react-极客园【PC】</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">三、react-hooks</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">四、react-redux</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">五、react-typescript</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable active"><!----><span class="title">六、react-极客园移动端</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-1%E3%80%90%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA%E3%80%91.html" class="nav-link sidebar-link sidebar-page" aria-label="📚极客园M-1【项目搭建】"><!---->📚极客园M-1【项目搭建】<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-2%E3%80%90%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97%E3%80%91.html" class="nav-link sidebar-link sidebar-page" aria-label="📚极客园M-2【登录模块】"><!---->📚极客园M-2【登录模块】<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-3%E3%80%90%E5%B8%83%E5%B1%80%E9%A1%B5%E9%9D%A2%E3%80%91.html" class="nav-link sidebar-link sidebar-page" aria-label="📚极客园M-3【布局页面】"><!---->📚极客园M-3【布局页面】<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="📚极客园M-4【个人中心】"><!---->📚极客园M-4【个人中心】<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_01-页面结构" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="01-页面结构"><!---->01-页面结构<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_02-获取用户信息并展示" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="02-获取用户信息并展示"><!---->02-获取用户信息并展示<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_03-用户信息-发送请求获取数据" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="03-用户信息-发送请求获取数据"><!---->03-用户信息-发送请求获取数据<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_04-用户信息-组件分发-action" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="04-用户信息-组件分发 action"><!---->04-用户信息-组件分发 action<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_05-用户信息-存储到-redux" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="05-用户信息-存储到 redux"><!---->05-用户信息-存储到 redux<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_06-用户信息-展示用户信息" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="06-用户信息-展示用户信息"><!---->06-用户信息-展示用户信息<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_07-封装-axios-响应工具类型" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="07-封装 axios 响应工具类型"><!---->07-封装 axios 响应工具类型<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_08-个人信息-页面结构" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="08-个人信息-页面结构"><!---->08-个人信息-页面结构<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_09-个人信息-获取并展示个人信息" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="09-个人信息-获取并展示个人信息"><!---->09-个人信息-获取并展示个人信息<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_10-自定义-hooks" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="10-自定义 hooks"><!---->10-自定义 hooks<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_11-自定义-hooks-分析要封装的代码逻辑" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="11-自定义 hooks-分析要封装的代码逻辑"><!---->11-自定义 hooks-分析要封装的代码逻辑<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_12-自定义-hooks-实现自定义-hooks-不考虑类型" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="12-自定义 hooks-实现自定义 hooks-不考虑类型"><!---->12-自定义 hooks-实现自定义 hooks-不考虑类型<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_13-自定义-hooks-为实现的自定义-hooks-添加类型" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="13-自定义 hooks-为实现的自定义 hooks 添加类型"><!---->13-自定义 hooks-为实现的自定义 hooks 添加类型<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_14-自定义-hooks-改造个人信息" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="14-自定义 hooks-改造个人信息"><!---->14-自定义 hooks-改造个人信息<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_15-修改昵称-渲染修改昵称组件" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="15-修改昵称-渲染修改昵称组件"><!---->15-修改昵称-渲染修改昵称组件<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_16-修改昵称-展示修改昵称组件" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="16-修改昵称-展示修改昵称组件"><!---->16-修改昵称-展示修改昵称组件<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_17-修改昵称-隐藏修改昵称组件" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="17-修改昵称-隐藏修改昵称组件"><!---->17-修改昵称-隐藏修改昵称组件<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_18-修改昵称-弹出层显示昵称" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="18-修改昵称-弹出层显示昵称"><!---->18-修改昵称-弹出层显示昵称<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_19-修改昵称-提交时拿到昵称回传给父组件" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="19-修改昵称-提交时拿到昵称回传给父组件"><!---->19-修改昵称-提交时拿到昵称回传给父组件<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_20-修改昵称-发送请求" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="20-修改昵称-发送请求"><!---->20-修改昵称-发送请求<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_21-修改昵称-更新-redux-状态" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="21-修改昵称-更新 redux 状态"><!---->21-修改昵称-更新 redux 状态<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_22-修改昵称-完成修改" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="22-修改昵称-完成修改"><!---->22-修改昵称-完成修改<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_23-修改简介-复用修改昵称弹出层" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="23-修改简介-复用修改昵称弹出层"><!---->23-修改简介-复用修改昵称弹出层<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_24-修改简介-展示修改简介弹出层" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="24-修改简介-展示修改简介弹出层"><!---->24-修改简介-展示修改简介弹出层<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_25-修改简介-弹出层中展示简介内容" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="25-修改简介-弹出层中展示简介内容"><!---->25-修改简介-弹出层中展示简介内容<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_25-修改简介-复用提交时的回传逻辑" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="25-修改简介-复用提交时的回传逻辑"><!---->25-修改简介-复用提交时的回传逻辑<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_26-修改性别-渲染修改性别弹出层" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="26-修改性别-渲染修改性别弹出层"><!---->26-修改性别-渲染修改性别弹出层<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_27-修改性别-修改性别弹出层的展示或隐藏" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="27-修改性别-修改性别弹出层的展示或隐藏"><!---->27-修改性别-修改性别弹出层的展示或隐藏<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_28-修改性别-更新数据" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="28-修改性别-更新数据"><!---->28-修改性别-更新数据<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_28-修改头像-展示修改头像弹出层内容" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="28-修改头像-展示修改头像弹出层内容"><!---->28-修改头像-展示修改头像弹出层内容<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_29-修改头像-弹窗选择图片" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="29-修改头像-弹窗选择图片"><!---->29-修改头像-弹窗选择图片<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_30-修改头像-组装修改头像的数据" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="30-修改头像-组装修改头像的数据"><!---->30-修改头像-组装修改头像的数据<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_31-修改头像-更新头像" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="31-修改头像-更新头像"><!---->31-修改头像-更新头像<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_32-修改生日-展示日期选择器" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="32-修改生日-展示日期选择器"><!---->32-修改生日-展示日期选择器<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_33-修改生日-更新生日" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="33-修改生日-更新生日"><!---->33-修改生日-更新生日<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_34-退出登录-弹窗确认" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="34-退出登录-弹窗确认"><!---->34-退出登录-弹窗确认<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_35-退出登录-功能完成" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="35-退出登录-功能完成"><!---->35-退出登录-功能完成<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_36-封装鉴权路由组件" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="36-封装鉴权路由组件"><!---->36-封装鉴权路由组件<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_37-登录时跳转到相应页面" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="37-登录时跳转到相应页面"><!---->37-登录时跳转到相应页面<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_38-理解无感刷新-token" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="38-理解无感刷新 token"><!---->38-理解无感刷新 token<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_39-实现无感刷新-token-换取新的-token" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="39-实现无感刷新 token-换取新的 token"><!---->39-实现无感刷新 token-换取新的 token<!----></a><ul class="sidebar-sub-headers"></ul></li></ul><!--]--></li><li><!--[--><a href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-5%E3%80%90%E9%A6%96%E9%A1%B5%E3%80%91.html" class="nav-link sidebar-link sidebar-page" aria-label="📚极客园M-5【首页】"><!---->📚极客园M-5【首页】<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-6%E3%80%90%E6%90%9C%E7%B4%A2%E3%80%91.html" class="nav-link sidebar-link sidebar-page" aria-label="📚极客园M-6【搜索】"><!---->📚极客园M-6【搜索】<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-7%E3%80%90%E6%96%87%E7%AB%A0%E8%AF%A6%E6%83%85%E3%80%91.html" class="nav-link sidebar-link sidebar-page" aria-label="📚极客园M-7【文章详情】"><!---->📚极客园M-7【文章详情】<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-8%E3%80%90%E5%B0%8F%E6%99%BA%E5%90%8C%E5%AD%A6%E3%80%91.html" class="nav-link sidebar-link sidebar-page" aria-label="📚 极客园M-8【小智同学】"><!---->📚 极客园M-8【小智同学】<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%E9%9D%A2%E8%AF%95%E9%A2%98.html" class="nav-link sidebar-link sidebar-page" aria-label="🌹 面试技巧"><!---->🌹 面试技巧<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/react%E9%9D%A2%E8%AF%95%E9%A2%98.html" class="nav-link sidebar-link sidebar-page" aria-label="🌹 React题目汇总"><!---->🌹 React题目汇总<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/webpack%E9%9D%A2%E8%AF%95%E9%A2%98.html" class="nav-link sidebar-link sidebar-page" aria-label="🌹 webpack面试题"><!---->🌹 webpack面试题<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-vue" style=""></span><span class="title">vue人力资源项目</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-vue" style=""></span><span class="title">vue黑马头条项目</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-wechat" style=""></span><span class="title">小程序课程笔记</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-repo" style=""></span><span class="title">面试题</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-vue" style=""></span><span class="title">vue3小兔鲜项目</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-react" style=""></span><span class="title">react进阶笔记</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-cache" style=""></span><span class="title">缓存相关</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-vue" style=""></span><span class="title">面试题系列</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">vue原理</span><span class="arrow right"></span></button><!----></section><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->📚极客园M-4【个人中心】</h1><div class="page-info"><span class="author-info" aria-label="作者🖊" data-balloon-pos="down" localizeddate="2022年5月22日" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="author-item" href="https://blog-1gxfs2h1401f4f58-1254415986.tcloudbaseapp.com/" target="_blank" rel="noopener noreferrer">武晓慧</a></span><span property="author" content="武晓慧"></span></span><!----><span class="date-info" aria-label="写作日期📅" data-balloon-pos="down" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span>2022年5月22日</span><meta property="datePublished" content="2022-05-22T10:16:09.000Z"></span><!----><!----><span class="reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down" localizeddate="2022年5月22日" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 36 分钟</span><meta property="timeRequired" content="PT36M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">此页内容</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_01-页面结构" class="router-link-active router-link-exact-active toc-link level2">01-页面结构</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_02-获取用户信息并展示" class="router-link-active router-link-exact-active toc-link level2">02-获取用户信息并展示</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_03-用户信息-发送请求获取数据" class="router-link-active router-link-exact-active toc-link level2">03-用户信息-发送请求获取数据</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_04-用户信息-组件分发-action" class="router-link-active router-link-exact-active toc-link level2">04-用户信息-组件分发 action</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_05-用户信息-存储到-redux" class="router-link-active router-link-exact-active toc-link level2">05-用户信息-存储到 redux</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_06-用户信息-展示用户信息" class="router-link-active router-link-exact-active toc-link level2">06-用户信息-展示用户信息</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_07-封装-axios-响应工具类型" class="router-link-active router-link-exact-active toc-link level2">07-封装 axios 响应工具类型</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_08-个人信息-页面结构" class="router-link-active router-link-exact-active toc-link level2">08-个人信息-页面结构</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_09-个人信息-获取并展示个人信息" class="router-link-active router-link-exact-active toc-link level2">09-个人信息-获取并展示个人信息</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_10-自定义-hooks" class="router-link-active router-link-exact-active toc-link level2">10-自定义 hooks</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_11-自定义-hooks-分析要封装的代码逻辑" class="router-link-active router-link-exact-active toc-link level2">11-自定义 hooks-分析要封装的代码逻辑</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_12-自定义-hooks-实现自定义-hooks-不考虑类型" class="router-link-active router-link-exact-active toc-link level2">12-自定义 hooks-实现自定义 hooks-不考虑类型</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_13-自定义-hooks-为实现的自定义-hooks-添加类型" class="router-link-active router-link-exact-active toc-link level2">13-自定义 hooks-为实现的自定义 hooks 添加类型</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_14-自定义-hooks-改造个人信息" class="router-link-active router-link-exact-active toc-link level2">14-自定义 hooks-改造个人信息</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_15-修改昵称-渲染修改昵称组件" class="router-link-active router-link-exact-active toc-link level2">15-修改昵称-渲染修改昵称组件</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_16-修改昵称-展示修改昵称组件" class="router-link-active router-link-exact-active toc-link level2">16-修改昵称-展示修改昵称组件</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_17-修改昵称-隐藏修改昵称组件" class="router-link-active router-link-exact-active toc-link level2">17-修改昵称-隐藏修改昵称组件</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_18-修改昵称-弹出层显示昵称" class="router-link-active router-link-exact-active toc-link level2">18-修改昵称-弹出层显示昵称</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_19-修改昵称-提交时拿到昵称回传给父组件" class="router-link-active router-link-exact-active toc-link level2">19-修改昵称-提交时拿到昵称回传给父组件</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_20-修改昵称-发送请求" class="router-link-active router-link-exact-active toc-link level2">20-修改昵称-发送请求</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_21-修改昵称-更新-redux-状态" class="router-link-active router-link-exact-active toc-link level2">21-修改昵称-更新 redux 状态</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_22-修改昵称-完成修改" class="router-link-active router-link-exact-active toc-link level2">22-修改昵称-完成修改</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_23-修改简介-复用修改昵称弹出层" class="router-link-active router-link-exact-active toc-link level2">23-修改简介-复用修改昵称弹出层</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_24-修改简介-展示修改简介弹出层" class="router-link-active router-link-exact-active toc-link level2">24-修改简介-展示修改简介弹出层</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_25-修改简介-弹出层中展示简介内容" class="router-link-active router-link-exact-active toc-link level2">25-修改简介-弹出层中展示简介内容</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_25-修改简介-复用提交时的回传逻辑" class="router-link-active router-link-exact-active toc-link level2">25-修改简介-复用提交时的回传逻辑</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_26-修改性别-渲染修改性别弹出层" class="router-link-active router-link-exact-active toc-link level2">26-修改性别-渲染修改性别弹出层</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_27-修改性别-修改性别弹出层的展示或隐藏" class="router-link-active router-link-exact-active toc-link level2">27-修改性别-修改性别弹出层的展示或隐藏</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_28-修改性别-更新数据" class="router-link-active router-link-exact-active toc-link level2">28-修改性别-更新数据</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_28-修改头像-展示修改头像弹出层内容" class="router-link-active router-link-exact-active toc-link level2">28-修改头像-展示修改头像弹出层内容</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_29-修改头像-弹窗选择图片" class="router-link-active router-link-exact-active toc-link level2">29-修改头像-弹窗选择图片</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_30-修改头像-组装修改头像的数据" class="router-link-active router-link-exact-active toc-link level2">30-修改头像-组装修改头像的数据</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_31-修改头像-更新头像" class="router-link-active router-link-exact-active toc-link level2">31-修改头像-更新头像</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_32-修改生日-展示日期选择器" class="router-link-active router-link-exact-active toc-link level2">32-修改生日-展示日期选择器</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_33-修改生日-更新生日" class="router-link-active router-link-exact-active toc-link level2">33-修改生日-更新生日</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_34-退出登录-弹窗确认" class="router-link-active router-link-exact-active toc-link level2">34-退出登录-弹窗确认</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_35-退出登录-功能完成" class="router-link-active router-link-exact-active toc-link level2">35-退出登录-功能完成</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_36-封装鉴权路由组件" class="router-link-active router-link-exact-active toc-link level2">36-封装鉴权路由组件</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_37-登录时跳转到相应页面" class="router-link-active router-link-exact-active toc-link level2">37-登录时跳转到相应页面</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_38-理解无感刷新-token" class="router-link-active router-link-exact-active toc-link level2">38-理解无感刷新 token</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-4%E3%80%90%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E3%80%91.html#_39-实现无感刷新-token-换取新的-token" class="router-link-active router-link-exact-active toc-link level2">39-实现无感刷新 token-换取新的 token</a></li><!----><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="📚极客园m-4【个人中心】" tabindex="-1"><a class="header-anchor" href="#📚极客园m-4【个人中心】" aria-hidden="true">#</a> 📚极客园M-4【个人中心】</h1><h2 id="_01-页面结构" tabindex="-1"><a class="header-anchor" href="#_01-页面结构" aria-hidden="true">#</a> 01-页面结构</h2><p><strong>目标</strong>：能够根据模板搭建个人中心页面结构</p><p><strong>步骤</strong>：</p><ol><li>根据模板修改 Profile 页面结构</li></ol><h2 id="_02-获取用户信息并展示" tabindex="-1"><a class="header-anchor" href="#_02-获取用户信息并展示" aria-hidden="true">#</a> 02-获取用户信息并展示</h2><p>该功能分为以下几步来实现：</p><ol><li>发送请求获取用户信息</li><li>页面分发获取用户信息的 action</li><li>将用户信息存储到 redux 中</li><li>获取用户信息并展示</li></ol><h2 id="_03-用户信息-发送请求获取数据" tabindex="-1"><a class="header-anchor" href="#_03-用户信息-发送请求获取数据" aria-hidden="true">#</a> 03-用户信息-发送请求获取数据</h2><p><strong>目标</strong>：能够发送请求获取用户信息</p><p><strong>步骤</strong>：</p><ol><li>根据接口准备所需类型</li><li>创建 actions/profile.ts 文件</li><li>创建获取用户信息的 action</li></ol><p><strong>核心代码</strong>：</p><p>types/data.d.ts 中：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// 我的 - 个人信息</span>
<span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token class-name">User</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  photo<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  art_count<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  follow_count<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  fans_count<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  like_count<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>actions/profile.ts 中：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> http <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/utils&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> RootThunkAction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/types/store&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> User <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/types/data&#39;</span><span class="token punctuation">;</span>


<span class="token keyword">type</span> <span class="token class-name">UserResponse</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  data<span class="token operator">:</span> User<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token comment">// 我的页面 - 获取个人信息</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> getUser <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> RootThunkAction <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>dispatch<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> http<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">get</span><span class="token generic class-name"><span class="token operator">&lt;</span>UserResponse<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&#39;/user&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_04-用户信息-组件分发-action" tabindex="-1"><a class="header-anchor" href="#_04-用户信息-组件分发-action" aria-hidden="true">#</a> 04-用户信息-组件分发 action</h2><p><strong>目标</strong>：能够在我的页面中分发获取用户信息的 action</p><p><strong>核心代码</strong>：</p><p>Profile/index.tsx 中：</p><div class="language-tsx ext-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useDispatch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react-redux&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> getUser <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/store/actions&#39;</span><span class="token punctuation">;</span>


<span class="token keyword">const</span> <span class="token function-variable function">Profile</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> dispatch <span class="token operator">=</span> <span class="token function">useDispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>dispatch<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_05-用户信息-存储到-redux" tabindex="-1"><a class="header-anchor" href="#_05-用户信息-存储到-redux" aria-hidden="true">#</a> 05-用户信息-存储到 redux</h2><p><strong>目标</strong>：能够将用户信息保存到 redux 中</p><p><strong>步骤</strong>：</p><ol><li>准备保存状态到 redux 的 action 类型</li><li>在获取个人信息的 action 中将用户信息存储到 redux 中</li><li>创建 reducers/profile.ts，并完成存储用户信息的功能</li><li>在 reducers/index.ts 中，将 profile 合并到根 reducer 中</li></ol><p><strong>核心代码</strong>：</p><p>types/store.d.ts 中：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> User <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../data&#39;</span><span class="token punctuation">;</span>


<span class="token comment">// 将 ProfileAction 联合到 redux action 类型中</span>
<span class="token keyword">type</span> <span class="token class-name">RootAction</span> <span class="token operator">=</span> LoginAction <span class="token operator">|</span> ProfileAction<span class="token punctuation">;</span>


<span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token class-name">ProfileAction</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token string">&#39;profile/getUser&#39;</span><span class="token punctuation">;</span>
  payload<span class="token operator">:</span> User<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>actions/profile.ts 中：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> getUser <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> RootThunkAction <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>dispatch<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> http<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">get</span><span class="token generic class-name"><span class="token operator">&lt;</span>UserResponse<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&#39;/user&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> data<span class="token punctuation">,</span> message <span class="token punctuation">}</span> <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">;</span>


    <span class="token comment">// 存储 redux 中</span>
    <span class="token comment">// 因为已经有 TS 类型，所以，此处代码都是有提示的</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">&#39;profile/getUser&#39;</span><span class="token punctuation">,</span> payload<span class="token operator">:</span> data <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>reducers/profile.ts 中：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> User <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/types/data&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> ProfileAction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/types/store&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token class-name">ProfileState</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  user<span class="token operator">:</span> User<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token keyword">const</span> initialState <span class="token operator">=</span> <span class="token punctuation">{</span>
  user<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">as</span> ProfileState<span class="token punctuation">;</span>


<span class="token keyword">const</span> profile <span class="token operator">=</span> <span class="token punctuation">(</span>state <span class="token operator">=</span> initialState<span class="token punctuation">,</span> action<span class="token operator">:</span> ProfileAction<span class="token punctuation">)</span><span class="token operator">:</span> ProfileState <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">&#39;profile/getUser&#39;</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token operator">...</span>state<span class="token punctuation">,</span>
        user<span class="token operator">:</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token keyword">export</span> <span class="token keyword">default</span> profile<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>reducers/index.ts 中：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> profile <span class="token keyword">from</span> <span class="token string">&#39;./profile&#39;</span><span class="token punctuation">;</span>


<span class="token keyword">const</span> rootReducer <span class="token operator">=</span> <span class="token function">combineReducers</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  profile<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_06-用户信息-展示用户信息" tabindex="-1"><a class="header-anchor" href="#_06-用户信息-展示用户信息" aria-hidden="true">#</a> 06-用户信息-展示用户信息</h2><p><strong>目标</strong>：能够展示用户信息</p><p><strong>分析说明</strong>：</p><p>TS 支持索引查询类型（索引访问类型），用来查询属性的类型</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">type</span> <span class="token class-name">RootState</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token comment">// T1 的类型是：name 属性的类型 string</span>
<span class="token keyword">type</span> <span class="token class-name"><span class="token constant">T1</span></span> <span class="token operator">=</span> RootState<span class="token punctuation">[</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>步骤</strong>：</p><ol><li>导入 useSelector</li><li>调用 useSelector 获取 user 状态</li><li>从 user 对象中解构出用户数据并展示在页面中</li></ol><p><strong>核心代码</strong>：</p><div class="language-tsx ext-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useSelector <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react-redux&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> RootState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/types/store&#39;</span><span class="token punctuation">;</span>


<span class="token keyword">const</span> <span class="token function-variable function">Profile</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// const { user } = useSelector&lt;RootState, RootState[&#39;profile&#39;]&gt;(state =&gt; state.profile)</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> user <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useSelector</span><span class="token punctuation">(</span><span class="token punctuation">(</span>state<span class="token operator">:</span> RootState<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>profile<span class="token punctuation">)</span><span class="token punctuation">;</span>


  <span class="token keyword">const</span> <span class="token punctuation">{</span> photo<span class="token punctuation">,</span> name<span class="token punctuation">,</span> like_count<span class="token punctuation">,</span> follow_count<span class="token punctuation">,</span> fans_count<span class="token punctuation">,</span> art_count <span class="token punctuation">}</span> <span class="token operator">=</span> user<span class="token punctuation">;</span>


  <span class="token comment">// ...</span>
  <span class="token comment">// 在 JSX 中渲染从 redux 中拿到的状态数据即可</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_07-封装-axios-响应工具类型" tabindex="-1"><a class="header-anchor" href="#_07-封装-axios-响应工具类型" aria-hidden="true">#</a> 07-封装 axios 响应工具类型</h2><p><strong>目标</strong>：能够封装工具类型统一处理 axios 的响应类型</p><p><strong>分析说明</strong>：</p><p>对于项目接口来说，任何一个接口返回的顶层数据格式都是一样的，都有：</p><ol><li>都有 message 属性，类型为 string （固定）</li><li>都有 data 属性，但是具体是什么类型不确定（变化）</li></ol><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// 登录</span>
<span class="token keyword">type</span> <span class="token class-name">LoginResponse</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  data<span class="token operator">:</span> Token<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 用户</span>
<span class="token keyword">type</span> <span class="token class-name">UserResponse</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  data<span class="token operator">:</span> User<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>问题：TS 类型中，什么类型可以配合多种类型使用，并且可以在使用时指定明确类型？<strong>泛型</strong></p><p><strong>步骤</strong>：</p><ol><li>在 types/data.d.ts 中，创建泛型工具类型 ApiResponse</li><li>通过该泛型工具类型，统一处理 axios 响应类型</li></ol><p><strong>核心代码</strong>：</p><p>types/data.d.ts 中：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// 泛型工具类型</span>
<span class="token keyword">type</span> <span class="token class-name">ApiResponse<span class="token operator">&lt;</span>Data<span class="token operator">&gt;</span></span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  data<span class="token operator">:</span> Data<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token comment">// 统一处理axios响应类型：</span>
<span class="token comment">// 登录</span>
<span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token class-name">LoginResponse</span> <span class="token operator">=</span> ApiResponse<span class="token operator">&lt;</span>Token<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token comment">// 用户</span>
<span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token class-name">UserResponse</span> <span class="token operator">=</span> ApiResponse<span class="token operator">&lt;</span>User<span class="token operator">&gt;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>actions/login.ts 中：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> LoginResponse <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/types/data&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>actions/profile.ts 中：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> UserResponse <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/types/data&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_08-个人信息-页面结构" tabindex="-1"><a class="header-anchor" href="#_08-个人信息-页面结构" aria-hidden="true">#</a> 08-个人信息-页面结构</h2><p><strong>目标</strong>：能够根据模板展示个人信息页面</p><p><strong>步骤</strong>：</p><ol><li>将 Edit 模板拷贝到 Profile 目录中</li><li>在 App.tsx 中配置个人信息页面的路由</li><li>在 App.scss 中统一调整 NavBar、List 的样式</li></ol><p><strong>核心代码</strong>：</p><p>App.tsx 中：</p><div class="language-tsx ext-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">import</span> ProfileEdit <span class="token keyword">from</span> <span class="token string">&#39;./pages/Profile/Edit&#39;</span><span class="token punctuation">;</span>


<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token comment">// ...</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/profile/edit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ProfileEdit</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Route</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>App.scss 中：</p><div class="language-scss ext-scss line-numbers-mode"><pre class="language-scss"><code><span class="token selector">.adm-list-default </span><span class="token punctuation">{</span>
  <span class="token property">border</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
  <span class="token property">font-size</span><span class="token punctuation">:</span> 16px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.adm-nav-bar-title </span><span class="token punctuation">{</span>
  <span class="token property">font-size</span><span class="token punctuation">:</span> 17px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.adm-nav-bar-back-arrow </span><span class="token punctuation">{</span>
  <span class="token property">font-size</span><span class="token punctuation">:</span> 17px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_09-个人信息-获取并展示个人信息" tabindex="-1"><a class="header-anchor" href="#_09-个人信息-获取并展示个人信息" aria-hidden="true">#</a> 09-个人信息-获取并展示个人信息</h2><p><strong>目标</strong>：能够获取并展示编辑时的个人信息</p><p><strong>步骤</strong>：</p><ol><li>在 types/data.d.ts 中，根据接口准备好返回数据类型</li><li>在 actions/profile.ts 中，创建获取编辑时个人信息的 action</li><li>在 types/store.d.ts 中，创建相应的 redux action 类型</li><li>在 actions 中分发修改 redux 状态的 action</li><li>在 reducers 中处理该 action，并将状态存储到 redux 中</li></ol><p><strong>核心代码</strong>：</p><p>types/data.d.ts 中：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token class-name">UserProfile</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  photo<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  mobile<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  gender<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  birthday<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  intro<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token class-name">UserProfileResponse</span> <span class="token operator">=</span> ApiResponse<span class="token operator">&lt;</span>UserProfile<span class="token operator">&gt;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>actions/profile.ts 中：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> UserProfileResponse <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/types/data&#39;</span><span class="token punctuation">;</span>


<span class="token keyword">export</span> <span class="token keyword">const</span> getUserProfile <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> RootThunkAction <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>dispatch<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> http<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">get</span><span class="token generic class-name"><span class="token operator">&lt;</span>UserProfileResponse<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&#39;/user/profile&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">&#39;profile/getUserProfile&#39;</span><span class="token punctuation">,</span> payload<span class="token operator">:</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>data <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>types/store/d.ts 中：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> UserProfile <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./data&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token class-name">ProfileAction</span> <span class="token operator">=</span>
  <span class="token comment">// ...</span>
  <span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token string">&#39;profile/getUserProfile&#39;</span><span class="token punctuation">;</span>
    payload<span class="token operator">:</span> UserProfile<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>reducers/profile.ts 中：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// 注意：以下代码为简化代码</span>


<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> UserProfile <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/types/data&#39;</span><span class="token punctuation">;</span>


<span class="token keyword">type</span> <span class="token class-name">ProfileState</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  userProfile<span class="token operator">:</span> UserProfile<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token keyword">const</span> initialState <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  userProfile<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">as</span> ProfileState<span class="token punctuation">;</span>


<span class="token keyword">const</span> profile <span class="token operator">=</span> <span class="token punctuation">(</span>state <span class="token operator">=</span> initialState<span class="token punctuation">,</span> action<span class="token operator">:</span> ProfileAction<span class="token punctuation">)</span><span class="token operator">:</span> ProfileState <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token keyword">case</span> <span class="token string">&#39;profile/getUserProfile&#39;</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token operator">...</span>state<span class="token punctuation">,</span>
        userProfile<span class="token operator">:</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Profile/Edit/index.tsx 中：</p><div class="language-tsx ext-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useDispatch<span class="token punctuation">,</span> useSelector <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react-redux&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> getUserProfile <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/store/actions&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> RootState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/types/store&#39;</span><span class="token punctuation">;</span>


<span class="token keyword">const</span> <span class="token function-variable function">ProfileEdit</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> dispatch <span class="token operator">=</span> <span class="token function">useDispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> userProfile <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useSelector</span><span class="token punctuation">(</span><span class="token punctuation">(</span>state<span class="token operator">:</span> RootState<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>profile<span class="token punctuation">)</span><span class="token punctuation">;</span>


  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">getUserProfile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>dispatch<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


  <span class="token keyword">const</span> <span class="token punctuation">{</span> photo<span class="token punctuation">,</span> name<span class="token punctuation">,</span> intro<span class="token punctuation">,</span> gender<span class="token punctuation">,</span> birthday <span class="token punctuation">}</span> <span class="token operator">=</span> userProfile<span class="token punctuation">;</span>


  <span class="token comment">// JSX 中展示用户信息</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token comment">// ...</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Item</span></span>
      <span class="token attr-name">arrow</span>
      <span class="token attr-name">extra</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">classNames</span><span class="token punctuation">(</span><span class="token string">&#39;intro&#39;</span><span class="token punctuation">,</span> intro <span class="token operator">&amp;&amp;</span> <span class="token string">&#39;normal&#39;</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>intro<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
      <span class="token punctuation">}</span></span>
    <span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token punctuation">{</span>intro <span class="token operator">||</span> <span class="token string">&#39;未填写&#39;</span><span class="token punctuation">}</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Item</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_10-自定义-hooks" tabindex="-1"><a class="header-anchor" href="#_10-自定义-hooks" aria-hidden="true">#</a> 10-自定义 hooks</h2><p><strong>目标</strong>：能够知道什么是自定义 hooks</p><p><strong>分析说明</strong>：</p><p>除了使用 React 提供的 hooks 之外，开发者还可以创建自己的 hooks，也就是自定义 hooks</p><p>问题：为什么要创建自定义 hooks？</p><p>回答：<strong>实现状态逻辑复用</strong>，也就是将与状态相关的逻辑代码封装到一个函数中，哪个地方用到了，哪个地方调用即可</p><p>封装自定义 hook 与封装普通函数的区别：<strong>是否包含了状态逻辑</strong>，如果需要包含 React 状态逻辑，那么，就得用自定义 hook；而如果封装的内容不涉及状态，此时，就用普通的函数封装即可。</p><p>如何理解状态逻辑？<strong>可以简单的理解为代码中是否包含 React hooks，比如，useState、useEffect、useRef 等，那么就得使用自定义 hook 来封装</strong></p><p>自定义 hooks 的特点：</p><ol><li>名称必须以 <code>use</code> 开头</li><li>和内置的 React Hooks 一样，自定义 hook 也是一个函数</li></ol><ul><li>React Hooks（不管是内置的还是自定义的）只能在函数组件或其他自定义 hook 内使用</li></ul><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// 创建自定义 hooks 函数</span>
<span class="token keyword">const</span> <span class="token function-variable function">useXxx</span> <span class="token operator">=</span> <span class="token punctuation">(</span>params<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token comment">// 需要复用的状态逻辑代码</span>
  <span class="token comment">// ...</span>


  <span class="token keyword">return</span> xxx
<span class="token punctuation">}</span>


<span class="token comment">// 使用自定义 hooks 函数</span>
<span class="token keyword">const</span> <span class="token function-variable function">Hello</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> xxx <span class="token operator">=</span> <span class="token function">useXxx</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>说明：自定义 hooks 就是一个函数，可以完全按照对函数的理解，来理解自定义 hooks <ul><li>比如：参数和返回值都可以可选的，可以提供也可以不提供，根据实际的需求来实现即可</li></ul></li></ul><p><strong>总结</strong>：</p><ol><li>自定义 hooks 是函数吗？ 是</li><li>自定义 hooks 的名称有什么约束？必须以 <code>use</code> 开头</li><li>自定义 hooks 可以没有参数或返回值吗？可以</li></ol><h2 id="_11-自定义-hooks-分析要封装的代码逻辑" tabindex="-1"><a class="header-anchor" href="#_11-自定义-hooks-分析要封装的代码逻辑" aria-hidden="true">#</a> 11-自定义 hooks-分析要封装的代码逻辑</h2><p><strong>目标</strong>：能够分析要封装的代码逻辑找到相同点和不同点</p><p><strong>分析说明</strong>：</p><p>函数封装的基本思想：将相同的逻辑直接拷贝到函数中，不同的数据或逻辑通过函数参数传入。需要返回数据，就通过函数返回值返回</p><div class="language-tsx ext-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token comment">// 不同：导入的 action 函数不同</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> getUser <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/store/actions&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> getUserProfile <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/store/actions&#39;</span><span class="token punctuation">;</span>


<span class="token keyword">const</span> <span class="token function-variable function">Profile</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 不同： 获取到的状态不同</span>
  <span class="token comment">//  注意：虽然，此处两个获取到的都是 &#39;profile&#39;，但，实际上其他页面获取到的数据可能不同</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> user <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useSelector</span><span class="token generic class-name"><span class="token operator">&lt;</span>RootState<span class="token punctuation">,</span> RootState<span class="token punctuation">[</span><span class="token string">&#39;profile&#39;</span><span class="token punctuation">]</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>profile<span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> userProfile <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useSelector</span><span class="token generic class-name"><span class="token operator">&lt;</span>RootState<span class="token punctuation">,</span> RootState<span class="token punctuation">[</span><span class="token string">&#39;profile&#39;</span><span class="token punctuation">]</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>profile<span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>


  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 不同：分发的 action 函数不同</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">getUserProfile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>dispatch<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


  <span class="token comment">// 不同：获取到的状态不同</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> photo<span class="token punctuation">,</span> name<span class="token punctuation">,</span> like_count<span class="token punctuation">,</span> follow_count<span class="token punctuation">,</span> fans_count<span class="token punctuation">,</span> art_count <span class="token punctuation">}</span> <span class="token operator">=</span> user<span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> photo<span class="token punctuation">,</span> name<span class="token punctuation">,</span> intro<span class="token punctuation">,</span> gender<span class="token punctuation">,</span> birthday <span class="token punctuation">}</span> <span class="token operator">=</span> userProfile<span class="token punctuation">;</span>


  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>分析以上【我的页面】和【个人信息页面】中获取数据的逻辑，有两个不同点：</p><ol><li>分发的 action 函数不同</li><li>获取的状态不同</li></ol><p>所以，只需要把这两点作为自定义 hooks 的<strong>参数</strong>即可</p><p>而这两个功能最终的目的，都是为了拿到相应的应用状态。因此，把拿到的应用状态，作为自定义 hooks 的<strong>返回值</strong>即可</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 将不同的内容，作为函数参数传入</span>
<span class="token keyword">const</span> <span class="token function-variable function">useInitialState</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">action<span class="token punctuation">,</span> stateName</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 需要复用的状态逻辑代码（ 相同的逻辑代码 ）</span>


  <span class="token comment">// 最终，该操作需要什么数据，最终就通过 返回值 来返回</span>
  <span class="token keyword">return</span> state<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token comment">// 使用自定义 hooks：</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> userProfile <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useInitialState</span><span class="token punctuation">(</span>getUserProfile<span class="token punctuation">,</span> <span class="token string">&#39;profile&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> photo<span class="token punctuation">,</span> name<span class="token punctuation">,</span> intro<span class="token punctuation">,</span> gender<span class="token punctuation">,</span> birthday <span class="token punctuation">}</span> <span class="token operator">=</span> userProfile<span class="token punctuation">;</span>


<span class="token keyword">const</span> <span class="token punctuation">{</span> user <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useInitialState</span><span class="token punctuation">(</span>getUser<span class="token punctuation">,</span> <span class="token string">&#39;profile&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> photo<span class="token punctuation">,</span> name<span class="token punctuation">,</span> like_count<span class="token punctuation">,</span> follow_count<span class="token punctuation">,</span> fans_count<span class="token punctuation">,</span> art_count <span class="token punctuation">}</span> <span class="token operator">=</span> user<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_12-自定义-hooks-实现自定义-hooks-不考虑类型" tabindex="-1"><a class="header-anchor" href="#_12-自定义-hooks-实现自定义-hooks-不考虑类型" aria-hidden="true">#</a> 12-自定义 hooks-实现自定义 hooks-不考虑类型</h2><p><strong>目标</strong>：能够通过 JS 代码实现自定义 hooks</p><p><strong>步骤</strong>：</p><ol><li>创建 utils/use-initial-state.ts 文件</li><li>创建 useInitialState 函数（自定义 hook）</li><li>导入用到的包</li><li>将相同的逻辑，直接封装到 useInitialState 函数中</li><li>将不同的地方，作为 useInitialState 函数的参数</li><li>将拿到的状态作为 useInitialState 函数的返回值</li></ol><p><strong>核心代码</strong>：</p><p>utils/use-initial-state.ts 中：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// 导入用到的包</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useDispatch<span class="token punctuation">,</span> useSelector <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react-redux&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> RootState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/types/store&#39;</span><span class="token punctuation">;</span>


<span class="token comment">// 创建 useInitialState 函数（自定义 hook）</span>
<span class="token keyword">const</span> <span class="token function-variable function">useInitialState</span> <span class="token operator">=</span> <span class="token punctuation">(</span>action<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> stateName<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> dispatch <span class="token operator">=</span> <span class="token function">useDispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">useSelector</span><span class="token punctuation">(</span><span class="token punctuation">(</span>state<span class="token operator">:</span> RootState<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">[</span>stateName<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>dispatch<span class="token punctuation">,</span> action<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


  <span class="token keyword">return</span> state<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token keyword">export</span> <span class="token punctuation">{</span> useInitialState <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Profile/Edit.tsx 中：</p><div class="language-tsx ext-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useInitialState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/utils/use-initial-state&#39;</span><span class="token punctuation">;</span>


<span class="token keyword">const</span> <span class="token function-variable function">ProfileEdti</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> userProfile <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useInitialState</span><span class="token punctuation">(</span>getUserProfile<span class="token punctuation">,</span> <span class="token string">&#39;profile&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_13-自定义-hooks-为实现的自定义-hooks-添加类型" tabindex="-1"><a class="header-anchor" href="#_13-自定义-hooks-为实现的自定义-hooks-添加类型" aria-hidden="true">#</a> 13-自定义 hooks-为实现的自定义 hooks 添加类型</h2><p><strong>目标</strong>：能够为实现的自定义 hooks 添加类型</p><p><strong>分析说明</strong>：</p><p>对于 useInitialState 这个自定义 hook 来说，只需要为参数指定类型即可</p><ol><li>参数 action：就是一个函数，所以，直接指定为最简单的函数类型即可</li><li>参数 stateName： <ul><li>stateName 表示从 Redux 状态中取出的状态名称，比如，<code>&#39;profile&#39;</code> 或 <code>&#39;login&#39;</code></li><li>所以，stateName 应该是 RootState 中的所有状态名称中的任意一个</li><li>但是，具体是哪一个不确定，只有在使用该函数时才能确定下来</li><li>问题：如果一个类型不确定，应该是什么 TS 中的什么类型来实现？<strong>泛型</strong></li></ul></li></ol><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// Redux 整个应用，状态的类型</span>
<span class="token comment">// 目前，Redux 中已经有两个状态：login（登录时的状态）和 profile（我的 - 个人信息）</span>
<span class="token comment">// RootState =&gt; { login: Token; profile: ProfileState; a: B }</span>
<span class="token keyword">type</span> <span class="token class-name">RootState</span> <span class="token operator">=</span> ReturnType<span class="token operator">&lt;</span><span class="token keyword">typeof</span> store<span class="token punctuation">.</span>getState<span class="token operator">&gt;</span>


<span class="token comment">// 希望，在使用 useInitialState 自定义 hook 的时候，只应该获取到 Redux 中已有的状态，但是，获取哪一个状态时不确定的，只有在调用时才能确定</span>
<span class="token comment">// 因为 stateName 只能是 Redux 已有状态中的任何一个，所以，stateName 的取值范围：&#39;login&#39; | &#39;profile&#39; | &#39;a&#39;</span>
<span class="token comment">// 而此处不能直接写死一个联合类型，因为 Redux 中的状态将来是会变化（将来还要继续往 redux 中添加状态）</span>
<span class="token comment">// 既然不能写死，就得动态获取，也就是 Redux 状态类型 RootState 中有哪些状态，就拿到这些状态的名字即可</span>
<span class="token comment">// 那也就是要获取到 RootState 对象类型中，所有键的集合：	keyof RootState =&gt; &#39;login&#39; | &#39;profile&#39; | &#39;a&#39;</span>
<span class="token keyword">const</span> useInitialState <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function-variable function">action</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">,</span> stateName<span class="token operator">:</span> <span class="token keyword">keyof</span> RootState<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>


<span class="token comment">// 使用泛型：</span>
<span class="token comment">// S extends keyof RootState 表示：创建了一个泛型的类型变量叫做：S</span>
<span class="token comment">// 通过 extends 关键字来给 类型变量S 添加了泛型约束</span>
<span class="token comment">// 约束：S 的类型应该是 keyof RootState 中的任意一个，也就是：&#39;login&#39; | &#39;profile&#39; | &#39;a&#39;</span>
<span class="token comment">// const useInitialState = &lt;S extends keyof RootState&gt;(action: () =&gt; void, stateName: S) {}</span>
<span class="token keyword">const</span> useInitialState <span class="token operator">=</span> <span class="token operator">&lt;</span>StateName <span class="token keyword">extends</span> <span class="token keyword">keyof</span> RootState<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token function-variable function">action</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">,</span> stateName<span class="token operator">:</span> StateName<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>


<span class="token comment">// -- 对比以上两种方式的区别 --</span>
<span class="token comment">// 1 这种方式：在调用该函数时，最终得到的返回值类型：Token | ProfileState | B 也就是将所有可能出现的情况都列举出来了</span>
<span class="token keyword">const</span> useInitialState <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function-variable function">action</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">,</span> stateName<span class="token operator">:</span> <span class="token keyword">keyof</span> RootState<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>


<span class="token comment">// 2 这种方式：在调用该函数时，最终得到的返回值类型：是某一个状态的类型，这个类型由我们传入的 stateName 类决定</span>
<span class="token comment">//					 比如，useInitialState(getUser, &#39;profile&#39;) 返回值类型，就是 profile 这个键对应的类型：ProfileState</span>
<span class="token keyword">const</span> useInitialState <span class="token operator">=</span> <span class="token operator">&lt;</span>StateName <span class="token keyword">extends</span> <span class="token keyword">keyof</span> RootState<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token function-variable function">action</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">,</span> stateName<span class="token operator">:</span> StateName<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>


<span class="token comment">// 调用：</span>
<span class="token function">useInitialState</span><span class="token punctuation">(</span>getUser<span class="token punctuation">,</span> <span class="token string">&#39;login&#39;</span><span class="token punctuation">)</span>
<span class="token function">useInitialState</span><span class="token punctuation">(</span>getUser<span class="token punctuation">,</span> <span class="token string">&#39;profile&#39;</span><span class="token punctuation">)</span>
<span class="token function">useInitialState</span><span class="token punctuation">(</span>getUser<span class="token punctuation">,</span> <span class="token string">&#39;a&#39;</span><span class="token punctuation">)</span>


<span class="token comment">// 原来讲过的泛型基础：</span>
<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">id</span><span class="token generic class-name"><span class="token operator">&lt;</span>Type<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>value<span class="token operator">:</span> Type<span class="token punctuation">)</span><span class="token operator">:</span> Type <span class="token punctuation">{</span>
  <span class="token keyword">return</span> value
<span class="token punctuation">}</span>


<span class="token generic-function"><span class="token function">id</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token comment">// 省略类型不写：</span>
<span class="token function">id</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>核心代码</strong>：</p><p>utils/use-initial-state.ts 中：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// StateName 是泛型类型变量的名称</span>
<span class="token comment">// extends 表示要遵循的泛型约束</span>
<span class="token comment">// keyof RootState 用来获取 Redux 状态中所有的 key，即：所有状态名称中的任意一个</span>
<span class="token comment">// 将类型变量作为参数 stateName 的类型</span>
<span class="token comment">// 解释：约束参数 stateName 只能是 RootState 所有状态名称中的任意一个</span>
<span class="token keyword">const</span> useInitialState <span class="token operator">=</span> <span class="token operator">&lt;</span>StateName <span class="token keyword">extends</span> <span class="token keyword">keyof</span> RootState<span class="token operator">&gt;</span><span class="token punctuation">(</span>
  <span class="token function-variable function">action</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">,</span>
  stateName<span class="token operator">:</span> StateName<span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">useSelector</span><span class="token punctuation">(</span><span class="token punctuation">(</span>state<span class="token operator">:</span> RootState<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">[</span>stateName<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>完整代码如下：</li></ul><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// 导入用到的包</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useDispatch<span class="token punctuation">,</span> useSelector <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react-redux&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> RootState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/types/store&#39;</span><span class="token punctuation">;</span>


<span class="token comment">// 创建 useInitialState 函数（自定义 hook）</span>
<span class="token keyword">const</span> useInitialState <span class="token operator">=</span> <span class="token operator">&lt;</span>StateName <span class="token keyword">extends</span> <span class="token keyword">keyof</span> RootState<span class="token operator">&gt;</span><span class="token punctuation">(</span>
  <span class="token function-variable function">action</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">,</span>
  stateName<span class="token operator">:</span> StateName<span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> dispatch <span class="token operator">=</span> <span class="token function">useDispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">useSelector</span><span class="token punctuation">(</span><span class="token punctuation">(</span>state<span class="token operator">:</span> RootState<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">[</span>stateName<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// const state = useSelector&lt;RootState, RootState[StateName]&gt;(</span>
  <span class="token comment">//   state =&gt; state[stateName]</span>
  <span class="token comment">// )</span>


  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>dispatch<span class="token punctuation">,</span> action<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


  <span class="token keyword">return</span> state<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token keyword">export</span> <span class="token punctuation">{</span> useInitialState <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_14-自定义-hooks-改造个人信息" tabindex="-1"><a class="header-anchor" href="#_14-自定义-hooks-改造个人信息" aria-hidden="true">#</a> 14-自定义 hooks-改造个人信息</h2><p><strong>目标</strong>：能够使用封装好的自定义 hook 改造获取个人信息功能</p><p><strong>步骤</strong>：</p><ol><li>导入自定义 hook</li><li>调用自定义 hook，并传入相应的参数，验证是否有明确的类型提示</li><li>通过返回值，拿到对应的状态</li></ol><p><strong>核心代码</strong>：</p><p>Profile/Edit/index.tsx 中：</p><div class="language-tsx ext-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useInitialState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/utils/use-initial-state&#39;</span><span class="token punctuation">;</span>


<span class="token keyword">const</span> <span class="token function-variable function">ProfileEdit</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> userProfile <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useInitialState</span><span class="token punctuation">(</span>getUserProfile<span class="token punctuation">,</span> <span class="token string">&#39;profile&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_15-修改昵称-渲染修改昵称组件" tabindex="-1"><a class="header-anchor" href="#_15-修改昵称-渲染修改昵称组件" aria-hidden="true">#</a> 15-修改昵称-渲染修改昵称组件</h2><p><strong>目标</strong>：能够根据模板渲染修改昵称组件</p><p><strong>步骤</strong>：</p><ol><li>在 Edit 目录中创建 components 文件夹</li><li>将准备好的修改昵称的模板（EditInput）拷贝到 components 目录中</li><li>从 antd-mobile 中导入 Popup 组件</li><li>导入修改昵称组件，在 Popup 组件中渲染</li></ol><p><strong>核心代码</strong>：</p><p>Edit/index.tsx 中：</p><div class="language-tsx ext-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Popup <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;antd-mobile&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> EditInput <span class="token keyword">from</span> <span class="token string">&#39;./components/EditInput&#39;</span><span class="token punctuation">;</span>


<span class="token keyword">const</span> <span class="token function-variable function">ProfileEdit</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token comment">// ...</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Popup</span></span> <span class="token attr-name">visible</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>inputVisible<span class="token punctuation">}</span></span> <span class="token attr-name">position</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>right<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">EditInput</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Popup</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_16-修改昵称-展示修改昵称组件" tabindex="-1"><a class="header-anchor" href="#_16-修改昵称-展示修改昵称组件" aria-hidden="true">#</a> 16-修改昵称-展示修改昵称组件</h2><p><strong>目标</strong>：能够在点击修改昵称时展示弹出层</p><p><strong>步骤</strong>：</p><ol><li>准备控制弹出层展示或隐藏的状态 inputVisible，默认值为 false</li><li>使用状态 inputVisible 控制 Popup 组件的展示和隐藏</li><li>给昵称绑定点击事件</li><li>在点击事件中修改状态 inputVisible 为 true 来展示弹出层</li></ol><p><strong>核心代码</strong>：</p><p>Edit/index.tsx 中：</p><div class="language-tsx ext-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span>


<span class="token keyword">const</span> <span class="token function-variable function">ProfileEdit</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>inputVisible<span class="token punctuation">,</span> setInputVisible<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>


  <span class="token keyword">const</span> <span class="token function-variable function">onInputShow</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setInputVisible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>


  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token comment">// ...</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Item</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onInputShow<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      昵称
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Item</span></span><span class="token punctuation">&gt;</span></span>


    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Popup</span></span> <span class="token attr-name">visible</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>inputVisible<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">EditInput</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Popup</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><details class="custom-container details"><summary>样式有问题?</summary><blockquote><p>弹层不占满屏幕，以及按钮展示错位问题</p></blockquote><div class="language-css ext-css line-numbers-mode"><pre class="language-css"><code> <span class="token selector">:global</span> <span class="token punctuation">{</span>
    <span class="token selector">.adm-popup-body-position-right</span> <span class="token punctuation">{</span>
      <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


<span class="token selector">.logout</span> <span class="token punctuation">{</span>
      <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
      <span class="token property">bottom</span><span class="token punctuation">:</span> 60px<span class="token punctuation">;</span>
      <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
      <span class="token property">height</span><span class="token punctuation">:</span> 44px<span class="token punctuation">;</span>
      <span class="token property">padding</span><span class="token punctuation">:</span> 0 16px<span class="token punctuation">;</span>
      <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>

      <span class="token selector">.btn</span> <span class="token punctuation">{</span>
        <span class="token property">width</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span>100% - 32px<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
        <span class="token property">border-radius</span><span class="token punctuation">:</span> 4px<span class="token punctuation">;</span>
        <span class="token property">color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
        <span class="token property">font-size</span><span class="token punctuation">:</span> 16px<span class="token punctuation">;</span>
        <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">linear-gradient</span><span class="token punctuation">(</span>315deg<span class="token punctuation">,</span> #fe4f4f<span class="token punctuation">,</span> #fc6627<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><h2 id="_17-修改昵称-隐藏修改昵称组件" tabindex="-1"><a class="header-anchor" href="#_17-修改昵称-隐藏修改昵称组件" aria-hidden="true">#</a> 17-修改昵称-隐藏修改昵称组件</h2><p><strong>目标</strong>：能够在修改昵称组件点击返回时隐藏</p><p><strong>分析说明</strong>：</p><p>Edit 组件和 EditInput 组件之间是父子组件的关系</p><p>目标是通过 EditInput 子组件来隐藏弹出层，也就是在子组件中修改父组件中的状态</p><p>所以，此处通过<strong>子到父的组件通讯</strong>来解决</p><p><strong>步骤</strong>：</p><ol><li>在 Edit 组件中，创建一个控制弹出层隐藏的函数</li><li>将该函数作为属性传递给子组件 EditInput</li><li>在 EditInput 子组件中，通过 props 接收该属性</li><li>为 EditInput 组件的 props 指定类型</li><li>在点击导航栏返回按钮时，调用该关闭函数即可</li></ol><p><strong>核心代码</strong>：</p><p>Edit/index.tsx 中：</p><div class="language-tsx ext-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">const</span> <span class="token function-variable function">ProfileEdit</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function-variable function">onInputHide</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setInputVisible</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>


  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token comment">// ...</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">EditInput</span></span> <span class="token attr-name">onClose</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onInputHide<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Edit/components/EditInput/index.tsx 中：</p><div class="language-tsx ext-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">type</span> <span class="token class-name">Props</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">onClose</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">EditInput</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> onClose <span class="token punctuation">}</span><span class="token operator">:</span> Props<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">NavBar</span></span> <span class="token attr-name">onBack</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onClose<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">编辑昵称</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">NavBar</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_18-修改昵称-弹出层显示昵称" tabindex="-1"><a class="header-anchor" href="#_18-修改昵称-弹出层显示昵称" aria-hidden="true">#</a> 18-修改昵称-弹出层显示昵称</h2><p><strong>目标</strong>：能够在弹出层文本框中展示昵称</p><p><strong>步骤</strong>：</p><ol><li>为 EditInput 组件添加 value 属性，用于接收昵称</li><li>在 Edit 组件中将昵称传递给 EditInput 组件</li><li>在 EditInput 组件中创建一个状态，默认值为接收到的昵称</li><li>为 Input 组件设置 value 来展示昵称</li><li>为 Input 组件设置 onChange 来修改昵称</li></ol><p><strong>核心代码</strong>：</p><p>Edit/index.tsx 中：</p><div class="language-tsx ext-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">EditInput</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>name<span class="token punctuation">}</span></span> <span class="token attr-name">onClose</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onInputHide<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Edit/components/EditInput/index.tsx 中：</p><div class="language-tsx ext-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span>


<span class="token keyword">type</span> <span class="token class-name">Props</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">EditInput</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> value <span class="token punctuation">}</span><span class="token operator">:</span> Props<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>inputValue<span class="token punctuation">,</span> setInputValue<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>


  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token comment">// ...</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Input</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>请输入<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>inputValue<span class="token punctuation">}</span></span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>setInputValue<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_19-修改昵称-提交时拿到昵称回传给父组件" tabindex="-1"><a class="header-anchor" href="#_19-修改昵称-提交时拿到昵称回传给父组件" aria-hidden="true">#</a> 19-修改昵称-提交时拿到昵称回传给父组件</h2><p><strong>目标</strong>：能够在点击提交时拿到昵称并回传给父组件</p><p><strong>分析说明</strong>：</p><p>用户个人信息的状态是在 Edit 父组件中拿到的，所以，修改用户个人信息也应该由 Edit 父组件发起</p><p>因此，需要将修改后的昵称回传给 Edit 父组件</p><p><strong>步骤</strong>：</p><ol><li>为 EditInput 组件添加 onUpdateName 函数属性</li><li>在 Edit 组件中为 EditInput 组件传递 onUpdateName 属性</li><li>为提交按钮绑定点击事件</li><li>在点击事件中，调用父组件传递过来的 onUpdateName 函数，将昵称回传给父组件</li></ol><p><strong>核心代码</strong>：</p><p>Edit/index.tsx 中：</p><div class="language-tsx ext-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">const</span> <span class="token function-variable function">ProfileEdit</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function-variable function">onUpdateName</span> <span class="token operator">=</span> <span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;父组件拿到修改后的昵称：&#39;</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token function">onInputHide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>


  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token comment">// ...</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">EditInput</span></span> <span class="token attr-name">onUpdateName</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onUpdateName<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Edit/components/EditInput/index.tsx 中：</p><div class="language-tsx ext-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">type</span> <span class="token class-name">Props</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function-variable function">onUpdateName</span><span class="token operator">:</span> <span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token keyword">const</span> <span class="token function-variable function">EditInput</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> onUpdateName <span class="token punctuation">}</span><span class="token operator">:</span> Props<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">const</span> <span class="token function-variable function">onSave</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">onUpdateName</span><span class="token punctuation">(</span>inputValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>


  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token comment">// ...</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">NavBar</span></span>
      <span class="token attr-name">right</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>commit-btn<span class="token punctuation">&quot;</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onSave<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          提交
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
      <span class="token punctuation">}</span></span>
    <span class="token punctuation">&gt;</span></span><span class="token plain-text">
      编辑昵称
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">NavBar</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_20-修改昵称-发送请求" tabindex="-1"><a class="header-anchor" href="#_20-修改昵称-发送请求" aria-hidden="true">#</a> 20-修改昵称-发送请求</h2><p><strong>目标</strong>：能够修改用户昵称</p><p><strong>分析说明</strong>：</p><ol><li>该接口没有返回值，所以，不需要额外定义接口返回数据的类型</li><li>不管修改昵称还是简介，都是通过同一个接口来修改的，因此，可以通过传入不同的参数来复用该 action</li></ol><p><strong>步骤</strong>：</p><ol><li>创建 updateUserProfile action</li><li>为该 action 指定参数，参数类型为要修改的用户信息</li><li>发送请求修改用户数据</li></ol><p><strong>核心代码</strong>：</p><p>ProfileEdit.tsx 中：</p><div class="language-tsx ext-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token comment">// 更新用户昵称</span>
<span class="token keyword">const</span> <span class="token function-variable function">onUpdateName</span> <span class="token operator">=</span> <span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 修改昵称</span>
  <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">updateUserProfile</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 修改简介</span>
  <span class="token comment">// dispatch(updateUserProfile({ intro }))</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>actions/profile.ts 中：</p><div class="language-tsx ext-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> UserProfile <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/types/data&#39;</span><span class="token punctuation">;</span>


<span class="token keyword">export</span> <span class="token keyword">const</span> updateUserProfile <span class="token operator">=</span> <span class="token punctuation">(</span>
  <span class="token comment">// 参数为 UserProfile 中的任意属性，也就是调用该 action 时，可以传入任意的用户信息</span>
  <span class="token comment">// 从而来实现该接口的复用</span>
  userProfile<span class="token operator">:</span> Partial<span class="token operator">&lt;</span>UserProfile<span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token operator">:</span> RootThunkAction <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>dispatch<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> http<span class="token punctuation">.</span><span class="token function">patch</span><span class="token punctuation">(</span><span class="token string">&#39;/user/profile&#39;</span><span class="token punctuation">,</span> userProfile<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_21-修改昵称-更新-redux-状态" tabindex="-1"><a class="header-anchor" href="#_21-修改昵称-更新-redux-状态" aria-hidden="true">#</a> 21-修改昵称-更新 redux 状态</h2><p><strong>目标</strong>：能够更新用户昵称状态</p><p><strong>步骤</strong>：</p><ol><li>在 types/store.d.ts 中添加更新用户个人资料的 action 类型</li><li>在 actions 中分发 action 以更新用户昵称状态</li><li>在 reducers 中更新用户昵称</li></ol><p><strong>核心代码</strong>：</p><p>types/store.d.ts 中：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token class-name">ProfileAction</span> <span class="token operator">=</span>
  <span class="token comment">// ...</span>
  <span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token string">&#39;profile/update&#39;</span><span class="token punctuation">;</span>
    payload<span class="token operator">:</span> Partial<span class="token operator">&lt;</span>UserProfile<span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>actions/profile.ts 中：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> updateUserProfile <span class="token operator">=</span> <span class="token punctuation">(</span>
  userProfile<span class="token operator">:</span> Partial<span class="token operator">&lt;</span>UserProfile<span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token operator">:</span> RootThunkAction <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>dispatch<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> http<span class="token punctuation">.</span><span class="token function">patch</span><span class="token punctuation">(</span><span class="token string">&#39;/user/profile&#39;</span><span class="token punctuation">,</span> userProfile<span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token comment">// 分发 action 以更新用户昵称</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">&#39;profile/update&#39;</span><span class="token punctuation">,</span> payload<span class="token operator">:</span> userProfile <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>reducers/profile.ts 中：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> profile <span class="token operator">=</span> <span class="token punctuation">(</span>state <span class="token operator">=</span> initialState<span class="token punctuation">,</span> action<span class="token operator">:</span> ProfileAction<span class="token punctuation">)</span><span class="token operator">:</span> ProfileState <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token keyword">case</span> <span class="token string">&#39;profile/update&#39;</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token operator">...</span>state<span class="token punctuation">,</span>
        userProfile<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token operator">...</span>state<span class="token punctuation">.</span>userProfile<span class="token punctuation">,</span>
          <span class="token operator">...</span>action<span class="token punctuation">.</span>payload
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_22-修改昵称-完成修改" tabindex="-1"><a class="header-anchor" href="#_22-修改昵称-完成修改" aria-hidden="true">#</a> 22-修改昵称-完成修改</h2><p><strong>目标</strong>：能够实现修改昵称并提示更新成功</p><p><strong>核心代码</strong>：</p><p>Edit/index.tsx 中：</p><div class="language-tsx ext-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useDispatch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react-redux&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> updateUserProfile <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/store/actions&#39;</span><span class="token punctuation">;</span>


<span class="token keyword">const</span> <span class="token function-variable function">ProfileEdit</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">const</span> <span class="token function-variable function">onUpdateName</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">updateUserProfile</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> value <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Toast<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      content<span class="token operator">:</span> <span class="token string">&#39;更新成功&#39;</span><span class="token punctuation">,</span>
      duration<span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 关闭弹出层</span>
    <span class="token function">onInputHide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_23-修改简介-复用修改昵称弹出层" tabindex="-1"><a class="header-anchor" href="#_23-修改简介-复用修改昵称弹出层" aria-hidden="true">#</a> 23-修改简介-复用修改昵称弹出层</h2><p><strong>目标</strong>：能够复用修改昵称弹出层</p><p><strong>分析说明</strong>：</p><p>修改简介弹出层有两种实现方式：</p><ol><li>创建一个新的弹出层，也就是参考修改昵称的弹出层重写一遍</li><li>复用修改昵称的弹出层</li></ol><p>此处，我们选择复用修改昵称的弹出层组件。</p><p>要复用同一个组件，就需要区分出点击的是昵称还是简介，此处，可以通过状态来区分，修改如下：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// 原来：</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>inputVisible<span class="token punctuation">,</span> setInputVisible<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">// 现在：</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>inputPopup<span class="token punctuation">,</span> setInputPopup<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// type 属性：用于告诉 EditInput 组件，当前修改的是昵称还是简介</span>
  type<span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// &#39;name&#39; or &#39;intro&#39;</span>
  <span class="token comment">// 当前值</span>
  value<span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
  <span class="token comment">// 展示或隐藏状态</span>
  visible<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">// 使用：</span>
<span class="token comment">// 1 点击修改昵称</span>
<span class="token function">setInputPopup</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token string">&#39;name&#39;</span><span class="token punctuation">,</span>
  value<span class="token operator">:</span> name<span class="token punctuation">,</span>
  visible<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>步骤</strong>：</p><ol><li>修改控制昵称弹出层状态的结构</li><li>修改昵称弹出层的展示、隐藏操作</li><li>修改控制弹出层的 visible 属性值</li><li>修改传递给 EditInput 组件的 value 属性</li><li>为 EditInput 组件添加 type 属性，来接收当前展示类型</li></ol><p><strong>核心代码</strong>：</p><p>Edit/index.tsx 中：</p><div class="language-tsx ext-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">type</span> <span class="token class-name">InputPopup</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token string">&#39;&#39;</span> <span class="token operator">|</span> <span class="token string">&#39;name&#39;</span> <span class="token operator">|</span> <span class="token string">&#39;intro&#39;</span><span class="token punctuation">;</span>
  value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  visible<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">ProfileEdit</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>inputPopup<span class="token punctuation">,</span> setInputPopup<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useState</span><span class="token generic class-name"><span class="token operator">&lt;</span>InputPopup<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
    value<span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
    visible<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


  <span class="token keyword">const</span> <span class="token function-variable function">onInputShow</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setInputPopup</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token string">&#39;name&#39;</span><span class="token punctuation">,</span>
      value<span class="token operator">:</span> name<span class="token punctuation">,</span>
      visible<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">onInputHide</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setInputPopup</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
      value<span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
      visible<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>


  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token comment">// ...</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Popup</span></span> <span class="token attr-name">visible</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>inputPopup<span class="token punctuation">.</span>visible<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">EditInput</span></span> <span class="token attr-name">type</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>inputPopup<span class="token punctuation">.</span>type<span class="token punctuation">}</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>inputPopup<span class="token punctuation">.</span>value<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Popup</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>EditInput/index.tsx 中：</p><div class="language-tsx ext-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">type</span> <span class="token class-name">Props</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token string">&#39;&#39;</span> <span class="token operator">|</span> <span class="token string">&#39;name&#39;</span> <span class="token operator">|</span> <span class="token string">&#39;intro&#39;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token keyword">const</span> <span class="token function-variable function">EditInput</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> type <span class="token punctuation">}</span><span class="token operator">:</span> Props<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_24-修改简介-展示修改简介弹出层" tabindex="-1"><a class="header-anchor" href="#_24-修改简介-展示修改简介弹出层" aria-hidden="true">#</a> 24-修改简介-展示修改简介弹出层</h2><p><strong>目标</strong>：能够展示修改简介弹出层内容</p><p><strong>步骤</strong>：</p><ol><li>给简介绑定点击事件</li><li>在点击事件中，设置为简介的信息</li><li>在 EditInput 组件中，根据 type 的类型来展示昵称或简介信息（比如，标题、文本框或富文本框等）</li></ol><p><strong>核心代码</strong>：</p><p>Edit/index.tsx 中：</p><div class="language-tsx ext-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">const</span> <span class="token function-variable function">ProfileEdit</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function-variable function">onIntroShow</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setInputPopup</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token string">&#39;intro&#39;</span><span class="token punctuation">,</span>
      value<span class="token operator">:</span> intro<span class="token punctuation">,</span>
      visible<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>


  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token comment">// ...</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Item</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onIntroShow<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">简介</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Item</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>EditInput/index.tsx 中：</p><div class="language-tsx ext-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> TextArea <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;antd-mobile&#39;</span><span class="token punctuation">;</span>


<span class="token keyword">type</span> <span class="token class-name">Props</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token string">&#39;&#39;</span> <span class="token operator">|</span> <span class="token string">&#39;name&#39;</span> <span class="token operator">|</span> <span class="token string">&#39;intro&#39;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token keyword">const</span> <span class="token function-variable function">EditInput</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> type <span class="token punctuation">}</span><span class="token operator">:</span> Props<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> isName <span class="token operator">=</span> type <span class="token operator">===</span> <span class="token string">&#39;name&#39;</span><span class="token punctuation">;</span>


  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token comment">// ...</span>


    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>root<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">NavBar</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">编辑</span><span class="token punctuation">{</span>isName <span class="token operator">?</span> <span class="token string">&#39;昵称&#39;</span> <span class="token operator">:</span> <span class="token string">&#39;简介&#39;</span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">NavBar</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">


      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>edit-input-content<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>isName <span class="token operator">?</span> <span class="token string">&#39;昵称&#39;</span> <span class="token operator">:</span> <span class="token string">&#39;简介&#39;</span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token punctuation">{</span>isName <span class="token operator">?</span> <span class="token punctuation">(</span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>input-wrap<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Input</span></span>
              <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>请输入<span class="token punctuation">&quot;</span></span>
              <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>inputValue<span class="token punctuation">}</span></span>
              <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>setInputValue<span class="token punctuation">}</span></span>
            <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">TextArea</span></span>
            <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>textarea<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>请输入<span class="token punctuation">&quot;</span></span>
            <span class="token comment">// 展示：右下角的字数统计</span>
            <span class="token attr-name">showCount</span>
            <span class="token comment">// 指定内容最大长度</span>
            <span class="token attr-name">maxLength</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token number">100</span><span class="token punctuation">}</span></span>
            <span class="token comment">// 指定 文本域 展示内容的行数（文本域高度）</span>
            <span class="token attr-name">rows</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token number">4</span><span class="token punctuation">}</span></span>
            <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>inputValue<span class="token punctuation">}</span></span>
            <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>setInputValue<span class="token punctuation">}</span></span>
          <span class="token punctuation">/&gt;</span></span>
        <span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_25-修改简介-弹出层中展示简介内容" tabindex="-1"><a class="header-anchor" href="#_25-修改简介-弹出层中展示简介内容" aria-hidden="true">#</a> 25-修改简介-弹出层中展示简介内容</h2><p><strong>目标</strong>：能够在复用修改昵称弹出层后正确展示简介内容</p><p><strong>分析说明</strong>：</p><p>问题：弹出层中昵称和简介之间会相互影响 操作如下：</p><ol><li>先点击昵称，弹出层中展示昵称内容【正常】</li><li>关闭弹出层后，再点击简介，此时，弹出层中展示的仍然是昵称内容【Bug】</li></ol><p>问题分析： 默认情况下，antd-mobile 中的 Popup 组件在隐藏时，不会销毁所渲染的内容，而是隐藏（display: none）。</p><p>对于第一次点击昵称来说，会展示弹出层内容，并第一次执行 EditInput 组件中的代码。EditInput 组件通过 props 接收到 value，然后，交给内部的 <code>useState</code> hook，该 state 的默认值就是 props.value 的值，这一切都是正常的。</p><p>接下来，关闭弹出层，Popup 并没有销毁组件内容。所以，当我们再次点击简介时，因为给 EditInput 组件传递了新的属性值，所以，对于 EditInput 组件来说相当于进行了重新渲染。 但是，由于 <strong><code>useState</code> hook 默认值的特点只会在组件第一次渲染时生效</strong>。因此，虽然，EditInput 接收到了简介的 value 值，但是对于 useState 来说，这次的 value 值会被忽略。因此，展示在富文本框中的仍然是昵称内容。</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// useState 的默认值，只会在组件第一次渲染时生效</span>
<span class="token comment">// 以后的每次组件更新后的重新渲染，拿到的就是最新的 count 值了</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>解决方式：在每次展示 EditInput 组件，让 <code>useState</code> hook 都能正确使用 value 值即可。</p><ol><li>通过 useEffect 监听 props.value 变化</li></ol><p>EditInput/index.tsx 中：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// value 为 null 或 undefined 时，设置为默认值为空字符串</span>
  <span class="token function">setInputValue</span><span class="token punctuation">(</span>value <span class="token operator">??</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>value<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li>为 Popup 组件添加 destroyOnClose 属性</li></ol><p>Edit/index.tsx 中：</p><div class="language-tsx ext-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Popup</span></span>
  <span class="token comment">// 表示在关闭弹出层时，销毁组件内容</span>
  <span class="token attr-name">destroyOnClose</span>
<span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li>利用特殊的 key 属性 <ul><li>React 内部 diff 时，首先判断 key 是否相同，key 不同直接重新渲染该组件</li></ul></li></ol><p>Edit/index.tsx 中：</p><div class="language-tsx ext-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Popup</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">EditInput</span></span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>inputPopup<span class="token punctuation">.</span>type<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Popup</span></span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_25-修改简介-复用提交时的回传逻辑" tabindex="-1"><a class="header-anchor" href="#_25-修改简介-复用提交时的回传逻辑" aria-hidden="true">#</a> 25-修改简介-复用提交时的回传逻辑</h2><p><strong>目标</strong>：能够在点击提交时复用修改昵称的回传逻辑</p><p><strong>分析说明</strong>：</p><p>复用时，只需额外的提供当前的 type 类型即可</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">type</span> <span class="token class-name">Props</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">onUpdateName</span><span class="token operator">:</span> <span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token keyword">type</span> <span class="token class-name">Props</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  onUpdateProfile<span class="token operator">:</span> <span class="token punctuation">(</span>type<span class="token operator">:</span> <span class="token string">&#39;name&#39;</span> <span class="token operator">|</span> <span class="token string">&#39;intro&#39;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>步骤</strong>：</p><ol><li>修改 EditInput 组件回传数据的函数属性类型</li><li>修改提交按钮中，调用回传数据函数的参数</li><li>修改 Edit 组件中传递给 EditInput 的属性</li><li>修改 Edit 组件中更新用户信息的函数参数</li><li>关闭弹出层</li></ol><p><strong>核心代码</strong>：</p><p>EditInput/index.tsx 中：</p><div class="language-tsx ext-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">type</span> <span class="token class-name">Props</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  onUpdateProfile<span class="token operator">:</span> <span class="token punctuation">(</span>type<span class="token operator">:</span> <span class="token string">&#39;name&#39;</span> <span class="token operator">|</span> <span class="token string">&#39;intro&#39;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token keyword">const</span> <span class="token function-variable function">EditInput</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> onUpdateProfile <span class="token punctuation">}</span><span class="token operator">:</span> Props<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function-variable function">onSave</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 通过该判断，去掉 type 属性中的 &#39;&#39; 类型，解决类型不一致的问题</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token function">onUpdateProfile</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> inputValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>


  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Edit/index.tsx 中：</p><div class="language-tsx ext-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">const</span> <span class="token function-variable function">ProfileEdit</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> onUpdateProfile <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>type<span class="token operator">:</span> <span class="token string">&#39;name&#39;</span> <span class="token operator">|</span> <span class="token string">&#39;intro&#39;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">updateUserProfile</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token operator">:</span> value <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">onInputHide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>


  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token comment">// ...</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">EditInput</span></span> <span class="token attr-name">onUpdateProfile</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onUpdateProfile<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_26-修改性别-渲染修改性别弹出层" tabindex="-1"><a class="header-anchor" href="#_26-修改性别-渲染修改性别弹出层" aria-hidden="true">#</a> 26-修改性别-渲染修改性别弹出层</h2><p><strong>目标</strong>：能够显示修改性别弹出层</p><p><strong>步骤</strong>：</p><ol><li>将准备好的修改性别的模板（EditList）拷贝到 components 目录中</li><li>导入修改性别组件，在 Popup 组件中渲染</li></ol><p><strong>核心代码</strong>：</p><p>Edit/index.tsx 中：</p><div class="language-tsx ext-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">import</span> EditList <span class="token keyword">from</span> <span class="token string">&#39;./components/EditList&#39;</span><span class="token punctuation">;</span>


<span class="token keyword">const</span> <span class="token function-variable function">ProfileEdit</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token comment">// ...</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Popup</span></span> <span class="token attr-name">visible</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token boolean">true</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">EditList</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Popup</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_27-修改性别-修改性别弹出层的展示或隐藏" tabindex="-1"><a class="header-anchor" href="#_27-修改性别-修改性别弹出层的展示或隐藏" aria-hidden="true">#</a> 27-修改性别-修改性别弹出层的展示或隐藏</h2><p><strong>目标</strong>：能够控制修改性别弹出层的展示或隐藏</p><p><strong>分析说明</strong>：</p><p>修改性别和修改头像的弹出层内容几乎是一样的，因此，也可以复用同一个弹出层组件</p><p>因此，接下来要从<strong>复用</strong>的角度，设计修改性别弹出层的逻辑（可以参考刚刚实现的修改昵称和简介）</p><p><strong>步骤</strong>：</p><ol><li>准备用于控制修改性别弹出层的状态</li><li>为性别添加点击事件，在点击事件中修改状态进行展示</li><li>创建隐藏弹出层的控制函数，在点击遮罩时关闭弹出层，并传递给 EditList 组件</li><li>为 EditList 组件添加 props 类型，并接收隐藏函数</li><li>为取消按钮添加点击事件来触发隐藏弹出层</li></ol><p><strong>核心代码</strong>：</p><p>Edit/index.tsx 中：</p><div class="language-tsx ext-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">type</span> <span class="token class-name">ListPopup</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token string">&#39;&#39;</span> <span class="token operator">|</span> <span class="token string">&#39;gender&#39;</span> <span class="token operator">|</span> <span class="token string">&#39;photo&#39;</span>
  visible<span class="token operator">:</span> <span class="token builtin">boolean</span>
<span class="token punctuation">}</span>


<span class="token keyword">const</span> <span class="token function-variable function">ProfileEdit</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>listPopup<span class="token punctuation">,</span> setListPopup<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useState</span><span class="token generic class-name"><span class="token operator">&lt;</span>ListPopup<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
    visible<span class="token operator">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>


  <span class="token keyword">const</span> <span class="token function-variable function">onGenderShow</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setListPopup</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token string">&#39;gender&#39;</span><span class="token punctuation">,</span>
      visible<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> <span class="token function-variable function">onGenderHide</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setListPopup</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
      visible<span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>


  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token comment">// ...</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Item</span></span>
      <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onGenderShow<span class="token punctuation">}</span></span>
    <span class="token punctuation">&gt;</span></span><span class="token plain-text">
      性别
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Item</span></span><span class="token punctuation">&gt;</span></span>


    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Popup</span></span> <span class="token attr-name">visible</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>listPopup<span class="token punctuation">.</span>visible<span class="token punctuation">}</span></span> <span class="token attr-name">onMaskClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onGenderHide<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">EditList</span></span> <span class="token attr-name">onClose</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onGenderHide<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Popup</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>EditList/index.tsx 中：</p><div class="language-tsx ext-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">type</span> <span class="token class-name">Props</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">onClose</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token keyword">const</span> <span class="token function-variable function">EditList</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> onClose <span class="token punctuation">}</span><span class="token operator">:</span> Props<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list-item<span class="token punctuation">&quot;</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onClose<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      取消
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_28-修改性别-更新数据" tabindex="-1"><a class="header-anchor" href="#_28-修改性别-更新数据" aria-hidden="true">#</a> 28-修改性别-更新数据</h2><p><strong>目标</strong>：能够实现修改性别功能</p><p><strong>步骤</strong>：</p><ol><li>为 EditList 组件添加 type 和 onUpdateProfile 属性及其类型</li><li>为男/女列表项绑定点击事件</li><li>在点击事件中拿到当前当前点击项的 value 值</li><li>调用 onUpdateProfile 回传数据给父组件</li><li>在父组件 Edit 中，为 EditList 组件指定 onUpdateProfile，值为 onUpdateProfile 函数</li><li>关闭修改弹出层</li></ol><p><strong>核心代码</strong>：</p><p>EditList/index.tsx 中：</p><div class="language-tsx ext-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">type</span> <span class="token class-name">Props</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token string">&#39;&#39;</span> <span class="token operator">|</span> <span class="token string">&#39;gender&#39;</span> <span class="token operator">|</span> <span class="token string">&#39;photo&#39;</span><span class="token punctuation">;</span>
  onUpdateProfile<span class="token operator">:</span> <span class="token punctuation">(</span>type<span class="token operator">:</span> <span class="token string">&#39;gender&#39;</span> <span class="token operator">|</span> <span class="token string">&#39;photo&#39;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">EditList</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token punctuation">,</span> onUpdateProfile <span class="token punctuation">}</span><span class="token operator">:</span> Props<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function-variable function">onItemClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token function">onUpdateProfile</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>


  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>root<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list-item<span class="token punctuation">&quot;</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">onItemClick</span><span class="token punctuation">(</span><span class="token string">&#39;0&#39;</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        男
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list-item<span class="token punctuation">&quot;</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">onItemClick</span><span class="token punctuation">(</span><span class="token string">&#39;1&#39;</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        女
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Edit/index.tsx 中：</p><div class="language-tsx ext-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">const</span> <span class="token function-variable function">ProfileEdit</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function-variable function">onUpdateProfile</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token function">onGenderHide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>


  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token comment">// ...</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">EditList</span></span>
      <span class="token attr-name">type</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>listPopup<span class="token punctuation">.</span>type<span class="token punctuation">}</span></span>
      <span class="token comment">// onUpdateProfile 复用修改昵称或简介时的函数</span>
      <span class="token attr-name">onUpdateProfile</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onUpdateProfile<span class="token punctuation">}</span></span>
    <span class="token punctuation">/&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><details class="custom-container details"><summary>调用更新用户信息的函数的时候类型报错？</summary><blockquote><p>为参数type指定生日和性别的可选属性即可</p></blockquote><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>  const dispatch = useDispatch&lt;AppDispatch&gt;();
  const onUpdateProfile = async (type: PopType | ListPopup[&#39;type&#39;] ,name: string) =&gt; {
    const {type: resType} = await dispatch(fetchUpdateProfile({[type]: name}));
    if (resType === fetchUpdateProfile.fulfilled.type) {
      Toast.show({
        content: &quot;修改成功&quot;,
      });
      setEditFalse();
    }
  };
</code></pre><div class="highlight-lines"><br><div class="highlight-line"> </div><br><br><br><br><br><br><br><br></div><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><h2 id="_28-修改头像-展示修改头像弹出层内容" tabindex="-1"><a class="header-anchor" href="#_28-修改头像-展示修改头像弹出层内容" aria-hidden="true">#</a> 28-修改头像-展示修改头像弹出层内容</h2><p><strong>目标</strong>：能够展示修改头像弹出层内容</p><p><strong>分析说明</strong>：</p><p>修改性别和修改头像复用同一个弹出层组件，为了展示不同的内容，可以将弹出层内容，抽象成数据，然后，根据当前传入的 type 类型，来决定渲染哪种数据。</p><div class="language-tsx ext-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">const</span> genderList <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> text<span class="token operator">:</span> <span class="token string">&#39;男&#39;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token string">&#39;0&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> text<span class="token operator">:</span> <span class="token string">&#39;女&#39;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token string">&#39;1&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>


<span class="token keyword">const</span> photoList <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> text<span class="token operator">:</span> <span class="token string">&#39;拍照&#39;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token string">&#39;&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> text<span class="token operator">:</span> <span class="token string">&#39;本地选择&#39;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token string">&#39;&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>


<span class="token comment">// 要渲染的数据为：</span>
<span class="token keyword">const</span> list <span class="token operator">=</span> type <span class="token operator">===</span> <span class="token string">&#39;gender&#39;</span> <span class="token operator">?</span> genderList <span class="token operator">:</span> photoList<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>步骤</strong>：</p><ol><li>为头像列表项绑定点击事件</li><li>在点击事件中，展示对应弹出层</li><li>在 EditList 组件中，创建性别和头像对应的列表数据</li><li>根据当前传入的 type 属性，决定要渲染哪种列表数据</li><li>根据 list 数组，渲染列表结构</li></ol><p><strong>核心代码</strong>：</p><p>Edit/index.tsx 中：</p><div class="language-tsx ext-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">const</span> <span class="token function-variable function">ProfileEdit</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function-variable function">onPhotoShow</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setListPopup</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token string">&#39;photo&#39;</span><span class="token punctuation">,</span>
      visible<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>


  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token comment">// ...</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Item</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onPhotoShow<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">头像</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Item</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>EditList/index.tsx 中：</p><div class="language-tsx ext-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">const</span> genderList <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> text<span class="token operator">:</span> <span class="token string">&#39;男&#39;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token string">&#39;0&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> text<span class="token operator">:</span> <span class="token string">&#39;女&#39;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token string">&#39;1&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>


<span class="token keyword">const</span> photoList <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> text<span class="token operator">:</span> <span class="token string">&#39;拍照&#39;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token string">&#39;picture&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> text<span class="token operator">:</span> <span class="token string">&#39;本地选择&#39;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token string">&#39;local&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>


<span class="token keyword">const</span> <span class="token function-variable function">EditList</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token punctuation">,</span> onClose<span class="token punctuation">,</span> onUpdateProfile <span class="token punctuation">}</span><span class="token operator">:</span> Props<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> list <span class="token operator">=</span> type <span class="token operator">===</span> <span class="token string">&#39;gender&#39;</span> <span class="token operator">?</span> genderList <span class="token operator">:</span> photoList<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>root<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token punctuation">{</span>list<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span>
          <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list-item<span class="token punctuation">&quot;</span></span>
          <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>text<span class="token punctuation">}</span></span>
          <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token function">onUpdateProfile</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> item<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
        <span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>text<span class="token punctuation">}</span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">


      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list-item<span class="token punctuation">&quot;</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onClose<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        取消
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_29-修改头像-弹窗选择图片" tabindex="-1"><a class="header-anchor" href="#_29-修改头像-弹窗选择图片" aria-hidden="true">#</a> 29-修改头像-弹窗选择图片</h2><p><strong>目标</strong>：能够在点击拍照或本地选择时弹窗选择图片</p><p><strong>分析说明</strong>：</p><p>修改头像的逻辑与修改性别的其他用户信息的逻辑不同：</p><ol><li>修改性别的其他用户信息：点击男/女或者提交按钮时，直接发送请求，修改后端数据即可</li><li>修改头像：点击拍照或本地选择时，<em>弹窗让用户选择图片</em>（不考虑拍照），等用户选择图片后，才会发送请求，修改后台数据</li></ol><p>因此，需要单独处理修改头像的逻辑。</p><p>此时，就会有一个新的问题：如何在点击拍照或本地选择时，弹窗让用户选择图片？</p><p>我们知道，HTML 中的 <code>input[type=file]</code> 标签，可以实现图片选择。所以，此处需要用到 file 标签。</p><p>但是，点击项并不是 file，因此，可以转换下思路：<strong>在点击拍照或本地选择时，触发 file 的点击</strong>即可。</p><div class="language-tsx ext-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token comment">// 假设 file 就是 input[type=file] 对应的 DOM 对象：</span>
file<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>步骤</strong>：</p><ol><li>在 Edit 组件中，创建一个 <code>input[type=file]</code> 标签，并且设置为 hidden（隐藏该标签）</li><li>创建一个 ref 对象，来拿到 file 标签</li><li>在 onUpdateProfile 回调中，判断类型是否为 photo</li><li>如果是，触发 file 的点击</li><li>如果不是，继续执行原来的逻辑即可</li></ol><p><strong>核心代码</strong>：</p><p>Edit/index.tsx 中：</p><div class="language-tsx ext-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">const</span> <span class="token function-variable function">ProfileEdit</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> fileRef <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useRef</span><span class="token generic class-name"><span class="token operator">&lt;</span>HTMLInputElement<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>


  <span class="token keyword">const</span> onUpdateProfile <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>
    type<span class="token operator">:</span> <span class="token string">&#39;name&#39;</span> <span class="token operator">|</span> <span class="token string">&#39;intro&#39;</span> <span class="token operator">|</span> <span class="token string">&#39;gender&#39;</span> <span class="token operator">|</span> <span class="token string">&#39;photo&#39;</span><span class="token punctuation">,</span>
    value<span class="token operator">:</span> <span class="token builtin">string</span>
  <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">&#39;photo&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      fileRef<span class="token punctuation">.</span>current<span class="token operator">?.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// ... 原来的逻辑</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>


  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token comment">// ...</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wrapper<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">


      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span> <span class="token attr-name">hidden</span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>fileRef<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dis</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
  )
}
</span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_30-修改头像-组装修改头像的数据" tabindex="-1"><a class="header-anchor" href="#_30-修改头像-组装修改头像的数据" aria-hidden="true">#</a> 30-修改头像-组装修改头像的数据</h2><p><strong>目标</strong>：能够组装修改头像需要的数据</p><p><strong>步骤</strong>：</p><ol><li>创建函数，监听 <code>input[type=file]</code> 选择文件的变化</li><li>在函数中，创建 FormData 对象</li><li>根据接口，拿到接口需要规定的参数名，并将选择的文件添加到 FormData 对象中</li></ol><p><strong>核心代码</strong>：</p><p>Edit/index.tsx 中：</p><div class="language-tsx ext-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">const</span> <span class="token function-variable function">ProfileEdit</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function-variable function">onChangePhoto</span> <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> React<span class="token punctuation">.</span>ChangeEvent<span class="token operator">&lt;</span>HTMLInputElement<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> file <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>files<span class="token operator">?.</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>file<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> photoData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    photoData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&#39;photo&#39;</span><span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>


  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token comment">// ...</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onChangePhoto<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_31-修改头像-更新头像" tabindex="-1"><a class="header-anchor" href="#_31-修改头像-更新头像" aria-hidden="true">#</a> 31-修改头像-更新头像</h2><p><strong>目标</strong>：能够实现更新头像</p><p><strong>步骤</strong>：</p><ol><li>在 Edit 组件中，分发修改头像的 action，传入 FormData 对象，并关闭弹出层</li><li>根据更新用户头像接口，在 types/data.ts 中，添加接口返回数据的类型</li><li>在 actions 中，创建修改头像的 action，接收到传递过来的 FormData 对象</li><li>发送请求，更新用户头像</li><li>分发 action 来修改 redux 中的头像状态</li></ol><p><strong>核心代码</strong>：</p><p>Edit/index.tsx 中：</p><div class="language-tsx ext-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> updateUserPhoto <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/store/actions&#39;</span><span class="token punctuation">;</span>


<span class="token keyword">const</span> <span class="token function-variable function">ProfileEdit</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ---</span>
  <span class="token keyword">const</span> <span class="token function-variable function">onChangePhoto</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token keyword">await</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">updateUserPhoto</span><span class="token punctuation">(</span>photoData<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">onGenderHide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>types/data.d.ts 中：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token class-name">UserPhotoResponse</span> <span class="token operator">=</span> ApiResponse<span class="token operator">&lt;</span><span class="token punctuation">{</span>
  photo<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>actions/profile.ts 中：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> updateUserPhoto <span class="token operator">=</span> <span class="token punctuation">(</span>data<span class="token operator">:</span> FormData<span class="token punctuation">)</span><span class="token operator">:</span> RootThunkAction <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>dispatch<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> http<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">patch</span><span class="token generic class-name"><span class="token operator">&lt;</span>UserPhotoResponse<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&#39;/user/photo&#39;</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token string">&#39;profile/update&#39;</span><span class="token punctuation">,</span>
      payload<span class="token operator">:</span> <span class="token punctuation">{</span>
        photo<span class="token operator">:</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>data<span class="token punctuation">.</span>photo<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>补充-JS 调用摄像头的资料：</p><ol><li><a href="https://www.cnblogs.com/51ma/p/11611487.html" target="_blank" rel="noopener noreferrer">js 调用摄像头拍照上传图片<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li>[html input<a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Attributes/capture" target="_blank" rel="noopener noreferrer">type=file] 的 capture 属性<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ol><h2 id="_32-修改生日-展示日期选择器" tabindex="-1"><a class="header-anchor" href="#_32-修改生日-展示日期选择器" aria-hidden="true">#</a> 32-修改生日-展示日期选择器</h2><p><strong>目标</strong>：能够在点击生日时展示日期选择器</p><p><strong>步骤</strong>：</p><ol><li>创建状态 showBirthday 用来控制日期选择器的展示或隐藏</li><li>将 showBirthday 设置为日期选择器的 visible 属性</li><li>给生日绑定点击事件，在点击事件中修改 showBirthday 值为 true 来展示日期选择器</li><li>为日期选择器设置 value，值为用户的生日值</li><li>在日期选择器关闭的回调中，隐藏日期选择器</li></ol><p><strong>核心代码</strong>：</p><p>Edit/index.tsx 中：</p><div class="language-tsx ext-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">const</span> <span class="token function-variable function">ProfileEdit</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>showBirthday<span class="token punctuation">,</span> setShowBirthday<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>


  <span class="token keyword">const</span> <span class="token function-variable function">onBirthdayShow</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setShowBirthday</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> <span class="token function-variable function">onBirthdayHide</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setShowBirthday</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>


  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token comment">// ...</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Item</span></span> <span class="token attr-name">arrow</span> <span class="token attr-name">extra</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>birthday<span class="token punctuation">}</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onBirthdayShow<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      生日
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Item</span></span><span class="token punctuation">&gt;</span></span>


    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">DatePicker</span></span>
      <span class="token attr-name">visible</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>showBirthday<span class="token punctuation">}</span></span>
      <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>birthday<span class="token punctuation">)</span><span class="token punctuation">}</span></span>
      <span class="token attr-name">onCancel</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onBirthdayHide<span class="token punctuation">}</span></span>
      <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>选择年月日<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">min</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token number">1900</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>
      <span class="token attr-name">max</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>
    <span class="token punctuation">/&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_33-修改生日-更新生日" tabindex="-1"><a class="header-anchor" href="#_33-修改生日-更新生日" aria-hidden="true">#</a> 33-修改生日-更新生日</h2><p><strong>目标</strong>：能够实现更新生日</p><p><strong>步骤</strong>：</p><ol><li>创建 onUpdateBirthday 函数，并设置为日期选择器的 onConfirm 属性值</li><li>通过该函数的参数拿到日期选择器中选择的日期</li><li>安装 dayjs ，根据接口来格式化选择的日期为 <code>&#39;2018-12-20&#39;</code></li><li>为更新用户信息的函数 onUpdateProfile 的 type 参数添加 &#39;birthday&#39; 类型</li><li>复用 onUpdateProfile 函数来更新用户生日</li></ol><p><strong>核心代码</strong>：</p><p>Edit/index.tsx 中：</p><div class="language-tsx ext-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">import</span> dayjs <span class="token keyword">from</span> <span class="token string">&#39;dayjs&#39;</span><span class="token punctuation">;</span>


<span class="token keyword">const</span> <span class="token function-variable function">ProfileEdit</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> onUpdateProfile <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>
    type<span class="token operator">:</span> <span class="token string">&#39;name&#39;</span> <span class="token operator">|</span> <span class="token string">&#39;intro&#39;</span> <span class="token operator">|</span> <span class="token string">&#39;gender&#39;</span> <span class="token operator">|</span> <span class="token string">&#39;photo&#39;</span> <span class="token operator">|</span> <span class="token string">&#39;birthday&#39;</span><span class="token punctuation">,</span>
    value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">onUpdateBirthday</span> <span class="token operator">=</span> <span class="token punctuation">(</span>value<span class="token operator">:</span> Date<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> birthday <span class="token operator">=</span> <span class="token function">dayjs</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&#39;YYYY-MM-DD&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token function">onUpdateProfile</span><span class="token punctuation">(</span><span class="token string">&#39;birthday&#39;</span><span class="token punctuation">,</span> birthday<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">onBirthdayHide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>


  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token comment">// ...</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">DatePicker</span></span> <span class="token attr-name">onConfirm</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onUpdateBirthday<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_34-退出登录-弹窗确认" tabindex="-1"><a class="header-anchor" href="#_34-退出登录-弹窗确认" aria-hidden="true">#</a> 34-退出登录-弹窗确认</h2><p><strong>目标</strong>：能够点击退出按钮时弹窗确认是否退出</p><p><strong>分析说明</strong>：</p><p>不需要自定义样式的情况下，使用 <code>Dialog.confirm</code> 来弹窗确认即可</p><p>如果需要自定义弹窗按钮的样式，需要使用 <code>Dialog.show</code> 基础方法来实现</p><p><strong>步骤</strong>：</p><ol><li>为退出登录按钮绑定点击事件</li><li>在点击事件中，使用 Dialog 弹窗让用户确认是否退出登录</li></ol><p><strong>核心代码</strong>：</p><p>Edit/index.tsx 中：</p><div class="language-tsx ext-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">const</span> <span class="token function-variable function">ProfileEdti</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function-variable function">onLogout</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> handler <span class="token operator">=</span> Dialog<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      title<span class="token operator">:</span> <span class="token string">&#39;温馨提示&#39;</span><span class="token punctuation">,</span>
      content<span class="token operator">:</span> <span class="token string">&#39;亲，你确定退出吗？&#39;</span><span class="token punctuation">,</span>
      actions<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            key<span class="token operator">:</span> <span class="token string">&#39;cancel&#39;</span><span class="token punctuation">,</span>
            text<span class="token operator">:</span> <span class="token string">&#39;取消&#39;</span><span class="token punctuation">,</span>
            <span class="token function-variable function">onClick</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              handler<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            key<span class="token operator">:</span> <span class="token string">&#39;confirm&#39;</span><span class="token punctuation">,</span>
            text<span class="token operator">:</span> <span class="token string">&#39;退出&#39;</span><span class="token punctuation">,</span>
            style<span class="token operator">:</span> <span class="token punctuation">{</span>
              color<span class="token operator">:</span> <span class="token string">&#39;var(--adm-color-weak)&#39;</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>


  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token comment">// ...</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onLogout<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">退出登录</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_35-退出登录-功能完成" tabindex="-1"><a class="header-anchor" href="#_35-退出登录-功能完成" aria-hidden="true">#</a> 35-退出登录-功能完成</h2><p><strong>目标</strong>：能够实现退出功能</p><p><strong>步骤</strong>：</p><ol><li>为退出按钮，绑定点击事件，在点击事件中分发退出 action</li><li>在 types 中，创建退出登录的 action 类型</li><li>在 actions/login.ts 中，创建退出 action</li><li>在退出 action 中，分发退出 action，并清理 token</li><li>在 reducers 中，处理退出 action 清空 token</li><li>返回登录页面</li></ol><p><strong>核心代码</strong>：</p><p>Edit/index.tsx 中：</p><div class="language-tsx ext-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">const</span> <span class="token function-variable function">onLogout</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> handler <span class="token operator">=</span> Dialog<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    actions<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          text<span class="token operator">:</span> <span class="token string">&#39;退出&#39;</span><span class="token punctuation">,</span>
          <span class="token function-variable function">onClick</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            handler<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            history<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&#39;/login&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>types/data.d.ts 中：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// 登录 action 类型</span>
<span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token class-name">LoginAction</span> <span class="token operator">=</span>
  <span class="token operator">|</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token string">&#39;login/token&#39;</span><span class="token punctuation">;</span>
      payload<span class="token operator">:</span> Token<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token operator">|</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token string">&#39;login/logout&#39;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>actions/login.ts 中：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> logout <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> RootThunkAction <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>dispatch<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">&#39;login/logout&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">clearToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>reducers/login.ts 中：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> <span class="token function-variable function">login</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token keyword">case</span> <span class="token string">&#39;login/logout&#39;</span><span class="token operator">:</span>
      <span class="token keyword">return</span> initialState<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_36-封装鉴权路由组件" tabindex="-1"><a class="header-anchor" href="#_36-封装鉴权路由组件" aria-hidden="true">#</a> 36-封装鉴权路由组件</h2><p><strong>目标</strong>：能够封装鉴权路由组件实现登录访问控制功能</p><p><strong>步骤</strong>：</p><ol><li>在 components 目录中创建 AuthRoute 路由组件</li><li>在 AuthRoute 组件中，实现路由的登录访问控制逻辑</li><li>未登录时，重定向到登录页面，并传递要访问的路由地址</li><li>登录时，直接渲染要访问的路由</li></ol><p><strong>核心代码</strong>：</p><p>components/AuthRoute.tsx 中：</p><div class="language-tsx ext-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token comment">// AuthRoute 组件的使用，与 路由自己的 Route 组件用法相同</span>
<span class="token comment">// 也就是说：Route 能够接受什么属性，AuthRoute 组件也能够接受什么属性</span>
<span class="token comment">// &lt;Route path=&quot;&quot; component={Home} /&gt;</span>


<span class="token keyword">import</span> <span class="token punctuation">{</span> logout <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/store/actions/login&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> isAuth <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/utils/token&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useDispatch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react-redux&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Route<span class="token punctuation">,</span> Redirect<span class="token punctuation">,</span> RouteProps<span class="token punctuation">,</span> useLocation <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react-router-dom&#39;</span><span class="token punctuation">;</span>


<span class="token comment">/*
  &lt;Route path=&quot;&quot;&gt;
    &lt;Home /&gt;
  &lt;/Route&gt;


  注意：此处的 children 就是 &lt;Home /&gt;，也就是一个渲染好的组件了
      所以，此处，直接返回 children 即可。因为已经渲染过了内容，所以，此处不需要再通过标签来渲染了
*/</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">AuthRoute</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> children<span class="token punctuation">,</span> <span class="token operator">...</span>rest <span class="token punctuation">}</span><span class="token operator">:</span> RouteProps<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> location <span class="token operator">=</span> <span class="token function">useLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> dispatch <span class="token operator">=</span> <span class="token function">useDispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>Route
      <span class="token punctuation">{</span><span class="token operator">...</span>rest<span class="token punctuation">}</span>
      render<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> isLogin <span class="token operator">=</span> <span class="token function">isAuth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>isLogin<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 登录</span>
          <span class="token keyword">return</span> children<span class="token punctuation">;</span>
          <span class="token comment">// return &lt;Home /&gt;</span>
        <span class="token punctuation">}</span>


        <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 未登录</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Redirect</span></span>
            <span class="token attr-name">to</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
              pathname<span class="token operator">:</span> <span class="token string">&#39;/login&#39;</span><span class="token punctuation">,</span>
              state<span class="token operator">:</span> <span class="token punctuation">{</span>
                from<span class="token operator">:</span> location<span class="token punctuation">.</span>pathname<span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
          <span class="token punctuation">/&gt;</span></span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>App.tsx 中：</p><div class="language-tsx ext-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> AuthRoute <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./components/AuthRoute&#39;</span><span class="token punctuation">;</span>


<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token comment">// ...</span>
    <span class="token comment">// 此处，通过 children 来指定要渲染的组件</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">AuthRoute</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/profile/edit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ProfileEdit</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">AuthRoute</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>pages/Layout/index.tsx 中：</p><div class="language-tsx ext-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> AuthRoute <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/components/AuthRoute&#39;</span><span class="token punctuation">;</span>


<span class="token keyword">const</span> <span class="token function-variable function">Layout</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token comment">// ...</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">AuthRoute</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/home/profile<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Profile</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Profile</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">AuthRoute</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_37-登录时跳转到相应页面" tabindex="-1"><a class="header-anchor" href="#_37-登录时跳转到相应页面" aria-hidden="true">#</a> 37-登录时跳转到相应页面</h2><p><strong>目标</strong>：能够在登录时根据重定向路径跳转到相应页面</p><p><strong>步骤</strong>：</p><ol><li>在 Login 组件中导入 useLocation 来获取路由重定向时传入的 state</li><li>调用 useLocation hook 时，指定 state 的类型</li><li>登录完成跳转页面时，判断 state 是否存在</li><li>如果存在，跳转到 state 指定的页面</li><li>如果不存在，默认跳转到首页</li></ol><p><strong>核心代码</strong>：</p><p>pages/Login/index.tsx 中：</p><div class="language-tsx ext-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useLocation <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react-router-dom&#39;</span><span class="token punctuation">;</span>


<span class="token keyword">const</span> <span class="token function-variable function">Login</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 注意： state 可能是不存在的，所以，类型中要明确包含不存在的情况，即 undefined</span>
  <span class="token keyword">const</span> location <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useLocation</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token punctuation">{</span> from<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


  <span class="token keyword">const</span> <span class="token function-variable function">onFinish</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>values<span class="token operator">:</span> LoginForm<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    Toast<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token function-variable function">afterClose</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>location<span class="token punctuation">.</span>state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> history<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>location<span class="token punctuation">.</span>state<span class="token punctuation">.</span>from<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>


        history<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&#39;/home/index&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>补充：Route 组件的 component 和 children 的区别</p><div class="language-tsx ext-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token comment">// 1 使用 component 属性来配置路由</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/home<span class="token punctuation">&quot;</span></span> <span class="token attr-name">component</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>Home<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span>


<span class="token comment">// 2 使用 children 属性来配置路由</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/home<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
	</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Home</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Route</span></span><span class="token punctuation">&gt;</span></span>


<span class="token comment">// 以上两种方式的区别：</span>
<span class="token comment">// 相同点：都可以用来配置路由</span>
<span class="token comment">// 不同点：</span>
<span class="token comment">//	1 component： 该方式，我们只是把要渲染的组件传递给了 Route 组件，是 Route 组件内部来渲染了组件</span>
<span class="token comment">//	2 children：  该方式，是我们自己手动渲染的组件（&lt;Home /&gt;）</span>
<span class="token comment">//	对于 Route 组件来说，如果使用了 component 形式，路由会自动将路由信息通过 props 来传递给组件</span>
<span class="token comment">//										如果使用了 children 形式，路由不会通过 props 来传递路由信息</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>补充：Route 如何通过 component/children 来为组件传递了路由信息（属性）？</p><ul><li><a href="https://zh-hans.reactjs.org/docs/react-api.html#isvalidelement" target="_blank" rel="noopener noreferrer">React.cloneElement() API 文档<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><div class="language-tsx ext-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token comment">// &lt;MyRoute path=&quot;/home&quot; component={Home} /&gt;</span>
<span class="token keyword">const</span> <span class="token function-variable function">MyRoute</span> <span class="token operator">=</span> <span class="token punctuation">(</span>component<span class="token operator">:</span> Component<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Component</span></span> <span class="token spread"><span class="token punctuation">{</span><span class="token operator">...</span>路由信息<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token comment">/*
	&lt;MyRoute&gt;
  	&lt;Layout /&gt;
  &lt;/MyRoute&gt;
*/</span>
<span class="token keyword">const</span> <span class="token function-variable function">MyRoute</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> children <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 通过 React.cloneElement() 方法来为 children 传递属性</span>
  <span class="token comment">// 最终，Layout 组件中，就可以通过 props 来接收到传递的数据了</span>
  <span class="token keyword">return</span> React<span class="token punctuation">.</span><span class="token function">cloneElement</span><span class="token punctuation">(</span>children<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    b<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>路由信息<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token comment">/*
&lt;MyRoute path=&quot;/home&quot;&gt;
	&lt;Home /&gt;
&lt;/MyRoute&gt;
*/</span>
<span class="token comment">// 注意：这种写法是错误的，因为 children 不是一个组件名称，所以，不能当做标签来渲染</span>
<span class="token comment">// const MyRoute = (children: Children) =&gt; {</span>
<span class="token comment">//   return &lt;Children /&gt;</span>
<span class="token comment">// }</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="_38-理解无感刷新-token" tabindex="-1"><a class="header-anchor" href="#_38-理解无感刷新-token" aria-hidden="true">#</a> 38-理解无感刷新 token</h2><p><strong>目标</strong>：能够理解什么是无感刷新 token</p><p><strong>分析说明</strong>：</p><p>一般情况下，我们用到的移动端的 App（比如，微信）只要登录过一次，一般就不需要再次重新登录，除非很长时间没有使用过 App。 这是如何做到的呢？这就用到我们要讲的无感刷新 token 了。</p><p>我们知道，登录时会拿到一个登录成功的标识 token（身份令牌），有了这个令牌就可以进行登录后的操作了，比如，获取个人资料、修改个人信息等等 但是，为了安全，登录标识 token 一般都是有有效期的，比如，咱们的极客园项目中 token 的有效期是 2 个小时。 如果不进行额外的处理，登录 2 小时以后，就得再次登录。但是，这种用户体验不好，特别是移动端（不管是 App 还是 H5）。 相对来说，更好的用户体验是前面提到的微信的那种方式。它的原理简单来说是这样的：</p><p>在登录时，同时拿到两个 token：</p><p>1 登录成功的令牌：<code>token</code>2 刷新 token 的令牌：<code>refresh_token</code></p><p>刷新 token 的令牌用来：在 token 过期后，换取新的 token（续费），从而实现“永久登录”效果。 这就是所谓的：<strong>无感刷新 token</strong>。</p><h2 id="_39-实现无感刷新-token-换取新的-token" tabindex="-1"><a class="header-anchor" href="#_39-实现无感刷新-token-换取新的-token" aria-hidden="true">#</a> 39-实现无感刷新 token-换取新的 token</h2><p><strong>目标</strong>：能够实现无感刷新 token 实现自动登录</p><p><strong>分析说明</strong>：</p><p>概述：在登录超时或者 token 失效时，也就是服务器接口返回 401，通过 refresh_token 换取新的 token 过程如下（以获取个人资料数据为例）：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>【1】发送请求获取个人资料数据
【2】接口返回 401，也就是 token 失效了
【3】在响应拦截器中统一处理，换取新的 token
【4】将新的 token 存储到本地缓存中
【5】**继续发送获取个人资料的请求，完成数据获取** - 关键点
【6】如果整个过程中出现了任意异常，一般来说就是 refresh_token 也过期了，换取 token 失败，此时，要进行错误处理，也就是： 清除 token，跳转到登录页面
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>axios 请求拦截过程说明：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>1 axios.get()
2 请求拦截器
3 响应代码
4 响应拦截器


以上 4 个步骤的执行顺序：


【1 axios.get()】 --&gt; 【2 请求拦截器】&gt;&gt;&gt; 服务器处理 &gt;&gt;&gt; 【4 响应拦截器】 --&gt; 【3 响应代码】
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>步骤</strong>：</p><ol><li>使用 try-catch 处理异常，出现异常时，清除 token，清空 redux token，跳转到登录页面</li><li>判断本地存储中，是否有 <code>refresh_token</code></li><li>如果没有，直接跳转到登录页面，让用户登录即可</li><li>如果有，就使用 <code>refresh_token</code> 通过 <strong>axios 发送请求</strong>，换取新的 token</li><li>将新获取到的 token 存储到本地缓存中和 redux 中</li><li>继续发送原来的请求</li></ol><p><strong>核心代码</strong>：</p><p>utils/http.ts 中：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// 响应拦截器</span>
http<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>response<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 响应失败时，会执行此处的回调函数</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>error<span class="token punctuation">.</span>response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 网路超时</span>
    Toast<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      content<span class="token operator">:</span> <span class="token string">&#39;网络繁忙，请稍后再试&#39;</span><span class="token punctuation">,</span>
      duration<span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>


  <span class="token comment">// 在此处，通过 refresh_token 来换取新的 token</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">.</span>response<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">401</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token comment">// ...</span>
      <span class="token comment">// 先判断 redux 中是否有 refresh_token</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> refresh_token <span class="token punctuation">}</span> <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>login<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>refresh_token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// console.log(&#39;refresh_token 没有了&#39;)</span>
        <span class="token comment">// // 本地没有</span>
        <span class="token comment">// Toast.show({</span>
        <span class="token comment">//   content: &#39;登录超时，请重新登录&#39;,</span>
        <span class="token comment">//   duration: 1000,</span>
        <span class="token comment">//   afterClose: () =&gt; {</span>
        <span class="token comment">//     customHistory.push(&#39;/login&#39;, {</span>
        <span class="token comment">//       from: customHistory.location.pathname</span>
        <span class="token comment">//     })</span>
        <span class="token comment">//   }</span>
        <span class="token comment">// })</span>


        <span class="token comment">// return Promise.reject(error)</span>


        <span class="token comment">// 1 手动抛出异常</span>
        <span class="token comment">// throw new Error(error)</span>


        <span class="token comment">// 2 因为 try-catch 无法直接捕获 Promise 的异常，所以，此处</span>
        <span class="token comment">//   通过 await 等待 Promise 完成。然后，try-catch 就可以</span>
        <span class="token comment">//   捕获到该异常了</span>
        <span class="token keyword">await</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>


      <span class="token comment">// 有 refresh_token，就用 refresh_token 换取新的 token</span>
      <span class="token comment">// 注意：</span>
      <span class="token comment">//  1 此处需要使用 axios 发请求</span>
      <span class="token comment">//  2 因为使用的是 axios 所以，此处需要指定完整的 接口路径</span>
      <span class="token comment">//  3 对于 put 请求来来说，第 3 个参数才表示配置项，才能够设置 请求头</span>
      <span class="token comment">//  4 此处的请求头用的是 refresh_token 而不是 token</span>
      <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>baseURL<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/authorizations</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        headers<span class="token operator">:</span> <span class="token punctuation">{</span>
          Authorization<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Bearer </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>refresh_token<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


      <span class="token comment">// console.log(res)</span>
      <span class="token comment">// 使用新拿到的 token 替换本地的 token 以及 redux 中的 token</span>
      <span class="token comment">// 组装所有 token</span>
      <span class="token keyword">const</span> tokens <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token comment">// token 是最新的，接口返回的</span>
        token<span class="token operator">:</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>data<span class="token punctuation">.</span>token<span class="token punctuation">,</span>
        <span class="token comment">// 因为接口没有返回新的 refresh_token，所以，需要使用原来的</span>
        refresh_token<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token function">setToken</span><span class="token punctuation">(</span>tokens<span class="token punctuation">)</span><span class="token punctuation">;</span>
      store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">&#39;login/token&#39;</span><span class="token punctuation">,</span> payload<span class="token operator">:</span> tokens <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


      <span class="token comment">// 继续完成原来要执行的操作</span>
      <span class="token comment">// 比如，在获取个人资料时，token 超时了，最终，在拿到最新的 token 后</span>
      <span class="token comment">//      要继续获取个人资料</span>
      <span class="token comment">// console.dir(error)</span>
      <span class="token comment">// 可以通过 error.config 来拿到原来发送的请求的相关信息</span>
      <span class="token comment">// 所以，要执行原来的操作，只需要将 error.config 重新请求一次即可</span>
      <span class="token comment">// 注意：此处，一定要返回 Promise 的结果</span>
      <span class="token keyword">return</span> <span class="token function">http</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 如果换取新 token 的过程中，代码出错了，一般就说明 refresh_token 失效了</span>
      <span class="token comment">// 此时，就清空token然后返回登录页面</span>
      <span class="token comment">// 注意：在直接分发 thunk action 时，会报类型错误</span>
      <span class="token comment">// store.dispatch(logout())</span>
      <span class="token comment">// 解决方式：先自己手动分发对象形式的 action 来实现退出</span>
      store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">&#39;login/logout&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 手动清理本地的 token</span>
      <span class="token function">clearToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


      Toast<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        content<span class="token operator">:</span> <span class="token string">&#39;登录超时，请重新登录&#39;</span><span class="token punctuation">,</span>
        duration<span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>
        <span class="token function-variable function">afterClose</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          customHistory<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&#39;/login&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            from<span class="token operator">:</span> customHistory<span class="token punctuation">.</span>location<span class="token punctuation">.</span>pathname<span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


      <span class="token keyword">return</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/vuepress-theme-hope/vuepress-theme-hope/edit/main/demo/src/react课程/05-react-极客园移动端/📚极客园M-4【个人中心】.md" rel="noopener noreferrer" target="_blank" aria-label="编辑此页" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item update-time"><span class="label">上次编辑于: </span><span class="info">2022/5/22 10:16:09</span></div><div class="meta-item contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: wxh199311@outlook.com">武晓慧</span><!--]--><!--]--></div></footer><nav class="page-nav"><a href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-3%E3%80%90%E5%B8%83%E5%B1%80%E9%A1%B5%E9%9D%A2%E3%80%91.html" class="nav-link prev" aria-label="📚极客园M-3【布局页面】"><div class="hint"><span class="arrow left"></span>上一页</div><div class="link"><!---->📚极客园M-3【布局页面】</div></a><a href="/react%E8%AF%BE%E7%A8%8B/05-react-%E6%9E%81%E5%AE%A2%E5%9B%AD%E7%A7%BB%E5%8A%A8%E7%AB%AF/%F0%9F%93%9A%E6%9E%81%E5%AE%A2%E5%9B%ADM-5%E3%80%90%E9%A6%96%E9%A1%B5%E3%80%91.html" class="nav-link next" aria-label="📚极客园M-5【首页】"><div class="hint">下一页<span class="arrow right"></span></div><div class="link">📚极客园M-5【首页】<!----></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer">黑马程序员</div><div class="copyright">Copyright © 2022 武晓慧</div></footer><!--]--></div><!--]--><!----><!----><!--]--></div>
    <script type="module" src="/assets/app.88f692a7.js" defer></script>
  </body>
</html>
